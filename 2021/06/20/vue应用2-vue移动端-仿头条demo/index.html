<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>vue应用2-vue移动端-仿头条demo | Abigail Cui的小站</title><meta name="keywords" content="Vue应用,Vue"><meta name="author" content="Abigail Cui"><meta name="copyright" content="Abigail Cui"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、项目初始化 目标  能使用 Vue CLI 创建项目 了解 Vant 组件库的导入方式 掌握制作使用字体图标的方式 掌握如何在 Vue 项目中处理 REM 适配 理解 axios 请求模块的封装   使用 Vue CLI 创建项目 如果你还没有安装 VueCLI，请执行下面的命令安装或是升级： 1npm install --global @vue&#x2F;cli  在命令行中输入以下命令创建 Vue">
<meta property="og:type" content="article">
<meta property="og:title" content="vue应用2-vue移动端-仿头条demo">
<meta property="og:url" content="https://www.abigailcui.com/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/index.html">
<meta property="og:site_name" content="Abigail Cui的小站">
<meta property="og:description" content="一、项目初始化 目标  能使用 Vue CLI 创建项目 了解 Vant 组件库的导入方式 掌握制作使用字体图标的方式 掌握如何在 Vue 项目中处理 REM 适配 理解 axios 请求模块的封装   使用 Vue CLI 创建项目 如果你还没有安装 VueCLI，请执行下面的命令安装或是升级： 1npm install --global @vue&#x2F;cli  在命令行中输入以下命令创建 Vue">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.abigailcui.com/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/%E9%A6%96%E9%A1%B5.png">
<meta property="article:published_time" content="2021-06-20T07:04:15.000Z">
<meta property="article:modified_time" content="2021-09-09T19:10:44.891Z">
<meta property="article:author" content="Abigail Cui">
<meta property="article:tag" content="Vue应用">
<meta property="article:tag" content="Vue">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.abigailcui.com/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/%E9%A6%96%E9%A1%B5.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.abigailcui.com/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'vue应用2-vue移动端-仿头条demo',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-10 03:10:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/custom.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/todo-List/index.html#/myday"><i class="fa-fw fas fa-clock"></i><span> ToDo-List</span></a></li><li><a class="site-page child" href="/te/"><i class="fa-fw fas fa-envelope"></i><span> 疫情地图</span></a></li><li><a class="site-page child" href="/catch-cat-master/index.html"><i class="fa-fw fas fa-spin"></i><span> 小游戏</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/%E9%A6%96%E9%A1%B5.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Abigail Cui的小站</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/todo-List/index.html#/myday"><i class="fa-fw fas fa-clock"></i><span> ToDo-List</span></a></li><li><a class="site-page child" href="/te/"><i class="fa-fw fas fa-envelope"></i><span> 疫情地图</span></a></li><li><a class="site-page child" href="/catch-cat-master/index.html"><i class="fa-fw fas fa-spin"></i><span> 小游戏</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">vue应用2-vue移动端-仿头条demo</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-06-20T07:04:15.000Z" title="发表于 2021-06-20 15:04:15">2021-06-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-09-09T19:10:44.891Z" title="更新于 2021-09-10 03:10:44">2021-09-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Vue/">Vue</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">29.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>125分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="vue应用2-vue移动端-仿头条demo"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一、项目初始化"><a href="#一、项目初始化" class="headerlink" title="一、项目初始化"></a>一、项目初始化</h1><blockquote>
<p>目标</p>
<ul>
<li>能使用 Vue CLI 创建项目</li>
<li>了解 Vant 组件库的导入方式</li>
<li>掌握制作使用字体图标的方式</li>
<li>掌握如何在 Vue 项目中处理 REM 适配</li>
<li>理解 axios 请求模块的封装</li>
</ul>
</blockquote>
<h2 id="使用-Vue-CLI-创建项目"><a href="#使用-Vue-CLI-创建项目" class="headerlink" title="使用 Vue CLI 创建项目"></a>使用 Vue CLI 创建项目</h2><blockquote>
<p>如果你还没有安装 VueCLI，请执行下面的命令安装或是升级：</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --global @vue/cli</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>在命令行中输入以下命令创建 Vue 项目：</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create toutiao-m</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.2.3</span><br><span class="line">? Please pick a preset:</span><br><span class="line">  default (babel, eslint)</span><br><span class="line">&gt; Manually select features</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>default：默认勾选 babel、eslint，回车之后直接进入装包</p>
<p>manually：自定义勾选特性配置，选择完毕之后，才会进入装包</p>
<p>选择第 2 种：手动选择特性，支持更多自定义选项</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">? Please pick a preset: Manually select features</span><br><span class="line">? Check the features needed for your project:</span><br><span class="line"> (*) Babel</span><br><span class="line"> ( ) TypeScript</span><br><span class="line"> ( ) Progressive Web App (PWA) Support</span><br><span class="line"> (*) Router</span><br><span class="line"> (*) Vuex</span><br><span class="line"> (*) CSS Pre-processors</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">(*) Linter / Formatter</span></span><br><span class="line"> ( ) Unit Testing</span><br><span class="line"> ( ) E2E Testing</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>分别选择：<br>Babel：es6 转 es5<br>Router：路由<br>Vuex：数据容器，存储共享数据<br>CSS Pre-processors：CSS 预处理器，后面会提示你选择 less、sass、stylus 等<br>Linter / Formatter：代码格式校验</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? Use history mode for router? (Requires proper server setup for index fallback in production) (Y/n) n</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>是否使用 history 路由模式，这里输入 n 不使用</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default):</span><br><span class="line">  Sass/SCSS (with dart-sass)</span><br><span class="line">  Sass/SCSS (with node-sass)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Less</span></span><br><span class="line">  Stylus</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>选择 CSS 预处理器，这里选择我们熟悉的 Less</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">? Pick a linter / formatter config:</span><br><span class="line">  ESLint with error prevention only</span><br><span class="line">  ESLint + Airbnb config</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ESLint + Standard config</span></span><br><span class="line">  ESLint + Prettier</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>选择校验工具，这里选择 ESLint + <a target="_blank" rel="noopener" href="https://standardjs.com/">Standard config</a></p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">? Pick additional lint features:</span><br><span class="line"> (*) Lint on save</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">(*) Lint and fix on commit</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>选择在什么时机下触发代码格式校验：</p>
<ul>
<li>Lint on save：每当保存文件的时候</li>
<li>Lint and fix on commit：每当执行 <code>git commit</code> 提交的时候</li>
</ul>
</blockquote>
<p>这里建议两个都选上，更严谨。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">? Where do you prefer placing config for Babel, ESLint, etc.? (Use arrow keys)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> In dedicated config files</span></span><br><span class="line">  In package.json</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Babel、ESLint 等工具会有一些额外的配置文件，这里的意思是问你将这些工具相关的配置文件写到哪里：</p>
<ul>
<li>In dedicated config files：分别保存到单独的配置文件</li>
<li>In package.json：保存到 package.json 文件中</li>
</ul>
</blockquote>
<p>这里建议选择第 1 个，保存到单独的配置文件，这样方便我们做自定义配置。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? Save this as a preset for future projects? (y/N) N</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>这里里是问你是否需要将刚才选择的一系列配置保存起来，然后它可以帮你记住上面的一系列选择，以便下次直接重用。</p>
</blockquote>
<blockquote>
<p>这里根据自己需要输入 y 或者 n，我这里输入 n 不需要。</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">✨  Creating project in C:\Users\LPZ\Desktop\topline-m-fe89\topline-m-89.</span><br><span class="line">�  Initializing git repository...</span><br><span class="line">⚙  Installing CLI plugins. This might take a while...</span><br><span class="line"></span><br><span class="line">[          ........] - extract:object-keys: sill extract json5@2.1.1</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>向导配置结束，开始装包。<br>安装包的时间可能较长，请耐心等待……</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">⚓  Running completion hooks...</span><br><span class="line"></span><br><span class="line">�  Generating README.md...</span><br><span class="line"></span><br><span class="line">�  Successfully created project topline-m-89.</span><br><span class="line">�  Get started with the following commands:</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"> $</span><span class="bash"> <span class="built_in">cd</span> topline-m</span></span><br><span class="line"><span class="meta"> $</span><span class="bash"> npm run serve</span></span><br></pre></td></tr></tbody></table></figure>
<p>安装结束，命令提示你项目创建成功，按照命令行的提示在终端中分别输入：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入你的项目目录</span></span><br><span class="line">cd toutiao-webapp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动开发服务</span></span><br><span class="line">npm run serve</span><br></pre></td></tr></tbody></table></figure>




<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DONE  Compiled successfully in 7527ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> App running at:</span><br><span class="line"> - Local:   http://localhost:8080/</span><br><span class="line"> - Network: http://192.168.10.216:8080/</span><br><span class="line"></span><br><span class="line"> Note that the development build is not optimized.</span><br><span class="line"> To create a production build, run npm run build.</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>启动成功，命令行中输出项目的 http 访问地址。<br>打开浏览器，输入其中任何一个地址进行访问。</p>
</blockquote>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1582010300149-9932febe-2625-4ee7-986f-9190ab449fec.png" alt="image.png"></p>
<p>如果能看到该页面，恭喜你，项目创建成功了。</p>
<h2 id="加入-Git-版本管理"><a href="#加入-Git-版本管理" class="headerlink" title="加入 Git 版本管理"></a>加入 Git 版本管理</h2><p>几个好处：</p>
<ul>
<li>代码备份</li>
<li>多人协作</li>
<li>历史记录</li>
<li>…</li>
</ul>
<p>（1）创建远程仓库</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/lipengzhou">GitHub</a></li>
<li><a target="_blank" rel="noopener" href="https://gitee.com/">码云</a></li>
<li><a target="_blank" rel="noopener" href="https://coding.net/">Coding</a></li>
<li>…</li>
</ul>
<p>（2）将本地仓库推到线上</p>
<p>如果没有本地仓库。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建本地仓库</span></span><br><span class="line">git init</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将文件添加到暂存区</span></span><br><span class="line">git add 文件</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交历史记录</span></span><br><span class="line">git commit "提交日志"</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加远端仓库地址</span></span><br><span class="line">git remote add origin 你的远程仓库地址</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送提交</span></span><br><span class="line">git push -u origin master</span><br></pre></td></tr></tbody></table></figure>

<p>如果已有本地仓库（Vue CLI 已经帮我们初始化好了）。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加远端仓库地址</span></span><br><span class="line">git remote add origin 你的远程仓库地址</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送提交</span></span><br><span class="line">git push -u origin master</span><br></pre></td></tr></tbody></table></figure>

<p>如果之后项目代码有了变动需要提交：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add</span><br><span class="line">git commit</span><br><span class="line">git push</span><br></pre></td></tr></tbody></table></figure>

<h2 id="调整初始目录结构"><a href="#调整初始目录结构" class="headerlink" title="调整初始目录结构"></a>调整初始目录结构</h2><p>默认生成的目录结构不满足我们的开发需求，所以这里需要做一些自定义改动。</p>
<p>这里主要就是下面的两个工作：</p>
<ul>
<li>删除初始化的默认文件</li>
<li>新增调整我们需要的目录结构</li>
</ul>
<p>1、将 <code>App.vue</code> 修改为</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>黑马头条<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'App'</span></span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、将 <code>router/index.js</code> 修改为</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter({</span><br><span class="line">  routes</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>3、删除</p>
<ul>
<li>src/views/About.vue</li>
<li>src/views/Home.vue</li>
<li>src/components/HelloWorld.vue</li>
<li>src/assets/logo.png</li>
</ul>
<p>4、创建以下几个目录</p>
<ul>
<li>src/api 目录<ul>
<li>存储接口封装</li>
</ul>
</li>
<li>src/utils 目录<ul>
<li>存储一些工具模块</li>
</ul>
</li>
<li>src/styles 目录<ul>
<li>index.less 文件，存储全局样式</li>
<li>在 <code>main.js</code> 中加载全局样式 <code>import './styles/index.less'</code></li>
</ul>
</li>
</ul>
<p>调整之后的目录结构如下。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.                                 </span><br><span class="line">├── README.md                     </span><br><span class="line">├── babel.config.js               </span><br><span class="line">├── package-lock.json             </span><br><span class="line">├── package.json                  </span><br><span class="line">├── public                        </span><br><span class="line">│   ├── favicon.ico               </span><br><span class="line">│   └── index.html                </span><br><span class="line">└── src                           </span><br><span class="line">    ├── api</span><br><span class="line">    ├── App.vue                   </span><br><span class="line">    ├── assets                    </span><br><span class="line">    ├── components                </span><br><span class="line">    ├── main.js                   </span><br><span class="line">    ├── router</span><br><span class="line">    ├── utils</span><br><span class="line">    ├── styles</span><br><span class="line">    ├── store                     </span><br><span class="line">    └── views</span><br></pre></td></tr></tbody></table></figure>



<h2 id="导入图标素材"><a href="#导入图标素材" class="headerlink" title="导入图标素材"></a>导入图标素材</h2><p>设计师为我们单独提供了设计稿中的图标，为了方便使用，我们在这里把它制作为字体图标。</p>
<p>制作字体图标的工具有很多，在这里我们推荐大家使用：<a target="_blank" rel="noopener" href="https://www.iconfont.cn/%E3%80%82">https://www.iconfont.cn/。</a></p>
<p>一、注册账户</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325004756766.png" alt="image-20200325004756766"></p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325004912687.png" alt="image-20200325004912687"></p>
<blockquote>
<p>直接选择第三方登录即可</p>
</blockquote>
<p>二、创建项目</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325005117323.png" alt="image-20200325005117323"></p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325005648620.png" alt="image-20200325005648620"></p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325010034390.png" alt="image-20200325010034390"></p>
<p>三、上传图标到项目</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325010119980.png" alt="image-20200325010119980"></p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325010201945.png" alt="image-20200325010201945"></p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325010254398.png" alt="image-20200325010254398"></p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325010413448.png" alt="image-20200325010413448"></p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325010439802.png" alt="image-20200325010439802"></p>
<p>四、生成链接</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200325010505302.png" alt="image-20200325010505302"></p>
<p>五、配置到项目中使用</p>
<p>一种方式是<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/cookbook/editable-svg-icons.html">将 SVG 图标 包装为 Vue 组件来使用</a>。</p>
<p>一种方式是将 SVG 制作为字体图标来使用：</p>
<h2 id="引入-Vant-组件库"><a href="#引入-Vant-组件库" class="headerlink" title="引入 Vant 组件库"></a>引入 Vant 组件库</h2><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1582010382780-c25b1af8-ce6d-438e-a6d5-009cd426b927.png" alt="image.png" style="zoom:25%;">



<p>Vant 是有赞商城前端开发团队开发的一个基于 Vue.js 的移动端组件库，它提供了非常丰富的移动端功能组件，简单易用。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/">官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/youzan/vant">GitHub 仓库</a></li>
</ul>
<p>下面是在 Vant 官网中列出的一些优点：</p>
<ul>
<li>60+ 高质量组件</li>
<li>90% 单元测试覆盖率</li>
<li>完善的中英文文档和示例</li>
<li>支持按需引入</li>
<li>支持主题定制</li>
<li>支持国际化</li>
<li>支持 TS</li>
<li>支持 SSR</li>
</ul>
<p>在我们的项目中主要使用 Vant 作为核心组件库，下面我们根据<a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/quickstart#yin-ru-zu-jian">官方文档</a>将 Vant 导入项目中。</p>
<p>将 Vant 引入项目一共有四种方式：</p>
<ul>
<li><p>方式一：自动按需引入组件</p>
<ul>
<li>和方式二一样，都是按需引入，但是加载更方便一些（需要额外配置插件）</li>
<li>优点：打包体积小</li>
<li>缺点：每个组件在使用之前都需要手动加载注册</li>
</ul>
</li>
<li><p>方式二：手动按需引入组件</p>
<ul>
<li>在不使用插件的情况下，可以手动引入需要的组件</li>
<li>优点：打包体积小</li>
<li>缺点：每个组件在使用之前都需要手动加载注册</li>
</ul>
</li>
<li><p>方式三：导入所有组件</p>
<ul>
<li>Vant 支持一次性导入所有组件，引入所有组件会增加代码包体积，因此不推荐这种做法</li>
<li>优点：导入一次，使用所有</li>
<li>缺点：打包体积大</li>
</ul>
</li>
<li><p>方式四：通过 CDN 引入</p>
<ul>
<li>使用 Vant 最简单的方法是直接在 html 文件中引入 CDN 链接，之后你可以通过全局变量<code>vant</code>访问到所有组件。</li>
<li>优点：适合一些演示、示例项目，一个 html 文件就可以跑起来</li>
<li>缺点：不适合在模块化系统中使用</li>
</ul>
</li>
</ul>
<p>这里建议为了前期开发的便利性我们选择方式三：导入所有组件，在最后做打包优化的时候根据需求配置按需加载以降低打包体积大小。</p>
<p>1、安装 Vant</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vant</span><br></pre></td></tr></tbody></table></figure>

<p>2、在 <code>main.js</code> 中加载注册 Vant 组件</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vant <span class="keyword">from</span> <span class="string">'vant'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'vant/lib/index.css'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vant)</span><br></pre></td></tr></tbody></table></figure>

<p>3、查阅文档使用组件</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1582017539392-6c48b63f-8e8b-4ef2-b4fa-ddeb059cec04.png" alt="image.png"></p>
<blockquote>
<p>Vant 的文档非常清晰，左侧是组件目录导航，中间是效果代码，右边是效果预览。</p>
</blockquote>
<p>例如我们在根组件使用 Vant 中的组件：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">"default"</span>&gt;</span>默认按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>主要按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">"info"</span>&gt;</span>信息按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">"warning"</span>&gt;</span>警告按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">"danger"</span>&gt;</span>危险按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"单元格"</span> <span class="attr">value</span>=<span class="string">"内容"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"单元格"</span> <span class="attr">value</span>=<span class="string">"内容"</span> <span class="attr">label</span>=<span class="string">"描述信息"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200227231037762.png" alt="image-20200227231037762" style="zoom:50%;">

<blockquote>
<p>如果在页面中能够正常的看到下面的效果，则说明 Vant 导入成功了。</p>
</blockquote>
<h2 id="移动端-REM-适配"><a href="#移动端-REM-适配" class="headerlink" title="移动端 REM 适配"></a>移动端 REM 适配</h2><p>Vant 中的样式默认使用 <code>px</code> 作为单位，如果需要使用 <code>rem</code> 单位，推荐使用以下两个工具：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/cuth/postcss-pxtorem">postcss-pxtorem</a> 是一款 postcss 插件，用于将单位转化为 rem</li>
<li><a target="_blank" rel="noopener" href="https://github.com/amfe/lib-flexible">lib-flexible</a> 用于设置 rem 基准值</li>
</ul>
<p>下面我们分别将这两个工具配置到项目中完成 REM 适配。</p>
<p><strong>一、使用 <a target="_blank" rel="noopener" href="https://github.com/amfe/lib-flexible">lib-flexible</a> 动态设置 REM 基准值（html 标签的字体大小）</strong></p>
<p>1、安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yarn add amfe-flexible</span></span><br><span class="line">npm i amfe-flexible</span><br></pre></td></tr></tbody></table></figure>

<p>2、然后在 <code>main.js</code> 中加载执行该模块</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'amfe-flexible'</span></span><br></pre></td></tr></tbody></table></figure>

<p>最后测试：在浏览器中切换不同的手机设备尺寸，观察 html 标签 <code>font-size</code> 的变化。</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1582034718723-500ef407-af66-4770-8fdd-33d0fc3ef9ed.png" alt="image.png"></p>
<blockquote>
<p>例如在 iPhone 6/7/8 设备下，html 标签字体大小为 37.5 px</p>
</blockquote>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1582034950176-868d5875-3496-45d3-8a61-e556e1cc1f90.png" alt="image.png"></p>
<blockquote>
<p>例如在 iPhone 6/7/8 Plus 设备下，html 标签字体大小为 41.4 px</p>
</blockquote>
<p><strong>二、使用 <a target="_blank" rel="noopener" href="https://github.com/cuth/postcss-pxtorem">postcss-pxtorem</a> 将 <code>px</code> 转为 <code>rem</code></strong></p>
<p>1、安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yarn add -D postcss-pxtorem</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -D 是 --save-dev 的简写</span></span><br><span class="line">npm install postcss-pxtorem -D</span><br></pre></td></tr></tbody></table></figure>

<p>2、然后在<strong>项目根目录</strong>中创建 <code>.postcssrc.js</code> 文件</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  <span class="attr">plugins</span>: {</span><br><span class="line">    <span class="string">'autoprefixer'</span>: {</span><br><span class="line">      <span class="attr">browsers</span>: [<span class="string">'Android &gt;= 4.0'</span>, <span class="string">'iOS &gt;= 8'</span>]</span><br><span class="line">    },</span><br><span class="line">    <span class="string">'postcss-pxtorem'</span>: {</span><br><span class="line">      <span class="attr">rootValue</span>: <span class="number">37.5</span>,</span><br><span class="line">      <span class="attr">propList</span>: [<span class="string">'*'</span>]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>3、<strong>配置完毕，重新启动服务</strong></p>
<p>最后测试：<strong>刷新浏览器页面</strong>，审查元素的样式查看是否已将 <code>px</code> 转换为 <code>rem</code>。</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1582035408807-1adb02e6-4576-48b6-8fb9-b3a0c57ead0d.png" alt="image.png"></p>
<blockquote>
<p>这是没有配置转换之前的。</p>
</blockquote>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1582035305177-d13c0a83-65bf-4fe5-a509-83bbb3bbf627.png" alt="image.png"></p>
<blockquote>
<p>这是转换之后的，可以看到 px 都被转换为了 rem。</p>
</blockquote>
<p><strong>需要注意的是：</strong></p>
<ul>
<li>该插件**不能转换行内样式中的 <code>px</code>**，例如 <code>&lt;div style="width: 200px;"&gt;&lt;/div&gt;</code></li>
</ul>
<h2 id="关于-postcssrc-js-配置文件"><a href="#关于-postcssrc-js-配置文件" class="headerlink" title="关于 .postcssrc.js 配置文件"></a>关于 <code>.postcssrc.js</code> 配置文件</h2><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  <span class="attr">plugins</span>: {</span><br><span class="line">    <span class="string">'autoprefixer'</span>: {</span><br><span class="line">      <span class="attr">browsers</span>: [<span class="string">'Android &gt;= 4.0'</span>, <span class="string">'iOS &gt;= 8'</span>]</span><br><span class="line">    },</span><br><span class="line">    <span class="string">'postcss-pxtorem'</span>: {</span><br><span class="line">      <span class="attr">rootValue</span>: <span class="number">37.5</span>,</span><br><span class="line">      <span class="attr">propList</span>: [<span class="string">'*'</span>]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><code>.postcssrc.js</code> 是 PostCSS 的配置文件。</p>
<p>（1）PostCSS 介绍</p>
<p><a target="_blank" rel="noopener" href="https://postcss.org/">PostCSS</a> 是一个处理 CSS 的处理工具，本身功能比较单一，它主要负责解析 CSS 代码，再交由插件来进行处理，它的插件体系非常强大，所能进行的操作是多种多样的，例如：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/postcss/autoprefixer">Autoprefixer</a> 插件可以实现自动添加浏览器相关的声明前缀</li>
<li><a target="_blank" rel="noopener" href="https://github.com/csstools/postcss-preset-env">PostCSS Preset Env</a> 插件可以让你使用更新的 CSS 语法特性并实现向下兼容</li>
<li><a target="_blank" rel="noopener" href="https://github.com/cuth/postcss-pxtorem">postcss-pxtorem</a> 可以实现将 px 转换为 rem</li>
<li>…</li>
</ul>
<p>目前 PostCSS 已经有 <a target="_blank" rel="noopener" href="https://github.com/postcss/postcss/blob/master/docs/plugins.md">200 多个功能各异的插件</a>。开发人员也可以根据项目的需要，开发出自己的 PostCSS 插件。</p>
<p>PostCSS 一般不单独使用，而是与已有的构建工具进行集成。</p>
<p><a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/css.html#postcss">Vue CLI 默认集成了 PostCSS</a>，并且默认开启了 <a target="_blank" rel="noopener" href="https://github.com/postcss/autoprefixer">autoprefixer</a> 插件。</p>
<blockquote>
<p>Vue CLI 内部使用了 PostCSS。</p>
<p>你可以通过 <code>.postcssrc</code> 或任何 <a target="_blank" rel="noopener" href="https://github.com/michael-ciniawsky/postcss-load-config">postcss-load-config</a> 支持的配置源来配置 PostCSS。也可以通过 <code>vue.config.js</code> 中的 <code>css.loaderOptions.postcss</code> 配置 <a target="_blank" rel="noopener" href="https://github.com/postcss/postcss-loader">postcss-loader</a>。</p>
<p>我们默认开启了 <a target="_blank" rel="noopener" href="https://github.com/postcss/autoprefixer">autoprefixer</a>。如果要配置目标浏览器，可使用 <code>package.json</code> 的 <a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/browser-compatibility.html#browserslist">browserslist</a> 字段。</p>
</blockquote>
<p>（2）Autoprefixer 插件的配置</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200319104557718.png" alt="image-20200319104557718"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/postcss/autoprefixer">autoprefixer</a> 是一个自动添加浏览器前缀的 PostCss 插件，<code>browsers</code> 用来配置兼容的浏览器版本信息，但是写在这里的话会引起编译器警告。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Replace Autoprefixer browsers option to Browserslist config.</span><br><span class="line">Use browserslist key in package.json or .browserslistrc file.</span><br><span class="line"></span><br><span class="line">Using browsers option can cause errors. Browserslist config</span><br><span class="line">can be used for Babel, Autoprefixer, postcss-normalize and other tools.</span><br><span class="line"></span><br><span class="line">If you really need to use option, rename it to overrideBrowserslist.</span><br><span class="line"></span><br><span class="line">Learn more at:</span><br><span class="line">https://github.com/browserslist/browserslist#readme</span><br><span class="line">https://twitter.com/browserslist</span><br></pre></td></tr></tbody></table></figure>

<p>警告意思就是说你应该将 <code>browsers</code> 选项写到 <code>package.json</code> 或 <code>.browserlistrc</code> 文件中。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Android]</span><br><span class="line">&gt;= 4.0</span><br><span class="line"></span><br><span class="line">[iOS]</span><br><span class="line">&gt;= 8</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>具体语法请<a target="_blank" rel="noopener" href="https://github.com/browserslist/browserslist">参考这里</a>。</p>
</blockquote>
<p>（3）postcss-pxtorem 插件的配置</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200319105610557.png" alt="image-20200319105610557"></p>
<ul>
<li><code>rootValue</code>：表示根元素字体大小，它会根据根元素大小进行单位转换</li>
<li><code>propList</code> 用来设定可以从 px 转为 rem 的属性<ul>
<li>例如 <code>*</code> 就是所有属性都要转换，<code>width</code> 就是仅转换 <code>width</code> 属性</li>
</ul>
</li>
</ul>
<p><code>rootValue</code> 应该如何设置呢？</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果你使用的是基于 lib-flexable 的 REM 适配方案，则应该设置为你的设计稿的十分之一。</span><br><span class="line">例如设计稿是 750 宽，则应该设置为 75。</span><br></pre></td></tr></tbody></table></figure>



<p>大多数设计稿的原型都是以 iphone6 为原型，iphone6 设备的宽是 750，我们的设计稿也是这样。</p>
<p>但是 Vant 建议设置为 37.5，为什么呢？</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为 Vant 是基于 375 写的，所以如果你设置为 75 的话，Vant 的样式就小了一半。</span><br></pre></td></tr></tbody></table></figure>

<p>所以如果设置为 <code>37.5</code> 的话，Vant 的样式是没有问题的，但是我们在测量设计稿的时候都必须除2才能使用，否则就会变得很大。</p>
<p>这样做其实也没有问题，但是有没有更好的办法呢？我就想实现测量多少写多少（不用换算）。于是聪明的你就想，可以不可以这样来做？</p>
<ul>
<li>如果是 Vant 的样式，就把 <code>rootValue</code> 设置为 37.5 来转换</li>
<li>如果是我们的样式，就按照 75 的 <code>rootValue</code> 来转换</li>
</ul>
<p>通过<a target="_blank" rel="noopener" href="https://github.com/cuth/postcss-pxtorem#options">查阅文档</a>我们可以看到 <code>rootValue</code> 支持两种参数类型：</p>
<ul>
<li>数字：固定值</li>
<li>函数：动态计算返回<ul>
<li>postcss-pxtorem 处理每个 CSS 文件的时候都会来调用这个函数</li>
<li>它会把被处理的 CSS 文件相关的信息通过参数传递给该函数</li>
</ul>
</li>
</ul>
<p>所以我们修改配置如下：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PostCSS 配置文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  <span class="comment">// 配置要使用的 PostCSS 插件</span></span><br><span class="line">  <span class="attr">plugins</span>: {</span><br><span class="line">    <span class="comment">// 配置使用 autoprefixer 插件</span></span><br><span class="line">    <span class="comment">// 作用：生成浏览器 CSS 样式规则前缀</span></span><br><span class="line">    <span class="comment">// VueCLI 内部已经配置了 autoprefixer 插件</span></span><br><span class="line">    <span class="comment">// 所以又配置了一次，所以产生冲突了</span></span><br><span class="line">    <span class="comment">// 'autoprefixer': { // autoprefixer 插件的配置</span></span><br><span class="line">    <span class="comment">//   // 配置要兼容到的环境信息</span></span><br><span class="line">    <span class="comment">//   browsers: ['Android &gt;= 4.0', 'iOS &gt;= 8']</span></span><br><span class="line">    <span class="comment">// },</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置使用 postcss-pxtorem 插件</span></span><br><span class="line">    <span class="comment">// 作用：把 px 转为 rem</span></span><br><span class="line">    <span class="string">'postcss-pxtorem'</span>: {</span><br><span class="line">      rootValue ({ file }) {</span><br><span class="line">        <span class="keyword">return</span> file.indexOf(<span class="string">'vant'</span>) !== -<span class="number">1</span> ? <span class="number">37.5</span> : <span class="number">75</span></span><br><span class="line">      },</span><br><span class="line">      <span class="attr">propList</span>: [<span class="string">'*'</span>]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>配置完毕，把服务重启一下，最后测试，very good。</p>
<h2 id="封装请求模块"><a href="#封装请求模块" class="headerlink" title="封装请求模块"></a>封装请求模块</h2><p>和之前项目一样，这里我们还是使用 <a target="_blank" rel="noopener" href="https://github.com/axios/axios">axios</a> 作为我们项目中的请求库，为了方便使用，我们把它封装为一个请求模块，在需要的时候直接加载即可。</p>
<p>1、安装 axios</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i axios</span><br></pre></td></tr></tbody></table></figure>

<p>2、创建 <code>src/utils/request.js</code></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装 axios 请求模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> request = axios.create({</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">"http://ttapi.research.itcast.cn/"</span> <span class="comment">// 基础路径</span></span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request</span><br></pre></td></tr></tbody></table></figure>

<p>3、如何使用</p>
<ul>
<li>方式一（简单方便，但是不利于接口维护）：我们可以把请求对象挂载到 <code>Vue.prototype</code> 原型对象中，然后在组件中通过 <code>this.xxx</code> 直接访问</li>
<li>方式二（推荐）：我们把每一个请求都封装成每个独立的功能函数，在需要的时候加载调用，这种做法更便于接口的管理和维护</li>
</ul>
<p>在我们的项目中建议使用方式二，更推荐（在随后的业务功能中我们就能学到）。</p>
<h1 id="二、登录注册"><a href="#二、登录注册" class="headerlink" title="二、登录注册"></a>二、登录注册</h1><blockquote>
<p>目标</p>
<ul>
<li>能实现登录页面的布局</li>
<li>能实现基本登录功能</li>
<li>能掌握 Vant 中 Toast 提示组件的使用</li>
<li>能理解 API 请求模块的封装</li>
<li>能理解发送验证码的实现思路</li>
<li>能理解 Vant Form 实现表单验证的使用</li>
</ul>
</blockquote>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200228161041266.png" alt="image-20200228161041266" style="zoom:50%;">

<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="创建组件并配置路由"><a href="#创建组件并配置路由" class="headerlink" title="创建组件并配置路由"></a>创建组件并配置路由</h3><p>1、创建 <code>src/views/login/index.vue</code> 并写入以下内容</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-container"</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'LoginPage'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、然后在 <code>src/router/index.js</code> 中配置登录页的路由表</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">path</span>: <span class="string">'/login'</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'login'</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/login'</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>


<p>最后，访问 <code>/login</code> 查看是否能访问到登录页面。</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200229115109026.png" alt="image-20200229115109026" style="zoom:50%;">


<h3 id="布局结构"><a href="#布局结构" class="headerlink" title="布局结构"></a>布局结构</h3><p>这里主要使用到三个 Vant 组件：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/nav-bar">NavBar 导航栏</a></li>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/form">Form 表单</a><ul>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/field">Field 输入框</a></li>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/button">Button 按钮</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>一个经验：使用组件库中的现有组件快速布局，再慢慢调整细节，效率更高（刚开始可能会感觉有点麻烦，越用越熟，慢慢的就有了自己的思想）。</p>
</blockquote>
<h3 id="布局样式"><a href="#布局样式" class="headerlink" title="布局样式"></a>布局样式</h3><blockquote>
<p>写样式的原则：将公共样式写到全局（<code>src/styles/index.less</code>），将局部样式写到组件内部。</p>
</blockquote>
<p>1、<code>src/styles/index.less</code></p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> {</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f5f7f9</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-nav-bar</span> {</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#3296fa</span>;</span><br><span class="line">  <span class="selector-class">.van-nav-bar__title</span> {</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、<code>src/views/login/index.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">class</span>=<span class="string">"page-nav-bar"</span> <span class="attr">title</span>=<span class="string">"登录"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 登录表单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-form</span> @<span class="attr">submit</span>=<span class="string">"onSubmit"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"用户名"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">"请输入手机号"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"left-icon"</span> <span class="attr">class</span>=<span class="string">"toutiao toutiao-shouji"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"password"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"验证码"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">"请输入验证码"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"left-icon"</span> <span class="attr">class</span>=<span class="string">"toutiao toutiao-yanzhengma"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> #<span class="attr">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">class</span>=<span class="string">"send-sms-btn"</span> <span class="attr">round</span> <span class="attr">size</span>=<span class="string">"small"</span> <span class="attr">type</span>=<span class="string">"default"</span>&gt;</span>发送验证码<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-btn-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">class</span>=<span class="string">"login-btn"</span> <span class="attr">block</span> <span class="attr">type</span>=<span class="string">"info"</span> <span class="attr">native-type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">          登录</span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /登录表单 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'LoginIndex'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">    onSubmit (values) {</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'submit'</span>, values)</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  }</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.login-container</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.toutiao</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">37px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.send-sms-btn</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">152px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">46px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">line-height</span>: <span class="number">46px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#ededed</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">22px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#666</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.login-btn-wrap</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">53px</span> <span class="number">33px</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.login-btn</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">background-color</span>: <span class="number">#6db4fb</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="实现基本登录功能"><a href="#实现基本登录功能" class="headerlink" title="实现基本登录功能"></a>实现基本登录功能</h2><p>思路：</p>
<ul>
<li>注册点击登录的事件</li>
<li>获取表单数据（根据接口要求使用 v-model 绑定）</li>
<li>表单验证</li>
<li>发请求提交</li>
<li>根据请求结果做下一步处理</li>
</ul>
<p><strong>一、根据接口要求绑定获取表单数据</strong></p>
<p>1、在登录页面组件的实例选项 data 中添加 <code>user</code> 数据字段</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="attr">user</span>: {</span><br><span class="line">      <span class="attr">mobile</span>: <span class="string">''</span>,</span><br><span class="line">      <span class="attr">code</span>: <span class="string">''</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、在表单中使用 <code>v-model</code> 绑定对应数据</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- van-cell-group 仅仅是提供了一个上下外边框，能看到包裹的区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">"user.mobile"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">required</span></span></span><br><span class="line"><span class="tag">    <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">    <span class="attr">label</span>=<span class="string">"手机号"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">placeholder</span>=<span class="string">"请输入手机号"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">"user.code"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">"number"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">label</span>=<span class="string">"验证码"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">placeholder</span>=<span class="string">"请输入验证码"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">required</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>最后测试。</p>
<blockquote>
<p>一个小技巧：使用 VueDevtools 调试工具查看是否绑定成功。</p>
</blockquote>
<p><strong>二、请求登录</strong></p>
<p>1、创建 <code>src/api/user.js</code> 封装请求方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户相关的请求模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> login = <span class="function"><span class="params">data</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/authorizations'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、给登录按钮注册点击事件</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLogin () {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> login(<span class="built_in">this</span>.user)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'登录成功'</span>, res)</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="keyword">if</span> (err.response.status === <span class="number">400</span>) {</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'登录失败'</span>, err)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>最后测试。</p>
<h2 id="登录状态提示"><a href="#登录状态提示" class="headerlink" title="登录状态提示"></a>登录状态提示</h2><p>Vant 中内置了<a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/toast">Toast 轻提示</a>组件，可以实现移动端常见的提示效果。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单文字提示</span></span><br><span class="line">Toast(<span class="string">"提示内容"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// loading 转圈圈提示</span></span><br><span class="line">Toast.loading({</span><br><span class="line">  <span class="attr">duration</span>: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">  <span class="attr">message</span>: <span class="string">"加载中..."</span>,</span><br><span class="line">  <span class="attr">forbidClick</span>: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 成功提示</span></span><br><span class="line">Ttoast.success(<span class="string">"成功文案"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 失败提示</span></span><br><span class="line">Toast.fail(<span class="string">"失败文案"</span>);</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>提示：在组件中可以直接通过 <code>this.$toast</code> 调用。</p>
</blockquote>
<p>另外需要注意的是：Toast 默认采用单例模式，即同一时间只会存在一个 Toast，如果需要在同一时间弹出多个 Toast，可以参考下面的示例</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Toast.allowMultiple();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toast1 = Toast(<span class="string">'第一个 Toast'</span>);</span><br><span class="line"><span class="keyword">const</span> toast2 = Toast.success(<span class="string">'第二个 Toast'</span>);</span><br><span class="line"></span><br><span class="line">toast1.clear();</span><br><span class="line">toast2.clear();</span><br></pre></td></tr></tbody></table></figure>

<p>下面是为我们的登录功能增加 toast 交互提示。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLogin () {</span><br><span class="line">  <span class="comment">// 开始转圈圈</span></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading({</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">0</span>, <span class="comment">// 持续时间，0表示持续展示不停止</span></span><br><span class="line">    <span class="attr">forbidClick</span>: <span class="literal">true</span>, <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">    <span class="attr">message</span>: <span class="string">'登录中...'</span> <span class="comment">// 提示消息</span></span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> request({</span><br><span class="line">      <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">'/app/v1_0/authorizations'</span>,</span><br><span class="line">      <span class="attr">data</span>: <span class="built_in">this</span>.user</span><br><span class="line">    })</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'登录成功'</span>, res)</span><br><span class="line">    <span class="comment">// 提示 success 或者 fail 的时候，会先把其它的 toast 先清除</span></span><br><span class="line">    <span class="built_in">this</span>.$toast.success(<span class="string">'登录成功'</span>)</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'登录失败'</span>, err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">'登录失败，手机号或验证码错误'</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>假如请求非常快的话就看不到 loading 效果了，这里可以手动将调试工具中的网络设置为慢速网络。</p>
<p>测试结束，再把网络设置恢复为 <code>Online</code> 正常网络。</p>
<h2 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h2><blockquote>
<p>参考文档：<a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/form#xiao-yan-gui-ze">Form 表单验证</a></p>
</blockquote>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">class</span>=<span class="string">"page-nav-bar"</span> <span class="attr">title</span>=<span class="string">"登录"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 登录表单 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      表单验证：</span></span><br><span class="line"><span class="comment">        1、给 van-field 组件配置 rules 验证规则</span></span><br><span class="line"><span class="comment">          参考文档：https://youzan.github.io/vant/#/zh-CN/form#rule-shu-ju-jie-gou</span></span><br><span class="line"><span class="comment">        2、当表单提交的时候会自动触发表单验证</span></span><br><span class="line"><span class="comment">           如果验证通过，会触发 submit 事件</span></span><br><span class="line"><span class="comment">           如果验证失败，不会触发 submit</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-form</span> @<span class="attr">submit</span>=<span class="string">"onSubmit"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">"user.mobile"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"手机号"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">"请输入手机号"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:rules</span>=<span class="string">"userFormRules.mobile"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"number"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">maxlength</span>=<span class="string">"11"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"left-icon"</span> <span class="attr">class</span>=<span class="string">"toutiao toutiao-shouji"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">"user.code"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"验证码"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">"请输入验证码"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:rules</span>=<span class="string">"userFormRules.code"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"number"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">maxlength</span>=<span class="string">"6"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"left-icon"</span> <span class="attr">class</span>=<span class="string">"toutiao toutiao-yanzhengma"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> #<span class="attr">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">class</span>=<span class="string">"send-sms-btn"</span> <span class="attr">round</span> <span class="attr">size</span>=<span class="string">"small"</span> <span class="attr">type</span>=<span class="string">"default"</span>&gt;</span>发送验证码<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-btn-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">class</span>=<span class="string">"login-btn"</span> <span class="attr">block</span> <span class="attr">type</span>=<span class="string">"info"</span> <span class="attr">native-type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">          登录</span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /登录表单 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> { login } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'LoginIndex'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      <span class="attr">user</span>: {</span></span><br><span class="line"><span class="javascript">        <span class="attr">mobile</span>: <span class="string">''</span>, <span class="comment">// 手机号</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">code</span>: <span class="string">''</span> <span class="comment">// 验证码</span></span></span><br><span class="line"><span class="javascript">      },</span></span><br><span class="line"><span class="javascript">      <span class="attr">userFormRules</span>: {</span></span><br><span class="line"><span class="javascript">        <span class="attr">mobile</span>: [{</span></span><br><span class="line"><span class="javascript">          <span class="attr">required</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">message</span>: <span class="string">'手机号不能为空'</span></span></span><br><span class="line"><span class="javascript">        }, {</span></span><br><span class="line"><span class="javascript">          <span class="attr">pattern</span>: <span class="regexp">/^1[3|5|7|8]\d{9}$/</span>,</span></span><br><span class="line"><span class="javascript">          message: <span class="string">'手机号格式错误'</span></span></span><br><span class="line"><span class="javascript">        }],</span></span><br><span class="line"><span class="javascript">        <span class="attr">code</span>: [{</span></span><br><span class="line"><span class="javascript">          <span class="attr">required</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">message</span>: <span class="string">'验证码不能为空'</span></span></span><br><span class="line"><span class="javascript">        }, {</span></span><br><span class="line"><span class="javascript">          <span class="attr">pattern</span>: <span class="regexp">/^\d{6}$/</span>,</span></span><br><span class="line"><span class="javascript">          message: <span class="string">'验证码格式错误'</span></span></span><br><span class="line"><span class="javascript">        }]</span></span><br><span class="line"><span class="javascript">      }</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> onSubmit () {</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 1. 获取表单数据</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> user = <span class="built_in">this</span>.user</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// <span class="doctag">TODO:</span> 2. 表单验证</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 3. 提交表单请求登录</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$toast.loading({</span></span><br><span class="line"><span class="javascript">        <span class="attr">message</span>: <span class="string">'登录中...'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">forbidClick</span>: <span class="literal">true</span>, <span class="comment">// 禁用背景点击</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">duration</span>: <span class="number">0</span> <span class="comment">// 持续时间，默认 2000，0 表示持续展示不关闭</span></span></span><br><span class="line"><span class="javascript">      })</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">try</span> {</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> res = <span class="keyword">await</span> login(user)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'登录成功'</span>, res)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$toast.success(<span class="string">'登录成功'</span>)</span></span><br><span class="line"><span class="javascript">      } <span class="keyword">catch</span> (err) {</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (err.response.status === <span class="number">400</span>) {</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.$toast.fail(<span class="string">'手机号或验证码错误'</span>)</span></span><br><span class="line"><span class="javascript">        } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.$toast.fail(<span class="string">'登录失败，请稍后重试'</span>)</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript">      }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 4. 根据请求响应结果处理后续操作</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  }</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.login-container</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.toutiao</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">37px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.send-sms-btn</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">152px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">46px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">line-height</span>: <span class="number">46px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#ededed</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">22px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#666</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.login-btn-wrap</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">53px</span> <span class="number">33px</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.login-btn</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">background-color</span>: <span class="number">#6db4fb</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h2 id="验证码处理"><a href="#验证码处理" class="headerlink" title="验证码处理"></a>验证码处理</h2><h3 id="验证手机号"><a href="#验证手机号" class="headerlink" title="验证手机号"></a>验证手机号</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onSendSms () {</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'onSendSms'</span>)</span><br><span class="line">  <span class="comment">// 1. 校验手机号</span></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.$refs.loginForm.validate(<span class="string">'mobile'</span>)</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'验证失败'</span>, err)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 验证通过，显示倒计时</span></span><br><span class="line">  <span class="comment">// 3. 请求发送验证码</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="使用倒计时组件"><a href="#使用倒计时组件" class="headerlink" title="使用倒计时组件"></a>使用倒计时组件</h3><p>1、在 data 中添加数据用来控制倒计时的显示和隐藏</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">isCountDownShow</span>: <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、使用倒计时组件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"user.code"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">placeholder</span>=<span class="string">"请输入验证码"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"icon icon-mima"</span> <span class="attr">slot</span>=<span class="string">"left-icon"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-count-down</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-if</span>=<span class="string">"isCountDownShow"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">slot</span>=<span class="string">"button"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:time</span>=<span class="string">"1000 * 5"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">format</span>=<span class="string">"ss s"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">finish</span>=<span class="string">"isCountDownShow = false"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-else</span></span></span><br><span class="line"><span class="tag">    <span class="attr">slot</span>=<span class="string">"button"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">size</span>=<span class="string">"small"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">"primary"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">round</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">"onSendSmsCode"</span></span></span><br><span class="line"><span class="tag">  &gt;</span>发送验证码<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="发送验证码"><a href="#发送验证码" class="headerlink" title="发送验证码"></a>发送验证码</h3><p>1、在 <code>api/user.js</code> 中添加封装数据接口</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSmsCode = <span class="function"><span class="params">mobile</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/app/v1_0/sms/codes/<span class="subst">${mobile}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、给发送验证码按钮注册点击事件</p>
<p>3、发送处理</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onSendSms () {</span><br><span class="line">  <span class="comment">// 1. 校验手机号</span></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.$refs.loginForm.validate(<span class="string">'mobile'</span>)</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'验证失败'</span>, err)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 验证通过，显示倒计时</span></span><br><span class="line">  <span class="built_in">this</span>.isCountDownShow = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 请求发送验证码</span></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">await</span> sendSms(<span class="built_in">this</span>.user.mobile)</span><br><span class="line">    <span class="built_in">this</span>.$toast(<span class="string">'发送成功'</span>)</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="comment">// 发送失败，关闭倒计时</span></span><br><span class="line">    <span class="built_in">this</span>.isCountDownShow = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (err.response.status === <span class="number">429</span>) {</span><br><span class="line">      <span class="built_in">this</span>.$toast(<span class="string">'发送太频繁了，请稍后重试'</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="built_in">this</span>.$toast(<span class="string">'发送失败，请稍后重试'</span>)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="处理用户-Token"><a href="#处理用户-Token" class="headerlink" title="处理用户 Token"></a>处理用户 Token</h2><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200329121650635.png" alt="image-20200329121650635">

<p>Token 是用户登录成功之后服务端返回的一个身份令牌，在项目中的多个业务中需要使用到：</p>
<ul>
<li>访问需要授权的 API 接口</li>
<li>校验页面的访问权限</li>
<li>…</li>
</ul>
<p>但是我们只有在第一次用户登录成功之后才能拿到 Token。</p>
<p>所以为了能在其它模块中获取到 Token 数据，我们需要把它存储到一个公共的位置，方便随时取用。</p>
<p>往哪儿存？</p>
<ul>
<li>本地存储<ul>
<li>获取麻烦</li>
<li>数据不是响应式</li>
</ul>
</li>
<li>Vuex 容器（推荐）<ul>
<li>获取方便</li>
<li>响应式的</li>
</ul>
</li>
</ul>
<p>使用容器存储 Token 的思路：</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200109192157006.png" alt="image-20200109192157006"></p>
<ul>
<li>登录成功，将 Token 存储到 Vuex 容器中<ul>
<li>获取方便</li>
<li>响应式</li>
</ul>
</li>
<li>为了持久化，还需要把 Token 放到本地存储<ul>
<li>持久化</li>
</ul>
</li>
</ul>
<p>下面是具体实现。</p>
<p>1、在 <code>src/store/index.js</code> 中</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store({</span><br><span class="line">  <span class="attr">state</span>: {</span><br><span class="line">    <span class="comment">// 用户的登录状态信息</span></span><br><span class="line">    <span class="attr">user</span>: <span class="built_in">JSON</span>.parse(<span class="built_in">window</span>.localStorage.getItem(<span class="string">'TOUTIAO_USER'</span>))</span><br><span class="line">    <span class="comment">// user: null</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">mutations</span>: {</span><br><span class="line">    setUser (state, user) {</span><br><span class="line">      state.user = user</span><br><span class="line">      <span class="built_in">window</span>.localStorage.setItem(<span class="string">'TOUTIAO_USER'</span>, <span class="built_in">JSON</span>.stringify(user))</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">actions</span>: {</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">modules</span>: {</span><br><span class="line">  }</span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、登录成功以后将后端返回的 token 相关数据存储到容器中</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLogin () {</span><br><span class="line">  <span class="comment">// const loginToast = this.$toast.loading({</span></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading({</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">0</span>, <span class="comment">// 持续时间，0表示持续展示不停止</span></span><br><span class="line">    <span class="attr">forbidClick</span>: <span class="literal">true</span>, <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">    <span class="attr">message</span>: <span class="string">'登录中...'</span> <span class="comment">// 提示消息</span></span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> login(<span class="built_in">this</span>.user)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// res.data.data =&gt; { token: 'xxx', refresh_token: 'xxx' }</span></span><br><span class="line">+    <span class="built_in">this</span>.$store.commit(<span class="string">'setUser'</span>, res.data.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提示 success 或者 fail 的时候，会先把其它的 toast 先清除</span></span><br><span class="line">    <span class="built_in">this</span>.$toast.success(<span class="string">'登录成功'</span>)</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'登录失败'</span>, err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">'登录失败，手机号或验证码错误'</span>)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 停止 loading，它会把当前页面中所有的 toast 都给清除</span></span><br><span class="line">  <span class="comment">// loginToast.clear()</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="优化封装本地存储操作模块"><a href="#优化封装本地存储操作模块" class="headerlink" title="优化封装本地存储操作模块"></a>优化封装本地存储操作模块</h2><p>创建 <code>src/utils/storage.js</code> 模块。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getItem = <span class="function"><span class="params">name</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">const</span> data = <span class="built_in">window</span>.localStorage.getItem(name)</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(data)</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setItem = <span class="function">(<span class="params">name, value</span>) =&gt;</span> {</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'object'</span>) {</span><br><span class="line">    value = <span class="built_in">JSON</span>.stringify(value)</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">window</span>.localStorage.setItem(name, value)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeItem = <span class="function"><span class="params">name</span> =&gt;</span> {</span><br><span class="line">  <span class="built_in">window</span>.localStorage.removeItem(name)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="关于-Token-过期问题"><a href="#关于-Token-过期问题" class="headerlink" title="关于 Token 过期问题"></a>关于 Token 过期问题</h2><p>登录成功之后后端会返回两个 Token：</p>
<ul>
<li><code>token</code>：访问令牌，有效期2小时</li>
<li><code>refresh_token</code>：刷新令牌，有效期14天，用于访问令牌过期之后重新获取新的访问令牌</li>
</ul>
<p>我们的项目接口中设定的 <code>Token</code> 有效期是 <code>2 小时</code>，超过有效期服务端会返回 <code>401</code> 表示 Token 无效或过期了。</p>
<p>为什么过期时间这么短？</p>
<ul>
<li>为了安全，例如 Token 被别人盗用</li>
</ul>
<p>过期了怎么办？</p>
<ul>
<li><del>让用户重新登录</del>，用户体验太差了</li>
<li>使用 <code>refresh_token</code> 解决 <code>token</code> 过期</li>
</ul>
<p>如何使用 <code>refresh_token</code> 解决 <code>token</code> 过期？</p>
<blockquote>
<p>到课程的后面我们开发的业务功能丰富起来之后，再给大家讲解 Token 过期处理。</p>
<p>大家需要注意的是<strong>在学习测试的时候如果收到 401 响应码，请重新登录再测试</strong>。</p>
</blockquote>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/v2-8f29f24dd291ddf46abda5d5ab7bec6c_720w.jpg" alt="img"></p>
<p>概述：服务器生成token的过程中，会有两个时间，一个是token失效时间，一个是token刷新时间，刷新时间肯定比失效时间长，当用户的 <code>token</code> 过期时，你可以拿着过期的token去换取新的token，来保持用户的登陆状态，当然你这个过期token的过期时间必须在刷新时间之内，如果超出了刷新时间，那么返回的依旧是 401。</p>
<p>处理流程：</p>
<ol>
<li>在axios的拦截器中加入token刷新逻辑</li>
<li>当用户token过期时，去向服务器请求新的 token</li>
<li>把旧的token替换为新的token</li>
<li>然后继续用户当前的请求</li>
</ol>
<p>在请求的响应拦截器中统一处理 token 过期：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装 axios 请求模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line"><span class="keyword">import</span> jsonBig <span class="keyword">from</span> <span class="string">"json-bigint"</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"@/store"</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">"@/router"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// axios.create 方法：复制一个 axios</span></span><br><span class="line"><span class="keyword">const</span> request = axios.create({</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">"http://ttapi.research.itcast.cn/"</span> <span class="comment">// 基础路径</span></span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置处理后端返回数据中超出 js 安全整数范围问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">request.defaults.transformResponse = [</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="keyword">return</span> jsonBig.parse(data);</span><br><span class="line">    } <span class="keyword">catch</span> (err) {</span><br><span class="line">      <span class="keyword">return</span> {};</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">request.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>{</span><br><span class="line">    <span class="keyword">const</span> user = store.state.user;</span><br><span class="line">    <span class="keyword">if</span> (user) {</span><br><span class="line">      config.headers.Authorization = <span class="string">`Bearer <span class="subst">${user.token}</span>`</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// Do something before request is sent</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>{</span><br><span class="line">    <span class="comment">// Do something with request error</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  }</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">request.interceptors.response.use(</span><br><span class="line">  <span class="comment">// 响应成功进入第1个函数</span></span><br><span class="line">  <span class="comment">// 该函数的参数是响应对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>{</span><br><span class="line">    <span class="comment">// Any status code that lie within the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response data</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 响应失败进入第2个函数，该函数的参数是错误对象</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>{</span><br><span class="line">    <span class="comment">// Any status codes that falls outside the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response error</span></span><br><span class="line">    <span class="comment">// 如果响应码是 401 ，则请求获取新的 token</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应拦截器中的 error 就是那个响应的错误对象</span></span><br><span class="line">    <span class="built_in">console</span>.dir(error);</span><br><span class="line">    <span class="keyword">if</span> (error.response &amp;&amp; error.response.status === <span class="number">401</span>) {</span><br><span class="line">      <span class="comment">// 校验是否有 refresh_token</span></span><br><span class="line">      <span class="keyword">const</span> user = store.state.user;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!user || !user.refresh_token) {</span><br><span class="line">        router.push(<span class="string">"/login"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 代码不要往后执行了</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果有refresh_token，则请求获取新的 token</span></span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> axios({</span><br><span class="line">          <span class="attr">method</span>: <span class="string">"PUT"</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">"http://ttapi.research.itcast.cn/app/v1_0/authorizations"</span>,</span><br><span class="line">          <span class="attr">headers</span>: {</span><br><span class="line">            <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">${user.refresh_token}</span>`</span></span><br><span class="line">          }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果获取成功，则把新的 token 更新到容器中</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"刷新 token  成功"</span>, res);</span><br><span class="line">        store.commit(<span class="string">"setUser"</span>, {</span><br><span class="line">          <span class="attr">token</span>: res.data.data.token, <span class="comment">// 最新获取的可用 token</span></span><br><span class="line">          <span class="attr">refresh_token</span>: user.refresh_token <span class="comment">// 还是原来的 refresh_token</span></span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把之前失败的用户请求继续发出去</span></span><br><span class="line">        <span class="comment">// config 是一个对象，其中包含本次失败请求相关的那些配置信息，例如 url、method 都有</span></span><br><span class="line">        <span class="comment">// return 把 request 的请求结果继续返回给发请求的具体位置</span></span><br><span class="line">        <span class="keyword">return</span> request(error.config);</span><br><span class="line">      } <span class="keyword">catch</span> (err) {</span><br><span class="line">        <span class="comment">// 如果获取失败，直接跳转 登录页</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"请求刷线 token 失败"</span>, err);</span><br><span class="line">        router.push(<span class="string">"/login"</span>);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  }</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></tbody></table></figure>
<h1 id="三、个人中心"><a href="#三、个人中心" class="headerlink" title="三、个人中心"></a>三、个人中心</h1><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1566431827166.png" width="250">

<h2 id="TabBar-处理"><a href="#TabBar-处理" class="headerlink" title="TabBar 处理"></a>TabBar 处理</h2><p>通过分析页面，我们可以看到，首页、问答、视频、我的 都使用的是同一个底部标签栏，我们没必要在每个页面中都写一个，所以为了通用方便，我们可以使用 Vue Router 的嵌套路由来处理。</p>
<ul>
<li>父路由：一个空页面，包含一个 tabbar，中间留子路由出口</li>
<li>子路由<ul>
<li>首页</li>
<li>问答</li>
<li>视频</li>
<li>我的</li>
</ul>
</li>
</ul>
<p>一、创建 tabbar 组件并配置路由</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200109153050432.png" alt="image-20200109153050432" width="250">

<p>这里主要使用到的 Vant 组件：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/tabbar">Tabbar 标签栏</a></li>
</ul>
<p>1、创建 <code>src/views/layout/index.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"layout-container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 子路由出口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /子路由出口 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 标签导航栏 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      route: 开启路由模式</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-tabbar</span> <span class="attr">class</span>=<span class="string">"layout-tabbar"</span> <span class="attr">route</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tabbar-item</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"icon"</span> <span class="attr">class</span>=<span class="string">"toutiao toutiao-shouye"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-tabbar-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tabbar-item</span> <span class="attr">to</span>=<span class="string">"/qa"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"icon"</span> <span class="attr">class</span>=<span class="string">"toutiao toutiao-wenda"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>问答<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-tabbar-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tabbar-item</span> <span class="attr">to</span>=<span class="string">"/video"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"icon"</span> <span class="attr">class</span>=<span class="string">"toutiao toutiao-shipin"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>视频<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-tabbar-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tabbar-item</span> <span class="attr">to</span>=<span class="string">"/my"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">slot</span>=<span class="string">"icon"</span> <span class="attr">class</span>=<span class="string">"toutiao toutiao-wode"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>我的<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-tabbar-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-tabbar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /标签导航栏 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'LayoutIndex'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.layout-container</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.layout-tabbar</span> {</span></span><br><span class="line"><span class="css">    <span class="selector-tag">i</span><span class="selector-class">.toutiao</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">    <span class="selector-tag">span</span><span class="selector-class">.text</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、然后将 layout 组件配置到一级路由</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">path</span>: <span class="string">'/'</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/layout'</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>访问 <code>/</code> 测试。</p>
<p>二、分别创建首页、问答、视频、我的页面组件</p>
<p>首页组件：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"home-container"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'HomePage'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>问答组件：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"qa-container"</span>&gt;</span>问答<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'QaPage'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>视频组件：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"video-container"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'VideoPage'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>我的组件：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my-container"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'MyPage'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>二、将四个主页面配置为 tab-bar 的子路由</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">path</span>: <span class="string">'/'</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'tab-bar'</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/tab-bar'</span>),</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">path</span>: <span class="string">''</span>, <span class="comment">// 默认子路由</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">'home'</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/home'</span>)</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">path</span>: <span class="string">'qa'</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">'qa'</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/qa'</span>)</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">path</span>: <span class="string">'video'</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">'video'</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/video'</span>)</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">path</span>: <span class="string">'my'</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">'my'</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/my'</span>)</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>最后测试。</p>
<h2 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h2><h3 id="未登录头部状态"><a href="#未登录头部状态" class="headerlink" title="未登录头部状态"></a>未登录头部状态</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"mobile-img"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">"~@/assets/mobile.png"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">"$router.push('/login')"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"grid-nav"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"消息通知"</span> <span class="attr">is-link</span> <span class="attr">url</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"实名认证"</span> <span class="attr">is-link</span> <span class="attr">url</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"用户反馈"</span> <span class="attr">is-link</span> <span class="attr">url</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"小智同学"</span> <span class="attr">is-link</span> <span class="attr">url</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"系统设置"</span> <span class="attr">is-link</span> <span class="attr">url</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'MyIndex'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.my-container</span> {</span></span><br><span class="line"><span class="css">  &gt; <span class="selector-class">.header</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">361px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">"~@/assets/banner.png"</span>) no-repeat;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-size</span>: cover;</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.mobile-img</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">width</span>: <span class="number">132px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>: <span class="number">132px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="已登录头部"><a href="#已登录头部" class="headerlink" title="已登录头部"></a>已登录头部</h3><h3 id="宫格导航"><a href="#宫格导航" class="headerlink" title="宫格导航"></a>宫格导航</h3><h3 id="单元格导航"><a href="#单元格导航" class="headerlink" title="单元格导航"></a>单元格导航</h3><h2 id="处理已登录和未登录的页面展示"><a href="#处理已登录和未登录的页面展示" class="headerlink" title="处理已登录和未登录的页面展示"></a>处理已登录和未登录的页面展示</h2><ul>
<li>未登录，展示登录按钮</li>
<li>已登录，展示登录用户信息</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 已登录：用户信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"$store.state.user"</span> <span class="attr">class</span>=<span class="string">"user-info-wrap"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /已登录：用户信息 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 未登录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">"not-login"</span> @<span class="attr">click</span>=<span class="string">"$router.push('/login')"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /未登录 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 退出 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-if</span>=<span class="string">"$store.state.user"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /退出 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="用户退出"><a href="#用户退出" class="headerlink" title="用户退出"></a>用户退出</h2><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/用户退出-1578559616164.gif" alt="用户退出" width="250">

<p>1、给退出按钮注册点击事件</p>
<p>2、退出处理</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">onLogout () {</span><br><span class="line">  <span class="comment">// 退出提示</span></span><br><span class="line">  <span class="comment">// 在组件中需要使用 this.$dialog 来调用弹框组件</span></span><br><span class="line">  <span class="built_in">this</span>.$dialog.confirm({</span><br><span class="line">    <span class="attr">title</span>: <span class="string">'确认退出吗？'</span></span><br><span class="line">  }).then(<span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="comment">// on confirm</span></span><br><span class="line">    <span class="comment">// 确认退出：清除登录状态（容器中的 user + 本地存储中的 user）</span></span><br><span class="line">    <span class="built_in">this</span>.$store.commit(<span class="string">'setUser'</span>, <span class="literal">null</span>)</span><br><span class="line">  }).catch(<span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="comment">// on cancel</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'取消执行这里'</span>)</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>最后测试。</p>
<h2 id="展示登录用户信息"><a href="#展示登录用户信息" class="headerlink" title="展示登录用户信息"></a>展示登录用户信息</h2><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200109133717775.png" alt="image-20200109133717775" width="250">

<p>步骤：</p>
<ul>
<li>封装接口</li>
<li>请求获取数据</li>
<li>模板绑定</li>
</ul>
<p>1、在 <code>api/user.js</code> 中添加封装数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户自己的信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserInfo = <span class="function">() =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/user'</span>,</span><br><span class="line">    <span class="comment">// 发送请求头数据</span></span><br><span class="line">    <span class="attr">headers</span>: {</span><br><span class="line">      <span class="comment">// 注意：该接口需要授权才能访问</span></span><br><span class="line">      <span class="comment">//       token的数据格式：Bearer token数据，注意 Bearer 后面有个空格</span></span><br><span class="line">      <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">${store.state.user.token}</span>`</span></span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、在 <code>views/my/index.vue</code> 请求加载数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> { getUserInfo } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'MyPage'</span>,</span><br><span class="line">  <span class="attr">components</span>: {},</span><br><span class="line">  <span class="attr">props</span>: {},</span><br><span class="line">  data () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">+      userInfo: {} <span class="comment">// 用户信息</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">computed</span>: {},</span><br><span class="line">  <span class="attr">watch</span>: {},</span><br><span class="line">+++  created () {</span><br><span class="line">    <span class="comment">// 初始化的时候，如果用户登录了，我才请求获取当前登录用户的信息</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.$store.state.user) {</span><br><span class="line">      <span class="built_in">this</span>.loadUser()</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  mounted () {},</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">+++    <span class="keyword">async</span> loadUser () {</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> { data } = <span class="keyword">await</span> getUserInfo()</span><br><span class="line">        <span class="built_in">this</span>.user = data.data</span><br><span class="line">      } <span class="keyword">catch</span> (err) {</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">        <span class="built_in">this</span>.$toast(<span class="string">'获取数据失败'</span>)</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>3、模板绑定</p>
<h2 id="优化设置-Token"><a href="#优化设置-Token" class="headerlink" title="优化设置 Token"></a>优化设置 Token</h2><p>项目中的接口除了登录之外大多数都需要提供 token 才有访问权限。</p>
<p>通过接口文档可以看到，后端接口要求我们将 token 放到请求头 <code>Header</code> 中并以下面的格式发送。</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200301214857543.png" alt="image-20200301214857543"></p>
<blockquote>
<p>字段名称：<code>Authorization</code></p>
<p>字段值：<code>Bearer token</code>，注意 <code>Bearer</code> 和 <code>token</code> 之间有一个空格</p>
</blockquote>
<p>方式一：在每次请求的时候手动添加（麻烦）。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios({</span><br><span class="line">  <span class="attr">method</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">headers</span>: {</span><br><span class="line">    <span class="attr">Authorization</span>: <span class="string">"Bearer token"</span></span><br><span class="line">  }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>方式二：使用请求拦截器统一添加（推荐，更方便）。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">  participant A as 发起请求</span><br><span class="line">  participant B as 请求拦截器</span><br><span class="line">  participant C as 服务端</span><br><span class="line">  A--&gt;&gt;B: http://xxx</span><br><span class="line">  Note right of B: 设置 token</span><br><span class="line">  B-&gt;&gt;C: 请求发出</span><br><span class="line">  </span><br><span class="line">  </span><br></pre></td></tr></tbody></table></figure>

<p>在 <code>src/utils/request.js</code> 中添加拦截器统一设置 token：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> request = axios.create({</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">'http://ttapi.research.itcast.cn/'</span> <span class="comment">// 接口的基准路径</span></span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line"><span class="comment">// Add a request interceptor</span></span><br><span class="line">request.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>{</span><br><span class="line">  <span class="comment">// Do something before request is sent</span></span><br><span class="line">  <span class="comment">// config ：本次请求的配置对象</span></span><br><span class="line">  <span class="comment">// config 里面有一个属性：headers</span></span><br><span class="line">  <span class="keyword">const</span> { user } = store.state</span><br><span class="line">  <span class="keyword">if</span> (user &amp;&amp; user.token) {</span><br><span class="line">    config.headers.Authorization = <span class="string">`Bearer <span class="subst">${user.token}</span>`</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">}, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">  <span class="comment">// Do something with request error</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h1 id="四、首页—文章列表"><a href="#四、首页—文章列表" class="headerlink" title="四、首页—文章列表"></a>四、首页—文章列表</h1><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1566539328996.png" width="250">

<h2 id="页面布局-1"><a href="#页面布局-1" class="headerlink" title="页面布局"></a>页面布局</h2><h3 id="头部导航栏"><a href="#头部导航栏" class="headerlink" title="头部导航栏"></a>头部导航栏</h3><p>1、使用导航栏组件</p>
<p>2、在导航栏组件中插入按钮</p>
<ul>
<li>文本</li>
<li>图标</li>
</ul>
<p>3、样式调整</p>
<ul>
<li>宽高</li>
<li>背景色</li>
<li>边框</li>
<li>文本大小</li>
<li>图标大小</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"home-container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">class</span>=<span class="string">"page-nav-bar"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"search-btn"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">"title"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"info"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">size</span>=<span class="string">"small"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        <span class="attr">icon</span>=<span class="string">"search"</span></span></span><br><span class="line"><span class="tag">      &gt;</span>搜索<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'HomeIndex'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.home-container</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.van-nav-bar__title</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">max-width</span>: unset;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.search-btn</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">555px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">64px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#5babfb</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">28px</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.van-icon</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h2 id="频道列表"><a href="#频道列表" class="headerlink" title="频道列表"></a>频道列表</h2><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200305195458197.png" alt="image-20200305195458197" style="zoom: 80%;">

<h3 id="使用-Tab-标签页组件"><a href="#使用-Tab-标签页组件" class="headerlink" title="使用 Tab 标签页组件"></a>使用 Tab 标签页组件</h3><p>参考：<a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/tab">Tab 标签页组件</a></p>
<h3 id="样式调整"><a href="#样式调整" class="headerlink" title="样式调整"></a>样式调整</h3><p>（1）基础样式调整</p>
<ul>
<li>标签项<ul>
<li>右边框</li>
<li>下边框</li>
<li>宽高</li>
<li>文字大小</li>
<li>文字颜色</li>
</ul>
</li>
<li>底部条<ul>
<li>宽高</li>
<li>颜色</li>
<li>位置</li>
</ul>
</li>
</ul>
<p>（2）处理汉堡按钮</p>
<p>1、使用插槽插入内容</p>
<p>2、样式调整</p>
<ul>
<li>定位</li>
<li>内容居中</li>
<li>宽高</li>
<li>背景色、透明度</li>
<li>字体图标大小</li>
</ul>
<p>3、使用伪元素设置渐变边框</p>
<ul>
<li>定位</li>
<li>宽高</li>
<li>背景图</li>
<li>背景图填充模式</li>
</ul>
<p>4、添加占位符充当内容区域</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200402215736215.png" alt="image-20200402215736215" style="zoom:50%;">

<p>CSS 样式：</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.placeholder</span> {</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">66px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">82px</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hamburger-btn</span> {</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">66px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">82px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.902</span>;</span><br><span class="line">  <span class="selector-tag">i</span><span class="selector-class">.toutiao</span> {</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">33px</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="selector-tag">&amp;</span>:<span class="selector-tag">before</span> {</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: url(<span class="string">~@/assets/gradient-gray-line.png</span>);</span><br><span class="line">    <span class="attribute">background-size</span>: contain;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>




<h3 id="展示频道列表"><a href="#展示频道列表" class="headerlink" title="展示频道列表"></a>展示频道列表</h3><p>思路：</p>
<ol>
<li>找数据接口</li>
<li>把接口封装为请求方法</li>
<li>在组件中请求获取数据</li>
<li>模板绑定</li>
</ol>
<p>1、封装数据请求接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户自己的信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserChannels = <span class="function">() =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/user/channels'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、请求获取数据</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200401004107079.png" alt="image-20200401004107079" style="zoom:50%;">

<p>3、模板绑定</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200401004138232.png" alt="image-20200401004138232" style="zoom:50%;">


<h2 id="文章列表"><a href="#文章列表" class="headerlink" title="文章列表"></a>文章列表</h2><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200311221143472.png" alt="image-20200311221143472" style="zoom: 50%;">

<h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>你的思路可能是这样的：</p>
<p>1、找到数据接口</p>
<p>2、封装请求方法</p>
<p>3、在组件中请求获取数据，将数据存储到 data 中</p>
<p>4、模板绑定展示</p>
<p>根据不同的频道加载不同的文章列表，你的思路可能是这样的：</p>
<ul>
<li>有一个 <code>list</code> 数组，用来存储文章列表</li>
<li>查看 <code>a</code> 频道：请求获取数据，让 <code>list = a</code> 频道文章</li>
<li>查看 <code>b</code> 频道：请求获取数据，让 <code>list = b</code> 频道文章</li>
<li>查看 <code>c</code> 频道：请求获取数据，让 <code>list = c</code> 频道文章</li>
<li>…</li>
</ul>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200111124415227.png" alt="image-20200111124415227"></p>
<p>思路没有问题，但是并不是我们想要的效果。</p>
<p>我们想要的效果是：<strong>加载过的数据列表不要重新加载</strong>。</p>
<p>实现思路也非常简单，就是我们准备<strong>多个 list 数组，每个频道对应一个，查看哪个频道就把数据往哪个频道的列表数组中存放，这样的话就不会导致覆盖问题</strong>。</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200111124530323.png" alt="image-20200111124530323"></p>
<p>可是有多少频道就得有多少频道文章数组，我们都一个一个声明的话会非常麻烦，所以这里的建议是利用组件来处理。</p>
<p>具体做法就是：</p>
<ul>
<li>封装一个文章列表组件</li>
<li>然后在频道列表中把文章列表遍历出来</li>
</ul>
<p><strong>因为文章列表组件中请求获取文章列表数据需要频道 id，所以 频道 id 应该作为 props 参数传递给文章列表组件，为了方便，我们直接把频道对象传递给文章列表组件就可以了。</strong></p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200306155328108.png" alt="image-20200306155328108" style="zoom: 67%;">

<p>在文章列表中请求获取对应的列表数据，展示到列表中。</p>
<p>最后把组件在频道列表中遍历出来，就像下面这样。</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200306154805522.png" alt="image-20200306154805522"></p>
<p>1、创建 <code>src/views/home/components/article-list.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-list"</span>&gt;</span>文章列表<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ArticleList'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">channel</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>2、在 <code>home/index.vue</code> 中注册使用</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200305205441485.png" alt="image-20200305205441485" style="zoom:50%;">



<p>3、最后测试。</p>
<p>答疑：</p>
<ul>
<li>为什么标签内容是懒渲染的？<ul>
<li>因为这是 Tab 标签页组件本身支持的默认功能，如果不需要可以通过配置 <code>:lazy-render="false"</code> 来关闭这个效果。</li>
</ul>
</li>
</ul>
<h3 id="使用-List-列表组件"><a href="#使用-List-列表组件" class="headerlink" title="使用 List 列表组件"></a>使用 List 列表组件</h3><p><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/list">List 列表组件</a>：瀑布流滚动加载，用于展示长列表。</p>
<p>List 组件通过 loading 和 finished 两个变量控制加载状态，<br>当组件初始化或滚动到到底部时，会触发 load 事件并将 loading 设置成 true，此时可以发起异步操作并更新数据，数据更新完毕后，将 loading 设置成 false 即可。<br>若数据已全部加载完毕，则直接将 finished 设置成 true 即可。</p>
<ul>
<li><code>load 事件</code>：<ul>
<li>List 初始化后会触发一次 load 事件，用于加载第一屏的数据。</li>
<li>如果一次请求加载的数据条数较少，导致列表内容无法铺满当前屏幕，List 会继续触发 load 事件，直到内容铺满屏幕或数据全部加载完成。</li>
</ul>
</li>
<li><code>loading 属性</code>：控制加载中的 loading 状态<ul>
<li>非加载中，loading 为 false，此时会根据列表滚动位置判断是否触发 load 事件（列表内容不足一屏幕时，会直接触发）</li>
<li>加载中，loading 为 true，表示正在发送异步请求，此时不会触发 load 事件</li>
</ul>
</li>
<li><code>finished 属性</code>：控制加载结束的状态<ul>
<li>在每次请求完毕后，需要手动将 loading 设置为 false，表示本次加载结束</li>
<li>所有数据加载结束，finished 为 true，此时不会触发 load 事件</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-list"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      List 列表组件：瀑布流滚动加载，用于展示长列表。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      List 组件通过 loading 和 finished 两个变量控制加载状态，</span></span><br><span class="line"><span class="comment">      当组件初始化或滚动到到底部时，会触发 load 事件并将 loading 自动设置成 true，此时可以发起异步操作并更新数据，</span></span><br><span class="line"><span class="comment">      数据更新完毕后，将 loading 设置成 false 即可。</span></span><br><span class="line"><span class="comment">      若数据已全部加载完毕，则直接将 finished 设置成 true 即可。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      - load 事件：</span></span><br><span class="line"><span class="comment">        + List 初始化后会触发一次 load 事件，用于加载第一屏的数据。</span></span><br><span class="line"><span class="comment">        + 如果一次请求加载的数据条数较少，导致列表内容无法铺满当前屏幕，List 会继续触发 load 事件，直到内容铺满屏幕或数据全部加载完成。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      - loading 属性：控制加载中的 loading 状态</span></span><br><span class="line"><span class="comment">        + 非加载中，loading 为 false，此时会根据列表滚动位置判断是否触发 load 事件（列表内容不足一屏幕时，会直接触发）</span></span><br><span class="line"><span class="comment">        + 加载中，loading 为 true，表示正在发送异步请求，此时不会触发 load 事件</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      - finished 属性：控制加载结束的状态</span></span><br><span class="line"><span class="comment">        + 在每次请求完毕后，需要手动将 loading 设置为 false，表示本次加载结束</span></span><br><span class="line"><span class="comment">        + 所有数据加载结束，finished 为 true，此时不会触发 load 事件</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">"loading"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:finished</span>=<span class="string">"finished"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">finished-text</span>=<span class="string">"没有更多了"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">load</span>=<span class="string">"onLoad"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">v-for</span>=<span class="string">"item in list"</span> <span class="attr">:key</span>=<span class="string">"item"</span> <span class="attr">:title</span>=<span class="string">"item"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ArticleList'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">channel</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      <span class="attr">list</span>: [], <span class="comment">// 存储列表数据的数组</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">loading</span>: <span class="literal">false</span>, <span class="comment">// 控制加载中 loading 状态</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">finished</span>: <span class="literal">false</span> <span class="comment">// 控制数据加载结束的状态</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 初始化或滚动到底部的时候会触发调用 onLoad</span></span></span><br><span class="line"><span class="javascript">    onLoad () {</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'onLoad'</span>)</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 1. 请求获取数据</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// setTimeout 仅做示例，真实场景中一般为 ajax 请求</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 2. 把请求结果数据放到 list 数组中</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 0 + 1 = 1</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// 1 + 1 = 2</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// 2 + 1 = 3</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.list.push(<span class="built_in">this</span>.list.length + <span class="number">1</span>)</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 3. 本次数据加载结束之后要把加载状态设置为结束</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//     loading 关闭以后才能触发下一次的加载更多</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 4. 判断数据是否全部加载完成</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="built_in">this</span>.list.length &gt;= <span class="number">40</span>) {</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 如果没有数据了，把 finished 设置为 true，之后不再触发加载更多</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.finished = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript">      }, <span class="number">1000</span>)</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  }</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="让列表固定定位"><a href="#让列表固定定位" class="headerlink" title="让列表固定定位"></a>让列表固定定位</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.article-list {</span><br><span class="line">  position: fixed;</span><br><span class="line">  top: 180px;</span><br><span class="line">  bottom: 100px;</span><br><span class="line">  right: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  overflow-y: auto;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="加载文章列表数据"><a href="#加载文章列表数据" class="headerlink" title="加载文章列表数据"></a>加载文章列表数据</h3><p>实现思路：</p>
<ul>
<li>找到数据接口</li>
<li>封装请求方法</li>
<li>请求获取数据</li>
<li>模板绑定</li>
</ul>
<p>1、创建 <code>src/api/article.js</code> 封装获取文章列表数据的接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章接口模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'@/utils/request'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取频道的文章列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticles = <span class="function"><span class="params">params</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_1/articles'</span>,</span><br><span class="line">    params</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意：使用接口文档中最下面的 <strong>频道新闻推荐_V1.1</strong></p>
</blockquote>
<p>2、然后在首页文章列表组件 <code>onload</code> 的时候请求加载文章列表</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-list"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        loading 控制上拉加载更多的 loading 状态</span></span><br><span class="line"><span class="comment">        finished 控制数据是否加载结束</span></span><br><span class="line"><span class="comment">        load 事件：当触发上拉加载更多的时候会触发调用 load 事件</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        List 初始化后会触发一次 load 事件，用于加载第一屏的数据</span></span><br><span class="line"><span class="comment">        如果一次请求加载的数据条数较少，导致列表内容无法铺满当前屏幕，List 会继续触发 load 事件，直到内容铺满屏幕或数据全部加载完成</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">"loading"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:finished</span>=<span class="string">"finished"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">finished-text</span>=<span class="string">"没有更多了"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:error.sync</span>=<span class="string">"error"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">error-text</span>=<span class="string">"请求失败，点击重新加载"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">load</span>=<span class="string">"onLoad"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-for</span>=<span class="string">"(article, index) in list"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:title</span>=<span class="string">"article.title"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> { getArticles } <span class="keyword">from</span> <span class="string">'@/api/article'</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ArticleList'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">channel</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      <span class="attr">list</span>: [], <span class="comment">// 文章列表数据</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">loading</span>: <span class="literal">false</span>, <span class="comment">// 上拉加载更多的 loading 状态</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">finished</span>: <span class="literal">false</span>, <span class="comment">// 是否加载结束</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">error</span>: <span class="literal">false</span>, <span class="comment">// 是否加载失败</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">timestamp</span>: <span class="literal">null</span> <span class="comment">// 请求下一页数据的时间戳</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 当触发上拉加载更多的时候调用该函数</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> onLoad () {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">try</span> {</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 1. 请求获取数据</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> { data } = <span class="keyword">await</span> getArticles({</span></span><br><span class="line"><span class="javascript">          <span class="attr">channel_id</span>: <span class="built_in">this</span>.channel.id, <span class="comment">// 频道 id</span></span></span><br><span class="line"><span class="javascript">          <span class="attr">timestamp</span>: <span class="built_in">this</span>.timestamp || <span class="built_in">Date</span>.now(), <span class="comment">// 时间戳，请求新的推荐数据传当前的时间戳，请求历史推荐传指定的时间戳</span></span></span><br><span class="line"><span class="javascript">          <span class="attr">with_top</span>: <span class="number">1</span> <span class="comment">// 是否包含置顶，进入页面第一次请求时要包含置顶文章，1-包含置顶，0-不包含</span></span></span><br><span class="line"><span class="javascript">        })</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 2. 把数据添加到 list 数组中</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> { results } = data.data</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.list.push(...results)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 3. 设置本次加载中 loading 状态结束</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 4. 判断数据是否加载结束</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (results.length) {</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 更新获取下一页数据的时间戳</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.timestamp = data.data.pre_timestamp</span></span><br><span class="line"><span class="javascript">        } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 没有数据了，设置加载状态结束，不再触发上拉加载更多了</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.finished = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript">      } <span class="keyword">catch</span> (err) {</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(err)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.loading = <span class="literal">false</span> <span class="comment">// 关闭 loading 效果</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.error = <span class="literal">true</span> <span class="comment">// 开启错误提示</span></span></span><br><span class="line"><span class="javascript">      }</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  }</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>最后测试。</p>
<h3 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h3><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/展示文章列表-下拉刷新.gif" alt="展示文章列表-下拉刷新" width="250">

<p>这里主要使用到 Vant 中的 <a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/pull-refresh">PullRefresh 下拉刷新</a> 组件。</p>
<p>思路：</p>
<ul>
<li>注册下拉刷新事件（组件）的处理函数</li>
<li>发送请求获取文章列表数据</li>
<li>把获取到的数据添加到当前频道的文章列表的顶部</li>
<li>提示用户刷新成功！</li>
</ul>
<p>下拉刷新时会触发组件的 <code>refresh</code> 事件，在事件的回调函数中可以进行同步或异步操作，操作完成后将 <code>v-model</code> 设置为 <code>false</code>，表示加载完成。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当触发下拉刷新的时候调用该函数</span></span><br><span class="line"><span class="keyword">async</span> onRefresh () {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">    <span class="keyword">const</span> { data } = <span class="keyword">await</span> getArticles({</span><br><span class="line">      <span class="attr">channel_id</span>: <span class="built_in">this</span>.channel.id, <span class="comment">// 频道 id</span></span><br><span class="line">      <span class="attr">timestamp</span>: <span class="built_in">Date</span>.now(), <span class="comment">// 下拉刷新每次都应该获取最新数据</span></span><br><span class="line">      <span class="attr">with_top</span>: <span class="number">1</span> <span class="comment">// 是否包含置顶，进入页面第一次请求时要包含置顶文章，1-包含置顶，0-不包含</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 将数据追加到列表的顶部</span></span><br><span class="line">    <span class="keyword">const</span> { results } = data.data</span><br><span class="line">    <span class="built_in">this</span>.list.unshift(...results)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 关闭下拉刷新的 loading 状态</span></span><br><span class="line">    <span class="built_in">this</span>.isRefreshLoading = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提示成功</span></span><br><span class="line">    <span class="built_in">this</span>.refreshSuccessText = <span class="string">`刷新成功，更新了<span class="subst">${results.length}</span>条数据`</span></span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.isRefreshLoading = <span class="literal">false</span> <span class="comment">// 关闭下拉刷新的 loading 状态</span></span><br><span class="line">    <span class="built_in">this</span>.$toast(<span class="string">'刷新失败'</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="文章列表项"><a href="#文章列表项" class="headerlink" title="文章列表项"></a>文章列表项</h2><h3 id="准备组件"><a href="#准备组件" class="headerlink" title="准备组件"></a>准备组件</h3><p>在我们项目中有好几个页面中都有这个文章列表项内容，如果我们在每个页面中都写一次的话不仅效率低而且维护起来也麻烦。所以最好的办法就是我们把它封装为一个组件，然后在需要使用的组件中加载使用即可。</p>
<p>1、创建 <code>src/components/article-item/index.vue</code> 组件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-item"</span>&gt;</span>文章列表项<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ArticleItem'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">article</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>2、在文章列表组件中注册使用文章列表项组件</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200404224728524.png" alt="image-20200404224728524" style="zoom:50%;">

<h3 id="展示列表项内容"><a href="#展示列表项内容" class="headerlink" title="展示列表项内容"></a>展示列表项内容</h3><ul>
<li>使用 Cell 单元格组件</li>
<li>展示标题</li>
<li>展示底部信息</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"article-item"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>{{ article.title }}<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"label"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"article.cover.type === 3"</span> <span class="attr">class</span>=<span class="string">"cover-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"cover-item"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-for</span>=<span class="string">"(img, index) in article.cover.images"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">            <span class="attr">width</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">height</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:src</span>=<span class="string">"img"</span></span></span><br><span class="line"><span class="tag">          /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>{{ article.aut_name }}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>{{ article.comm_count }}评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>{{ article.pubdate }}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-if</span>=<span class="string">"article.cover.type === 1"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">slot</span>=<span class="string">"default"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">height</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:src</span>=<span class="string">"article.cover.images[0]"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ArticleItem'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">article</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="样式调整-1"><a href="#样式调整-1" class="headerlink" title="样式调整"></a>样式调整</h3><ul>
<li>文章标题<ul>
<li>字号</li>
<li>颜色</li>
<li>多行文字省略</li>
</ul>
</li>
<li>单图封面<ul>
<li>封面容器<ul>
<li>去除 flex: 1，固定宽高</li>
<li>左内边距</li>
</ul>
</li>
<li>封面图<ul>
<li>宽高</li>
<li>填充模式：cover</li>
</ul>
</li>
</ul>
</li>
<li>底部文本信息<ul>
<li>字号</li>
<li>颜色</li>
<li>间距</li>
</ul>
</li>
<li>多图封面<ul>
<li>外层容器<ul>
<li>flex 容器</li>
<li>上下外边距</li>
</ul>
</li>
<li>图片容器<ul>
<li>平均分配容器空间：flex: 1;</li>
<li>固定高度</li>
<li>容器项间距</li>
</ul>
</li>
<li>图片<ul>
<li>宽高</li>
<li>填充模式</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>以下代码仅供参考。</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"article-item"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title van-multi-ellipsis--l2"</span>&gt;</span>{{ article.title }}<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"label"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"article.cover.type === 3"</span> <span class="attr">class</span>=<span class="string">"cover-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"cover-item"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-for</span>=<span class="string">"(img, index) in article.cover.images"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">"cover-item-img"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">fit</span>=<span class="string">"cover"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:src</span>=<span class="string">"img"</span></span></span><br><span class="line"><span class="tag">          /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"label-info-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>{{ article.aut_name }}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>{{ article.comm_count }}评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>{{ article.pubdate }}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-if</span>=<span class="string">"article.cover.type === 1"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">slot</span>=<span class="string">"default"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"right-cover"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fit</span>=<span class="string">"cover"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:src</span>=<span class="string">"article.cover.images[0]"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ArticleItem'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">article</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.article-item</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.title</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#3a3a3a</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.van-cell__value</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">flex</span>: unset;</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">232px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">146px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">padding-left</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.right-cover</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">232px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">146px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.label-info-wrap</span> <span class="selector-tag">span</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">22px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#b4b4b4</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-right</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.cover-wrap</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">30px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.cover-item</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">flex</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>: <span class="number">146px</span>;</span></span><br><span class="line"><span class="css">      &amp;<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:last-child</span>) {</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-right</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">      <span class="selector-class">.cover-item-img</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">146px</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h3 id="关于第三方图片资源403问题"><a href="#关于第三方图片资源403问题" class="headerlink" title="关于第三方图片资源403问题"></a>关于第三方图片资源403问题</h3><p>为什么文章列表数据中的好多图片资源请求失败返回 403？</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这是因为我们项目的接口数据是后端通过爬虫抓取的第三方平台内容，而第三方平台对图片资源做了防盗链保护处理。</span><br></pre></td></tr></tbody></table></figure>



<p>第三方平台怎么处理图片资源保护的？</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">服务端一般使用 Referer 请求头识别访问来源，然后处理资源访问。</span><br></pre></td></tr></tbody></table></figure>

<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200405134347749.png" alt="image-20200405134347749">



<p>Referer 是什么东西？</p>
<blockquote>
<p>扩展参考：<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2019/06/http-referer.html">http://www.ruanyifeng.com/blog/2019/06/http-referer.html</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer 是 HTTP 请求头的一部分，当浏览器向 Web 服务器发送请求的时候，一般会带上 Referer，它包含了当前请求资源的来源页面的地址。服务端一般使用 Referer 请求头识别访问来源，可能会以此进行统计分析、日志记录以及缓存优化等。</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>需要注意的是 referer 实际上是 “referrer” 误拼写。参见 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/HTTP_referer">HTTP referer on Wikipedia</a> （HTTP referer 在维基百科上的条目）来获取更详细的信息。</p>
</blockquote>
<p>怎么解决？</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不要发送 referrer ，对方服务端就不知道你从哪来的了，姑且认为是你是自己人吧。</span><br></pre></td></tr></tbody></table></figure>



<p>如何设置不发送 referrer？</p>
<p>用 <code>&lt;a&gt;</code>、<code>&lt;area&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;iframe&gt;</code>、<code>&lt;script&gt;</code> 或者 <code>&lt;link&gt;</code> 元素上的 <code>referrerpolicy</code> 属性为其设置独立的请求策略，例如：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://……"</span> <span class="attr">referrerPolicy</span>=<span class="string">"no-referrer"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>或者直接在 HTMl 页面头中通过 meta 属性全局配置：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"referrer"</span> <span class="attr">content</span>=<span class="string">"no-referrer"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="处理相对时间"><a href="#处理相对时间" class="headerlink" title="处理相对时间"></a>处理相对时间</h3><p>推荐两个第三方库：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://momentjs.com/">Moment.js</a></li>
<li><a target="_blank" rel="noopener" href="https://day.js.org/">Day.js</a></li>
</ul>
<p>两者都是专门用于处理时间的 JavaScript 库，功能差不多，因为 Day.js 的设计就是参考的 Moment.js。但是 Day.js 相比 Moment.js 的包体积要更小一些，因为它采用了插件化的处理方式。</p>
<p><a target="_blank" rel="noopener" href="https://day.js.org/zh-CN/">Day.js</a> 是一个轻量的处理时间和日期的 JavaScript 库，和 <a target="_blank" rel="noopener" href="https://momentjs.com/">Moment.js</a> 的 API 设计保持完全一样，如果您曾经用过 Moment.js, 那么您已经知道如何使用 Day.js 。</p>
<ul>
<li><p>Day.js 可以运行在浏览器和 Node.js 中。</p>
</li>
<li><p>🕒 和 Moment.js 相同的 API 和用法</p>
</li>
<li><p>💪 不可变数据 (Immutable)</p>
</li>
<li><p>🔥 支持链式操作 (Chainable)</p>
</li>
<li><p>🌐 国际化 I18n</p>
</li>
<li><p>📦 仅 2kb 大小的微型库</p>
</li>
<li><p>👫 全浏览器兼容</p>
</li>
</ul>
<p>1、安装</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i dayjs</span><br></pre></td></tr></tbody></table></figure>

<p>2、创建 <code>utils/dayjs.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">'dayjs'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载中文语言包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'dayjs/locale/zh-cn'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> relativeTime <span class="keyword">from</span> <span class="string">'dayjs/plugin/relativeTime'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置使用处理相对时间的插件</span></span><br><span class="line">dayjs.extend(relativeTime)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置使用中文语言包</span></span><br><span class="line">dayjs.locale(<span class="string">'zh-cn'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局过滤器：处理相对时间</span></span><br><span class="line">Vue.filter(<span class="string">'relativeTime'</span>, <span class="function"><span class="params">value</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> dayjs().to(dayjs(value))</span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>3、在 <code>main.js</code> 中加载初始化</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./utils/dayjs'</span></span><br></pre></td></tr></tbody></table></figure>

<p>4、使用</p>
<p>使用过滤器：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>{{ 日期数据 | relativeTime }}<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<h1 id="五、首页—频道编辑"><a href="#五、首页—频道编辑" class="headerlink" title="五、首页—频道编辑"></a>五、首页—频道编辑</h1><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1566541118035.png" width="300">





<h2 id="处理页面弹出层"><a href="#处理页面弹出层" class="headerlink" title="处理页面弹出层"></a>处理页面弹出层</h2><p>Vant 中内置了 <a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/popup">Popup 弹出层</a> 组件。</p>
<p>1、在 <code>data</code>中添加一个数据用来控制弹层的显示和隐藏</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">isChannelEditShow</span>: <span class="literal">true</span> <span class="comment">// 这里我们先设置为 true 就能看到弹窗的页面了</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、然后在首页模板中的频道列表后面添加弹出层组件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 频道编辑 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">"edit-channel-popup"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"isEditChannelShow"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">"{ height: '100%' }"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">closeable</span></span></span><br><span class="line"><span class="tag">  <span class="attr">close-icon-position</span>=<span class="string">"top-left"</span></span></span><br><span class="line"><span class="tag">&gt;</span>内容<span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /频道编辑 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.edit-channel-popup</span> {</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>测试查看结果。</p>
<h2 id="创建频道编辑组件"><a href="#创建频道编辑组件" class="headerlink" title="创建频道编辑组件"></a>创建频道编辑组件</h2><p>1、创建 <code>views/home/components/channel-edit.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"channel-edit"</span>&gt;</span>频道编辑<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ChannelEdit'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、在首页中加载注册</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ChannelEdit <span class="keyword">from</span> <span class="string">'./components/channel-edit'</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">components</span>: {</span><br><span class="line">    ...</span><br><span class="line">    ChannelEdit</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>3、在弹出层中使用频道编辑组件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 频道编辑 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"isChannelEditShow"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">closeable</span></span></span><br><span class="line"><span class="tag">  <span class="attr">close-icon-position</span>=<span class="string">"top-left"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">"{ height: '100%' }"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">channel-edit</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /频道编辑 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="页面布局-2"><a href="#页面布局-2" class="headerlink" title="页面布局"></a>页面布局</h2><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"channel-edit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"我的频道"</span> <span class="attr">:border</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">size</span>=<span class="string">"mini"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"danger"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">plain</span></span></span><br><span class="line"><span class="tag">      &gt;</span>编辑<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">:gutter</span>=<span class="string">"10"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid-item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"channel-item"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">"value in 8"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">"value"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">text</span>=<span class="string">"文字"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"频道推荐"</span> <span class="attr">:border</span>=<span class="string">"false"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">:gutter</span>=<span class="string">"10"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid-item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"channel-item"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">"value in 8"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">"value"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">text</span>=<span class="string">"文字"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ChannelEdit'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.channel-edit</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.channel-item</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">86px</span>;</span></span><br><span class="line"><span class="css">    /deep/ <span class="selector-class">.van-grid-item__content</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">background-color</span>: <span class="number">#f5f5f6</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.van-grid-item__text</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#222</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">font-size</span>: <span class="number">28px</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h2 id="展示我的频道"><a href="#展示我的频道" class="headerlink" title="展示我的频道"></a>展示我的频道</h2><p>1、在父组件中把 <code>channels</code> 传递给频道编辑组件</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316002816033.png" alt="image-20200316002816033" style="zoom:50%;">



<p>2、在频道编辑组件中声明接收父组件的 <code>userChannels</code> 频道列表数据并遍历展示</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316002911027.png" alt="image-20200316002911027" style="zoom:50%;">

<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316002958971.png" alt="image-20200316002958971" style="zoom:50%;">

<h2 id="展示推荐频道列表"><a href="#展示推荐频道列表" class="headerlink" title="展示推荐频道列表"></a>展示推荐频道列表</h2><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1571040968593.png" alt="1571040968593" style="zoom:50%;">

<p>没有用来获取推荐频道的数据接口，但是我们有获取所有频道列表的数据接口。</p>
<p>所以：<code>所有频道列表 - 我的频道 = 剩余推荐的频道</code>。</p>
<p>实现过程所以一共分为两大步：</p>
<ul>
<li>获取所有频道</li>
<li>基于所有频道和我的频道计算获取剩余的推荐频道</li>
</ul>
<h3 id="获取所有频道"><a href="#获取所有频道" class="headerlink" title="获取所有频道"></a>获取所有频道</h3><p>1、封装数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取所有频道</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getAllChannels = <span class="function">() =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/channels'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、在编辑频道组件中请求获取所有频道数据</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316021948407.png" alt="image-20200316021948407" style="zoom:50%;">

<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316022017473.png" alt="image-20200316022017473" style="zoom:50%;">

<p>3、在调试工具中测试是否有拿到数据</p>
<h3 id="处理展示推荐频道"><a href="#处理展示推荐频道" class="headerlink" title="处理展示推荐频道"></a>处理展示推荐频道</h3><p>思路：<code>所有频道 - 用户频道 = 推荐频道</code></p>
<p>1、封装计算属性筛选数据</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316022123370.png" alt="image-20200316022123370" style="zoom:50%;">

<ul>
<li>遍历所有频道</li>
<li>对每一个频道都判断：该频道是否属于我的频道</li>
<li>如果不属于我的频道，则收集起来</li>
<li>直到遍历结束，剩下来就是那些剩余的推荐频道</li>
</ul>
<p>2、模板绑定</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316022153646.png" alt="image-20200316022153646" style="zoom:50%;">



<h2 id="添加频道"><a href="#添加频道" class="headerlink" title="添加频道"></a>添加频道</h2><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/频道管理-添加频道.gif" alt="频道管理-添加频道" width="250">

<p>思路：</p>
<ul>
<li>给推荐频道列表中每一项注册点击事件</li>
<li>获取点击的频道项</li>
<li>将频道项添加到我的频道中</li>
<li><del>将当前点击的频道项从推荐频道中移除</del><ul>
<li>不需要删除，因为我们获取数据使用的是计算属性，当我频道发生改变，计算属性重新求值了</li>
</ul>
</li>
</ul>
<p>1、给推荐频道中的频道注册点击事件</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316030501261.png" alt="image-20200316030501261" style="zoom:50%;">

<p>2、在添加频道事件处理函数中</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316030518012.png" alt="image-20200316030518012" style="zoom:50%;">

<p>然后你会神奇的发现点击的那个推荐频道跑到我的频道中了，我们并没有去手动的删除点击的这个推荐频道，但是它没了！主要是因为推荐频道是通过一个计算属性获取的，计算属性中使用了 channels（我的频道）数据，所以只要我的频道中的数据发生变化，那么计算属性就会重新运算获取最新的数据。</p>
<h2 id="编辑频道"><a href="#编辑频道" class="headerlink" title="编辑频道"></a>编辑频道</h2><p>思路：</p>
<ul>
<li>给我的频道中的频道项注册点击事件</li>
<li>在事件处理函数中<ul>
<li>如果是编辑状态，则执行删除频道操作</li>
<li>如果是非编辑状态，则执行切换频道操作</li>
</ul>
</li>
</ul>
<h3 id="处理编辑状态"><a href="#处理编辑状态" class="headerlink" title="处理编辑状态"></a>处理编辑状态</h3><p>1、在 data 中添加数据用来控制编辑状态的显示</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316033317098.png" alt="image-20200316033317098" style="zoom:50%;">

<p>2、在我的频道项中添加删除图标</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316033121847.png" alt="image-20200316033121847" style="zoom:50%;">

<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316033200148.png" alt="image-20200316033200148" style="zoom:50%;">

<p>3、处理点击编辑按钮</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316033239687.png" alt="image-20200316033239687" style="zoom:50%;">





<h3 id="切换频道"><a href="#切换频道" class="headerlink" title="切换频道"></a>切换频道</h3><p>功能需求：在非编辑器状态下切换频道。</p>
<p>1、给我的频道项注册点击事件</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316040309812.png" alt="image-20200316040309812" style="zoom:50%;">

<p>2、处理函数</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316040344551.png" alt="image-20200316040344551" style="zoom:50%;">

<p>3、在父组件中监听处理自定义事件</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316040428331.png" alt="image-20200316040428331" style="zoom:50%;">

<h3 id="让激活频道高亮"><a href="#让激活频道高亮" class="headerlink" title="让激活频道高亮"></a>让激活频道高亮</h3><p>思路：</p>
<ul>
<li>将首页中的激活的标签索引传递给频道编辑组件</li>
<li>在频道编辑组件中遍历我的频道列表的时候判断遍历项的索引是否等于激活的频道标签索引，如果一样则作用一个高亮的 CSS 类名</li>
</ul>
<p>1、将首页组件中的 <code>active</code> 传递到频道编辑组件中</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316004637299.png" alt="image-20200316004637299" style="zoom:50%;">

<p>2、在频道编辑组件中声明 props 接收</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316004657340.png" alt="image-20200316004657340" style="zoom:50%;">

<p>3、判断遍历项，如果 <code>遍历项索引 === active</code>，则给这个频道项设置高亮样式</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316004830847.png" alt="image-20200316004830847" style="zoom:50%;">

<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316004847629.png" alt="image-20200316004847629" style="zoom:50%;">

<h3 id="删除频道"><a href="#删除频道" class="headerlink" title="删除频道"></a>删除频道</h3><p>功能需求：在编辑状态下删除频道。</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316042008623.png" alt="image-20200316042008623" style="zoom:50%;">

<h2 id="频道数据持久化"><a href="#频道数据持久化" class="headerlink" title="频道数据持久化"></a>频道数据持久化</h2><h3 id="业务分析"><a href="#业务分析" class="headerlink" title="业务分析"></a>业务分析</h3><p>频道编辑这个功能，无论用户是否登录用户都可以使用。</p>
<p>不登录也能使用</p>
<ul>
<li>数据存储在本地</li>
<li>不支持同步功能</li>
</ul>
<p>登录也能使用</p>
<ul>
<li>数据存储在线上后台服务器</li>
<li>更换不同的设备可以同步数据</li>
</ul>
<h3 id="添加频道-1"><a href="#添加频道-1" class="headerlink" title="添加频道"></a>添加频道</h3><p>思路：</p>
<ul>
<li>如果未登录，则存储到本地</li>
<li>如果已登录，则存储到线上<ul>
<li>找到数据接口</li>
<li>封装请求方法</li>
<li>请求调用</li>
</ul>
</li>
</ul>
<p>1、封装添加频道的请求方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加用户频道</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addUserChannel = <span class="function"><span class="params">channels</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'PATCH'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/user/channels'</span>,</span><br><span class="line">    <span class="attr">data</span>: {</span><br><span class="line">      channels</span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、修改添加频道的处理逻辑</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onAddChannel (channel) {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="built_in">this</span>.userChannels.push(channel)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.user) {</span><br><span class="line">      <span class="comment">// 已登录，数据存储到线上</span></span><br><span class="line">      <span class="keyword">await</span> addUserChannel([{</span><br><span class="line">        <span class="attr">id</span>: channel.id, <span class="comment">// 频道 id</span></span><br><span class="line">        <span class="attr">seq</span>: <span class="built_in">this</span>.userChannels.length <span class="comment">// 频道的 序号</span></span><br><span class="line">      }])</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 未登录，数据存储到本地</span></span><br><span class="line">      setItem(<span class="string">'channels'</span>, <span class="built_in">this</span>.userChannels)</span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast(<span class="string">'添加频道失败'</span>)</span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>



<h3 id="删除频道-1"><a href="#删除频道-1" class="headerlink" title="删除频道"></a>删除频道</h3><p>思路：</p>
<ul>
<li>如果未登录，则存储到本地</li>
<li>如果已登录，则存储到线上<ul>
<li>找到数据接口</li>
<li>封装请求方法</li>
<li>请求调用</li>
</ul>
</li>
</ul>
<p>1、封装删除用户频道请求方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除用户频道</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteUserChannel = <span class="function"><span class="params">channelId</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'DELETE'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/app/v1_0/user/channels/<span class="subst">${channelId}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、修改删除频道的处理逻辑</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200316051028617.png" alt="image-20200316051028617" style="zoom:50%;">

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> deleteChannel (channel) {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.user) {</span><br><span class="line">      <span class="comment">// 已登录，将数据存储到线上</span></span><br><span class="line">      <span class="keyword">await</span> deleteUserChannel(channel.id)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 未登录，将数据存储到本地</span></span><br><span class="line">      setItem(<span class="string">'channles'</span>, <span class="built_in">this</span>.userChannels)</span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast(<span class="string">'删除频道失败，请稍后重试'</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="正确的获取首页频道列表数据"><a href="#正确的获取首页频道列表数据" class="headerlink" title="正确的获取首页频道列表数据"></a>正确的获取首页频道列表数据</h2><p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/%E9%A6%96%E9%A1%B5-%E8%8E%B7%E5%8F%96%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8.png" alt="首页-获取频道列表"></p>
<blockquote>
<p>提示：获取登录用户的频道列表和获取默认推荐的频道列表是同一个数据接口。后端会根据接口中的 token 来判定返回数据。</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> loadChannels () {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">let</span> channels = []</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.user) {</span><br><span class="line">      <span class="comment">// 已登录，请求获取线上的频道数据</span></span><br><span class="line">      <span class="keyword">const</span> { data } = <span class="keyword">await</span> getChannels()</span><br><span class="line">      channels = data.data.channels</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 未登录</span></span><br><span class="line">      <span class="keyword">const</span> localChannels = getItem(<span class="string">'channels'</span>)</span><br><span class="line">      <span class="keyword">if</span> (localChannels) {</span><br><span class="line">        <span class="comment">// 有本地频道数据，则使用</span></span><br><span class="line">        channels = localChannels</span><br><span class="line">      } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// 没有本地频道数据，则请求获取默认推荐的频道列表</span></span><br><span class="line">        <span class="keyword">const</span> { data } = <span class="keyword">await</span> getChannels()</span><br><span class="line">        channels = data.data.channels</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数据更新到组件中</span></span><br><span class="line">    <span class="built_in">this</span>.channels = channels</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast(<span class="string">'数据获取失败'</span>)</span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>
<h1 id="六、文章搜索"><a href="#六、文章搜索" class="headerlink" title="六、文章搜索"></a>六、文章搜索</h1><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1566431801892.png" width="250">



<h2 id="创建组件并配置路由-1"><a href="#创建组件并配置路由-1" class="headerlink" title="创建组件并配置路由"></a>创建组件并配置路由</h2><p>1、创建 <code>src/views/search/index.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"search-container"</span>&gt;</span>搜索页面<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">    <span class="attr">name</span>: <span class="string">"SearchPage"</span>,</span></span><br><span class="line"><span class="javascript">    <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">    <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> {};</span></span><br><span class="line"><span class="javascript">    },</span></span><br><span class="line"><span class="javascript">    <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">    <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {},</span></span><br><span class="line"><span class="javascript">    <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">  };</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>2、然后把搜索页面的路由配置到根组件路由（一级路由）</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">path</span>: <span class="string">'/search'</span>,</span><br><span class="line">  <span class="attr">omponent</span>: Search</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>最后访问 <code>/search</code> 测试。</p>
<h2 id="页面布局-3"><a href="#页面布局-3" class="headerlink" title="页面布局"></a>页面布局</h2><p>1、创建 <code>src/views/search/components/search-history.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"search-history"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"搜索历史"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>全部删除<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"delete"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"close"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"close"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"close"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"close"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'SearchHistory'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、创建 <code>src/views/search/components/search-suggestion.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"search-suggestion"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"程序员..."</span> <span class="attr">icon</span>=<span class="string">"search"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"程序员..."</span> <span class="attr">icon</span>=<span class="string">"search"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"程序员..."</span> <span class="attr">icon</span>=<span class="string">"search"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"程序员..."</span> <span class="attr">icon</span>=<span class="string">"search"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"程序员..."</span> <span class="attr">icon</span>=<span class="string">"search"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'SearchSuggestion'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>3、创建 <code>src/views/search/components/search-result.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"search-result"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">"loading"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:finished</span>=<span class="string">"finished"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">finished-text</span>=<span class="string">"没有更多了"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">load</span>=<span class="string">"onLoad"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">v-for</span>=<span class="string">"item in list"</span> <span class="attr">:key</span>=<span class="string">"item"</span> <span class="attr">:title</span>=<span class="string">"item"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'SearchResult'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      <span class="attr">list</span>: [],</span></span><br><span class="line"><span class="javascript">      <span class="attr">loading</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">finished</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">    onLoad () {</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 异步更新数据</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// setTimeout 仅做示例，真实场景中一般为 ajax 请求</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.list.push(<span class="built_in">this</span>.list.length + <span class="number">1</span>)</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 加载状态结束</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 数据全部加载完成</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="built_in">this</span>.list.length &gt;= <span class="number">40</span>) {</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.finished = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript">      }, <span class="number">1000</span>)</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  }</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>4、搜索组件内容如下：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"search-container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 搜索栏 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      Tips: 在 van-search 外层增加 form 标签，且 action 不为空，即可在 iOS 输入法中显示搜索按钮</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-search</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">"searchText"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">show-action</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">"请输入搜索关键词"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">background</span>=<span class="string">"#3296fa"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">search</span>=<span class="string">"onSearch"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">cancel</span>=<span class="string">"onCancel"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /搜索栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 搜索历史记录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">search-history</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /搜索历史记录 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 联想建议 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">search-suggestion</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /联想建议 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 历史记录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">search-result</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /历史记录 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> SearchHistory <span class="keyword">from</span> <span class="string">'./components/search-history'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> SearchSuggestion <span class="keyword">from</span> <span class="string">'./components/search-suggestion'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> SearchResult <span class="keyword">from</span> <span class="string">'./components/search-result'</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'SearchIndex'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {</span></span><br><span class="line"><span class="javascript">    SearchHistory,</span></span><br><span class="line"><span class="javascript">    SearchSuggestion,</span></span><br><span class="line"><span class="javascript">    SearchResult</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      <span class="attr">searchText</span>: <span class="string">''</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">    onSearch (val) {</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(val)</span></span><br><span class="line"><span class="javascript">    },</span></span><br><span class="line"><span class="javascript">    onCancel () {</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$router.back()</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  }</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.search-container</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.van-search__action</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h2 id="处理页面显示状态"><a href="#处理页面显示状态" class="headerlink" title="处理页面显示状态"></a>处理页面显示状态</h2><p>1、在 <code>data</code> 中添加数据用来控制搜索结果的显示状态</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">isResultShow</span>: <span class="literal">false</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、在模板中绑定条件渲染</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 搜索结果 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">search-result</span> <span class="attr">v-if</span>=<span class="string">"isResultShow"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /搜索结果 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 联想建议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">search-suggestion</span> <span class="attr">v-else-if</span>=<span class="string">"searchText"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /联想建议 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 搜索历史记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">search-history</span> <span class="attr">v-else</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /搜索历史记录 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="搜索联想建议"><a href="#搜索联想建议" class="headerlink" title="搜索联想建议"></a>搜索联想建议</h2><p>基本思路：</p>
<ul>
<li>当搜索框输入内容的时候，请求加载联想建议的数据</li>
<li>将请求得到的结果绑定到模板中</li>
</ul>
<h3 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h3><p>一、将父组件中搜索框输入的内容传给联想建议子组件</p>
<p>二、在子组件中监视搜索框输入内容的变化，如果变化则请求获取联想建议数据</p>
<p>三、将获取到的联想建议数据展示到列表中</p>
<h3 id="防抖优化"><a href="#防抖优化" class="headerlink" title="防抖优化"></a>防抖优化</h3><p>1、安装 lodash</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add lodash</span></span><br><span class="line">npm i lodash</span><br></pre></td></tr></tbody></table></figure>

<p>2、防抖处理</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lodash 支持按需加载，有利于打包结果优化</span></span><br><span class="line"><span class="keyword">import</span> { debounce } <span class="keyword">from</span> <span class="string">"lodash"</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>不建议下面这样使用，因为这样会加载整个模块。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line">_.debounce()</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// debounce 函数</span></span><br><span class="line"><span class="comment">// 参数1：函数</span></span><br><span class="line"><span class="comment">// 参数2：防抖时间</span></span><br><span class="line"><span class="comment">// 返回值：防抖之后的函数，和参数1功能是一样的</span></span><br><span class="line"><span class="attr">onSearchInput</span>: debounce(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">const</span> searchContent = <span class="built_in">this</span>.searchContent</span><br><span class="line">  <span class="keyword">if</span> (!searchContent) {</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">  <span class="keyword">const</span> { data } = <span class="keyword">await</span> getSuggestions(searchContent)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 将数据添加到组件实例中</span></span><br><span class="line">  <span class="built_in">this</span>.suggestions = data.data.options</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 模板绑定</span></span><br><span class="line">}, <span class="number">200</span>),</span><br></pre></td></tr></tbody></table></figure>





<h3 id="搜索关键字高亮"><a href="#搜索关键字高亮" class="headerlink" title="搜索关键字高亮"></a>搜索关键字高亮</h3><p>如何将字符串中的指定字符在<strong>网页</strong>中高亮展示？</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Hello World"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>将需要高亮的字符包裹 HTML 标签，为其单独设置颜色。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Hello &lt;span style="</span>color: red<span class="string">"&gt;World&lt;/span&gt;"</span></span><br></pre></td></tr></tbody></table></figure>

<p>在 Vue 中如何渲染带有 HTML 标签的字符串？</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="attr">htmlStr</span>: <span class="string">'Hello &lt;span style="color: red"&gt;World&lt;/span&gt;'</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>{{ htmlStr }}<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">"htmlStr"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200112154732044.png" alt="image-20200112154732044"></p>
<p>如何把字符串中指定字符统一替换为高亮（包裹了 HTML）的字符？</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">"Hello World"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果：&lt;span style="color: red"&gt;Hello&lt;/span&gt; World</span></span><br><span class="line"><span class="string">"Hello World"</span>.replace(<span class="string">'Hello'</span>, <span class="string">'&lt;span style="color: red"&gt;Hello&lt;/span&gt;'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要注意的是，replace 方法的字符串匹配只能替换第1个满足的字符</span></span><br><span class="line"><span class="comment">// &lt;span style="color: red"&gt;Hello&lt;/span&gt; World Hello abc</span></span><br><span class="line"><span class="string">"Hello World Hello abc"</span>.replace(<span class="string">'Hello'</span>, <span class="string">'&lt;span style="color: red"&gt;Hello&lt;/span&gt;'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果想要全文替换，使用正则表达式</span></span><br><span class="line"><span class="comment">// g 全局</span></span><br><span class="line"><span class="comment">// i 忽略大小写</span></span><br><span class="line"><span class="comment">// &lt;span style="color: red"&gt;Hello&lt;/span&gt; World &lt;span style="color: red"&gt;Hello&lt;/span&gt; abc</span></span><br><span class="line"><span class="string">"Hello World Hello abc"</span>.replace(<span class="regexp">/Hello/gi</span>, <span class="string">'&lt;span style="color: red"&gt;Hello&lt;/span&gt;'</span>)</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>一个小扩展：使用字符串的 split 结合数组的 join 方法实现高亮</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"hello world 你好 hello"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ["", " world 你好 ", ""]</span></span><br><span class="line"><span class="keyword">const</span> arr = str.split(<span class="string">"hello"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// "&lt;span&gt;hello&lt;/span&gt; world 你好 &lt;span&gt;hello&lt;/span&gt;"</span></span><br><span class="line">arr.join(<span class="string">"&lt;span&gt;hello&lt;/span&gt;"</span>);</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>下面是具体的处理。</p>
<p>1、在 methods 中添加一个方法处理高亮</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数 source: 原始字符串</span></span><br><span class="line"><span class="comment">// 参数 keyword: 需要高亮的关键词</span></span><br><span class="line"><span class="comment">// 返回值：替换之后的高亮字符串</span></span><br><span class="line">highlight (source, keyword) {</span><br><span class="line">  <span class="comment">// /searchContent/ 正则表达式中的一切内容都会当做字符串使用</span></span><br><span class="line">  <span class="comment">// 这里可以 new RegExp 方式根据字符串创建一个正则表达式</span></span><br><span class="line">  <span class="comment">// RegExp 是原生 JavaScript 的内置构造函数</span></span><br><span class="line">  <span class="comment">// 参数1：字符串，注意，这里不要加 //</span></span><br><span class="line">  <span class="comment">// 参数2：匹配模式，g 全局，i 忽略大小写</span></span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(keyword, <span class="string">'gi'</span>)</span><br><span class="line">  <span class="keyword">return</span> source.replace(reg, <span class="string">`&lt;span style="color: #3296fa"&gt;<span class="subst">${keyword}</span>&lt;/span&gt;`</span>)</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>

<p>2、然后在联想建议列表项中绑定调用</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 联想建议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else-if</span>=<span class="string">"searchContent"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">icon</span>=<span class="string">"search"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">"(item, index) in suggestions"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">"onSearch(item)"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"title"</span> <span class="attr">v-html</span>=<span class="string">"highlight(item, searchContent)"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /联想建议 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="搜索结果"><a href="#搜索结果" class="headerlink" title="搜索结果"></a>搜索结果</h2><p>思路：</p>
<ul>
<li>找到数据接口</li>
<li>请求获取数据</li>
<li>将数据展示到模板中</li>
</ul>
<p>一、获取搜索关键字</p>
<p>1、声明接收父组件中的搜索框输入的内容</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">props: {</span><br><span class="line">  <span class="attr">q</span>: {</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">require</span>: <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>



<p>2、在父组件给子组件传递数据</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 搜索结果 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">search-result</span> <span class="attr">v-if</span>=<span class="string">"isResultShow"</span> <span class="attr">:q</span>=<span class="string">"searchText"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /搜索结果 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<p>最后在调试工具中查看确认是否接收到 props 数据。</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200112162223915.png" alt="image-20200112162223915"></p>
<p>二、请求获取数据</p>
<p>1、在 <code>api/serach.js</code> 添加封装获取搜索结果的请求方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取搜索结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getSearch</span>(<span class="params">params</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">"GET"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">"/app/v1_0/search"</span>,</span><br><span class="line">    params</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、请求获取</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> { getSearch } <span class="keyword">from</span> <span class="string">'@/api/search'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'SearchResult'</span>,</span><br><span class="line">  <span class="attr">components</span>: {},</span><br><span class="line">  <span class="attr">props</span>: {</span><br><span class="line">    <span class="attr">q</span>: {</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="attr">require</span>: <span class="literal">true</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">list</span>: [],</span><br><span class="line">      <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">finished</span>: <span class="literal">false</span>,</span><br><span class="line">+      page: <span class="number">1</span>,</span><br><span class="line">+      perPage: <span class="number">20</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">computed</span>: {},</span><br><span class="line">  <span class="attr">watch</span>: {},</span><br><span class="line">  created () {},</span><br><span class="line">  mounted () {},</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">+++    <span class="keyword">async</span> onLoad () {</span><br><span class="line">      <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">      <span class="keyword">const</span> { data } = <span class="keyword">await</span> getSearch({</span><br><span class="line">        <span class="attr">page</span>: <span class="built_in">this</span>.page, <span class="comment">// 页码</span></span><br><span class="line">        <span class="attr">per_page</span>: <span class="built_in">this</span>.perPage, <span class="comment">// 每页大小</span></span><br><span class="line">        <span class="attr">q</span>: <span class="built_in">this</span>.q <span class="comment">// 搜索关键字</span></span><br><span class="line">      })</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2. 将数据添加到列表中</span></span><br><span class="line">      <span class="keyword">const</span> { results } = data.data</span><br><span class="line">      <span class="built_in">this</span>.list.push(...results)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 设置加载状态结束</span></span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4. 判断数据是否加载完毕</span></span><br><span class="line">      <span class="keyword">if</span> (results.length) {</span><br><span class="line">        <span class="built_in">this</span>.page++ <span class="comment">// 更新获取下一页数据的页码</span></span><br><span class="line">      } <span class="keyword">else</span> {</span><br><span class="line">        <span class="built_in">this</span>.finished = <span class="literal">true</span> <span class="comment">// 没有数据了，将加载状态设置结束，不再 onLoad</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>三、最后，模板绑定</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"loading"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:finished</span>=<span class="string">"finished"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">finished-text</span>=<span class="string">"没有更多了"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">load</span>=<span class="string">"onLoad"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">+    <span class="attr">v-for</span>=<span class="string">"(article, index) in list"</span></span></span><br><span class="line"><span class="tag">+    <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">+    <span class="attr">:title</span>=<span class="string">"article.title"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="搜索历史记录"><a href="#搜索历史记录" class="headerlink" title="搜索历史记录"></a>搜索历史记录</h2><h3 id="添加历史记录"><a href="#添加历史记录" class="headerlink" title="添加历史记录"></a>添加历史记录</h3><p>当发生搜索的时候我们才需要记录历史记录。</p>
<p>1、在 data 中添加一个数据用来存储历史记录</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">searchHistories</span>: []</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、在触发搜索的时候，记录历史记录</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">onSearch (val) {</span><br><span class="line">  <span class="comment">// 更新文本框内容</span></span><br><span class="line">  <span class="built_in">this</span>.searchText = val</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 存储搜索历史记录</span></span><br><span class="line">  <span class="comment">// 要求：不要有重复历史记录、最新的排在最前面</span></span><br><span class="line">  <span class="keyword">const</span> index = <span class="built_in">this</span>.searchHistories.indexOf(val)</span><br><span class="line">  <span class="keyword">if</span> (index !== -<span class="number">1</span>) {</span><br><span class="line">    <span class="built_in">this</span>.searchHistories.splice(index, <span class="number">1</span>)</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">this</span>.searchHistories.unshift(val)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染搜索结果</span></span><br><span class="line">  <span class="built_in">this</span>.isResultShow = <span class="literal">true</span></span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>



<h3 id="展示历史记录"><a href="#展示历史记录" class="headerlink" title="展示历史记录"></a>展示历史记录</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 历史记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"历史记录"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"delete"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>全部删除<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">"item"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">"(item, index) in searchHistories"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"close"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /历史记录 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="删除历史记录"><a href="#删除历史记录" class="headerlink" title="删除历史记录"></a>删除历史记录</h3><p>基本思路：</p>
<ul>
<li>给历史记录中的每一项注册点击事件</li>
<li>在处理函数中判断<ul>
<li>如果是删除状态，则执行删除操作</li>
<li>如果是非删除状态，则执行搜索操作</li>
</ul>
</li>
</ul>
<p>一、处理删除相关元素的展示状态</p>
<p>1、在 data 中添加一个数据用来控制删除相关元素的显示状态</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">isDeleteShow</span>: <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、绑定使用</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 历史记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"历史记录"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">"isDeleteShow"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">"searchHistories = []"</span>&gt;</span>全部删除<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">"isDeleteShow = false"</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">v-else</span> <span class="attr">name</span>=<span class="string">"delete"</span> @<span class="attr">click</span>=<span class="string">"isDeleteShow = true"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">"item"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">"(item, index) in searchHistories"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">"onSearch(item)"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-show</span>=<span class="string">"isDeleteShow"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">name</span>=<span class="string">"close"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">click</span>=<span class="string">"searchHistories.splice(index, 1)"</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /历史记录 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>二、处理删除操作</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 历史记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"历史记录"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">"isDeleteShow"</span>&gt;</span></span><br><span class="line">+      <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">"searchHistories = []"</span>&gt;</span>全部删除<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">"isDeleteShow = false"</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">v-else</span> <span class="attr">name</span>=<span class="string">"delete"</span> @<span class="attr">click</span>=<span class="string">"isDeleteShow = true"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">"item"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">"(item, index) in searchHistories"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">+    @<span class="attr">click</span>=<span class="string">"onHistoryClick(item, index)"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">v-show</span>=<span class="string">"isDeleteShow"</span> <span class="attr">name</span>=<span class="string">"close"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /历史记录 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">onHistoryClick (item, index) {</span><br><span class="line">  <span class="comment">// 如果是删除状态，则执行删除操作</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.isDeleteShow) {</span><br><span class="line">    <span class="built_in">this</span>.searchHistories.splice(index, <span class="number">1</span>)</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// 否则执行搜索操作</span></span><br><span class="line">    <span class="built_in">this</span>.onSearch(item)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="数据持久化"><a href="#数据持久化" class="headerlink" title="数据持久化"></a>数据持久化</h3><p>1、利用 watch 监视统一存储数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">watch: {</span><br><span class="line">  searchHistories (val) {</span><br><span class="line">    <span class="comment">// 同步到本地存储</span></span><br><span class="line">    setItem(<span class="string">'serach-histories'</span>, val)</span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>



<p>2、初始化的时候从本地存储获取数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">searchHistories</span>: getItem(<span class="string">'serach-histories'</span>) || [],</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h1 id="七、文章详情"><a href="#七、文章详情" class="headerlink" title="七、文章详情"></a>七、文章详情</h1><h2 id="创建组件并配置路由-2"><a href="#创建组件并配置路由-2" class="headerlink" title="创建组件并配置路由"></a>创建组件并配置路由</h2><p>1、创建 <code>views/article/index.vue</code> 组件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-container"</span>&gt;</span>文章详情<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ArticleIndex'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">articleId</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: [<span class="built_in">Number</span>, <span class="built_in">String</span>],</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、然后将该页面配置到根级路由</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">path</span>: <span class="string">'/article/:articleId'</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'article'</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/article'</span>),</span><br><span class="line">  <span class="comment">// 将路由动态参数映射到组件的 props 中，更推荐这种做法</span></span><br><span class="line">  <span class="attr">props</span>: <span class="literal">true</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/guide/essentials/passing-props.html">官方文档：路由 props 传参</a></p>
</blockquote>
<h2 id="页面布局-4"><a href="#页面布局-4" class="headerlink" title="页面布局"></a>页面布局</h2><p>使用到的 Vant 中的组件：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/nav-bar">NavBar 导航栏</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/loading">Loading 加载</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/cell">Cell 单元格</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/button">Button 按钮</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/image">Image 图片</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/divider">Divider 分割线</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/icon">Icon 图标</a></p>
</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"page-nav-bar"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">left-arrow</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">"黑马头条"</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main-wrap"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 加载中 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"loading-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-loading</span></span></span><br><span class="line"><span class="tag">          <span class="attr">color</span>=<span class="string">"#3296fa"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">vertical</span></span></span><br><span class="line"><span class="tag">        &gt;</span>加载中<span class="tag">&lt;/<span class="name">van-loading</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- /加载中 --&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 加载完成-文章详情 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-detail"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 文章标题 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"article-title"</span>&gt;</span>这是文章标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- /文章标题 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 用户信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">class</span>=<span class="string">"user-info"</span> <span class="attr">center</span> <span class="attr">:border</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">"avatar"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">slot</span>=<span class="string">"icon"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">round</span></span></span><br><span class="line"><span class="tag">            <span class="attr">fit</span>=<span class="string">"cover"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"https://img.yzcdn.cn/vant/cat.jpeg"</span></span></span><br><span class="line"><span class="tag">          /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"user-name"</span>&gt;</span>黑马头条号<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"label"</span> <span class="attr">class</span>=<span class="string">"publish-date"</span>&gt;</span>14小时前<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">"follow-btn"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">"info"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">color</span>=<span class="string">"#3296fa"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">round</span></span></span><br><span class="line"><span class="tag">            <span class="attr">size</span>=<span class="string">"small"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">icon</span>=<span class="string">"plus"</span></span></span><br><span class="line"><span class="tag">          &gt;</span>关注<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- &lt;van-button</span></span><br><span class="line"><span class="comment">            class="follow-btn"</span></span><br><span class="line"><span class="comment">            round</span></span><br><span class="line"><span class="comment">            size="small"</span></span><br><span class="line"><span class="comment">          &gt;已关注&lt;/van-button&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- /用户信息 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 文章内容 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-content"</span>&gt;</span>这是文章内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-divider</span>&gt;</span>正文结束<span class="tag">&lt;/<span class="name">van-divider</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- /加载完成-文章详情 --&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 加载失败：404 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"failure"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>该资源不存在或已删除！<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- /加载失败：404 --&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 加载失败：其它未知错误（例如网络原因或服务端异常） --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"failure"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>内容加载失败！<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">class</span>=<span class="string">"retry-btn"</span>&gt;</span>点击重试<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- /加载失败：其它未知错误（例如网络原因或服务端异常） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 底部区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-bottom"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"comment-btn"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"default"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        <span class="attr">size</span>=<span class="string">"small"</span></span></span><br><span class="line"><span class="tag">      &gt;</span>写评论<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"comment-o"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">info</span>=<span class="string">"123"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">color</span>=<span class="string">"#777"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">color</span>=<span class="string">"#777"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"star-o"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">color</span>=<span class="string">"#777"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"good-job-o"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"share"</span> <span class="attr">color</span>=<span class="string">"#777777"</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /底部区域 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'ArticleIndex'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">articleId</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: [<span class="built_in">Number</span>, <span class="built_in">String</span>],</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.article-container</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.main-wrap</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="css">    <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">top</span>: <span class="number">92px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">bottom</span>: <span class="number">88px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">overflow-y</span>: scroll;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.article-detail</span> {</span></span><br><span class="line"><span class="css">    <span class="selector-class">.article-title</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">padding</span>: <span class="number">50px</span> <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">color</span>: <span class="number">#3a3a3a</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.user-info</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.avatar</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">70px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">70px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">margin-right</span>: <span class="number">17px</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">      <span class="selector-class">.van-cell__label</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">margin-top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">      <span class="selector-class">.user-name</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">font-size</span>: <span class="number">24px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#3a3a3a</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">      <span class="selector-class">.publish-date</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">font-size</span>: <span class="number">23px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: <span class="number">#b7b7b7</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">      <span class="selector-class">.follow-btn</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">170px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">58px</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.article-content</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">padding</span>: <span class="number">55px</span> <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">      /deep/ <span class="selector-tag">p</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: justify;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.loading-wrap</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">200px</span> <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.error-wrap</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">200px</span> <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.van-icon</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">122px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">color</span>: <span class="number">#b4b4b4</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">    <span class="selector-class">.text</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">color</span>: <span class="number">#666666</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">margin</span>: <span class="number">33px</span> <span class="number">0</span> <span class="number">46px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">    <span class="selector-class">.retry-btn</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">width</span>: <span class="number">280px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>: <span class="number">70px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">line-height</span>: <span class="number">70px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#c3c3c3</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">color</span>: <span class="number">#666666</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.article-bottom</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="css">    <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">justify-content</span>: space-around;</span></span><br><span class="line"><span class="css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">    <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">88px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#d8d8d8</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.comment-btn</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">width</span>: <span class="number">282px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>: <span class="number">46px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#eeeeee</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">line-height</span>: <span class="number">46px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">color</span>: <span class="number">#a7a7a7</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">    <span class="selector-class">.van-icon</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.van-info</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: <span class="number">#e22829</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="关于后端返回数据中的大数字问题"><a href="#关于后端返回数据中的大数字问题" class="headerlink" title="关于后端返回数据中的大数字问题"></a>关于后端返回数据中的大数字问题</h2><p>之所以请求文章详情返回 404 是因为我们请求发送的文章 ID （article.art_id）不正确。</p>
<p>JavaScript 能够准确表示的整数范围在<code>-2^53</code>到<code>2^53</code>之间（不含两个端点），超过这个范围，无法精确表示这个值，这使得 JavaScript 不适合进行科学和金融方面的精确计算。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) <span class="comment">// 9007199254740992</span></span><br><span class="line"></span><br><span class="line"><span class="number">9007199254740992</span>  <span class="comment">// 9007199254740992</span></span><br><span class="line"><span class="number">9007199254740993</span>  <span class="comment">// 9007199254740992</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) === <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) + <span class="number">1</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure>

<p>上面代码中，超出 2 的 53 次方之后，一个数就不精确了。<br>ES6 引入了<code>Number.MAX_SAFE_INTEGER</code>和<code>Number.MIN_SAFE_INTEGER</code>这两个常量，用来表示这个范围的上下限。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.MAX_SAFE_INTEGER === <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) - <span class="number">1</span></span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.MAX_SAFE_INTEGER === <span class="number">9007199254740991</span></span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Number</span>.MIN_SAFE_INTEGER === -<span class="built_in">Number</span>.MAX_SAFE_INTEGER</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.MIN_SAFE_INTEGER === -<span class="number">9007199254740991</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure>

<p>上面代码中，可以看到 JavaScript 能够精确表示的极限。</p>
<p>后端返回的数据一般都是 <strong>JSON 格式的字符串</strong>。</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'{ <span class="attr">"id"</span>: <span class="number">9007199254740995</span>, <span class="attr">"name"</span>: <span class="string">"Jack"</span>, <span class="attr">"age"</span>: <span class="number">18</span> }'</span><br></pre></td></tr></tbody></table></figure>

<p>如果这个字符不做任何处理，你能方便的获取到字符串中的指定数据吗？非常麻烦。所以我们要把它转换为 JavaScript 对象来使用就很方便了。</p>
<p>幸运的是 axios 为了方便我们使用数据，它会在内部使用 <code>JSON.parse()</code> 把后端返回的数据转为 JavaScript 对象。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// { id: 9007199254740996, name: 'Jack', age: 18 }</span></span><br><span class="line"><span class="built_in">JSON</span>.parse(<span class="string">'{ "id": 9007199254740995, "name": "Jack", "age": 18 }'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到，超出安全整数范围的 id 无法精确表示，这个问题并不是 axios 的错。</p>
<p>了解了什么是大整数的概念，接下来的问题是如何解决？</p>
<p><a target="_blank" rel="noopener" href="https://github.com/sidorares/json-bigint">json-bigint</a> 是一个第三方包，它可以帮我们很好的处理这个问题。</p>
<p>使用它的第一步就是把它安装到你的项目中。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i json-bigint</span><br></pre></td></tr></tbody></table></figure>

<p>下面是使用它的一个简单示例。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonStr = <span class="string">'{ "art_id": 1245953273786007552 }'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(jsonStr)) <span class="comment">// 1245953273786007600</span></span><br><span class="line"><span class="comment">// JSON.stringify()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// JSONBig 可以处理数据中超出 JavaScript 安全整数范围的问题</span></span><br><span class="line"><span class="built_in">console</span>.log(JSONBig.parse(jsonStr)) <span class="comment">// 把 JSON 格式的字符串转为 JavaScript 对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用的时候需要把 BigNumber 类型的数据转为字符串来使用</span></span><br><span class="line"><span class="built_in">console</span>.log(JSONBig.parse(jsonStr).art_id.toString()) <span class="comment">// 1245953273786007552</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(JSONBig.parse(jsonStr)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(JSONBig.stringify(JSONBig.parse(jsonStr))) <span class="comment">// 把 JavaScript 对象 转为 JSON 格式的字符串转</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1582099315865-5e805425-7abf-4cf2-9df3-acc2ef8f9bb9.png" alt="image.png"></p>
<blockquote>
<p>json-bigint 会把超出 JS 安全整数范围的数字转为一个 BigNumber 类型的对象，对象数据是它内部的一个算法处理之后的，我们要做的就是在使用的时候转为字符串来使用。</p>
</blockquote>
<p>通过 Axios 请求得到的数据都是 Axios 处理（JSON.parse）之后的，我们应该在 Axios 执行处理之前手动使用 json-bigint 来解析处理。Axios 提供了自定义处理原始后端返回数据的 API：<code>transformResponse</code> 。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jsonBig <span class="keyword">from</span> <span class="string">'json-bigint'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> json = <span class="string">'{ "value" : 9223372036854775807, "v2": 123 }'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(jsonBig.parse(json))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> request = axios.create({</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">'http://ttapi.research.itcast.cn/'</span>, <span class="comment">// 接口基础路径</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// transformResponse 允许自定义原始的响应数据（字符串）</span></span><br><span class="line">  <span class="attr">transformResponse</span>: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="comment">// 如果转换成功则返回转换的数据结果</span></span><br><span class="line">      <span class="keyword">return</span> jsonBig.parse(data)</span><br><span class="line">    } <span class="keyword">catch</span> (err) {</span><br><span class="line">      <span class="comment">// 如果转换失败，则包装为统一数据格式并返回</span></span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">        data</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }]</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>扩展：ES2020 BigInt</p>
<p>ES2020 引入了一种新的数据类型 BigInt（大整数），来解决这个问题。BigInt 只用来表示整数，没有位数的限制，任何位数的整数都可以精确表示。</p>
<p>参考链接：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt</a></li>
<li><a target="_blank" rel="noopener" href="http://es6.ruanyifeng.com/#docs/number#BigInt-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">http://es6.ruanyifeng.com/#docs/number#BigInt-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B</a></li>
</ul>
</blockquote>
<h2 id="展示文章详情"><a href="#展示文章详情" class="headerlink" title="展示文章详情"></a>展示文章详情</h2><p>思路：</p>
<ul>
<li>找到数据接口</li>
<li>封装请求方法</li>
<li>请求获取数据</li>
<li>模板绑定</li>
</ul>
<p>一、请求并展示文章详情</p>
<p>1、在 <code>api/article.js</code> 中新增封装接口方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据 id 获取指定文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticleById = <span class="function"><span class="params">articleId</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/app/v1_0/articles/<span class="subst">${articleId}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、在组件中调用获取文章详情</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> { getArticleById } <span class="keyword">from</span> <span class="string">'@/api/article'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'ArticlePage'</span>,</span><br><span class="line">  <span class="attr">components</span>: {},</span><br><span class="line">  <span class="attr">props</span>: {</span><br><span class="line">    <span class="attr">articleId</span>: {</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">+      article: {} <span class="comment">// 文章详情</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">computed</span>: {},</span><br><span class="line">  <span class="attr">watch</span>: {},</span><br><span class="line">  created () {</span><br><span class="line">+    <span class="built_in">this</span>.loadArticle()</span><br><span class="line">  },</span><br><span class="line">  mounted () {},</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">+++    <span class="keyword">async</span> loadArticle () {</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> { data } = <span class="keyword">await</span> getArticleById(<span class="built_in">this</span>.articleId)</span><br><span class="line">        <span class="built_in">this</span>.article = data.data</span><br><span class="line">      } <span class="keyword">catch</span> (err) {</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>3、模板绑定</p>
<h2 id="处理内容加载状态"><a href="#处理内容加载状态" class="headerlink" title="处理内容加载状态"></a>处理内容加载状态</h2><p>需求：</p>
<ul>
<li>加载中，显示 loading</li>
<li>加载成功，显示文章详情</li>
<li>加载失败，显示错误提示<ul>
<li>如果 404，提示资源不存在</li>
<li>其它的，提示加载失败，用户可以点击重试重新加载</li>
</ul>
</li>
</ul>
<h2 id="关于文章正文的样式"><a href="#关于文章正文的样式" class="headerlink" title="关于文章正文的样式"></a>关于文章正文的样式</h2><p>文章正文包括各种数据：段落、标题、列表、链接、图片、视频等资源。</p>
<ul>
<li>将 <a target="_blank" rel="noopener" href="https://github.com/sindresorhus/github-markdown-css">github-markdown-css</a> 样式文件下载到项目中</li>
<li>配置不要转换样式文件中的字号</li>
</ul>
<h2 id="图片点击预览"><a href="#图片点击预览" class="headerlink" title="图片点击预览"></a>图片点击预览</h2><p>一、<a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/image-preview">ImagePreview 图片预览</a> 的使用</p>
<p>二、处理图片点击预览</p>
<p>思路：</p>
<p>1、从文章内容中获取到所有的 img DOM 节点</p>
<p>2、获取文章内容中所有的图片地址</p>
<p>3、遍历所有 img 节点，给每个节点注册点击事件</p>
<p>4、在 img 点击事件处理函数中，调用 ImagePreview 预览</p>
<h2 id="关注用户"><a href="#关注用户" class="headerlink" title="关注用户"></a>关注用户</h2><p>思路：</p>
<ul>
<li>给按钮注册点击事件</li>
<li>在事件处理函数中<ul>
<li>如果已关注，则取消关注</li>
<li>如果没有关注，则添加关注</li>
</ul>
</li>
</ul>
<p>下面是具体实现。</p>
<h3 id="视图处理"><a href="#视图处理" class="headerlink" title="视图处理"></a>视图处理</h3><h3 id="功能处理"><a href="#功能处理" class="headerlink" title="功能处理"></a>功能处理</h3><ul>
<li>找到数据接口</li>
<li>封装请求方法</li>
<li>请求调用</li>
<li>视图更新</li>
</ul>
<p>1、在 <code>api/user.js</code> 中添加封装请求方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加关注</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addFollow = <span class="function"><span class="params">userId</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/user/followings'</span>,</span><br><span class="line">    <span class="attr">data</span>: {</span><br><span class="line">      <span class="attr">target</span>: userId</span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消关注</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteFollow = <span class="function"><span class="params">userId</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'DELETE'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/app/v1_0/user/followings/<span class="subst">${userId}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、给关注/取消关注按钮注册点击事件</p>
<p>3、在事件处理函数中</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { addFollow, deleteFollow } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onFollow () {</span><br><span class="line">  <span class="comment">// 开启按钮的 loading 状态</span></span><br><span class="line">  <span class="built_in">this</span>.isFollowLoading = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// 如果已关注，则取消关注</span></span><br><span class="line">    <span class="keyword">const</span> authorId = <span class="built_in">this</span>.article.aut_id</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.article.is_followed) {</span><br><span class="line">      <span class="keyword">await</span> deleteFollow(authorId)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 否则添加关注</span></span><br><span class="line">      <span class="keyword">await</span> addFollow(authorId)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新视图</span></span><br><span class="line">    <span class="built_in">this</span>.article.is_followed = !<span class="built_in">this</span>.article.is_followed</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">'操作失败'</span>)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关闭按钮的 loading 状态</span></span><br><span class="line">  <span class="built_in">this</span>.isFollowLoading = <span class="literal">false</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>最后测试。</p>
<h3 id="loading-效果"><a href="#loading-效果" class="headerlink" title="loading 效果"></a>loading 效果</h3><p>两个作用：</p>
<ul>
<li>交互反馈</li>
<li>防止网络慢用户多次点击按钮导致重复触发点击事件</li>
</ul>
<h3 id="组件封装"><a href="#组件封装" class="headerlink" title="组件封装"></a>组件封装</h3><h2 id="文章收藏"><a href="#文章收藏" class="headerlink" title="文章收藏"></a>文章收藏</h2><blockquote>
<p>该功能和关注用户的处理思路几乎一样，建议由学员自己编写。</p>
</blockquote>
<h3 id="封装组件"><a href="#封装组件" class="headerlink" title="封装组件"></a>封装组件</h3><h3 id="处理视图"><a href="#处理视图" class="headerlink" title="处理视图"></a>处理视图</h3><h3 id="功能处理-1"><a href="#功能处理-1" class="headerlink" title="功能处理"></a>功能处理</h3><p>思路：</p>
<ul>
<li>给收藏按钮注册点击事件</li>
<li>如果已经收藏了，则取消收藏</li>
<li>如果没有收藏，则添加收藏</li>
</ul>
<p>下面是具体实现。</p>
<p>1、在 <code>api/article.js</code> 添加封装数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 收藏文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addCollect = <span class="function"><span class="params">target</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/article/collections'</span>,</span><br><span class="line">    <span class="attr">data</span>: {</span><br><span class="line">      target</span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消收藏文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteCollect = <span class="function"><span class="params">target</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'DELETE'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/app/v1_0/article/collections/<span class="subst">${target}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、给收藏按钮注册点击事件</p>
<p>3、处理函数</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onCollect () {</span><br><span class="line">  <span class="comment">// 这里 loading 不仅仅是为了交互提示，更重要的是请求期间禁用背景点击功能，防止用户不断的操作界面发出请求</span></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading({</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">    <span class="attr">message</span>: <span class="string">'操作中...'</span>,</span><br><span class="line">    <span class="attr">forbidClick</span>: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// 如果已收藏，则取消收藏</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.article.is_collected) {</span><br><span class="line">      <span class="keyword">await</span> deleteCollect(<span class="built_in">this</span>.articleId)</span><br><span class="line">      <span class="comment">// this.article.is_collected = false</span></span><br><span class="line">      <span class="built_in">this</span>.$toast.success(<span class="string">'取消收藏'</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 添加收藏</span></span><br><span class="line">      <span class="keyword">await</span> addCollect(<span class="built_in">this</span>.articleId)</span><br><span class="line">      <span class="comment">// this.article.is_collected = true</span></span><br><span class="line">      <span class="built_in">this</span>.$toast.success(<span class="string">'收藏成功'</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">this</span>.article.is_collected = !<span class="built_in">this</span>.article.is_collected</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">'操作失败'</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="文章点赞"><a href="#文章点赞" class="headerlink" title="文章点赞"></a>文章点赞</h2><blockquote>
<p>该功能和关注用户的处理思路几乎一样，建议由学员自己编写。</p>
</blockquote>
<p>article 中的 <code>attitude</code> 表示用户对文章的态度</p>
<ul>
<li><code>-1</code> 无态度</li>
<li><code>0</code> 不喜欢</li>
<li><code>1</code> 已点赞</li>
</ul>
<p>思路：</p>
<ul>
<li>给点赞按钮注册点击事件</li>
<li>如果已经点赞，则请求取消点赞</li>
<li>如果没有点赞，则请求点赞</li>
</ul>
<p>1、添加封装数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点赞</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addLike = <span class="function"><span class="params">articleId</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/article/likings'</span>,</span><br><span class="line">    <span class="attr">data</span>: {</span><br><span class="line">      <span class="attr">target</span>: articleId</span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消点赞</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteLike = <span class="function"><span class="params">articleId</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'DELETE'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/app/v1_0/article/likings/<span class="subst">${articleId}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、给点赞按钮注册点击事件</p>
<p>3、处理函数</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLike () {</span><br><span class="line">  <span class="comment">// 两个作用：1、交互提示 2、防止网络慢用户连续不断的点击按钮请求</span></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading({</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">    <span class="attr">message</span>: <span class="string">'操作中...'</span>,</span><br><span class="line">    <span class="attr">forbidClick</span>: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// 如果已经点赞，则取消点赞</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.article.attitude === <span class="number">1</span>) {</span><br><span class="line">      <span class="keyword">await</span> deleteLike(<span class="built_in">this</span>.articleId)</span><br><span class="line">      <span class="built_in">this</span>.article.attitude = -<span class="number">1</span></span><br><span class="line">      <span class="built_in">this</span>.$toast.success(<span class="string">'取消点赞'</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 否则添加点赞</span></span><br><span class="line">      <span class="keyword">await</span> addLike(<span class="built_in">this</span>.articleId)</span><br><span class="line">      <span class="built_in">this</span>.article.attitude = <span class="number">1</span></span><br><span class="line">      <span class="built_in">this</span>.$toast.success(<span class="string">'点赞成功'</span>)</span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">'操作失败'</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="八、文章评论"><a href="#八、文章评论" class="headerlink" title="八、文章评论"></a>八、文章评论</h1><h2 id="展示文章评论列表"><a href="#展示文章评论列表" class="headerlink" title="展示文章评论列表"></a>展示文章评论列表</h2><h3 id="准备组件-1"><a href="#准备组件-1" class="headerlink" title="准备组件"></a>准备组件</h3><p>为了更好的开发和维护，这里我们把文章评论单独封装到一个组件中来处理。</p>
<p>1、创建 <code>src/views/article/components/article-comment.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-comments"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 评论列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">"loading"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:finished</span>=<span class="string">"finished"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">finished-text</span>=<span class="string">"没有更多了"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">load</span>=<span class="string">"onLoad"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">v-for</span>=<span class="string">"item in list"</span> <span class="attr">:key</span>=<span class="string">"item"</span> <span class="attr">:title</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">slot</span>=<span class="string">"icon"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">width</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">height</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">style</span>=<span class="string">"margin-right: 10px;"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">"https://img.yzcdn.cn/vant/cat.jpeg"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: #466b9d;"</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"label"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: #363636;"</span>&gt;</span>我出去跟别人说我的是。。。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"margin-right: 10px;"</span>&gt;</span>3天前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">size</span>=<span class="string">"mini"</span> <span class="attr">type</span>=<span class="string">"default"</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">"right-icon"</span> <span class="attr">name</span>=<span class="string">"like-o"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 评论列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 发布评论 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">class</span>=<span class="string">"publish-wrap"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">clearable</span> <span class="attr">placeholder</span>=<span class="string">"请输入评论内容"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">slot</span>=<span class="string">"button"</span> <span class="attr">size</span>=<span class="string">"mini"</span> <span class="attr">type</span>=<span class="string">"info"</span>&gt;</span>发布<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /发布评论 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">    <span class="attr">name</span>: <span class="string">"ArticleComment"</span>,</span></span><br><span class="line"><span class="javascript">    <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">        <span class="attr">list</span>: [], <span class="comment">// 评论列表</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">loading</span>: <span class="literal">false</span>, <span class="comment">// 上拉加载更多的 loading</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">finished</span>: <span class="literal">false</span> <span class="comment">// 是否加载结束</span></span></span><br><span class="line"><span class="javascript">      };</span></span><br><span class="line"><span class="javascript">    },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> {</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 异步更新数据</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span></span><br><span class="line"><span class="javascript">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.list.push(<span class="built_in">this</span>.list.length + <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">          }</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 加载状态结束</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.loading = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">          <span class="comment">// 数据全部加载完成</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (<span class="built_in">this</span>.list.length &gt;= <span class="number">40</span>) {</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.finished = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">          }</span></span><br><span class="line"><span class="javascript">        }, <span class="number">500</span>);</span></span><br><span class="line"><span class="javascript">      }</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  };</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.publish-wrap</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="css">    <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.van-list</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-bottom</span>: <span class="number">45px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>2、在文章详情页面中加载注册文章评论子组件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ArticleComment <span class="keyword">from</span> <span class="string">'./components/article-comment'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">components</span>: {</span><br><span class="line">    ArticleComment</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>3、在文章详情页面的加载失败提示消息后面使用文章评论子组件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文章评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">article-comment</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /文章评论 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>最终页面效果如下：</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20191206152846065.png" alt="image-20191206152846065"></p>
<h3 id="获取数据并展示"><a href="#获取数据并展示" class="headerlink" title="获取数据并展示"></a>获取数据并展示</h3><blockquote>
<p>提示：有评论数据的文章 id：<code>139987</code>。</p>
</blockquote>
<p>步骤：</p>
<ul>
<li>封装接口</li>
<li>请求获取数据</li>
<li>处理模板</li>
</ul>
<p>实现：</p>
<p>1、在 <code>api/comment.js</code> 中添加封装请求方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评论接口模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">"@/utils/request"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取文章列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getComments</span>(<span class="params">params</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">"GET"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">"/app/v1_0/comments"</span>,</span><br><span class="line">    params</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、请求获取数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">articleComment</span>: { <span class="comment">// 文章评论相关数据</span></span><br><span class="line">      <span class="attr">list</span>: [],</span><br><span class="line">      <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">finished</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">offset</span>: <span class="literal">null</span>, <span class="comment">// 请求下一页数据的页码</span></span><br><span class="line">      <span class="attr">totalCount</span>: <span class="number">0</span> <span class="comment">// 总数据条数</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLoad () {</span><br><span class="line">  <span class="keyword">const</span> articleComment = <span class="built_in">this</span>.articleComment</span><br><span class="line">  <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">  <span class="keyword">const</span> { data } = <span class="keyword">await</span> getComments({</span><br><span class="line">    <span class="attr">type</span>: <span class="string">'a'</span>, <span class="comment">// 评论类型，a-对文章(article)的评论，c-对评论(comment)的回复</span></span><br><span class="line">    <span class="attr">source</span>: <span class="built_in">this</span>.articleId, <span class="comment">// 源id，文章id或评论id</span></span><br><span class="line">    <span class="attr">offset</span>: articleComment.offset, <span class="comment">// 获取评论数据的偏移量，值为评论id，表示从此id的数据向后取，不传表示从第一页开始读取数据</span></span><br><span class="line">    <span class="attr">limit</span>: <span class="number">10</span> <span class="comment">// 每页大小</span></span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 将数据添加到列表中</span></span><br><span class="line">  <span class="keyword">const</span> { results } = data.data</span><br><span class="line">  articleComment.list.push(...results)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新总数据条数</span></span><br><span class="line">  articleComment.totalCount = data.data.total_count</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 将加载更多的 loading 设置为 false</span></span><br><span class="line">  articleComment.loading = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. 判断是否还有数据</span></span><br><span class="line">  <span class="keyword">if</span> (results.length) {</span><br><span class="line">    articleComment.offset = data.data.last_id <span class="comment">// 更新获取下一页数据的页码</span></span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    articleComment.finished = <span class="literal">true</span> <span class="comment">// 没有数据了，关闭加载更多</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>3、模板绑定</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"loading"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:finished</span>=<span class="string">"finished"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">finished-text</span>=<span class="string">"没有更多了"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">load</span>=<span class="string">"onLoad"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">v-for</span>=<span class="string">"item in list"</span> + <span class="attr">:key</span>=<span class="string">"item.com_id.toString()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">      <span class="attr">slot</span>=<span class="string">"icon"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">round</span></span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">height</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">"margin-right: 10px;"</span></span></span><br><span class="line"><span class="tag">      +</span></span><br><span class="line"><span class="tag">      <span class="attr">:src</span>=<span class="string">"item.aut_photo"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    + <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: #466b9d;"</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span>{{ item.aut_name }}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"label"</span>&gt;</span></span><br><span class="line">      +</span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: #363636;"</span>&gt;</span>{{ item.content }}<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        +</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"margin-right: 10px;"</span></span></span><br><span class="line"><span class="tag">          &gt;</span>{{ item.pubdate | relativeTime }}&lt;/span</span><br><span class="line">        &gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">size</span>=<span class="string">"mini"</span> <span class="attr">type</span>=<span class="string">"default"</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">"right-icon"</span> <span class="attr">name</span>=<span class="string">"like-o"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 评论列表 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="展示文章评论总数量"><a href="#展示文章评论总数量" class="headerlink" title="展示文章评论总数量"></a>展示文章评论总数量</h3><h3 id="文章评论项"><a href="#文章评论项" class="headerlink" title="文章评论项"></a>文章评论项</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">class</span>=<span class="string">"comment-item"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">      <span class="attr">slot</span>=<span class="string">"icon"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"avatar"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">round</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fit</span>=<span class="string">"cover"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">"https://img.yzcdn.cn/vant/cat.jpeg"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title-wrap"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-name"</span>&gt;</span>用户名称<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"like-btn"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">icon</span>=<span class="string">"good-job-o"</span></span></span><br><span class="line"><span class="tag">      &gt;</span>赞<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"label"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"comment-content"</span>&gt;</span>这是评论内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bottom-info"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"comment-pubdate"</span>&gt;</span>4天前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"reply-btn"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        &gt;</span>回复 0<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'CommentItem'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.comment-item</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.avatar</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">72px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">72px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-right</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.title-wrap</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.user-name</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">color</span>: <span class="number">#406599</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">26px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.comment-content</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#222222</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">word-break</span>: break-all;</span></span><br><span class="line"><span class="css">    <span class="attribute">text-align</span>: justify;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.comment-pubdate</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">19px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#222</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-right</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.bottom-info</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.reply-btn</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">135px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">48px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">line-height</span>: <span class="number">48px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">21px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#222</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.like-btn</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">19px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-right</span>: <span class="number">7px</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.van-icon</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>绑定之后：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">class</span>=<span class="string">"comment-item"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">      <span class="attr">slot</span>=<span class="string">"icon"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"avatar"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">round</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fit</span>=<span class="string">"cover"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:src</span>=<span class="string">"comment.aut_photo"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title-wrap"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-name"</span>&gt;</span>{{ comment.aut_name }}<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"like-btn"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">icon</span>=<span class="string">"good-job-o"</span></span></span><br><span class="line"><span class="tag">      &gt;</span>{{ comment.like_count || '赞' }}<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"label"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"comment-content"</span>&gt;</span>{{ comment.content }}<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bottom-info"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"comment-pubdate"</span>&gt;</span>{{ comment.pubdate | relativeTime }}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"reply-btn"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        &gt;</span>回复 {{ comment.reply_count }}<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'CommentItem'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">comment</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.comment-item</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.avatar</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">72px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">72px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-right</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.title-wrap</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.user-name</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">color</span>: <span class="number">#406599</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">26px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.comment-content</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#222222</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">word-break</span>: break-all;</span></span><br><span class="line"><span class="css">    <span class="attribute">text-align</span>: justify;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.comment-pubdate</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">19px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#222</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-right</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.bottom-info</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.reply-btn</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">135px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">48px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">line-height</span>: <span class="number">48px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">21px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#222</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.like-btn</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">19px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-right</span>: <span class="number">7px</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.van-icon</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="评论点赞"><a href="#评论点赞" class="headerlink" title="评论点赞"></a>评论点赞</h2><p>1、在 <code>api/comment.js</code> 中添加封装两个数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对评论或评论回复点赞</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addCommentLike</span>(<span class="params">commentId</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">"POST"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">"/app/v1_0/comment/likings"</span>,</span><br><span class="line">    <span class="attr">data</span>: {</span><br><span class="line">      <span class="attr">target</span>: commentId</span><br><span class="line">    }</span><br><span class="line">  });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消对评论或评论回复点赞</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteCommentLike</span>(<span class="params">commentId</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">"DELETE"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/app/v1_0/comment/likings/<span class="subst">${commentId}</span>`</span></span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、然后给评论项中的 <code>like</code> 图标注册点击事件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">  <span class="attr">slot</span>=<span class="string">"right-icon"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">color</span>=<span class="string">"red"</span></span></span><br><span class="line"><span class="tag">  +</span></span><br><span class="line"><span class="tag">  <span class="attr">:name</span>=<span class="string">"item.is_liking ? 'like' : 'like-o'"</span></span></span><br><span class="line"><span class="tag">  +</span></span><br><span class="line"><span class="tag">  @<span class="attr">click</span>=<span class="string">"onCommentLike(item)"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>3、在事件处理函数中</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> {</span><br><span class="line">  getComments,</span><br><span class="line">  addComment,</span><br><span class="line">+  addCommentLike,</span><br><span class="line">+  deleteCommentLike</span><br><span class="line">} <span class="keyword">from</span> <span class="string">'@/api/comment'</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onCommentLike (comment) {</span><br><span class="line">  <span class="comment">// 如果已经赞了则取消点赞</span></span><br><span class="line">  <span class="keyword">if</span> (comment.is_liking) {</span><br><span class="line">    <span class="keyword">await</span> deleteCommentLike(comment.com_id)</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// 如果没有赞，则点赞</span></span><br><span class="line">    <span class="keyword">await</span> addCommentLike(comment.com_id)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新视图状态</span></span><br><span class="line">  comment.is_liking = !comment.is_liking</span><br><span class="line">  <span class="built_in">this</span>.$toast(<span class="string">'操作成功'</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="发布文章评论"><a href="#发布文章评论" class="headerlink" title="发布文章评论"></a>发布文章评论</h2><h3 id="准备弹出层"><a href="#准备弹出层" class="headerlink" title="准备弹出层"></a>准备弹出层</h3><h3 id="封装组件-1"><a href="#封装组件-1" class="headerlink" title="封装组件"></a>封装组件</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"comment-post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"post-field"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">"message"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rows</span>=<span class="string">"2"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">autosize</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"textarea"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">maxlength</span>=<span class="string">"50"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">"请输入留言"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">show-word-limit</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"post-btn"</span></span></span><br><span class="line"><span class="tag">    &gt;</span>发布<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'CommentPost'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      <span class="attr">message</span>: <span class="string">''</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.comment-post</span> {</span></span><br><span class="line"><span class="css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">  <span class="attribute">padding</span>: <span class="number">32px</span> <span class="number">0</span> <span class="number">32px</span> <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.post-field</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#f5f7f9</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.post-btn</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">150px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#6ba3d8</span>;</span></span><br><span class="line"><span class="css">    &amp;<span class="selector-pseudo">::before</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>步骤：</p>
<ul>
<li>注册发布点击事件</li>
<li>请求提交表单</li>
<li>根据响应结果进行后续处理</li>
</ul>
<p>一、使用弹层展示发布评论</p>
<p>1、添加弹层组件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">isPostShow</span>: <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 发布文章评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"isPostShow"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /发布文章评论 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>提示：不设置高度的时候，内容会自动撑开弹层高度</p>
</blockquote>
<p>2、点击发评论按钮的时候显示弹层</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">"write-btn"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">"default"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">round</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">"small"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click</span>=<span class="string">"isPostShow = true"</span></span></span><br><span class="line"><span class="tag">&gt;</span>写评论<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>二、封装发布评论组件</p>
<p>1、创建 <code>post-comment.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"post-comment"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"post-field"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">"message"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rows</span>=<span class="string">"2"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">autosize</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"textarea"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">maxlength</span>=<span class="string">"50"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">"优质评论将会被优先展示"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">show-word-limit</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"primary"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">size</span>=<span class="string">"small"</span></span></span><br><span class="line"><span class="tag">    &gt;</span>发布<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'PostComment'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      <span class="attr">message</span>: <span class="string">''</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.post-comment</span> {</span></span><br><span class="line"><span class="css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">  <span class="attribute">padding</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">align-items</span>: flex-end;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.post-field</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">background</span>: <span class="number">#f5f7f9</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-right</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、在详情页加载注册</p>
<p>3、在发布评论的弹层中使用</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 发布文章评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"isPostShow"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">post-comment</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /发布文章评论 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>三、发布评论</p>
<p>1、在 <code>api/comment.js</code> 中添加封装数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加评论或评论回复</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addComment</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">"POST"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">"/app/v1_0/comments"</span>,</span><br><span class="line">    data</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、绑定获取添加评论的输入框数据并且注册发布按钮的点击事件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">inputComment</span>: <span class="string">''</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 发布评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">class</span>=<span class="string">"publish-wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-field</span> + <span class="attr">v-model</span>=<span class="string">"inputComment"</span> <span class="attr">clearable</span> <span class="attr">placeholder</span>=<span class="string">"请输入评论内容"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">slot</span>=<span class="string">"button"</span> <span class="attr">size</span>=<span class="string">"mini"</span> <span class="attr">type</span>=<span class="string">"info"</span> + @<span class="attr">click</span>=<span class="string">"onAddComment"</span></span></span><br><span class="line"><span class="tag">      &gt;</span>发布&lt;/van-button</span><br><span class="line">    &gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /发布评论 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>3、在事件处理函数中</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> {</span><br><span class="line">  getComments,</span><br><span class="line">+  addComment</span><br><span class="line">} <span class="keyword">from</span> <span class="string">'@/api/comment'</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onAddComment () {</span><br><span class="line">  <span class="keyword">const</span> inputComment = <span class="built_in">this</span>.inputComment.trim()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 非空校验</span></span><br><span class="line">  <span class="keyword">if</span> (!inputComment.length) {</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 请求添加</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> addComment({</span><br><span class="line">    <span class="attr">target</span>: <span class="built_in">this</span>.$route.params.articleId, <span class="comment">// 评论的目标id（评论文章即为文章id，对评论进行回复则为评论id）</span></span><br><span class="line">    <span class="attr">content</span>: inputComment <span class="comment">// 评论内容</span></span><br><span class="line">    <span class="comment">// art_id // 文章id，对评论内容发表回复时，需要传递此参数，表明所属文章id。对文章进行评论，不要传此参数。</span></span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将发布的最新评论展示到列表顶部</span></span><br><span class="line">  <span class="built_in">this</span>.list.unshift(res.data.data.new_obj)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清空文本框</span></span><br><span class="line">  <span class="built_in">this</span>.inputComment = <span class="string">''</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="请求发布"><a href="#请求发布" class="headerlink" title="请求发布"></a>请求发布</h3><p>基本思路：</p>
<ul>
<li>找到数据接口</li>
<li>封装请求方法</li>
<li>注册发布点击事件<ul>
<li>请求发布</li>
<li>成功：将发布的内容展示到列表中</li>
<li>失败：提示失败</li>
</ul>
</li>
</ul>
<p>1、封装数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发布评论</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addComment = <span class="function"><span class="params">data</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/comments'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>2、给发布按钮点击事件</p>
<p>3、事件处理函数</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onAddComment () {</span><br><span class="line">  <span class="comment">// 1. 拿到数据</span></span><br><span class="line">  <span class="keyword">const</span> postMessage = <span class="built_in">this</span>.postMessage</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 非空校验</span></span><br><span class="line">  <span class="keyword">if</span> (!postMessage) {</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading({</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">    <span class="attr">message</span>: <span class="string">'发布中...'</span>,</span><br><span class="line">    <span class="attr">forbidClick</span>: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// 2. 请求提交</span></span><br><span class="line">    <span class="keyword">const</span> { data } = <span class="keyword">await</span> addComment({</span><br><span class="line">      <span class="attr">target</span>: <span class="built_in">this</span>.articleId, <span class="comment">// 评论的目标id（评论文章即为文章id，对评论进行回复则为评论id）</span></span><br><span class="line">      <span class="attr">content</span>: postMessage</span><br><span class="line">      <span class="comment">// art_id: // 文章id，对评论内容发表回复时，需要传递此参数，表明所属文章id。对文章进行评论，不要传此参数。</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭发布评论的弹层</span></span><br><span class="line">    <span class="built_in">this</span>.isPostShow = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将最新发布的评论展示到列表的顶部</span></span><br><span class="line">    <span class="built_in">this</span>.articleComment.list.unshift(data.data.new_obj)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新文章评论的总数量</span></span><br><span class="line">    <span class="built_in">this</span>.articleComment.totalCount++</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空文本框</span></span><br><span class="line">    <span class="built_in">this</span>.postMessage = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.$toast.success(<span class="string">'发布成功'</span>)</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">'发布失败'</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="发布成功处理"><a href="#发布成功处理" class="headerlink" title="发布成功处理"></a>发布成功处理</h3><h2 id="评论回复"><a href="#评论回复" class="headerlink" title="评论回复"></a>评论回复</h2><h3 id="准备回复弹层"><a href="#准备回复弹层" class="headerlink" title="准备回复弹层"></a>准备回复弹层</h3><p>一、在详情页中使用弹层用来展示文章的回复</p>
<p>1、在 data 中添加数据用来控制展示回复弹层的显示状态</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">isReplyShow</span>: <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、在详情页中添加使用弹层组件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"isReplyShow"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">"height: 95%"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  评论回复</span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /评论回复 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>二、当点击评论项组件中的回复按钮的时候展示弹层</p>
<p>1、在 <code>comment-item.vue</code> 组件中点击回复按钮的时候，对外发布自定义事件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;van-button</span><br><span class="line">  size="mini"</span><br><span class="line">  type="default"</span><br><span class="line">  @click="$emit('click-reply')"</span><br><span class="line">&gt;回复 {{ comment.reply_count }}&lt;/van-button&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>2、在详情页组件中使用的位置监听处理</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">comment-item</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">"(comment, index) in articleComment.list"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:comment</span>=<span class="string">"comment"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click-reply</span>=<span class="string">"isReplyShow = true"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="点击回复显示弹出层"><a href="#点击回复显示弹出层" class="headerlink" title="点击回复显示弹出层"></a>点击回复显示弹出层</h3><h3 id="封装内容组件"><a href="#封装内容组件" class="headerlink" title="封装内容组件"></a>封装内容组件</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"comment-reply"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">:title</span>=<span class="string">"`${comment.reply_count}条回复`"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">"left"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"cross"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">"$emit('click-close')"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 当前评论项 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /当前评论项 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"所有回复"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 评论的回复列表 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /评论的回复列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /底部 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'CommentReply'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="传递当前点击回复的评论项"><a href="#传递当前点击回复的评论项" class="headerlink" title="传递当前点击回复的评论项"></a>传递当前点击回复的评论项</h3><h3 id="处理头部"><a href="#处理头部" class="headerlink" title="处理头部"></a>处理头部</h3><h3 id="处理当前评论项"><a href="#处理当前评论项" class="headerlink" title="处理当前评论项"></a>处理当前评论项</h3><p>一、让 <code>comment-reply.vue</code> 组件拿到点击回复的评论对象</p>
<p>1、在 <code>comment-item.vue</code> 组件中点击回复按钮的时候把评论对象给传出来</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">"mini"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">"default"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click</span>=<span class="string">"$emit('click-reply', comment)"</span></span></span><br><span class="line"><span class="tag">&gt;</span>回复 {{ comment.reply_count }}<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>2、在文章详情组件中接收处理</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">currentComment</span>: {} <span class="comment">// 点击回复的那个评论对象</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">comment-item</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">"(comment, index) in articleComment.list"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:comment</span>=<span class="string">"comment"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click-reply</span>=<span class="string">"onReplyShow"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onReplyShow (comment) {</span><br><span class="line">  <span class="comment">// 将子组件中传给我评论对象存储到当前组件</span></span><br><span class="line">  <span class="built_in">this</span>.currentComment = comment</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 展示评论回复弹层</span></span><br><span class="line">  <span class="built_in">this</span>.isReplyShow = <span class="literal">true</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>3、在详情组件中将 <code>currentComment</code> 传递给 <code>comment-reply.vue</code> 组件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"isReplyShow"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">"height: 95%"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">comment-reply</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click-close</span>=<span class="string">"isReplyShow = false"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:comment</span>=<span class="string">"currentComment"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /评论回复 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>4、在 <code>comment-reply.vue</code> 组件中声明接收</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">props: {</span><br><span class="line">  <span class="attr">comment</span>: {</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Object</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>

<p>最后使用调试工具查看 props 数据是否接收正确。</p>
<p>二、在 <code>comment-reply.vue</code> 组件中展示当前评论</p>
<p>1、加载注册 <code>comment-item.vue</code> 组件</p>
<p>2、使用展示</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"comment-reply"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">:title</span>=<span class="string">"`${comment.reply_count}条回复`"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">"left"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"cross"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">"$emit('click-close')"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 当前评论项 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">comment-item</span> <span class="attr">:comment</span>=<span class="string">"comment"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /当前评论项 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 评论的回复列表 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /评论的回复列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /底部 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>





<p>一：把点击回复的评论对象传递给评论回复组件</p>
<p>1、在 data 中添加一个数据用来存储点击回复的评论对象</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data () {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">currentComment</span>: {} <span class="comment">// 存储当前点击回复的评论对象</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、在点击回复的处理函数中评论对象存储到数据中</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onReplyShow (comment) {</span><br><span class="line">+  <span class="built_in">this</span>.currentComment = comment</span><br><span class="line">  <span class="comment">// 显示回复的弹层</span></span><br><span class="line">  <span class="built_in">this</span>.isReplyShow = <span class="literal">true</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>3、把当前组件的 <code>currentComment</code> 传递给评论回复组件</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"isReplyShow"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">get-container</span>=<span class="string">"body"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">round</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">"{ height: '90%' }"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 回复列表 --&gt;</span></span><br><span class="line">  + <span class="tag">&lt;<span class="name">comment-reply</span> <span class="attr">:comment</span>=<span class="string">"currentComment"</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- /回复列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>4、在评论回复组件中声明 <code>props</code> 接收数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">props: {</span><br><span class="line">  <span class="attr">comment</span>: {</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Object</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>

<p>测试：点击不同的评论回复按钮，查看子组件中的 props 数据 <code>comment</code> 是否是当前点击回复所在的评论对象。</p>
<p>二、数据绑定：在评论回复组件中展示当前评论</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">+</span><br><span class="line"><span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">:title</span>=<span class="string">"comment.reply_count + '条回复'"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">"left"</span> <span class="attr">name</span>=<span class="string">"cross"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 当前评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"当前评论"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">    <span class="attr">slot</span>=<span class="string">"icon"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">round</span></span></span><br><span class="line"><span class="tag">    <span class="attr">width</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">height</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">"margin-right: 10px;"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:src</span>=<span class="string">"comment.aut_photo"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  + <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: #466b9d;"</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span>{{ comment.aut_name }}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"label"</span>&gt;</span></span><br><span class="line">    +</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: #363636;"</span>&gt;</span>{{ comment.content }}<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      +</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"margin-right: 10px;"</span></span></span><br><span class="line"><span class="tag">        &gt;</span>{{ comment.pubdate | relativeTime }}&lt;/span</span><br><span class="line">      &gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">size</span>=<span class="string">"mini"</span> <span class="attr">type</span>=<span class="string">"default"</span> +</span></span><br><span class="line"><span class="tag">        &gt;</span>回复 {{ comment.reply_count }}&lt;/van-button</span><br><span class="line">      &gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">"right-icon"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /当前评论 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="展示评论回复列表"><a href="#展示评论回复列表" class="headerlink" title="展示评论回复列表"></a>展示评论回复列表</h3><p>基本思路：</p>
<ul>
<li>回复列表和文章的评论列表几乎是一样的</li>
<li>重用把之前封装的评论列表</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"comment-reply"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">:title</span>=<span class="string">"`${comment.reply_count}条回复`"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">"left"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"cross"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">"$emit('click-close')"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 当前评论项 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">comment-item</span> <span class="attr">:comment</span>=<span class="string">"comment"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /当前评论项 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"所有回复"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 评论的回复列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">"loading"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:finished</span>=<span class="string">"finished"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">finished-text</span>=<span class="string">"没有更多了"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">load</span>=<span class="string">"onLoad"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">comment-item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">"(comment, index) in list"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:comment</span>=<span class="string">"comment"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /评论的回复列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /底部 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> CommentItem <span class="keyword">from</span> <span class="string">'./comment-item'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> { getComments } <span class="keyword">from</span> <span class="string">'@/api/comment'</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'CommentReply'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {</span></span><br><span class="line"><span class="javascript">    CommentItem</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">comment</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      <span class="attr">list</span>: [],</span></span><br><span class="line"><span class="javascript">      <span class="attr">loading</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">finished</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">offset</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">limit</span>: <span class="number">20</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> onLoad () {</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 1. 请求获取数据</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> { data } = <span class="keyword">await</span> getComments({</span></span><br><span class="line"><span class="javascript">        <span class="attr">type</span>: <span class="string">'c'</span>, <span class="comment">// 评论类型，a-对文章(article)的评论，c-对评论(comment)的回复</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">source</span>: <span class="built_in">this</span>.comment.com_id.toString(), <span class="comment">// 源id，文章id或评论id</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">offset</span>: <span class="built_in">this</span>.offset, <span class="comment">// 获取评论数据的偏移量，值为评论id，表示从此id的数据向后取，不传表示从第一页开始读取数据</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">limit</span>: <span class="built_in">this</span>.limit <span class="comment">// 获取的评论数据个数，不传表示采用后端服务设定的默认每页数据量</span></span></span><br><span class="line"><span class="javascript">      })</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 2. 将数据添加到列表中</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> { results } = data.data</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.list.push(...results)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 3. 关闭 loading</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 4. 判断数据是否加载完毕</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (results.length) {</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.offset = data.data.last_id</span></span><br><span class="line"><span class="javascript">      } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.finished = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">      }</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  }</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h3 id="解决弹层中组件内容不更新问题"><a href="#解决弹层中组件内容不更新问题" class="headerlink" title="解决弹层中组件内容不更新问题"></a>解决弹层中组件内容不更新问题</h3><p>弹层组件：</p>
<ul>
<li>如果初始的条件是 false，则弹层的内容不会渲染</li>
<li>程序运行期间，当条件变为 true 的时候，弹层才渲染了内容</li>
<li>之后切换弹层的展示，弹层只是通过 CSS 控制隐藏和显示</li>
</ul>
<p>弹层渲染出来以后就只是简单的切换显示和隐藏，里面的内容也不再重新渲染了，所以会导致我们的评论的回复列表不会动态更新了。解决办法就是在每次弹层显示的时候重新渲染组件。</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"isReplyShow"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">get-container</span>=<span class="string">"body"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">round</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">"bottom"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">"{ height: '90%' }"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 回复列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">comment-reply</span> <span class="attr">:comment</span>=<span class="string">"currentComment"</span> + <span class="attr">v-if</span>=<span class="string">"isReplyShow"</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- /回复列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="发布回复"><a href="#发布回复" class="headerlink" title="发布回复"></a>发布回复</h3><h1 id="九、用户页面"><a href="#九、用户页面" class="headerlink" title="九、用户页面"></a>九、用户页面</h1><blockquote>
<p>该模块作为学生作业，不讲解，仅供源码参考。</p>
</blockquote>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200111104547462.png" alt="image-20200111104547462" width="250">



<h2 id="创建组件并配置路由-3"><a href="#创建组件并配置路由-3" class="headerlink" title="创建组件并配置路由"></a>创建组件并配置路由</h2><p>1、创建 <code>views/user/index.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-container"</span>&gt;</span>用户页面<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'UserPage'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、配置到根路由</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">path</span>: <span class="string">'/user/:userId'</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'user'</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/user'</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>最后访问 <code>/user/用户ID</code> 测试。</p>
<h2 id="页面布局-5"><a href="#页面布局-5" class="headerlink" title="页面布局"></a>页面布局</h2><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"page-nav-bar"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">left-arrow</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">"用户名"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">click-left</span>=<span class="string">"$router.back()"</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-info"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"base-info"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"avatar"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">fit</span>=<span class="string">"cover"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">"https://img.yzcdn.cn/vant/cat.jpeg"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right-area"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"stats-wrap"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"stats-item"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"count"</span>&gt;</span>66<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>发布<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"stats-item"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"count"</span>&gt;</span>88<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>关注<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"stats-item"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"count"</span>&gt;</span>28<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>粉丝<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"stats-item"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"count"</span>&gt;</span>160<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>获赞<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">class</span>=<span class="string">"follow-btn"</span>&gt;</span>关注<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"label-info"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bio-wrap"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label"</span>&gt;</span>简介：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>这是用户简介<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'UserIndex'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {</span></span><br><span class="line"><span class="javascript">    <span class="attr">userId</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="attr">type</span>: [<span class="built_in">Number</span>, <span class="built_in">String</span>, <span class="built_in">Object</span>],</span></span><br><span class="line"><span class="javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.user-container</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.user-info</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">25px</span> <span class="number">32px</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.base-info</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">      <span class="attribute">margin-bottom</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.avatar</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">155px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">155px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">margin-right</span>: <span class="number">62px</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">    <span class="selector-class">.label-info</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">font-size</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.bio-wrap</span> {</span></span><br><span class="line"><span class="css">        <span class="selector-class">.label</span> {</span></span><br><span class="line"><span class="css">          <span class="attribute">color</span>: <span class="number">#646263</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-class">.text</span> {</span></span><br><span class="line"><span class="css">          <span class="attribute">color</span>: <span class="number">#212121</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">  <span class="selector-class">.right-area</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">flex</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">    <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="css">    <span class="attribute">justify-content</span>: space-evenly;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.stats-wrap</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">      <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.stats-item</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.count</span> {</span></span><br><span class="line"><span class="css">          <span class="attribute">font-size</span>: <span class="number">26px</span>;</span></span><br><span class="line"><span class="css">          <span class="attribute">color</span>: <span class="number">#0d0a10</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-class">.text</span> {</span></span><br><span class="line"><span class="css">          <span class="attribute">font-size</span>: <span class="number">21px</span>;</span></span><br><span class="line"><span class="css">          <span class="attribute">color</span>: <span class="number">#9c9b9d</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">    <span class="selector-class">.follow-btn</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">width</span>: <span class="number">289px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>: <span class="number">55px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">line-height</span>: <span class="number">55px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">background-color</span>: <span class="number">#6bb5ff</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">title</span>=<span class="string">"黑马头条号"</span> <span class="attr">left-arrow</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用户信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-info-container"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"col1"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">fit</span>=<span class="string">"cover"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">"https://img.yzcdn.cn/vant/cat.jpeg"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col2"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"count"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>发布<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"count"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>关注<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"count"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>粉丝<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"count"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>获赞<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"action"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">"primary"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">size</span>=<span class="string">"small"</span></span></span><br><span class="line"><span class="tag">            &gt;</span>私信<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">"default"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">size</span>=<span class="string">"small"</span></span></span><br><span class="line"><span class="tag">            &gt;</span>编辑资料<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"intro-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>认证：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>用户的认证信息<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>简介：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>用户的简介信息<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /用户信息 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 文章列表 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /文章列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'UserPage'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.user-container</span> {</span></span><br><span class="line"><span class="css">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.user-info-container</span> {</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">    &gt;<span class="selector-class">.row1</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">      <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">      <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">      <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-class">.item</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.text</span> {</span></span><br><span class="line"><span class="css">          <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">      &gt;<span class="selector-class">.col1</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">      &gt;<span class="selector-class">.col2</span> {</span></span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="css">        <span class="attribute">justify-content</span>: space-evenly;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">70%</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">12px</span>;</span></span><br><span class="line"><span class="css">        &gt;<span class="selector-class">.row1</span> {</span></span><br><span class="line"><span class="css">          <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">          <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-class">.action</span> {</span></span><br><span class="line"><span class="css">          <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">          <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">          <span class="selector-class">.van-button</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">45%</span>;</span></span><br><span class="line"><span class="css">          }</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">      }</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="展示用户信息"><a href="#展示用户信息" class="headerlink" title="展示用户信息"></a>展示用户信息</h2><p>步骤：</p>
<ul>
<li>封装数据接口</li>
<li>请求获取数据</li>
<li>模板绑定</li>
</ul>
<p>1、在 <code>api/user.js</code> 中添加获取指定用户信息的数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取指定用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserById = <span class="function"><span class="params">userId</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/app/v1_0/users/<span class="subst">${userId}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、在用户页面中请求获取数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> { getUserById } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'UserPage'</span>,</span><br><span class="line">  <span class="attr">components</span>: {},</span><br><span class="line">  <span class="attr">props</span>: {},</span><br><span class="line">  data () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">+      user: {} <span class="comment">// 用户信息</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">computed</span>: {},</span><br><span class="line">  <span class="attr">watch</span>: {},</span><br><span class="line">  created () {</span><br><span class="line">+    <span class="built_in">this</span>.loadUser()</span><br><span class="line">  },</span><br><span class="line">  mounted () {},</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">+++    <span class="keyword">async</span> loadUser () {</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> { data } = <span class="keyword">await</span> getUserById(<span class="built_in">this</span>.$route.params.userId)</span><br><span class="line">        <span class="built_in">this</span>.user = data.data</span><br><span class="line">      } <span class="keyword">catch</span> (err) {</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">        <span class="built_in">this</span>.$toast(<span class="string">'获取用户数据失败'</span>)</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>3、模板绑定</p>
<h2 id="用户关注"><a href="#用户关注" class="headerlink" title="用户关注"></a>用户关注</h2><h2 id="展示用户文章列表"><a href="#展示用户文章列表" class="headerlink" title="展示用户文章列表"></a>展示用户文章列表</h2><h3 id="列表组件"><a href="#列表组件" class="headerlink" title="列表组件"></a>列表组件</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;van-list</span><br><span class="line">  v-model="loading"</span><br><span class="line">  :finished="finished"</span><br><span class="line">  finished-text="没有更多了"</span><br><span class="line">  @load="onLoad"</span><br><span class="line">&gt;</span><br><span class="line">  &lt;van-cell</span><br><span class="line">    v-for="item in list"</span><br><span class="line">    :key="item"</span><br><span class="line">    :title="item"</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/van-list&gt;</span><br><span class="line">export default {</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      list: [],</span><br><span class="line">      loading: false,</span><br><span class="line">      finished: false</span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  methods: {</span><br><span class="line">    onLoad() {</span><br><span class="line">      // 异步更新数据</span><br><span class="line">      setTimeout(() =&gt; {</span><br><span class="line">        for (let i = 0; i &lt; 10; i++) {</span><br><span class="line">          this.list.push(this.list.length + 1);</span><br><span class="line">        }</span><br><span class="line">        // 加载状态结束</span><br><span class="line">        this.loading = false;</span><br><span class="line"></span><br><span class="line">        // 数据全部加载完成</span><br><span class="line">        if (this.list.length &gt;= 40) {</span><br><span class="line">          this.finished = true;</span><br><span class="line">        }</span><br><span class="line">      }, 500);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="分析列表组件使用"><a href="#分析列表组件使用" class="headerlink" title="分析列表组件使用"></a>分析列表组件使用</h3><p>List 的运行机制是什么？</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List 会监听浏览器的滚动事件并计算列表的位置，当列表底部与可视区域的距离小于offset时，List 会触发一次 load 事件。</span><br></pre></td></tr></tbody></table></figure>

<p>为什么 List 初始化后会立即触发 load 事件？</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List 初始化后会触发一次 load 事件，用于加载第一屏的数据，这个特性可以通过`immediate-check`属性关闭。</span><br></pre></td></tr></tbody></table></figure>

<p>为什么会连续触发 load 事件？</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果一次请求加载的数据条数较少，导致列表内容无法铺满当前屏幕，List 会继续触发 load 事件，直到内容铺满屏幕或数据全部加载完成。因此你需要调整每次获取的数据条数，理想情况下每次请求获取的数据条数应能够填满一屏高度。</span><br></pre></td></tr></tbody></table></figure>

<p>loading 和 finished 分别是什么含义？</p>
<blockquote>
<p><code>List</code>有以下三种状态，理解这些状态有助于你正确地使用<code>List</code>组件：</p>
<ul>
<li>非加载中，<code>loading</code>为<code>false</code>，此时会根据列表滚动位置判断是否触发<code>load</code>事件（列表内容不足一屏幕时，会直接触发）</li>
<li>加载中，<code>loading</code>为<code>true</code>，表示正在发送异步请求，此时不会触发<code>load</code>事件</li>
<li>加载完成，<code>finished</code>为<code>true</code>，此时不会触发<code>load</code>事件</li>
</ul>
<p>在每次请求完毕后，需要手动将<code>loading</code>设置为<code>false</code>，表示本次 load 加载结束</p>
</blockquote>
<p>使用 float 布局后一直触发加载？</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">若 List 的内容使用了 float 布局，可以在容器上添加van-clearfix类名来清除浮动，使得 List 能正确判断元素位置</span><br></pre></td></tr></tbody></table></figure>

<h3 id="展示文章列表"><a href="#展示文章列表" class="headerlink" title="展示文章列表"></a>展示文章列表</h3><p>1、封装获取用户文章列表的数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取指定用户的文章列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticlesByUser = <span class="function">(<span class="params">userId, params</span>) =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/app/v1_0/users/<span class="subst">${userId}</span>/articles`</span>,</span><br><span class="line">    params</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2、在用户页面中请求获取数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getUserById } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span><br><span class="line">+ <span class="keyword">import</span> { getArticlesByUser } <span class="keyword">from</span> <span class="string">'@/api/article'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'UserPage'</span>,</span><br><span class="line">  <span class="attr">components</span>: {},</span><br><span class="line">  <span class="attr">props</span>: {},</span><br><span class="line">  data () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">user</span>: {}, <span class="comment">// 用户信息</span></span><br><span class="line">      <span class="attr">list</span>: [], <span class="comment">// 列表数据</span></span><br><span class="line">      <span class="attr">loading</span>: <span class="literal">false</span>, <span class="comment">// 控制上拉加载更多的 loading</span></span><br><span class="line">      <span class="attr">finished</span>: <span class="literal">false</span>, <span class="comment">// 控制是否加载结束了</span></span><br><span class="line">+      page: <span class="number">1</span> <span class="comment">// 获取下一页数据的页码</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">computed</span>: {},</span><br><span class="line">  <span class="attr">watch</span>: {},</span><br><span class="line">  created () {</span><br><span class="line">    <span class="built_in">this</span>.loadUser()</span><br><span class="line">  },</span><br><span class="line">  mounted () {},</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="keyword">async</span> loadUser () {</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> { data } = <span class="keyword">await</span> getUserById(<span class="built_in">this</span>.$route.params.userId)</span><br><span class="line">        <span class="built_in">this</span>.user = data.data</span><br><span class="line">      } <span class="keyword">catch</span> (err) {</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">        <span class="built_in">this</span>.$toast(<span class="string">'获取用户数据失败'</span>)</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">+++    <span class="keyword">async</span> onLoad () {</span><br><span class="line">      <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">      <span class="keyword">const</span> { data } = <span class="keyword">await</span> getArticlesByUser(<span class="built_in">this</span>.$route.params.userId, {</span><br><span class="line">        <span class="attr">page</span>: <span class="built_in">this</span>.page, <span class="comment">// 可选的，默认是第 1 页</span></span><br><span class="line">        <span class="attr">per_page</span>: <span class="number">20</span> <span class="comment">// 可选的，默认每页 10 条</span></span><br><span class="line">      })</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2. 把数据添加到列表中</span></span><br><span class="line">      <span class="comment">// list []</span></span><br><span class="line">      <span class="comment">// data.data.results []</span></span><br><span class="line">      <span class="comment">// ...[1, 2, 3] 会把数组给展开，所谓的展开就是一个一个的拿出来</span></span><br><span class="line">      <span class="keyword">const</span> { results } = data.data</span><br><span class="line">      <span class="built_in">this</span>.list.push(...results)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 加载状态结束</span></span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4. 判断数据是否全部加载完毕</span></span><br><span class="line">      <span class="keyword">if</span> (results.length) {</span><br><span class="line">        <span class="built_in">this</span>.page++ <span class="comment">// 更新获取下一页数据的页码</span></span><br><span class="line">      } <span class="keyword">else</span> {</span><br><span class="line">        <span class="built_in">this</span>.finished = <span class="literal">true</span> <span class="comment">// 没有数据了，不需要加载更多了</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h1 id="十、编辑用户资料"><a href="#十、编辑用户资料" class="headerlink" title="十、编辑用户资料"></a>十、编辑用户资料</h1><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1566431661910.png" width="300">



<h2 id="创建组件并配置路由-4"><a href="#创建组件并配置路由-4" class="headerlink" title="创建组件并配置路由"></a>创建组件并配置路由</h2><p>1、创建 <code>views/user/index.vue</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">title</span>=<span class="string">"个人信息"</span> <span class="attr">left-arrow</span> <span class="attr">right-text</span>=<span class="string">"保存"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"头像"</span> <span class="attr">is-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">width</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">height</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">fit</span>=<span class="string">"cover"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">"http://toutiao.meiduo.site/FgSTA3msGyxp5-Oufnm5c0kjVgW7"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"昵称"</span> <span class="attr">value</span>=<span class="string">"abc"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"性别"</span> <span class="attr">value</span>=<span class="string">"男"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"生日"</span> <span class="attr">value</span>=<span class="string">"2019-9-27"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">    <span class="attr">name</span>: <span class="string">"UserIndex"</span></span></span><br><span class="line"><span class="javascript">  };</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>2、将该页面配置到根路由</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'user-profile'</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="string">'/user/profile'</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/user-profile'</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="页面布局-6"><a href="#页面布局-6" class="headerlink" title="页面布局"></a>页面布局</h2><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-profile"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"page-nav-bar"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">"个人信息"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">left-arrow</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">click-left</span>=<span class="string">"$router.back()"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 个人信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">class</span>=<span class="string">"avatar-cell"</span> <span class="attr">title</span>=<span class="string">"头像"</span> <span class="attr">is-link</span> <span class="attr">center</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"avatar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fit</span>=<span class="string">"cover"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">"https://img.yzcdn.cn/vant/cat.jpeg"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"昵称"</span> <span class="attr">value</span>=<span class="string">"内容"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"性别"</span> <span class="attr">value</span>=<span class="string">"内容"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"生日"</span> <span class="attr">value</span>=<span class="string">"内容"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /个人信息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">'UserProfile'</span>,</span></span><br><span class="line"><span class="javascript">  <span class="attr">components</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">props</span>: {},</span></span><br><span class="line"><span class="javascript">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {}</span></span><br><span class="line"><span class="javascript">  },</span></span><br><span class="line"><span class="javascript">  <span class="attr">computed</span>: {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">watch</span>: {},</span></span><br><span class="line"><span class="javascript">  created () {},</span></span><br><span class="line"><span class="javascript">  mounted () {},</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: {}</span></span><br><span class="line"><span class="javascript">}</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-class">.user-profile</span> {</span></span><br><span class="line"><span class="css">  <span class="selector-class">.avatar-cell</span> {</span></span><br><span class="line"><span class="css">    <span class="selector-class">.van-cell__value</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">      <span class="attribute">flex-direction</span>: row-reverse;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">    <span class="selector-class">.avatar</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">width</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  }</span></span><br><span class="line"><span class="css">}</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h2 id="展示用户信息-1"><a href="#展示用户信息-1" class="headerlink" title="展示用户信息"></a>展示用户信息</h2><p>思路：</p>
<ul>
<li>找到数据接口</li>
<li>封装请求方法</li>
<li>请求获取数据</li>
<li>模板绑定</li>
</ul>
<p>1、在 <code>api/user.js</code> 中添加封装数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、在 <code>views/user/index.vue</code> 组件中请求获取数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>3、模板绑定</p>
<h2 id="修改昵称"><a href="#修改昵称" class="headerlink" title="修改昵称"></a>修改昵称</h2><p>一、准备弹出层</p>
<p>二、封装组件</p>
<p>三、页面布局</p>
<p>四、基本功能处理</p>
<p>五、更新完成</p>
<h2 id="修改性别"><a href="#修改性别" class="headerlink" title="修改性别"></a>修改性别</h2><h2 id="修改生日"><a href="#修改生日" class="headerlink" title="修改生日"></a>修改生日</h2><h2 id="修改头像"><a href="#修改头像" class="headerlink" title="修改头像"></a>修改头像</h2><h3 id="图片上传预览"><a href="#图片上传预览" class="headerlink" title="图片上传预览"></a>图片上传预览</h3><p>方式一：结合服务器的图片上传预览</p>
<p><img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/1567067894388.png" alt="1567067894388"></p>
<p>方式二：纯客户端实现上传图片预览</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取文文件对象</span></span><br><span class="line"><span class="keyword">const</span> file = fileInput.files[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置图片的 src</span></span><br><span class="line">img.src = <span class="built_in">window</span>.URL.createObjectURL(file)</span><br></pre></td></tr></tbody></table></figure>

<p>客户端上传预览示例：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>客户端图片上传预览示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.img-wrap</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">      <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-tag">img</span> {</span></span><br><span class="line"><span class="css">      <span class="attribute">max-width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">    }</span></span><br><span class="line"><span class="css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>客户端图片上传预览示例<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"img-wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"img"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file"</span> <span class="attr">onchange</span>=<span class="string">"onFileChange()"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> img = <span class="built_in">document</span>.querySelector(<span class="string">'#img'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> file = <span class="built_in">document</span>.querySelector(<span class="string">'#file'</span>)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">onFileChange</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 得到 file-input 的文件对象</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> fileObj = file.files[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> data = <span class="built_in">window</span>.URL.createObjectURL(fileObj)</span></span><br><span class="line"><span class="javascript">      img.src = data</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>接下来就是在项目中使用纯客户端的方式处理用户头像上传预览。</p>
<p>在 <code>views/user/index.vue</code> 组件中：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">title</span>=<span class="string">"个人信息"</span> <span class="attr">left-arrow</span> <span class="attr">right-text</span>=<span class="string">"保存"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">      +</span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"头像"</span> <span class="attr">is-link</span> @<span class="attr">click</span>=<span class="string">"onChangePhoto"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span> <span class="attr">round</span> <span class="attr">width</span>=<span class="string">"30"</span> <span class="attr">height</span>=<span class="string">"30"</span> <span class="attr">:src</span>=<span class="string">"user.photo"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"昵称"</span> <span class="attr">:value</span>=<span class="string">"user.name"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"性别"</span> <span class="attr">:value</span>=<span class="string">"user.gender === 0 ? '男' : '女'"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"生日"</span> <span class="attr">:value</span>=<span class="string">"user.birthday"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      表单元素的 hidden 表示隐藏这个表单元素</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    + <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">hidden</span> <span class="attr">ref</span>=<span class="string">"file"</span> @<span class="attr">change</span>=<span class="string">"onFileChange"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> { getProfile } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">    <span class="attr">name</span>: <span class="string">'UserIndex'</span>,</span></span><br><span class="line"><span class="javascript">    data () {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">        <span class="attr">user</span>: {}</span></span><br><span class="line"><span class="javascript">      }</span></span><br><span class="line"><span class="javascript">    },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    created () {</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.loadUserProfile()</span></span><br><span class="line"><span class="javascript">    },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> loadUserProfile () {</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> { data } = <span class="keyword">await</span> getProfile()</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.user = data.data</span></span><br><span class="line"><span class="javascript">      },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  +    onChangePhoto () {</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$refs.file.click()</span></span><br><span class="line"><span class="javascript">      },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  +    onFileChange () {</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.user.photo = <span class="built_in">window</span>.URL.createObjectURL(<span class="built_in">this</span>.$refs.file.files[<span class="number">0</span>])</span></span><br><span class="line"><span class="javascript">      }</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  }</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>


<h3 id="头像裁切"><a href="#头像裁切" class="headerlink" title="头像裁切"></a>头像裁切</h3><p>方案一：结合服务端的图片裁切上传流程</p>
<img src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/image-20200418015503681.png" alt="image-20200418015503681">

<p>方案二：纯客户端的图片裁切上传流程</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/Input/file">&lt;input type=”file”&gt;</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/File/Using_files_from_web_applications">在web应用程序中使用文件</a></li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">viewMode: 1,</span><br><span class="line">dragMode: 'move',</span><br><span class="line">aspectRatio: 1,</span><br><span class="line">autoCropArea: 1,</span><br><span class="line">cropBoxMovable: false,</span><br><span class="line">cropBoxResizable: false,</span><br><span class="line">background: false,</span><br><span class="line">movable: true</span><br></pre></td></tr></tbody></table></figure>



<h3 id="保存更新"><a href="#保存更新" class="headerlink" title="保存更新"></a>保存更新</h3><p>如果是基于服务端的裁切，则使用：<a target="_blank" rel="noopener" href="https://github.com/fengyuanchen/cropperjs#getdatarounded">getData</a> 方法，该方法得到裁切的区域参数。</p>
<p>如果是纯客户端的图片裁切，则使用：<a target="_blank" rel="noopener" href="https://github.com/fengyuanchen/cropperjs#getcroppedcanvasoptions">getCroppedCanvas</a> 方法，该方法得到裁切之后的图片对象（类似于URL.createObjectURL 方法得到的文件对象）。</p>
<p>步骤：</p>
<ul>
<li>封装接口</li>
<li>请求提交</li>
<li>更新视图</li>
</ul>
<p>1、在 <code>api/user.js</code> 中添加封装数据接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1、接口重用</span></span><br><span class="line"><span class="comment"> * 2、接口维护</span></span><br><span class="line"><span class="comment"> * 实际开发过程中，接口经常容易变化，</span></span><br><span class="line"><span class="comment"> * 你能记住你在哪里请求了这个接口吗？很难记住</span></span><br><span class="line"><span class="comment"> * 怎么办呢？</span></span><br><span class="line"><span class="comment"> *  我们单独的把接口请求的代码封装起来，统一的放到一起。</span></span><br><span class="line"><span class="comment"> * 放到哪里呢？</span></span><br><span class="line"><span class="comment"> *  我们放到项目的 api 目录中，</span></span><br><span class="line"><span class="comment"> *  根据接口的种类进行归类管理</span></span><br><span class="line"><span class="comment"> *  例如用户相关的接口放到 user.js 中</span></span><br><span class="line"><span class="comment"> *      文章相关的接口放到 article.js 中</span></span><br><span class="line"><span class="comment"> * 如何封装呢？</span></span><br><span class="line"><span class="comment"> *  一个函数，接收参数，返回请求结果就可以了。</span></span><br><span class="line"><span class="comment"> * 用户接口相关请求模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'@/utils/request'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 登录</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span> (<span class="params">user</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="comment">// method 用来指定请求方法，这是 axios 的固定 API，不能瞎写</span></span><br><span class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="comment">// url 用来指定请求路径</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/authorizations'</span>,</span><br><span class="line">    <span class="comment">// data 是 axios 请求要求的字段名，用来传递请求体数据的</span></span><br><span class="line">    <span class="attr">data</span>: user</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 关注用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">followUser</span> (<span class="params">userId</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/user/followings'</span>,</span><br><span class="line">    <span class="attr">data</span>: {</span><br><span class="line">      <span class="attr">target</span>: userId <span class="comment">// 用户id</span></span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消关注用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">unFollowUser</span> (<span class="params">userId</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'DELETE'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/user/followings/'</span> + userId</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户自己信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getSelf</span> (<span class="params">userId</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/user'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户个人资料</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getProfile</span> (<span class="params">userId</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/user/profile'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新用户头像</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">+ <span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateUserPhoto</span> (<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'PATCH'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/app/v1_0/user/photo'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>2、在 <code>views/user/index.vue</code> 组件中保存提交</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">"个人信息"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">left-arrow</span></span></span><br><span class="line"><span class="tag">      <span class="attr">right-text</span>=<span class="string">"保存"</span></span></span><br><span class="line"><span class="tag">      +</span></span><br><span class="line"><span class="tag">      @<span class="attr">click-right</span>=<span class="string">"onSave"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"头像"</span> <span class="attr">is-link</span> @<span class="attr">click</span>=<span class="string">"onChangePhoto"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span> <span class="attr">round</span> <span class="attr">width</span>=<span class="string">"30"</span> <span class="attr">height</span>=<span class="string">"30"</span> <span class="attr">:src</span>=<span class="string">"user.photo"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"昵称"</span> <span class="attr">:value</span>=<span class="string">"user.name"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"性别"</span> <span class="attr">:value</span>=<span class="string">"user.gender === 0 ? '男' : '女'"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"生日"</span> <span class="attr">:value</span>=<span class="string">"user.birthday"</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      表单元素的 hidden 表示隐藏这个表单元素</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">hidden</span> <span class="attr">ref</span>=<span class="string">"file"</span> @<span class="attr">change</span>=<span class="string">"onFileChange"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  + <span class="keyword">import</span> { getProfile, updateUserPhoto } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">    <span class="attr">name</span>: <span class="string">'UserIndex'</span>,</span></span><br><span class="line"><span class="javascript">    data () {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">        <span class="attr">user</span>: {}</span></span><br><span class="line"><span class="javascript">      }</span></span><br><span class="line"><span class="javascript">    },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    created () {</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.loadUserProfile()</span></span><br><span class="line"><span class="javascript">    },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> loadUserProfile () {</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> { data } = <span class="keyword">await</span> getProfile()</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.user = data.data</span></span><br><span class="line"><span class="javascript">      },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      onChangePhoto () {</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$refs.file.click()</span></span><br><span class="line"><span class="javascript">      },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      onFileChange () {</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> fileObj = <span class="built_in">this</span>.$refs.file.files[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (fileObj) {</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.user.photo = <span class="built_in">window</span>.URL.createObjectURL(fileObj)</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript">      },</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  +    <span class="keyword">async</span> onSave () {</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 如果 Content-Type 要求是  application/json  ，则 data 传普通对象 {}</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 如果 Content-Type 要求是  multipart/form-data ，则 data 传 FormData 对象</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 纵观所有数据接口，你会发现大多数的接口都要求 Content-Type 要求是  application/json</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 一般只有涉及到文件上传的数据接口才要求Content-Type 要求是  multipart/form-data</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 这个时候传递一个 FormData 对象</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$toast.loading({</span></span><br><span class="line"><span class="javascript">          <span class="attr">duration</span>: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span></span><br><span class="line"><span class="javascript">          <span class="attr">forbidClick</span>: <span class="literal">true</span>, <span class="comment">// 禁用背景点击</span></span></span><br><span class="line"><span class="javascript">          <span class="attr">loadingType</span>: <span class="string">'spinner'</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">message</span>: <span class="string">'保存中'</span></span></span><br><span class="line"><span class="javascript">        })</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> {</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData()</span></span><br><span class="line"><span class="javascript">          <span class="comment">// formData.append('名字', 数据)</span></span></span><br><span class="line"><span class="javascript">          formData.append(<span class="string">'photo'</span>, <span class="built_in">this</span>.$refs.file.files[<span class="number">0</span>])</span></span><br><span class="line"><span class="javascript">          <span class="keyword">await</span> updateUserPhoto(formData)</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.$toast.success(<span class="string">'保存成功'</span>)</span></span><br><span class="line"><span class="javascript">        } <span class="keyword">catch</span> (err) {</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(err)</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.$toast.fail(<span class="string">'保存失败'</span>)</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript">      }</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript">  }</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>










</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Abigail Cui</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.abigailcui.com/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/">https://www.abigailcui.com/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.abigailcui.com" target="_blank">Abigail Cui的小站</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Vue%E5%BA%94%E7%94%A8/">Vue应用</a><a class="post-meta__tags" href="/tags/Vue/">Vue</a></div><div class="post_share"><div class="social-share" data-image="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/%E9%A6%96%E9%A1%B5.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/07/01/Todo-List/"><img class="prev-cover" src="/2021/07/01/Todo-List/todo-list.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">基于vue的简易Todo-List</div></div></a></div><div class="next-post pull-right"><a href="/2021/05/20/vue%E5%BA%94%E7%94%A81-%E7%94%A8vant%E5%92%8Cnode%E5%AE%9E%E7%8E%B0%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E6%A1%88%E4%BE%8B/"><img class="next-cover" src="/2021/05/20/vue%E5%BA%94%E7%94%A81-%E7%94%A8vant%E5%92%8Cnode%E5%AE%9E%E7%8E%B0%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E6%A1%88%E4%BE%8B/1_%E9%A6%96%E9%A1%B5.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">vue应用1—用vant和node实现网易云音乐案例</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/07/01/Todo-List/" title="基于vue的简易Todo-List"><img class="cover" src="/2021/07/01/Todo-List/todo-list.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-01</div><div class="title">基于vue的简易Todo-List</div></div></a></div><div><a href="/2021/05/20/vue应用1-用vant和node实现网易云音乐案例/" title="vue应用1—用vant和node实现网易云音乐案例"><img class="cover" src="/2021/05/20/vue%E5%BA%94%E7%94%A81-%E7%94%A8vant%E5%92%8Cnode%E5%AE%9E%E7%8E%B0%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E6%A1%88%E4%BE%8B/1_%E9%A6%96%E9%A1%B5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-20</div><div class="title">vue应用1—用vant和node实现网易云音乐案例</div></div></a></div><div><a href="/2021/07/02/vue应用3—HR-saas中台系统/" title="vue应用3—HR-saas中台系统"><img class="cover" src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200711002545085.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-02</div><div class="title">vue应用3—HR-saas中台系统</div></div></a></div><div><a href="/2021/05/14/vue基础6-路由_vant组件库使用/" title="vue基础6-路由_vant组件库使用"><img class="cover" src="/2021/05/14/vue%E5%9F%BA%E7%A1%806-%E8%B7%AF%E7%94%B1_vant%E7%BB%84%E4%BB%B6%E5%BA%93%E4%BD%BF%E7%94%A8/ArcGIS.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-14</div><div class="title">vue基础6-路由_vant组件库使用</div></div></a></div><div><a href="/2021/05/14/vue基础1-vue脚手架&基础API/" title="vue基础1-vue脚手架&基础API"><img class="cover" src="/2021/05/14/vue%E5%9F%BA%E7%A1%801-vue%E8%84%9A%E6%89%8B%E6%9E%B6&%E5%9F%BA%E7%A1%80API/ArcGIS.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-14</div><div class="title">vue基础1-vue脚手架&基础API</div></div></a></div><div><a href="/2021/05/14/vue基础2-基础API_计算属性_过滤器_侦听器_品牌管理案例/" title="vue基础2-基础API_计算属性_过滤器_侦听器"><img class="cover" src="/2021/05/14/vue%E5%9F%BA%E7%A1%802-%E5%9F%BA%E7%A1%80API_%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7_%E8%BF%87%E6%BB%A4%E5%99%A8_%E4%BE%A6%E5%90%AC%E5%99%A8_%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86%E6%A1%88%E4%BE%8B/ArcGIS.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-14</div><div class="title">vue基础2-基础API_计算属性_过滤器_侦听器</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">一、项目初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Vue-CLI-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.1.</span> <span class="toc-text">使用 Vue CLI 创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5-Git-%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">加入 Git 版本管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E5%88%9D%E5%A7%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">调整初始目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%9B%BE%E6%A0%87%E7%B4%A0%E6%9D%90"><span class="toc-number">1.4.</span> <span class="toc-text">导入图标素材</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5-Vant-%E7%BB%84%E4%BB%B6%E5%BA%93"><span class="toc-number">1.5.</span> <span class="toc-text">引入 Vant 组件库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF-REM-%E9%80%82%E9%85%8D"><span class="toc-number">1.6.</span> <span class="toc-text">移动端 REM 适配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-postcssrc-js-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.7.</span> <span class="toc-text">关于 .postcssrc.js 配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E8%AF%B7%E6%B1%82%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.</span> <span class="toc-text">封装请求模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C"><span class="toc-number">2.</span> <span class="toc-text">二、登录注册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-number">2.1.</span> <span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="toc-number">2.1.1.</span> <span class="toc-text">创建组件并配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.2.</span> <span class="toc-text">布局结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E6%A0%B7%E5%BC%8F"><span class="toc-number">2.1.3.</span> <span class="toc-text">布局样式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">2.2.</span> <span class="toc-text">实现基本登录功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E6%8F%90%E7%A4%BA"><span class="toc-number">2.3.</span> <span class="toc-text">登录状态提示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81"><span class="toc-number">2.4.</span> <span class="toc-text">表单验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E5%A4%84%E7%90%86"><span class="toc-number">2.5.</span> <span class="toc-text">验证码处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E6%89%8B%E6%9C%BA%E5%8F%B7"><span class="toc-number">2.5.1.</span> <span class="toc-text">验证手机号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%80%92%E8%AE%A1%E6%97%B6%E7%BB%84%E4%BB%B6"><span class="toc-number">2.5.2.</span> <span class="toc-text">使用倒计时组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">2.5.3.</span> <span class="toc-text">发送验证码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7-Token"><span class="toc-number">2.6.</span> <span class="toc-text">处理用户 Token</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%B0%81%E8%A3%85%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%9D%97"><span class="toc-number">2.7.</span> <span class="toc-text">优化封装本地存储操作模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-Token-%E8%BF%87%E6%9C%9F%E9%97%AE%E9%A2%98"><span class="toc-number">2.8.</span> <span class="toc-text">关于 Token 过期问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83"><span class="toc-number">3.</span> <span class="toc-text">三、个人中心</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TabBar-%E5%A4%84%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">TabBar 处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80"><span class="toc-number">3.2.</span> <span class="toc-text">页面布局</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E7%99%BB%E5%BD%95%E5%A4%B4%E9%83%A8%E7%8A%B6%E6%80%81"><span class="toc-number">3.2.1.</span> <span class="toc-text">未登录头部状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%B2%E7%99%BB%E5%BD%95%E5%A4%B4%E9%83%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">已登录头部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%AB%E6%A0%BC%E5%AF%BC%E8%88%AA"><span class="toc-number">3.2.3.</span> <span class="toc-text">宫格导航</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%A0%BC%E5%AF%BC%E8%88%AA"><span class="toc-number">3.2.4.</span> <span class="toc-text">单元格导航</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%B7%B2%E7%99%BB%E5%BD%95%E5%92%8C%E6%9C%AA%E7%99%BB%E5%BD%95%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA"><span class="toc-number">3.3.</span> <span class="toc-text">处理已登录和未登录的页面展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E9%80%80%E5%87%BA"><span class="toc-number">3.4.</span> <span class="toc-text">用户退出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">3.5.</span> <span class="toc-text">展示登录用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E8%AE%BE%E7%BD%AE-Token"><span class="toc-number">3.6.</span> <span class="toc-text">优化设置 Token</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%A6%96%E9%A1%B5%E2%80%94%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-number">4.</span> <span class="toc-text">四、首页—文章列表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80-1"><span class="toc-number">4.1.</span> <span class="toc-text">页面布局</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B4%E9%83%A8%E5%AF%BC%E8%88%AA%E6%A0%8F"><span class="toc-number">4.1.1.</span> <span class="toc-text">头部导航栏</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8"><span class="toc-number">4.2.</span> <span class="toc-text">频道列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Tab-%E6%A0%87%E7%AD%BE%E9%A1%B5%E7%BB%84%E4%BB%B6"><span class="toc-number">4.2.1.</span> <span class="toc-text">使用 Tab 标签页组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E8%B0%83%E6%95%B4"><span class="toc-number">4.2.2.</span> <span class="toc-text">样式调整</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8"><span class="toc-number">4.2.3.</span> <span class="toc-text">展示频道列表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-number">4.3.</span> <span class="toc-text">文章列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"><span class="toc-number">4.3.1.</span> <span class="toc-text">思路分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-List-%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">4.3.2.</span> <span class="toc-text">使用 List 列表组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A9%E5%88%97%E8%A1%A8%E5%9B%BA%E5%AE%9A%E5%AE%9A%E4%BD%8D"><span class="toc-number">4.3.3.</span> <span class="toc-text">让列表固定定位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">4.3.4.</span> <span class="toc-text">加载文章列表数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="toc-number">4.3.5.</span> <span class="toc-text">下拉刷新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E9%A1%B9"><span class="toc-number">4.4.</span> <span class="toc-text">文章列表项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E7%BB%84%E4%BB%B6"><span class="toc-number">4.4.1.</span> <span class="toc-text">准备组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E5%88%97%E8%A1%A8%E9%A1%B9%E5%86%85%E5%AE%B9"><span class="toc-number">4.4.2.</span> <span class="toc-text">展示列表项内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E8%B0%83%E6%95%B4-1"><span class="toc-number">4.4.3.</span> <span class="toc-text">样式调整</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E7%AC%AC%E4%B8%89%E6%96%B9%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90403%E9%97%AE%E9%A2%98"><span class="toc-number">4.4.4.</span> <span class="toc-text">关于第三方图片资源403问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E7%9B%B8%E5%AF%B9%E6%97%B6%E9%97%B4"><span class="toc-number">4.4.5.</span> <span class="toc-text">处理相对时间</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E9%A6%96%E9%A1%B5%E2%80%94%E9%A2%91%E9%81%93%E7%BC%96%E8%BE%91"><span class="toc-number">5.</span> <span class="toc-text">五、首页—频道编辑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%A1%B5%E9%9D%A2%E5%BC%B9%E5%87%BA%E5%B1%82"><span class="toc-number">5.1.</span> <span class="toc-text">处理页面弹出层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A2%91%E9%81%93%E7%BC%96%E8%BE%91%E7%BB%84%E4%BB%B6"><span class="toc-number">5.2.</span> <span class="toc-text">创建频道编辑组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80-2"><span class="toc-number">5.3.</span> <span class="toc-text">页面布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%88%91%E7%9A%84%E9%A2%91%E9%81%93"><span class="toc-number">5.4.</span> <span class="toc-text">展示我的频道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%8E%A8%E8%8D%90%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8"><span class="toc-number">5.5.</span> <span class="toc-text">展示推荐频道列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E9%A2%91%E9%81%93"><span class="toc-number">5.5.1.</span> <span class="toc-text">获取所有频道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%B1%95%E7%A4%BA%E6%8E%A8%E8%8D%90%E9%A2%91%E9%81%93"><span class="toc-number">5.5.2.</span> <span class="toc-text">处理展示推荐频道</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%A2%91%E9%81%93"><span class="toc-number">5.6.</span> <span class="toc-text">添加频道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E9%A2%91%E9%81%93"><span class="toc-number">5.7.</span> <span class="toc-text">编辑频道</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E7%BC%96%E8%BE%91%E7%8A%B6%E6%80%81"><span class="toc-number">5.7.1.</span> <span class="toc-text">处理编辑状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E9%A2%91%E9%81%93"><span class="toc-number">5.7.2.</span> <span class="toc-text">切换频道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A9%E6%BF%80%E6%B4%BB%E9%A2%91%E9%81%93%E9%AB%98%E4%BA%AE"><span class="toc-number">5.7.3.</span> <span class="toc-text">让激活频道高亮</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%A2%91%E9%81%93"><span class="toc-number">5.7.4.</span> <span class="toc-text">删除频道</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%91%E9%81%93%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">5.8.</span> <span class="toc-text">频道数据持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%88%86%E6%9E%90"><span class="toc-number">5.8.1.</span> <span class="toc-text">业务分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%A2%91%E9%81%93-1"><span class="toc-number">5.8.2.</span> <span class="toc-text">添加频道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%A2%91%E9%81%93-1"><span class="toc-number">5.8.3.</span> <span class="toc-text">删除频道</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E7%9A%84%E8%8E%B7%E5%8F%96%E9%A6%96%E9%A1%B5%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">5.9.</span> <span class="toc-text">正确的获取首页频道列表数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%96%87%E7%AB%A0%E6%90%9C%E7%B4%A2"><span class="toc-number">6.</span> <span class="toc-text">六、文章搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1-1"><span class="toc-number">6.1.</span> <span class="toc-text">创建组件并配置路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80-3"><span class="toc-number">6.2.</span> <span class="toc-text">页面布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%A1%B5%E9%9D%A2%E6%98%BE%E7%A4%BA%E7%8A%B6%E6%80%81"><span class="toc-number">6.3.</span> <span class="toc-text">处理页面显示状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E8%81%94%E6%83%B3%E5%BB%BA%E8%AE%AE"><span class="toc-number">6.4.</span> <span class="toc-text">搜索联想建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="toc-number">6.4.1.</span> <span class="toc-text">基本功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E6%8A%96%E4%BC%98%E5%8C%96"><span class="toc-number">6.4.2.</span> <span class="toc-text">防抖优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E5%AD%97%E9%AB%98%E4%BA%AE"><span class="toc-number">6.4.3.</span> <span class="toc-text">搜索关键字高亮</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C"><span class="toc-number">6.5.</span> <span class="toc-text">搜索结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-number">6.6.</span> <span class="toc-text">搜索历史记录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-number">6.6.1.</span> <span class="toc-text">添加历史记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-number">6.6.2.</span> <span class="toc-text">展示历史记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-number">6.6.3.</span> <span class="toc-text">删除历史记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">6.6.4.</span> <span class="toc-text">数据持久化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%96%87%E7%AB%A0%E8%AF%A6%E6%83%85"><span class="toc-number">7.</span> <span class="toc-text">七、文章详情</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1-2"><span class="toc-number">7.1.</span> <span class="toc-text">创建组件并配置路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80-4"><span class="toc-number">7.2.</span> <span class="toc-text">页面布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%90%8E%E7%AB%AF%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%E4%B8%AD%E7%9A%84%E5%A4%A7%E6%95%B0%E5%AD%97%E9%97%AE%E9%A2%98"><span class="toc-number">7.3.</span> <span class="toc-text">关于后端返回数据中的大数字问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%96%87%E7%AB%A0%E8%AF%A6%E6%83%85"><span class="toc-number">7.4.</span> <span class="toc-text">展示文章详情</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%86%85%E5%AE%B9%E5%8A%A0%E8%BD%BD%E7%8A%B6%E6%80%81"><span class="toc-number">7.5.</span> <span class="toc-text">处理内容加载状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%96%87%E7%AB%A0%E6%AD%A3%E6%96%87%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="toc-number">7.6.</span> <span class="toc-text">关于文章正文的样式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E7%82%B9%E5%87%BB%E9%A2%84%E8%A7%88"><span class="toc-number">7.7.</span> <span class="toc-text">图片点击预览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E6%B3%A8%E7%94%A8%E6%88%B7"><span class="toc-number">7.8.</span> <span class="toc-text">关注用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%A4%84%E7%90%86"><span class="toc-number">7.8.1.</span> <span class="toc-text">视图处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%A4%84%E7%90%86"><span class="toc-number">7.8.2.</span> <span class="toc-text">功能处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loading-%E6%95%88%E6%9E%9C"><span class="toc-number">7.8.3.</span> <span class="toc-text">loading 效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">7.8.4.</span> <span class="toc-text">组件封装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F"><span class="toc-number">7.9.</span> <span class="toc-text">文章收藏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%BB%84%E4%BB%B6"><span class="toc-number">7.9.1.</span> <span class="toc-text">封装组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E8%A7%86%E5%9B%BE"><span class="toc-number">7.9.2.</span> <span class="toc-text">处理视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%A4%84%E7%90%86-1"><span class="toc-number">7.9.3.</span> <span class="toc-text">功能处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E7%82%B9%E8%B5%9E"><span class="toc-number">7.10.</span> <span class="toc-text">文章点赞</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA"><span class="toc-number">8.</span> <span class="toc-text">八、文章评论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8"><span class="toc-number">8.1.</span> <span class="toc-text">展示文章评论列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E7%BB%84%E4%BB%B6-1"><span class="toc-number">8.1.1.</span> <span class="toc-text">准备组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%B9%B6%E5%B1%95%E7%A4%BA"><span class="toc-number">8.1.2.</span> <span class="toc-text">获取数据并展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E6%80%BB%E6%95%B0%E9%87%8F"><span class="toc-number">8.1.3.</span> <span class="toc-text">展示文章评论总数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E9%A1%B9"><span class="toc-number">8.1.4.</span> <span class="toc-text">文章评论项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%84%E8%AE%BA%E7%82%B9%E8%B5%9E"><span class="toc-number">8.2.</span> <span class="toc-text">评论点赞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA"><span class="toc-number">8.3.</span> <span class="toc-text">发布文章评论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%BC%B9%E5%87%BA%E5%B1%82"><span class="toc-number">8.3.1.</span> <span class="toc-text">准备弹出层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%BB%84%E4%BB%B6-1"><span class="toc-number">8.3.2.</span> <span class="toc-text">封装组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%91%E5%B8%83"><span class="toc-number">8.3.3.</span> <span class="toc-text">请求发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E6%88%90%E5%8A%9F%E5%A4%84%E7%90%86"><span class="toc-number">8.3.4.</span> <span class="toc-text">发布成功处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%84%E8%AE%BA%E5%9B%9E%E5%A4%8D"><span class="toc-number">8.4.</span> <span class="toc-text">评论回复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%9B%9E%E5%A4%8D%E5%BC%B9%E5%B1%82"><span class="toc-number">8.4.1.</span> <span class="toc-text">准备回复弹层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E5%9B%9E%E5%A4%8D%E6%98%BE%E7%A4%BA%E5%BC%B9%E5%87%BA%E5%B1%82"><span class="toc-number">8.4.2.</span> <span class="toc-text">点击回复显示弹出层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%86%85%E5%AE%B9%E7%BB%84%E4%BB%B6"><span class="toc-number">8.4.3.</span> <span class="toc-text">封装内容组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E9%80%92%E5%BD%93%E5%89%8D%E7%82%B9%E5%87%BB%E5%9B%9E%E5%A4%8D%E7%9A%84%E8%AF%84%E8%AE%BA%E9%A1%B9"><span class="toc-number">8.4.4.</span> <span class="toc-text">传递当前点击回复的评论项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%A4%B4%E9%83%A8"><span class="toc-number">8.4.5.</span> <span class="toc-text">处理头部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%BD%93%E5%89%8D%E8%AF%84%E8%AE%BA%E9%A1%B9"><span class="toc-number">8.4.6.</span> <span class="toc-text">处理当前评论项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E8%AF%84%E8%AE%BA%E5%9B%9E%E5%A4%8D%E5%88%97%E8%A1%A8"><span class="toc-number">8.4.7.</span> <span class="toc-text">展示评论回复列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%BC%B9%E5%B1%82%E4%B8%AD%E7%BB%84%E4%BB%B6%E5%86%85%E5%AE%B9%E4%B8%8D%E6%9B%B4%E6%96%B0%E9%97%AE%E9%A2%98"><span class="toc-number">8.4.8.</span> <span class="toc-text">解决弹层中组件内容不更新问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E5%9B%9E%E5%A4%8D"><span class="toc-number">8.4.9.</span> <span class="toc-text">发布回复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E7%94%A8%E6%88%B7%E9%A1%B5%E9%9D%A2"><span class="toc-number">9.</span> <span class="toc-text">九、用户页面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1-3"><span class="toc-number">9.1.</span> <span class="toc-text">创建组件并配置路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80-5"><span class="toc-number">9.2.</span> <span class="toc-text">页面布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">9.3.</span> <span class="toc-text">展示用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8"><span class="toc-number">9.4.</span> <span class="toc-text">用户关注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%94%A8%E6%88%B7%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-number">9.5.</span> <span class="toc-text">展示用户文章列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">9.5.1.</span> <span class="toc-text">列表组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">9.5.2.</span> <span class="toc-text">分析列表组件使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-number">9.5.3.</span> <span class="toc-text">展示文章列表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E7%BC%96%E8%BE%91%E7%94%A8%E6%88%B7%E8%B5%84%E6%96%99"><span class="toc-number">10.</span> <span class="toc-text">十、编辑用户资料</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1-4"><span class="toc-number">10.1.</span> <span class="toc-text">创建组件并配置路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80-6"><span class="toc-number">10.2.</span> <span class="toc-text">页面布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF-1"><span class="toc-number">10.3.</span> <span class="toc-text">展示用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%98%B5%E7%A7%B0"><span class="toc-number">10.4.</span> <span class="toc-text">修改昵称</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%80%A7%E5%88%AB"><span class="toc-number">10.5.</span> <span class="toc-text">修改性别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%94%9F%E6%97%A5"><span class="toc-number">10.6.</span> <span class="toc-text">修改生日</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A4%B4%E5%83%8F"><span class="toc-number">10.7.</span> <span class="toc-text">修改头像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E9%A2%84%E8%A7%88"><span class="toc-number">10.7.1.</span> <span class="toc-text">图片上传预览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B4%E5%83%8F%E8%A3%81%E5%88%87"><span class="toc-number">10.7.2.</span> <span class="toc-text">头像裁切</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E6%9B%B4%E6%96%B0"><span class="toc-number">10.7.3.</span> <span class="toc-text">保存更新</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/%E9%A6%96%E9%A1%B5.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Abigail Cui</div><div class="footer_custom_text">plain living and high thinking</div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                console.log('已挂载history_calendar')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax  src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script data-pjax>function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                console.log('已挂载electric_clock')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax  src="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body></html>