<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>vue应用3—HR-saas中台系统 | Abigail Cui的小站</title><meta name="keywords" content="Vue应用,Vue"><meta name="author" content="Abigail Cui"><meta name="copyright" content="Abigail Cui"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.项目设计 1.人力资源的环境搭建vue-element-admin的了解和介绍目标: 学习和了解通用的vue后台集成方案**vue-element-admin** vue-element-admin 是一个后台前端解决方案，它基于 vue 和 element-ui实现。它使用了最新的前端技术栈，内置了 i18 国际化解决方案，动态路由，权限验证，提炼了典型的业务模型，提供了丰富的功能组件，它可">
<meta property="og:type" content="article">
<meta property="og:title" content="vue应用3—HR-saas中台系统">
<meta property="og:url" content="https://www.abigailcui.com/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="Abigail Cui的小站">
<meta property="og:description" content="1.项目设计 1.人力资源的环境搭建vue-element-admin的了解和介绍目标: 学习和了解通用的vue后台集成方案**vue-element-admin** vue-element-admin 是一个后台前端解决方案，它基于 vue 和 element-ui实现。它使用了最新的前端技术栈，内置了 i18 国际化解决方案，动态路由，权限验证，提炼了典型的业务模型，提供了丰富的功能组件，它可">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.abigailcui.com/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200711002545085.png">
<meta property="article:published_time" content="2021-07-02T07:04:15.000Z">
<meta property="article:modified_time" content="2021-09-09T20:01:49.352Z">
<meta property="article:author" content="Abigail Cui">
<meta property="article:tag" content="Vue应用">
<meta property="article:tag" content="Vue">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.abigailcui.com/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200711002545085.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.abigailcui.com/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'vue应用3—HR-saas中台系统',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-10 04:01:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/custom.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/todo-List/index.html#/myday"><i class="fa-fw fas fa-clock"></i><span> ToDo-List</span></a></li><li><a class="site-page child" href="/te/"><i class="fa-fw fas fa-envelope"></i><span> 疫情地图</span></a></li><li><a class="site-page child" href="/catch-cat-master/index.html"><i class="fa-fw fas fa-spin"></i><span> 小游戏</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200711002545085.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Abigail Cui的小站</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/todo-List/index.html#/myday"><i class="fa-fw fas fa-clock"></i><span> ToDo-List</span></a></li><li><a class="site-page child" href="/te/"><i class="fa-fw fas fa-envelope"></i><span> 疫情地图</span></a></li><li><a class="site-page child" href="/catch-cat-master/index.html"><i class="fa-fw fas fa-spin"></i><span> 小游戏</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">vue应用3—HR-saas中台系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-07-02T07:04:15.000Z" title="发表于 2021-07-02 15:04:15">2021-07-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-09-09T20:01:49.352Z" title="更新于 2021-09-10 04:01:49">2021-09-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Vue/">Vue</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">56.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>234分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="vue应用3—HR-saas中台系统"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-项目设计"><a href="#1-项目设计" class="headerlink" title="1.项目设计"></a>1.项目设计</h1><p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200810012833240.png" alt="image-20200810012833240"></p>
<h1 id="1-人力资源的环境搭建"><a href="#1-人力资源的环境搭建" class="headerlink" title="1.人力资源的环境搭建"></a>1.人力资源的环境搭建</h1><h2 id="vue-element-admin的了解和介绍"><a href="#vue-element-admin的了解和介绍" class="headerlink" title="vue-element-admin的了解和介绍"></a>vue-element-admin的了解和介绍</h2><p><strong><code>目标</code></strong>: 学习和了解通用的vue后台集成方案**<code>vue-element-admin</code>**</p>
<p><a target="_blank" rel="noopener" href="https://panjiachen.gitee.io/vue-element-admin-site/zh/">vue-element-admin</a> 是一个后台前端解决方案，它基于 <a target="_blank" rel="noopener" href="https://github.com/vuejs/vue">vue</a> 和 <a target="_blank" rel="noopener" href="https://github.com/ElemeFE/element">element-ui</a>实现。它使用了最新的前端技术栈，内置了 i18 国际化解决方案，动态路由，权限验证，提炼了典型的业务模型，提供了丰富的功能组件，它可以帮助你快速搭建企业级中后台产品原型。</p>
<p><a target="_blank" rel="noopener" href="http://panjiachen.github.io/vue-element-admin">vue-element-admin</a> 是一个后台集成方案, 集成了PC项目中很多的业务场景和功能, 尤其在当下SPA的趋势下,我们可以从中获得很多成熟的解决方案.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://panjiachen.github.io/vue-element-admin">vue-element-admin</a> 有一个成熟的<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin">集成方案</a>，里面包含了所有的业务功能和场景,并不适合直接拿来进行二次开发, 但是可以通过该项目中的一个案例来进行学习和使用.</p>
</blockquote>
<p>这里是<a target="_blank" rel="noopener" href="https://panjiachen.gitee.io/vue-element-admin-site/zh/">官网地址</a></p>
<p>这里是<a target="_blank" rel="noopener" href="https://panjiachen.github.io/vue-element-admin/#/dashboard">线上demo地址</a></p>
<blockquote>
<p>如果你想查看该项目的具体功能和效果，可以拉取代码，启动进行预览￥ </p>
</blockquote>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/PanJiaChen/vue-element-admin.git  <span class="comment">#拉取代码</span></span><br><span class="line">$ <span class="built_in">cd</span> vue-element-admin <span class="comment">#切换到具体目录下</span></span><br><span class="line">$ npm run dev  <span class="comment">#启动开发调试模式  查看package.json文件的scripts可知晓启动命令</span></span><br></pre></td></tr></tbody></table></figure>

<p>**<code>注意</code>**：当前项目下载速度如果过慢，可以直接下载代码的压缩包运行</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200703173319390.png" alt="image-20200703173319390"></p>
<blockquote>
<p>集成方案并不适合我们直接拿来进行二次开发，<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-admin-template">基础模板</a>则是一个更好的选择</p>
</blockquote>
<p>基础模板, 包含了基本的 <strong>登录 / 鉴权 / 主页布局</strong> 的一些基础功能模板, 我们可以直接在该模板上进行功能的扩展和项目的二次开发</p>
<p>**<code>本节任务</code>**： 浏览vue-element-admin的文档，了解这个集成方案</p>
<h2 id="搭建项目前的一些基本准备"><a href="#搭建项目前的一些基本准备" class="headerlink" title="搭建项目前的一些基本准备"></a>搭建项目前的一些基本准备</h2><p><strong><code>目标</code></strong>: 介绍搭建一个vue中台项目,需要环境和工具</p>
<blockquote>
<p>接下来要做的是一个大型的项目，我们需要更好的环境准备和资源前置，所以提前检查我们的环境和资源</p>
</blockquote>
<p><strong>nodejs环境</strong></p>
<blockquote>
<p>nodejs是当下前端工程化开发必不可少的环境, 使用 nodejs的**<code>npm</code>**功能来管理依赖包</p>
</blockquote>
<p>查看node 和 npm的版本</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node -v <span class="comment">#查看node版本</span></span><br><span class="line">$ npm  -v <span class="comment">#查看npm版本</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200706130603160.png" alt="image-20200706130603160"></p>
<p><strong>git版本控制</strong></p>
<blockquote>
<p>git版本控制工具是目前最为流行的分布式版本管理工具,代码的**<code>提交, 检出, 日志</code>**, 都需要通过git完成</p>
</blockquote>
<p>查看git安装版本</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git --version <span class="comment">#查看git安装版本</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200706131337563.png" alt="image-20200706131337563"></p>
<p><strong>npm淘宝镜像</strong></p>
<blockquote>
<p>npm是非常重要的npm管理工具,由于npm的服务器位于国外, 所以一般建议 将 npm设置成国内的淘宝镜像</p>
</blockquote>
<p>设置淘宝镜像</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm config <span class="built_in">set</span> registry  https://registry.npm.taobao.org/  <span class="comment">#设置淘宝镜像地址</span></span><br><span class="line">$ npm config get registry  <span class="comment">#查看镜像地址</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>vscode编辑器</strong></p>
<blockquote>
<p>vscode编辑器是目前前端开发的编码利器， 以及丰富的插件系统，非常适合开发前端项目 </p>
</blockquote>
<p>vscode编辑器插件 + <strong><code>vetur</code></strong> + <strong><code>eslint</code></strong></p>
<blockquote>
<p>vetur是基于 单文件组件开发的支持插件, eslint是 基于代码校验的插件工具</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200706134607517.png" alt="image-20200706134607517"></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200706134614330.png" alt="image-20200706134614330"></p>
<p>除此之外, eslint需要在vscode中进行一些参数的配置</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">{ </span><br><span class="line">    <span class="attr">"eslint.enable"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"eslint.run"</span>: <span class="string">"onType"</span>,</span><br><span class="line">    <span class="attr">"eslint.options"</span>: {</span><br><span class="line">        <span class="attr">"extensions"</span>: [</span><br><span class="line">            <span class="string">".js"</span>,</span><br><span class="line">            <span class="string">".vue"</span>,</span><br><span class="line">            <span class="string">".jsx"</span>,</span><br><span class="line">            <span class="string">".tsx"</span></span><br><span class="line">        ]</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">"editor.codeActionsOnSave"</span>: {</span><br><span class="line">        <span class="attr">"source.fixAll.eslint"</span>: <span class="literal">true</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>本项目的技术栈 本项目技术栈基于 <a target="_blank" rel="noopener" href="http://es6.ruanyifeng.com/">ES2015+</a>、<a target="_blank" rel="noopener" href="https://cn.vuejs.org/index.html">vue</a>、<a target="_blank" rel="noopener" href="https://vuex.vuejs.org/zh-cn/">vuex</a>、<a target="_blank" rel="noopener" href="https://router.vuejs.org/zh-cn/">vue-router</a> 、<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-cli">vue-cli</a> 、<a target="_blank" rel="noopener" href="https://github.com/axios/axios">axios</a> 和 <a target="_blank" rel="noopener" href="https://github.com/ElemeFE/element">element-ui</a></p>
</blockquote>
<p>**<code>本节任务</code>**： 大家检查各自的开发环境和资源，尤其是npm的淘宝镜像额外需要注意</p>
<h2 id="项目模板启动和目录介绍"><a href="#项目模板启动和目录介绍" class="headerlink" title="项目模板启动和目录介绍"></a>项目模板启动和目录介绍</h2><p><strong><code>目标</code></strong>: 拉取项目的基础模板,并对目录进行介绍</p>
<blockquote>
<p>vue-element-admin的基础 模板和我们之前开发的项目一样吗 ？本章节，我们对该项目目录进行一下介绍</p>
</blockquote>
<p><strong>git拉取基础项目模板</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span>  https://github.com/PanJiaChen/vue-admin-template.git  hrsaas <span class="comment">#拉取基础模板到hrsaas目录</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>安装项目依赖</strong>（定位到项目目录下）</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install  <span class="comment">#安装依赖</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>启动项目</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run dev <span class="comment">#启动开发模式的服务</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200708010741325.png" alt="image-20200708010741325"></p>
<p>项目运行完毕，浏览器会自动打开基础模板的登录页，如上图</p>
<p><strong>目录结构</strong></p>
<p>本项目已经为你生成了一个基本的开发框架，提供了涵盖中后台开发的各类功能和坑位，下面是整个项目的目录结构。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">├── build                      <span class="comment"># 构建相关</span></span><br><span class="line">├── mock                       <span class="comment"># 项目mock 模拟数据</span></span><br><span class="line">├── public                     <span class="comment"># 静态资源</span></span><br><span class="line">│   │── favicon.ico            <span class="comment"># favicon图标</span></span><br><span class="line">│   └── index.html             <span class="comment"># html模板</span></span><br><span class="line">├── src                        <span class="comment"># 源代码</span></span><br><span class="line">│   ├── api                    <span class="comment"># 所有请求</span></span><br><span class="line">│   ├── assets                 <span class="comment"># 主题 字体等静态资源</span></span><br><span class="line">│   ├── components             <span class="comment"># 全局公用组件</span></span><br><span class="line">│   ├── icons                  <span class="comment"># 项目所有 svg icons</span></span><br><span class="line">│   ├── layout                 <span class="comment"># 全局 layout</span></span><br><span class="line">│   ├── router                 <span class="comment"># 路由</span></span><br><span class="line">│   ├── store                  <span class="comment"># 全局 store管理</span></span><br><span class="line">│   ├── styles                 <span class="comment"># 全局样式</span></span><br><span class="line">│   ├── utils                  <span class="comment"># 全局公用方法</span></span><br><span class="line">│   ├── vendor                 <span class="comment"># 公用vendor</span></span><br><span class="line">│   ├── views                  <span class="comment"># views 所有页面</span></span><br><span class="line">│   ├── App.vue                <span class="comment"># 入口页面</span></span><br><span class="line">│   ├── main.js                <span class="comment"># 入口文件 加载组件 初始化等</span></span><br><span class="line">│   └── permission.js          <span class="comment"># 权限管理</span></span><br><span class="line">│   └── settings.js          <span class="comment"># 配置文件</span></span><br><span class="line">├── tests                      <span class="comment"># 测试</span></span><br><span class="line">├── .env.xxx                   <span class="comment"># 环境变量配置</span></span><br><span class="line">├── .eslintrc.js               <span class="comment"># eslint 配置项</span></span><br><span class="line">├── .babelrc                   <span class="comment"># babel-loader 配置</span></span><br><span class="line">├── .travis.yml                <span class="comment"># 自动化CI配置</span></span><br><span class="line">├── vue.config.js              <span class="comment"># vue-cli 配置</span></span><br><span class="line">├── postcss.config.js          <span class="comment"># postcss 配置</span></span><br><span class="line">└── package.json               <span class="comment"># package.json</span></span><br></pre></td></tr></tbody></table></figure>

<p>此时,你可能会<strong>眼花缭乱</strong>, 因为生成的目录里面有太多的文件 我们在做项目时 其中最关注的就是**<code>src</code>**目录, 里面是所有的源代码和资源, 至于其他目录, 都是对项目的环境和工具的配置</p>
<p>**<code>本节任务</code>**： 按照操作和讲解步骤，进行拉取代码，安装依赖，运行项目，阅读目录和文件的操作</p>
<p><strong><code>本节注意</code></strong> 需要注意自己的npm是否已经设置了淘宝镜像</p>
<h2 id="项目运行机制和代码注释"><a href="#项目运行机制和代码注释" class="headerlink" title="项目运行机制和代码注释"></a>项目运行机制和代码注释</h2><p><strong><code>目标</code></strong>: 了解当前模板的基本运行机制和基础架构</p>
<blockquote>
<p>眼花缭乱的目录和文件到底是怎么工作的？ 我们进行一下最基本的讲解，帮助大家更好的去理解和开发</p>
</blockquote>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">├── src                        <span class="comment"># 源代码</span></span><br><span class="line">│   ├── api                    <span class="comment"># 所有请求</span></span><br><span class="line">│   ├── assets                 <span class="comment"># 主题 字体等静态资源</span></span><br><span class="line">│   ├── components             <span class="comment"># 全局公用组件</span></span><br><span class="line">│   ├── icons                  <span class="comment"># 项目所有 svg icons</span></span><br><span class="line">│   ├── layout                 <span class="comment"># 全局 layout</span></span><br><span class="line">│   ├── router                 <span class="comment"># 路由</span></span><br><span class="line">│   ├── store                  <span class="comment"># 全局 store管理</span></span><br><span class="line">│   ├── styles                 <span class="comment"># 全局样式</span></span><br><span class="line">│   ├── utils                  <span class="comment"># 全局公用方法</span></span><br><span class="line">│   ├── vendor                 <span class="comment"># 公用vendor</span></span><br><span class="line">│   ├── views                  <span class="comment"># views 所有页面</span></span><br><span class="line">│   ├── App.vue                <span class="comment"># 入口页面</span></span><br><span class="line">│   ├── main.js                <span class="comment"># 入口文件 加载组件 初始化等</span></span><br><span class="line">│   └── permission.js          <span class="comment"># 权限管理</span></span><br><span class="line">│   └── settings.js            <span class="comment"># 配置文件</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a><strong>main.js</strong></h3><p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200824153141764.png" alt="image-20200824153141764"></p>
<p>请注释掉**<code>mock数据</code><strong>的部分，删除src下的</strong><code>mock</code>**文件夹，我们开发的时候用不到模拟数据，如图</p>
<p>同时，请注释掉**<code>vue.config.js</code>**中的  <strong>before: require(‘./mock/mock-server.js’)</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200811013813693.png" alt="image-20200811013813693"></p>
<h3 id="App-vue"><a href="#App-vue" class="headerlink" title="App.vue"></a><strong>App.vue</strong></h3><p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200824155103340.png" alt="image-20200824155103340"></p>
<h3 id="permission-js"><a href="#permission-js" class="headerlink" title="permission.js"></a><strong>permission.js</strong></h3><blockquote>
<p>src下，除了main.js还有两个文件，**<code>permission.js</code>** 和**<code>settings.js</code>**</p>
</blockquote>
<p><strong><code>permission.js</code></strong> 是控制页面登录权限的文件， 此处的代码没有经历构建过程会很难理解， 所以先将此处的代码进行注释，等我们构建权限功能时，再从0到1进行构建。</p>
<p><strong>注释代码</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200708014558617.png" alt="image-20200708014558617"></p>
<blockquote>
<p>**<code>settings.js</code><strong>则是对于一些项目信息的配置，里面有三个属性 <strong><code>title</code></strong>(项目名称)，</strong><code>fixedHeader</code><strong>（固定头部），</strong><code>sidebarLogo</code>**（显示左侧菜单logo）</p>
</blockquote>
<p>**<code>settings.js</code>**中的文件在其他的位置会引用到，所以这里暂时不去对该文件进行变动</p>
<h3 id="Vuex结构"><a href="#Vuex结构" class="headerlink" title="Vuex结构"></a><strong>Vuex结构</strong></h3><blockquote>
<p>当前的Vuex结构采用了模块形式进行管理共享状态，其架构如下</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200824165153331.png" alt="image-20200824165153331"></p>
<blockquote>
<p>其中app.js模块和settings.js模块，功能已经完备，不需要再进行修改。 user.js模块是我们后期需要重点开发的内容，所以这里我们将user.js里面的内容删除，并且导出一个默认配置</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>  {</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: {},</span><br><span class="line">  <span class="attr">mutations</span>: {},</span><br><span class="line">  <span class="attr">actions</span>: {}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>同时，由于getters中引用了user中的状态，所以我们将getters中的状态改为</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = {</span><br><span class="line">  <span class="attr">sidebar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.sidebar,</span><br><span class="line">  <span class="attr">device</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.device</span><br><span class="line">}</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="scss"><a href="#scss" class="headerlink" title="scss"></a><strong>scss</strong></h3><blockquote>
<p>该项目还使用了<a target="_blank" rel="noopener" href="https://www.sass.hk/">scss</a>作为css的扩展语言，在**<code>styles</code>**目录下，我们可以发现scss的相关文件，相关用法 我们<a href="">下一小节</a> 进行讲解<img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200824171327384.png" alt="image-20200824171327384"></p>
</blockquote>
<h3 id="icons"><a href="#icons" class="headerlink" title="icons"></a><strong>icons</strong></h3><blockquote>
<p>icons的结构如下</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200824173239955.png" alt="image-20200824173239955"></p>
<blockquote>
<p>以上就是vue-element-admin的基础和介绍,希望大家在这过程中体会 一个基础的模板运行机制</p>
</blockquote>
<p>**<code>本节任务</code>**： 大家根据目录结构和设计图，对以上的内容进行了解</p>
<h2 id="SCSS处理的了解和使用"><a href="#SCSS处理的了解和使用" class="headerlink" title="SCSS处理的了解和使用"></a>SCSS处理的了解和使用</h2><p><strong><code>目标</code></strong>: 了解和学习Scss处理器的规范和用法</p>
<p><a target="_blank" rel="noopener" href="https://www.sass.hk/">官方文档</a></p>
<blockquote>
<p>首先注意,这里的sass和我们的scss是什么关系</p>
</blockquote>
<p>sass和scss其实是**<code>一样的</code>**css预处理语言，SCSS 是 Sass 3 引入新的语法，其后缀名是分别为 .sass和.scss两种。<br>SASS版本3.0之前的后缀名为.sass，而版本3.0之后的后缀名.scss。<br>两者是有不同的，继sass之后scss的编写规范基本和css一致，sass时代是有严格的缩进规范并且没有‘{}’和‘；’。<br>而scss则和css的规范是一致的。</p>
<h3 id="搭建小型测试环境"><a href="#搭建小型测试环境" class="headerlink" title="搭建小型测试环境"></a>搭建小型测试环境</h3><blockquote>
<p>为了方便应用scss，我们可以在vscode中安装一个名为**<code>easy sass</code>** 的插件，但是我们只在该项目中工作区中应用该插件，因为在项目中，不需要该插件的辅助</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200825143713888.png" alt="image-20200825143713888"></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200825143800666.png" alt="image-20200825143800666"></p>
<blockquote>
<p>首先我们新建一个文件夹test，然后我们在test下新建一个index.html，并新建一个test.scss</p>
</blockquote>
<p>页面结构如下</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./test.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span>&gt;</span> Scss样式 <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        Hello World</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">article</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>文章标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>文章内容 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aside</span>&gt;</span></span><br><span class="line">            侧边栏</span><br><span class="line">        <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>我们使用的**<code>easy sass</code><strong>插件会自动的帮助我们把</strong><code>test.scss  =&gt;  test.css</code>**</p>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p><code>sass</code>使用<code>$</code>符号来标识变量 </p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$highlight</span>-color: <span class="comment">#f90     </span></span><br></pre></td></tr></tbody></table></figure>

<p>上面我们声明了一个 名为**<code>$highlight-color</code>**的变量, 我们可以把该变量用在任何位置</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#app {</span></span><br><span class="line">    background-color:  <span class="variable">$highlight</span>-color;</span><br><span class="line">}     </span><br></pre></td></tr></tbody></table></figure>

<p>以空格分割的多属性值也可以标识变量</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$basic</span>-border: 1px solid black;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#app {</span></span><br><span class="line">    background-color:  <span class="variable">$highlight</span>-color;</span><br><span class="line">    border: <span class="variable">$basic</span>-border</span><br><span class="line">}     </span><br></pre></td></tr></tbody></table></figure>

<p><strong>变量范围</strong></p>
<p>与<code>CSS</code>属性不同，变量可以在<code>css</code>规则块定义之外存在。当变量定义在<code>css</code>规则块内，那么该变量只能在此规则块内使用。如果它们出现在任何形式的<code>{...}</code>块中（如<code>@media</code>或者<code>@font-face</code>块），情况也是如此：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nav</span>-color: <span class="comment">#F90;</span></span><br><span class="line">nav {</span><br><span class="line">  <span class="variable">$width</span>: 100px;</span><br><span class="line">  width: <span class="variable">$width</span>;</span><br><span class="line">  color: <span class="variable">$nav</span>-color;</span><br><span class="line">  background-color: black</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译后 </span></span><br><span class="line"></span><br><span class="line">nav {</span><br><span class="line">  width: 100px;</span><br><span class="line">  color: <span class="comment">#F90;</span></span><br><span class="line">  background-color: black;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>在这段代码中，<code>$nav-color</code>这个变量定义在了规则块外边，所以在这个样式表中都可以像 <code>nav</code>规则块那样引用它。<code>$width</code>这个变量定义在了<code>nav</code>的<code>{ }</code>规则块内，所以它只能在<code>nav</code>规则块 内使用。这意味着是你可以在样式表的其他地方定义和使用<code>$width</code>变量，不会对这里造成影响。</p>
<p><strong>嵌套语法</strong></p>
<p>和less一样,scss同样支持**<code>嵌套型</code>**的语法</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#content</span> {</span><br><span class="line">    <span class="selector-tag">article</span> {</span><br><span class="line">      <span class="selector-tag">h1</span> { <span class="attribute">color</span>: <span class="number">#1dc08a</span> }</span><br><span class="line">      p {  font-style: italic; }</span><br><span class="line">    }</span><br><span class="line">    <span class="selector-tag">aside</span> { <span class="attribute">background-color</span>: <span class="number">#f90</span> }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p>转化后</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#content</span> <span class="selector-tag">article</span> <span class="selector-tag">h1</span> {</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1dc08a</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#content</span> <span class="selector-tag">article</span> <span class="selector-tag">p</span> {</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#content</span> <span class="selector-tag">aside</span> {</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f90</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>&amp;父选择器</strong></p>
<p>假如你想针对某个特定子元素 进行设置</p>
<p>比如</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#content</span> {</span><br><span class="line">  <span class="selector-tag">article</span> {</span><br><span class="line">    <span class="selector-tag">h1</span> { <span class="attribute">color</span>: <span class="number">#1dc08a</span> }</span><br><span class="line">    p {  font-style: italic; }</span><br><span class="line">    <span class="selector-tag">a</span> {</span><br><span class="line">      <span class="attribute">color</span>: blue;</span><br><span class="line">      &amp;<span class="selector-pseudo">:hover</span> { <span class="attribute">color</span>: red }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  aside { background-color: <span class="number">#f90</span> }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>学到这里,我们会发现scss和less有很多相似之处,最大的区别就在于声明变量的方式,less采用的是**<code>@变量名</code><strong>, 而scss采用的</strong><code>$变量名</code>**</p>
</blockquote>
<p>此时,我们再来看一下模板中的 <strong><code>styles/variables.scss</code></strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20201017230542301.png" alt="image-20201017230542301"></p>
<p>上述文件,实际上定义了我们的一些基础数值,方便大家在某个文件统一的处理.</p>
<p>**<code>本节任务</code>**：对scss进行了解和掌握</p>
<h2 id="建立远程Git仓库并完成初始提交"><a href="#建立远程Git仓库并完成初始提交" class="headerlink" title="建立远程Git仓库并完成初始提交"></a>建立远程Git仓库并完成初始提交</h2><p><strong><code>目标</code></strong> 在<a target="_blank" rel="noopener" href="https://gitee.com/">码云</a>或者<a target="_blank" rel="noopener" href="https://github.com/">github</a>上建立相应的远程仓库,并将代码分支提交</p>
<p><strong>建立远程仓库</strong></p>
<blockquote>
<p>远程仓库建立只需要在网站上直接操作即可</p>
</blockquote>
<p><strong>本地项目提交</strong></p>
<p><strong><code>注意</code></strong>: 由于我们之前的项目是直接从 vue-element-admin **<code>克隆</code><strong>而来,里面拥有原来的提交记录,为了避免冲突, 先将原来的</strong><code>.git</code>**文件夹删除掉</p>
<p>并且对项目进行git初始化</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git init  <span class="comment">#初始化项目</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$  git add . <span class="comment">#将修改添加到暂存</span></span><br><span class="line">$  git commit -m <span class="string">'人资项目初始化'</span> <span class="comment">#将暂存提到本地仓库</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>查看版本日志</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> <span class="comment">#查看版本日志</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>推送到远程仓库</strong></p>
<p>推送到远程仓库一般先将**<code>远程仓库地址</code>**用本地仓库别名代替</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin &lt;远程仓库地址&gt;  <span class="comment">#添加远程仓库地址</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>当我们不清楚自己的仓库对应的origin地址时, 我们可以通过命令查看当前的远程仓库地址</p>
</blockquote>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v <span class="comment">#查看本地仓库的远程仓库地址映射</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>推送master分支到远程仓库</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push -u origin master <span class="comment">#将master分支推送到origin所代表的远程仓库地址</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong><code>本节任务</code></strong>: 同学们 根据以上操作,将拉取下的项目提交到自己的仓库里面</p>
<h2 id="API模块和请求封装模块介绍"><a href="#API模块和请求封装模块介绍" class="headerlink" title="API模块和请求封装模块介绍"></a>API模块和请求封装模块介绍</h2><p><strong><code>目标</code></strong> 介绍API模块的单独请求和 request模块的封装</p>
<h3 id="Axios的拦截器介绍"><a href="#Axios的拦截器介绍" class="headerlink" title="Axios的拦截器介绍"></a>Axios的拦截器介绍</h3><blockquote>
<p>该项目采用了API的单独模块封装和axios拦截器的方式进行开发</p>
</blockquote>
<p>axios的拦截器原理如下</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200811012945409.png" alt="image-20200811012945409"></p>
<p><strong>axios拦截器</strong></p>
<p>axios作为网络请求的第三方工具, 可以进行请求和响应的拦截</p>
<p><strong>通过create创建了一个新的axios实例</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建了一个新的axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create({</span><br><span class="line">  <span class="attr">baseURL</span>: process.env.VUE_APP_BASE_API, <span class="comment">// url = base url + request url</span></span><br><span class="line">  <span class="comment">// withCredentials: true, // send cookies when cross-domain requests</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">// 超时时间</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p><strong>请求拦截器</strong></p>
<p>请求拦截器主要处理 token的**<code>统一注入问题</code>**</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// axios的请求拦截器</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> {</span><br><span class="line">    <span class="comment">// do something before request is sent</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (store.getters.token) {</span><br><span class="line">      <span class="comment">// let each request carry token</span></span><br><span class="line">      <span class="comment">// ['X-Token'] is a custom headers key</span></span><br><span class="line">      <span class="comment">// please modify it according to the actual situation</span></span><br><span class="line">      config.headers[<span class="string">'X-Token'</span>] = getToken()</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> {</span><br><span class="line">    <span class="comment">// do something with request error</span></span><br><span class="line">    <span class="built_in">console</span>.log(error) <span class="comment">// for debug</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">  }</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>响应拦截器</strong></p>
<p>响应拦截器主要处理 返回的**<code>数据异常</code>** 和**<code>数据结构</code>**问题</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> res = response.data</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if the custom code is not 20000, it is judged as an error.</span></span><br><span class="line">    <span class="keyword">if</span> (res.code !== <span class="number">20000</span>) {</span><br><span class="line">      Message({</span><br><span class="line">        <span class="attr">message</span>: res.message || <span class="string">'Error'</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">'error'</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">      })</span><br><span class="line">      <span class="keyword">if</span> (res.code === <span class="number">50008</span> || res.code === <span class="number">50012</span> || res.code === <span class="number">50014</span>) {</span><br><span class="line">        <span class="comment">// to re-login</span></span><br><span class="line">        MessageBox.confirm(<span class="string">'You have been logged out, you can cancel to stay on this page, or log in again'</span>, <span class="string">'Confirm logout'</span>, {</span><br><span class="line">          <span class="attr">confirmButtonText</span>: <span class="string">'Re-Login'</span>,</span><br><span class="line">          <span class="attr">cancelButtonText</span>: <span class="string">'Cancel'</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">'warning'</span></span><br><span class="line">        }).then(<span class="function">() =&gt;</span> {</span><br><span class="line">          store.dispatch(<span class="string">'user/resetToken'</span>).then(<span class="function">() =&gt;</span> {</span><br><span class="line">            location.reload()</span><br><span class="line">          })</span><br><span class="line">        })</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(res.message || <span class="string">'Error'</span>))</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'err'</span> + error) <span class="comment">// for debug</span></span><br><span class="line">    Message({</span><br><span class="line">      <span class="attr">message</span>: error.message,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">'error'</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">  }</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>这里为了后续更清楚的书写代码,我们将原有代码注释掉,换成如下代码</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出一个axios的实例  而且这个实例要有请求拦截器 响应拦截器</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create() <span class="comment">// 创建一个axios的实例</span></span><br><span class="line">service.interceptors.request.use() <span class="comment">// 请求拦截器</span></span><br><span class="line">service.interceptors.response.use() <span class="comment">// 响应拦截器</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service <span class="comment">// 导出axios实例</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="api模块的单独封装"><a href="#api模块的单独封装" class="headerlink" title="api模块的单独封装"></a><strong>api模块的单独封装</strong></h3><p>我们习惯性的将所有的网络请求 放置在api目录下统一管理,按照模块进行划分</p>
<p><strong>单独封装代码</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'@/utils/request'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/vue-admin-template/user/login'</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'post'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params">token</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/vue-admin-template/user/info'</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'get'</span>,</span><br><span class="line">    <span class="attr">params</span>: { token }</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/vue-admin-template/user/logout'</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'post'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>上面代码中,使用了封装的request工具,每个接口的请求都单独**<code>导出</code>**了一个方法,这样做的好处就是,任何位置需要请求的话,可以直接引用我们导出的请求方法</p>
<p>为了后续更好的开发，我们可以先将<strong>user.js</strong>代码的方法设置为空，后续在进行更正</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import request from '@/utils/request'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">data</span>) </span>{</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params">token</span>) </span>{</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>{</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**： 将request和用户模块的代码进行清理，理解request和模块封装</p>
<h2 id="公共资源图片和统一样式"><a href="#公共资源图片和统一样式" class="headerlink" title="公共资源图片和统一样式"></a>公共资源图片和统一样式</h2><p><strong><code>目标</code></strong> 将一些公共的图片和样式资源放入到 规定目录中</p>
<blockquote>
<p>我们已经将整体的基础模块进行了简单的介绍，接下来，我们需要将该项目所用到的图片和样式进行统一的处理</p>
</blockquote>
<p> <strong>图片资源</strong></p>
<blockquote>
<p>图片资源在课程资料的图片文件中，我们只需要将**<code>common</code>**文件夹拷贝放置到 **<code>assets</code>**目录即可</p>
</blockquote>
<p><strong>样式</strong></p>
<blockquote>
<p>样式资源在  资源/样式目录下</p>
</blockquote>
<p>修改**<code>variables.scss</code>**</p>
<p>新增**<code>common.scss</code>**</p>
<p>我们在**<code>variables.scss</code>**添加了一些基础的变量值</p>
<p>我们提供了 一份公共的**<code>common.scss</code>**样式,里面内置了一部分内容的样式,在开发期间可以帮助我们快速的实现页面样式和布局</p>
<p>将两个文件放置到<strong>styles</strong>目录下，然后在**<code>index.scss</code>**中引入该样式</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">'./common.scss'</span>; <span class="comment">//引入common.scss样式表 </span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节注意</code><strong>：注意在scss文件中，通过</strong>@import</strong> 引入其他样式文件，需要注意最后加分号，否则会报错</p>
<p><strong><code>本节任务</code></strong> 将公共资源的图片和样式放置到规定位置</p>
<h1 id="2-登录模块"><a href="#2-登录模块" class="headerlink" title="2.登录模块"></a>2.登录模块</h1><p><a target="_blank" rel="noopener" href="http://ihrm-java.itheima.net/#/login">线上地址</a></p>
<p>本章节，我们将在现有模板的基础上，完成如图的登录模块的功能</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200811014205189.png" alt="image-20200811014205189"></p>
<h2 id="设置固定的本地访问端口和网站名称"><a href="#设置固定的本地访问端口和网站名称" class="headerlink" title="设置固定的本地访问端口和网站名称"></a>设置固定的本地访问端口和网站名称</h2><p><strong><code>目标</code></strong>: 设置统一的本地访问端口和网站title</p>
<p>在正式开发业务之前，先将项目的<strong>本地端口</strong>和<strong>网站名称</strong>进行一下调整</p>
<p><strong>本地服务端口</strong>:  在**<code>vue.config.js</code>**中进行设置</p>
<p><strong><code>vue.config.js</code></strong> 就是vue项目相关的编译，配置，打包，启动服务相关的配置文件，它的核心在于<strong>webpack</strong>，但是又不同于webpack，相当于改良版的webpack， <a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/">文档地址</a></p>
<blockquote>
<p>如图，是开发环境服务端口的位置</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200710162221402.png" alt="image-20200710162221402"></p>
<p>我们看到上面的 **<code>process.env.port</code>**实际上是一个nodejs服务下的环境变量，该变量在哪里设置呢？</p>
<p>在项目下, 我们发现了**<code>.env.development</code><strong>和</strong><code>.env.production</code>**两个文件</p>
<p>development =&gt; 开发环境</p>
<p>production =&gt; 生产环境</p>
<p>当我们运行<strong>npm run dev</strong>进行开发调试的时候,此时会加载执行**<code>.env.development</code>**文件内容</p>
<p>当我们运行<strong>npm run build:prod</strong>进行生产环境打包的时候,会加载执行**<code>.env.production</code>**文件内容</p>
<p>所以,如果想要设置开发环境的接口,直接在**<code>.env.development</code>**中写入对于port变量的赋值即可</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置端口号</span></span><br><span class="line">port = 8888</span><br></pre></td></tr></tbody></table></figure>

<p><strong><code>本节注意</code></strong>:修改服务的配置文件,想要生效的话,必须要重新启动服务，值‘8888’后面不能留有空格</p>
<p><strong>网站名称</strong></p>
<p>网站名称实际在<strong>configureWebpack</strong>选项中的<strong>name</strong>选项,通过阅读代码,我们会发现name实际上来源于src目录下</p>
<p>**<code>settings.js</code>**文件</p>
<p>所以,我们可以将网站名称改成”<strong><code>人力资源管理平台</code></strong>“</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200710164040042.png" alt="image-20200710164040042"></p>
<p><strong>提交代码</strong></p>
<p><strong><code>本节注意</code></strong>:修改服务的配置文件,想要生效的话,必须要重新启动服务，值‘8888’后面不能留有空格</p>
<p>**<code>本节任务</code>**：完成网站的开发服务端口设置和网站名称设置</p>
<h2 id="登录页面的基础布局"><a href="#登录页面的基础布局" class="headerlink" title="登录页面的基础布局"></a>登录页面的基础布局</h2><p>**<code>目标</code>**完成登录页面的基础布局</p>
<p><strong>页面效果</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200710164517167.png" alt="image-20200710164517167"></p>
<p>首先要实现以上的页面效果, 我们可以直接将当前的登录页面进行相应的改造</p>
<p><strong>设置头部背景</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 放置标题图片 @是设置的别名--&gt;</span><br><span class="line">&lt;div class="title-container"&gt;</span><br><span class="line">        &lt;h3 class="title"&gt;</span><br><span class="line">          &lt;img src="@/assets/common/login-logo.png" alt=""&gt;</span><br><span class="line">        &lt;/h3&gt;</span><br><span class="line"> &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>**<code>本节注意</code>**： <code>@</code>是我们在vue.config.js中设置的一个路径别名，指定src根目录，这样可以很方便的寻找文件</p>
<p><strong>设置背景图片</strong></p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* reset element-ui css */</span></span><br><span class="line"><span class="selector-class">.login-container</span> {</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'~@/assets/common/login.jpg'</span>); // 设置背景图片</span><br><span class="line">  <span class="attribute">background-position</span>: center; // 将图片位置设置为充满整个屏幕</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>**<code>本节注意</code><strong>： 如需要在样式表中使用</strong><code>@</code><strong>别名的时候，需要在@前面加上一个</strong><code>~</code>**符号，否则不识别</p>
<p><strong>设置手机号和密码的字体颜色</strong></p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$light_gray: <span class="number">#68b0fe</span>;  // 将输入框颜色改成蓝色</span><br></pre></td></tr></tbody></table></figure>

<p><strong>设置输入表单整体背景色</strong></p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.el-form-item</span> {</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.1</span>);</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.7</span>); // 输入登录表单的背景色</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#454545</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>设置错误信息的颜色</strong></p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.el-form-item__error</span> {</span><br><span class="line">   <span class="attribute">color</span>: <span class="number">#fff</span></span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>设置登录按钮的样式</strong></p>
<blockquote>
<p>需要给el-button 增加一个loginBtn的class样式</p>
</blockquote>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.loginBtn</span> {</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#407ffe</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">64px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">24px</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>修改显示的提示文本和登录文本</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tips"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"margin-right:20px;"</span>&gt;</span>账号: 13800000002<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">span</span>&gt;</span> 密码: 123456<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>经过以上的改动, 我们得到了一个比较完善的登录页面</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200711002545085.png" alt="image-20200711002545085"></p>
<blockquote>
<p>解释:我们该项目的侧重点在于更多的介绍Vue中台项目所应用的技术,所以对于一些过于细节的样式或者布局,我们采用直接粘贴或者拷贝成型代码的方式,同学们可以通过课下多多练习</p>
</blockquote>
<p><strong>提交代码</strong></p>
<p>**<code>本节注意</code>**： <code>@</code>是我们在vue.config.js中设置的一个路径别名，指定src根目录，这样可以很方便的寻找文件</p>
<p>**<code>本节注意</code><strong>： 如需要在样式表中使用</strong><code>@</code><strong>别名的时候，需要在@前面加上一个</strong><code>~</code>**符号，否则不识别</p>
<p>**<code>本节任务</code>**： 完成登录首页的基本布局</p>
<h2 id="登录表单的校验"><a href="#登录表单的校验" class="headerlink" title="登录表单的校验"></a>登录表单的校验</h2><p>**<code>目标</code>**对登录表单进行规则校验</p>
<blockquote>
<p>基础模板已经有了基础校验的代码,所以我们这一章节更多的是修正和完善</p>
</blockquote>
<h3 id="el-form表单校验的先决条件"><a href="#el-form表单校验的先决条件" class="headerlink" title="el-form表单校验的先决条件"></a><strong>el-form表单校验的先决条件</strong></h3><p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200830212537835.png" alt="image-20200830212537835"></p>
<h3 id="手机号和密码的校验"><a href="#手机号和密码的校验" class="headerlink" title="手机号和密码的校验"></a>手机号和密码的校验</h3><p><strong>字段名对应</strong></p>
<blockquote>
<p>为什么要对应? 因为基础模板采用的是**<code>username</code><strong>的字段,但是实际接口中采用的是</strong><code>mobile</code><strong>的字段,为了更方便的写代码,所以我们将</strong><code>username</code><strong>改成</strong><code>mobile</code>**</p>
</blockquote>
<p>这里除了字段名，还有我们的规则校验名称，以及prop名称。</p>
<p><strong>英文提示变成中文</strong></p>
<p>基础模板中都是<strong>placeHolder</strong>占位符是英文,要变成中文</p>
<p>登录按钮文字同样需要换成中文</p>
<p><strong>校验手机号和校验密码</strong></p>
<p>基础模板中,已经做了校验,我们针对代码进行一些优化</p>
<p>新规则：手机号必填，并且进行格式校验，密码必填，长度6-16位之间</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">   <span class="comment">// 自定义校验函数</span></span><br><span class="line">   <span class="keyword">const</span> validateMobile = <span class="function"><span class="keyword">function</span>(<span class="params">rule, value, callback</span>) </span>{</span><br><span class="line">     <span class="comment">// 校验value</span></span><br><span class="line">     <span class="comment">// if (validMobile(value)) {</span></span><br><span class="line">     <span class="comment">//   // 如果通过 直接执行callback</span></span><br><span class="line">     <span class="comment">//   callback()</span></span><br><span class="line">     <span class="comment">// } else {</span></span><br><span class="line">     <span class="comment">//   callback(new Error('手机号格式不正确'))</span></span><br><span class="line">     <span class="comment">// }</span></span><br><span class="line">     validMobile(value) ? callback() : callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'手机号格式不正确'</span>))</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> {</span><br><span class="line">     <span class="attr">loginForm</span>: {</span><br><span class="line">       <span class="attr">mobile</span>: <span class="string">'13800000002'</span>,</span><br><span class="line">       <span class="attr">password</span>: <span class="string">'123456'</span></span><br><span class="line">     },</span><br><span class="line">     <span class="attr">loginRules</span>: {</span><br><span class="line">       <span class="attr">mobile</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span>, <span class="attr">message</span>: <span class="string">'手机号不能为空'</span> }, {</span><br><span class="line">         <span class="attr">validator</span>: validateMobile, <span class="attr">trigger</span>: <span class="string">'blur'</span></span><br><span class="line">       }],</span><br><span class="line">       <span class="attr">password</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span>, <span class="attr">message</span>: <span class="string">'密码不能为空'</span> }, {</span><br><span class="line">         <span class="attr">min</span>: <span class="number">6</span>, <span class="attr">max</span>: <span class="number">16</span>, <span class="attr">message</span>: <span class="string">'密码的长度在6-16位之间 '</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span></span><br><span class="line">       }]</span><br><span class="line">     },</span><br><span class="line">     <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">     <span class="attr">passwordType</span>: <span class="string">'password'</span>,</span><br><span class="line">     <span class="attr">redirect</span>: <span class="literal">undefined</span></span><br><span class="line">   }</span><br><span class="line"> },</span><br></pre></td></tr></tbody></table></figure>

<p>我们在**<code>utils/validate.js</code>**方法中增加了一个校验手机号的方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 校验手机号</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">validMobile</span>(<span class="params">str</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^1[3-9]\d{9}$/</span>.test(str) <span class="comment">// 校验手机号</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>**<code>utils/validate.js</code>**是一个专门存放校验工具方法的文件</p>
<h3 id="关于修饰符"><a href="#关于修饰符" class="headerlink" title="关于修饰符"></a>关于修饰符</h3><p><strong>关于修饰符</strong></p>
<blockquote>
<p>在该页面中，我们发现了事件的几个修饰符 <strong><code>@keyup.enter.native</code></strong>  <strong><code>@click.native.prevent</code></strong></p>
</blockquote>
<p>@keyup.**<code>enter</code>**属于按键修饰符，如果我们想监听在按回车键的时候触发，可以如下编写</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 只有在 `key` 是 `Enter` 时调用 `vm.submit()` --&gt;</span><br><span class="line">&lt;input v-on:keyup.enter="submit"&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>@keyup.enter.<strong><code>native</code></strong> 表示监听组件的原生事件，比如 keyup就是于input的原生事件，这里写native表示keyup是一个原生事件</p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：实现登录用户的手机号和密码校验</p>
<h2 id="Vue-Cli配置跨域代理"><a href="#Vue-Cli配置跨域代理" class="headerlink" title="Vue-Cli配置跨域代理"></a>Vue-Cli配置跨域代理</h2><p><strong><code>目标</code></strong>: 通过配置vue-cli的代理解决跨域访问的问题</p>
<h3 id="为什么会出现跨域？"><a href="#为什么会出现跨域？" class="headerlink" title="为什么会出现跨域？"></a>为什么会出现跨域？</h3><p>当下,最流行的就是**<code>前后分离</code><strong>项目,也就是</strong><code>前端项目</code><strong>和</strong><code>后端接口</code><strong>并不在一个域名之下，那么前端项目访问后端接口必然存在</strong><code>跨域</code>**的行为.</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200826110754199.png" alt="image-20200826110754199"></p>
<blockquote>
<p>怎么解决这种跨域 ？</p>
</blockquote>
<p><strong><code>请注意</code><strong>，我们所遇到的这种跨域是位于</strong>开发环境</strong>的，真正部署上线时的跨域是<strong>生产环境</strong>的</p>
<h3 id="解决开发环境的跨域问题"><a href="#解决开发环境的跨域问题" class="headerlink" title="解决开发环境的跨域问题"></a>解决开发环境的跨域问题</h3><p><strong>开发环境的跨域</strong></p>
<p>开发环境的跨域，也就是在**<code>vue-cli脚手架环境</code><strong>下开发启动服务时，我们访问接口所遇到的跨域问题，vue-cli为我们在本地</strong><code>开启了一个服务</code><strong>,可以通过这个服务帮我们</strong><code>代理请求</code>**,解决跨域问题</p>
<p>这就是vue-cli配置<strong>webpack的反向代理</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200811022013103.png" alt="image-20200811022013103"></p>
<blockquote>
<p>采用vue-cli的代理配置</p>
</blockquote>
<p>vue-cli的配置文件即**<code>vue.config.js</code>**,这里有我们需要的 <a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/config/#devserver-proxy">代理选项</a></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  <span class="attr">devServer</span>: {</span><br><span class="line">   <span class="comment">// 代理配置</span></span><br><span class="line">    <span class="attr">proxy</span>: {</span><br><span class="line">        <span class="comment">// 这里的api 表示如果我们的请求地址有/api的时候,就出触发代理机制</span></span><br><span class="line">        <span class="comment">// localhost:8888/api/abc  =&gt; 代理给另一个服务器</span></span><br><span class="line">        <span class="comment">// 本地的前端  =》 本地的后端  =》 代理我们向另一个服务器发请求 （行得通）</span></span><br><span class="line">        <span class="comment">// 本地的前端  =》 另外一个服务器发请求 （跨域 行不通）</span></span><br><span class="line">        <span class="string">'/api'</span>: {</span><br><span class="line">        <span class="attr">target</span>: <span class="string">'www.baidu.com'</span>, <span class="comment">// 我们要代理的地址</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>, <span class="comment">// 是否跨域 需要设置此值为true 才可以让本地服务代理我们发出请求</span></span><br><span class="line">         <span class="comment">// 路径重写</span></span><br><span class="line">        <span class="attr">pathRewrite</span>: {</span><br><span class="line">            <span class="comment">// 重新路由  localhost:8888/api/login  =&gt; www.baidu.com/api/login</span></span><br><span class="line">            <span class="string">'^/api'</span>: <span class="string">''</span> <span class="comment">// 假设我们想把 localhost:8888/api/login 变成www.baidu.com/login 就需要这么做 </span></span><br><span class="line">        }</span><br><span class="line">      },</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>以上就是我们在vue-cli项目中配置的代理设置</p>
<blockquote>
<p>接下来,我们在代码中将要代理的后端地址变成 <a target="_blank" rel="noopener" href="http://ihrm-java.itheima.net/">后端接口地址</a></p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代理跨域的配置</span></span><br><span class="line">   <span class="attr">proxy</span>: {</span><br><span class="line">     <span class="comment">// 当我们的本地的请求 有/api的时候，就会代理我们的请求地址向另外一个服务器发出请求</span></span><br><span class="line">     <span class="string">'/api'</span>: {</span><br><span class="line">       <span class="attr">target</span>: <span class="string">'http://ihrm-java.itheima.net/'</span>, <span class="comment">// 跨域请求的地址</span></span><br><span class="line">       <span class="attr">changeOrigin</span>: <span class="literal">true</span> <span class="comment">// 只有这个值为true的情况下 才表示开启跨域</span></span><br><span class="line">     }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<p><strong><code>本节注意</code><strong>：我们并没有进行</strong><code>pathRewrite</code></strong>,因为后端接口就是**<code>ihrm-java.itheima.net/api</code>**这种格式,所以不需要重写</p>
<p>**<code>vue.config.js</code>**的改动如果要生效,需要进行重启服务</p>
<p>同时，还需要注意的是，我们同时需要注释掉 mock的加载，因为mock-server会导致代理服务的异常</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// before: require('./mock/mock-server.js'),  // 注释mock-server加载</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>生产环境的跨域</strong></p>
<p>生产环境表示我们已经开发完成项目，将项目部署到了服务器上,这时已经没有了vue-cli脚手架的**<code>辅助</code><strong>了，我们只是把打包好的</strong><code>html+js+css</code><strong>交付运维人员，放到</strong><code>Nginx</code><strong>服务器而已,所以此时需要借助</strong><code>Nginx</code>**的反向代理来进行</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server{</span><br><span class="line">    <span class="comment"># 监听9099端口</span></span><br><span class="line">    listen 9099;</span><br><span class="line">    <span class="comment"># 本地的域名是localhost</span></span><br><span class="line">    server_name localhost;</span><br><span class="line">    <span class="comment">#凡是localhost:9099/api这个样子的，都转发到真正的服务端地址http://baidu.com</span></span><br><span class="line">    location ^~ /api {</span><br><span class="line">        proxy_pass http://baidu.com;</span><br><span class="line">    }    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong><code>注意</code></strong>:这里的操作一般由运维人员完成,需要前端进行操作,这里我们进行一下简单了解</p>
<p>更多正向代理和反向代理知识,请阅读这篇文章<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ysocean/p/9392908.html">Nginx反向代理</a></p>
<p><strong>提交代码</strong></p>
<p><strong><code>本节注意</code><strong>：我们并没有进行</strong><code>pathRewrite</code></strong>,因为后端接口就是**<code>ihrm-java.itheima.net/api</code>**这种格式,所以不需要重写</p>
<p>**<code>本节任务</code>**： 配置vue-cli的反向代理，实现后端接口的跨域访问</p>
<h2 id="封装单独的登录接口"><a href="#封装单独的登录接口" class="headerlink" title="封装单独的登录接口"></a>封装单独的登录接口</h2><p><strong><code>目标</code></strong> 在单独请求模块中,单独封装登录接口</p>
<blockquote>
<p>完成登录模块之后，我们需要对登录接口进行封装</p>
</blockquote>
<p>首先，查阅接口文档中的登录接口</p>
<blockquote>
<p>基础模板已经有了原来的登录代码,我们只需要进行简单的改造即可</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="comment">// 返回一个axios对象 =&gt; promise  // 返回了一个promise对象</span></span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/login'</span>, <span class="comment">// 因为所有的接口都要跨域 表示所有的接口要带 /api</span></span><br><span class="line">    <span class="attr">method</span>: <span class="string">'post'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>如图</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200812002834804.png" alt="image-20200812002834804"></p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：封装单独的登录接口</p>
<h2 id="封装Vuex的登录Action并处理token"><a href="#封装Vuex的登录Action并处理token" class="headerlink" title="封装Vuex的登录Action并处理token"></a>封装Vuex的登录Action并处理token</h2><p>**<code>目标</code>**在vuex中封装登录的action,并处理token</p>
<blockquote>
<p>在这个小节中，我们将在vuex中加入对于用户的登录的处理</p>
</blockquote>
<h3 id="在Vuex中对token进行管理"><a href="#在Vuex中对token进行管理" class="headerlink" title="在Vuex中对token进行管理"></a>在Vuex中对token进行管理</h3><p>在传统模式中，我们登录的逻辑很简单，如图</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200812003821680.png" alt="image-20200812003821680"></p>
<blockquote>
<p>上图中，组件直接和接口打交道，这并没有什么问题，但是对于用户token这一高频使用的**<code>钥匙</code>**，我们需要让vuex来介入，将用户的token状态共享，更方便的读取，如图</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200812011826021.png" alt="image-20200812011826021"></p>
<p><strong>实现store/modules/user.js基本配置</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 状态</span></span><br><span class="line"><span class="keyword">const</span> state = {}</span><br><span class="line"><span class="comment">// 修改状态</span></span><br><span class="line"><span class="keyword">const</span> mutations = {}</span><br><span class="line"><span class="comment">// 执行异步</span></span><br><span class="line"><span class="keyword">const</span> actions = {}</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>设置token的共享状态</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = {</span><br><span class="line">  <span class="attr">token</span>: <span class="literal">null</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>我们需要知道,**<code>钥匙</code>**不能每次都通过登录获取,我们可以将token放置到本地的缓存中</p>
</blockquote>
<p>在**<code>utils/auth.js</code><strong>中,基础模板已经为我们提供了</strong><code>获取token</code><strong>,</strong><code>设置token</code><strong>,</strong><code>删除token</code>**的方法,可以直接使用</p>
<p>只需要将存储的key放置成特定值即可</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">'js-cookie'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TokenKey = <span class="string">'hrsaas-ihrm-token'</span> <span class="comment">// 设定一个独一无二的key</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getToken</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> Cookies.get(TokenKey)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setToken</span>(<span class="params">token</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> Cookies.set(TokenKey, token)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeToken</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> Cookies.remove(TokenKey)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>初始化token状态</strong> - <strong><code>store/modules/user.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getToken, setToken, removeToken } <span class="keyword">from</span> <span class="string">'@/utils/auth'</span></span><br><span class="line"><span class="comment">// 状态</span></span><br><span class="line"><span class="comment">// 初始化的时候从缓存中读取状态 并赋值到初始化的状态上</span></span><br><span class="line"><span class="comment">// Vuex的持久化 如何实现 ？ Vuex和前端缓存相结合</span></span><br><span class="line"><span class="keyword">const</span> state = {</span><br><span class="line">  <span class="attr">token</span>: getToken() <span class="comment">// 设置token初始状态   token持久化 =&gt; 放到缓存中</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提供修改token的mutations</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改状态</span></span><br><span class="line"><span class="keyword">const</span> mutations = {</span><br><span class="line">  <span class="comment">// 设置token</span></span><br><span class="line">  <span class="function"><span class="title">setToken</span>(<span class="params">state, token</span>)</span> {</span><br><span class="line">    state.token = token <span class="comment">// 设置token  只是修改state的数据  123 =》 1234</span></span><br><span class="line">    <span class="comment">// vuex变化 =&gt; 缓存数据</span></span><br><span class="line">    setToken(token) <span class="comment">// vuex和 缓存数据的同步</span></span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 删除缓存</span></span><br><span class="line">  <span class="function"><span class="title">removeToken</span>(<span class="params">state</span>)</span> {</span><br><span class="line">    state.token = <span class="literal">null</span> <span class="comment">// 删除vuex的token</span></span><br><span class="line">    removeToken() <span class="comment">// 先清除 vuex  再清除缓存 vuex和 缓存数据的同步</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="封装登录的Action"><a href="#封装登录的Action" class="headerlink" title="封装登录的Action"></a>封装登录的Action</h3><p><strong>封装登录的action</strong></p>
<blockquote>
<p>登录action要做的事情,<strong><code>调用登录接口</code></strong>,<strong><code>成功后设置token到vuex</code></strong>,<strong><code>失败则返回失败</code></strong></p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行异步</span></span><br><span class="line"><span class="keyword">const</span> actions = {</span><br><span class="line">  <span class="comment">// 定义login action  也需要参数 调用action时 传递过来的参数</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">login</span>(<span class="params">context, data</span>)</span> {</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> login(data) <span class="comment">// 实际上就是一个promise  result就是执行的结果</span></span><br><span class="line">    <span class="comment">// axios默认给数据加了一层data</span></span><br><span class="line">    <span class="keyword">if</span> (result.data.success) {</span><br><span class="line">      <span class="comment">// 表示登录接口调用成功 也就是意味着你的用户名和密码是正确的</span></span><br><span class="line">      <span class="comment">// 现在有用户token</span></span><br><span class="line">      <span class="comment">// actions 修改state 必须通过mutations</span></span><br><span class="line">      context.commit(<span class="string">'setToken'</span>, result.data.data)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>上述代码中,我们使用了**<code>async/await</code><strong>语法,如果用</strong><code>then</code>**语法也是可以的</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 为什么async/await 不用返回new Promise,因为 async函数本身就是 Promise,promise的值返回的值  </span></span><br><span class="line"><span class="function"><span class="title">login</span>(<span class="params">context, data</span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{</span><br><span class="line">      login(data).then(<span class="function"><span class="params">result</span> =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (result.data.success) {</span><br><span class="line">          context.commit(<span class="string">'setToken'</span>,  result.data.data) <span class="comment">// 提交mutations设置token</span></span><br><span class="line">          resolve()  <span class="comment">// 表示执行成功了</span></span><br><span class="line">        }</span><br><span class="line">      })</span><br><span class="line">    })</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>以上两种写法都是OK的,我们在项目研发过程中,尽可能的采用前一种</p>
</blockquote>
<p>除此之外，为了更好的让其他模块和组件更好的获取token数据，我们可以在**<code>store/getters.js</code>**中将token值作为公共的访问属性放出</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = {</span><br><span class="line">  <span class="attr">sidebar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.sidebar,</span><br><span class="line">  <span class="attr">device</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.device,</span><br><span class="line">  <span class="attr">token</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.token <span class="comment">// 在根级的getters上 开发子模块的属性给别人看 给别人用</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<blockquote>
<p>通过本节内容，我们要掌握在Vuex中如何来管理共享状态</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200826145500269.png" alt="image-20200826145500269"></p>
<p>**<code>本节任务</code>**：封装Vuex的登录Action并处理token</p>
<h2 id="request中环境变量和异常的处理"><a href="#request中环境变量和异常的处理" class="headerlink" title="request中环境变量和异常的处理"></a>request中环境变量和异常的处理</h2><p>**<code>目标</code>**设置request环境变量和异常处理</p>
<h3 id="区分axios在不同环境中的请求基础地址"><a href="#区分axios在不同环境中的请求基础地址" class="headerlink" title="区分axios在不同环境中的请求基础地址"></a>区分axios在不同环境中的请求基础地址</h3><blockquote>
<p>为什么会有环境变量之分? 如图</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200826150136697.png" alt="image-20200826150136697"></p>
<blockquote>
<p>从上图可以看出，开发环境实际上就是在自己的本地开发或者要求不那么高的环境，但是一旦进入生产，就是**<code>真实的数据</code>**。 拿银行作比喻，如果你在开发环境拿生产环境的接口做测试，银行系统就会发生很大的风险。</p>
</blockquote>
<p>前端主要区分两个环境,<strong><code>开发环境</code></strong>,<strong><code>生产环境</code></strong></p>
<blockquote>
<p> 也就是两个环境发出的请求地址是不同的，用什么区分呢?</p>
</blockquote>
<p><strong>环境变量</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ process.env.NODE_ENV <span class="comment"># 当为production时为生产环境 为development时为开发环境</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>环境文件</strong></p>
<p> 我们可以在**<code>.env.development</code><strong>和</strong><code>.env.production</code>**定义变量，变量自动就为当前环境的值</p>
<p>基础模板在以上文件定义了变量**<code>VUE_APP_BASE_API</code><strong>，该变量可以作为axios请求的</strong><code>baseURL</code>**</p>
<p>我们会发现,在模板中,两个值分别为**<code>/dev-api</code><strong>和</strong><code>/prod-api</code>**</p>
<p>但是我们的开发环境代理是**<code>/api</code>**，所以可以统一下</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开发环境的基础地址和代理对应</span></span><br><span class="line">VUE_APP_BASE_API = <span class="string">'/api'</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里配置了/api,意味着需要在Nginx服务器上为该服务配置 nginx的反向代理对应/prod-api的地址 </span></span><br><span class="line">VUE_APP_BASE_API = <span class="string">'/prod-api'</span>  </span><br></pre></td></tr></tbody></table></figure>

<p>**<code>本节注意</code>**：我们这里生产环境和开发环境设置了不同的值，后续我们还会在生产环境部署的时候，去配置该值所对应的反向代理，反向代理指向哪个地址，完全由我们自己决定，不会和开发环境冲突</p>
<p><strong>在request中设置baseUrl</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> service = axios.create({</span><br><span class="line">  <span class="comment">// 如果执行 npm run dev  值为 /api 正确  /api 这个代理只是给开发环境配置的代理</span></span><br><span class="line">  <span class="comment">// 如果执行 npm run build 值为 /prod-api  没关系  运维应该在上线的时候 给你配置上 /prod-api的代理</span></span><br><span class="line">  <span class="attr">baseURL</span>: process.env.VUE_APP_BASE_API, <span class="comment">// 设置axios请求的基础的基础地址</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">// 定义5秒超时</span></span><br><span class="line">}) <span class="comment">// 创建一个axios的实例</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="处理axios的响应拦截器"><a href="#处理axios的响应拦截器" class="headerlink" title="处理axios的响应拦截器"></a>处理axios的响应拦截器</h3><blockquote>
<p>OK，除此之外,axios返回的数据中默认增加了一层**<code>data的包裹</code>**,我们需要在这里处理下</p>
</blockquote>
<blockquote>
<p>并且,人资项目的接口,如果执行失败,只是设置了**<code>success</code><strong>为</strong><code>false</code>**，并没有reject，我们需要一并处理下</p>
</blockquote>
<p>处理逻辑如图</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200812020656210.png" alt="image-20200812020656210"></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> {</span><br><span class="line">  <span class="comment">// axios默认加了一层data</span></span><br><span class="line">  <span class="keyword">const</span> { success, message, data } = response.data</span><br><span class="line">  <span class="comment">//   要根据success的成功与否决定下面的操作</span></span><br><span class="line">  <span class="keyword">if</span> (success) {</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// 业务已经错误了 还能进then ? 不能 ！ 应该进catch</span></span><br><span class="line">    Message.error(message) <span class="comment">// 提示错误消息</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(message))</span><br><span class="line">  }</span><br><span class="line">}, <span class="function"><span class="params">error</span> =&gt;</span> {</span><br><span class="line">  Message.error(error.message) <span class="comment">// 提示错误信息</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error) <span class="comment">// 返回执行错误 让当前的执行链跳出成功 直接进入 catch</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>既然在request中已经默认去除了一层data的外衣，所以我们也将上节login的action进行一下改动</p>
</blockquote>
<p><strong>处理登录的返回结构问题</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">login</span>(<span class="params">context, data</span>)</span> {</span><br><span class="line">  <span class="comment">// 经过响应拦截器的处理之后 这里的result实际上就是 token</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> login(data) <span class="comment">// 实际上就是一个promise  result就是执行的结果</span></span><br><span class="line">  <span class="comment">// axios默认给数据加了一层data</span></span><br><span class="line">  <span class="comment">// 表示登录接口调用成功 也就是意味着你的用户名和密码是正确的</span></span><br><span class="line">  <span class="comment">// 现在有用户token</span></span><br><span class="line">  <span class="comment">// actions 修改state 必须通过mutations</span></span><br><span class="line">  context.commit(<span class="string">'setToken'</span>, result)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**： 完成request环境变量和异常的处理</p>
<h2 id="登录页面调用登录action-处理异常"><a href="#登录页面调用登录action-处理异常" class="headerlink" title="登录页面调用登录action,处理异常"></a>登录页面调用登录action,处理异常</h2><p><strong><code>目标</code></strong> 调用vuex中的登录action,并跳转到主页</p>
<blockquote>
<p>按照如图的业务逻辑，把剩下的内容在登录页面引入</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200812011826021.png" alt="image-20200812011826021"></p>
<p><strong>引入actions辅助函数</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { mapActions } <span class="keyword">from</span> <span class="string">'vuex'</span>  <span class="comment">// 引入vuex的辅助函数</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>引入action方法</strong></p>
<blockquote>
<p>此处，我们采用直接引入模块action的方式，后面我们采用分模块的引用方式</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">methods: {</span><br><span class="line">    ...mapActions([<span class="string">'user/login'</span>])</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>调用登录</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$refs.loginForm.validate(<span class="keyword">async</span> isOK =&gt; {</span><br><span class="line">      <span class="keyword">if</span> (isOK) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">          <span class="built_in">this</span>.loading = <span class="literal">true</span></span><br><span class="line">          <span class="comment">// 只有校验通过了 我们才去调用action</span></span><br><span class="line">          <span class="keyword">await</span> <span class="built_in">this</span>[<span class="string">'user/login'</span>](<span class="built_in">this</span>.loginForm)</span><br><span class="line">          <span class="comment">// 应该登录成功之后</span></span><br><span class="line">          <span class="comment">// async标记的函数实际上一个promise对象</span></span><br><span class="line">          <span class="comment">// await下面的代码 都是成功执行的代码</span></span><br><span class="line">          <span class="built_in">this</span>.$router.push(<span class="string">'/'</span>)</span><br><span class="line">        } <span class="keyword">catch</span> (error) {</span><br><span class="line">          <span class="built_in">console</span>.log(error)</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">          <span class="comment">//  不论执行try 还是catch  都去关闭转圈</span></span><br><span class="line">          <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    })</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节注意</code><strong>：我们调用的是Vuex中子模块的action，该模块我们进行了namespaced: true，所以引用aciton时需要带上</strong><code>user/</code></strong>, 并且在使用该方法时，直接使用 <strong><code>this['user/login']</code></strong>, 使用this.user/login 语法是错误的</p>
<p>**<code>本节任务</code>**：登录页面调用登录action，处理异常</p>
<h2 id="主页的token拦截处理"><a href="#主页的token拦截处理" class="headerlink" title="主页的token拦截处理"></a>主页的token拦截处理</h2><p>**<code>目标</code>**：根据token处理主页的访问权限问题</p>
<h3 id="权限拦截的流程图"><a href="#权限拦截的流程图" class="headerlink" title="权限拦截的流程图"></a>权限拦截的流程图</h3><blockquote>
<p>我们已经完成了登录的过程，并且存储了token，但是此时主页并没有因为token的有无而被控制访问权限</p>
</blockquote>
<p>接下来我们需要实现以下如下的流程图</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200714093601730.png" alt="image-20200714093601730"></p>
<blockquote>
<p>在基础框架阶段，我们已经知道**<code>src/permission.js</code>**是专门处理路由权限的，所以我们在这里处理</p>
</blockquote>
<h3 id="流程图转化代码"><a href="#流程图转化代码" class="headerlink" title="流程图转化代码"></a>流程图转化代码</h3><p><strong>流程图转化的代码</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 权限拦截 导航守卫 路由守卫  router</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'@/router'</span> <span class="comment">// 引入路由实例</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span> <span class="comment">// 引入vuex store实例</span></span><br><span class="line"><span class="keyword">import</span> NProgress <span class="keyword">from</span> <span class="string">'nprogress'</span> <span class="comment">// 引入一份进度条插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'nprogress/nprogress.css'</span> <span class="comment">// 引入进度条样式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">'/login'</span>, <span class="string">'/404'</span>] <span class="comment">// 定义白名单  所有不受权限控制的页面</span></span><br><span class="line"><span class="comment">// 路由的前置守卫</span></span><br><span class="line">router.beforeEach(<span class="function"><span class="keyword">function</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) </span>{</span><br><span class="line">  NProgress.start() <span class="comment">// 开启进度条</span></span><br><span class="line">  <span class="comment">//  首先判断有无token</span></span><br><span class="line">  <span class="keyword">if</span> (store.getters.token) {</span><br><span class="line">    <span class="comment">//   如果有token 继续判断是不是去登录页</span></span><br><span class="line">    <span class="keyword">if</span> (to.path === <span class="string">'/login'</span>) {</span><br><span class="line">      <span class="comment">//  表示去的是登录页</span></span><br><span class="line">      next(<span class="string">'/'</span>) <span class="comment">// 跳到主页</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      next() <span class="comment">// 直接放行</span></span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// 如果没有token</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.indexOf(to.path) &gt; -<span class="number">1</span>) {</span><br><span class="line">      <span class="comment">// 如果找到了 表示在在名单里面</span></span><br><span class="line">      next()</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      next(<span class="string">'/login'</span>) <span class="comment">// 跳到登录页</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  NProgress.done() <span class="comment">// 手动强制关闭一次  为了解决 手动切换地址时  进度条的不关闭的问题</span></span><br><span class="line">})</span><br><span class="line"><span class="comment">// 后置守卫</span></span><br><span class="line">router.afterEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  NProgress.done() <span class="comment">// 关闭进度条</span></span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>在导航守卫的位置，我们添加了NProgress的插件，可以完成进入时的进度条效果</p>
</blockquote>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：完成主页中根据有无token，进行页面访问的处理</p>
<h2 id="主页的左侧导航样式"><a href="#主页的左侧导航样式" class="headerlink" title="主页的左侧导航样式"></a>主页的左侧导航样式</h2><p>**<code>目标</code>**设置左侧的导航样式</p>
<blockquote>
<p>接下来我们需要将左侧导航设置成如图样式</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200714142517337.png" alt="image-20200714142517337"></p>
<blockquote>
<p>主页的布局组件位置**<code>src/layout</code>**</p>
</blockquote>
<p><strong>主页布局架构</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200812023354631.png" alt="image-20200812023354631"></p>
<p><strong>左侧导航组件的样式文件</strong><code>styles/siderbar.scss</code></p>
<p><strong>设置背景渐变色</strong></p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sidebar-container</span> {</span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">-webkit-linear-gradient</span>(bottom, <span class="number">#3d6df8</span>, <span class="number">#5b8cff</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>设置左侧导航背景图片</strong></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.scrollbar-wrapper</span> { </span><br><span class="line">    <span class="attribute">background</span>: url(<span class="string">'~@/assets/common/leftnavBg.png'</span>) no-repeat <span class="number">0</span> <span class="number">100%</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>**<code>注意</code><strong>：在scss中，如果我们想要使用</strong><code>@</code><strong>别名，需要在前面加上一个</strong><code>~</code>**才可以</p>
<p><strong>设置菜单选中颜色</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">.el-menu {</span><br><span class="line">  border: none;</span><br><span class="line">  height: 100%;</span><br><span class="line">  width: 100% !important;</span><br><span class="line">  a{</span><br><span class="line">    li{</span><br><span class="line">      .svg-icon{</span><br><span class="line">        color: <span class="comment">#fff;</span></span><br><span class="line">        font-size: 18px;</span><br><span class="line">        vertical-align: middle;</span><br><span class="line">        .icon{</span><br><span class="line">          color:<span class="comment">#fff;</span></span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      span{</span><br><span class="line">        color: <span class="comment">#fff;</span></span><br><span class="line">      }</span><br><span class="line">      &amp;:hover{</span><br><span class="line">        .svg-icon{</span><br><span class="line">          color: <span class="comment">#43a7fe</span></span><br><span class="line">        }</span><br><span class="line">        span{</span><br><span class="line">          color: <span class="comment">#43a7fe;</span></span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>**<code>注意</code>**：因为我们后期没有二级菜单，所以这里暂时不用对二级菜单的样式进行控制</p>
<p><strong>显示左侧logo图片</strong> <strong><code>src/setttings.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line"></span><br><span class="line">  <span class="attr">title</span>: <span class="string">'人力资源管理平台'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@type <span class="type">{boolean}</span> </span>true | false</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>Whether fix the header</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">fixedHeader</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@type <span class="type">{boolean}</span> </span>true | false</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>Whether show the logo in sidebar</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">sidebarLogo</span>: <span class="literal">true</span> <span class="comment">// 显示logo</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>设置头部图片结构</strong> <strong><code>src/layout/components/Sidebar/Logo.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="sidebar-logo-container" :class="{'collapse':collapse}"&gt;</span><br><span class="line">    &lt;transition name="sidebarLogoFade"&gt;</span><br><span class="line">      &lt;router-link key="collapse" class="sidebar-logo-link" to="/"&gt;</span><br><span class="line">        &lt;img src="@/assets/common/logo.png" class="sidebar-logo  "&gt;</span><br><span class="line">      &lt;/router-link&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>设置大图和小图的样式</strong></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  &amp;<span class="selector-class">.collapse</span> {</span><br><span class="line">    <span class="selector-class">.sidebar-logo</span> {</span><br><span class="line">      <span class="attribute">margin-right</span>: <span class="number">0px</span>;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">32px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"><span class="comment">// 小图样式</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sidebar-logo</span> {</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">140px</span>;</span><br><span class="line">      <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">      <span class="attribute">margin-right</span>: <span class="number">12px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 大图样式</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>去除logo的背景色</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200827104724769.png" alt="image-20200827104724769"></p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**： 完成主页的左侧导航样式</p>
<p>**<code>本节注意</code>**：我们该项目中没有二级显示菜单，所以二级菜单的样式并没有做过多处理，同学们不必在意</p>
<h2 id="设置头部内容的布局和样式"><a href="#设置头部内容的布局和样式" class="headerlink" title="设置头部内容的布局和样式"></a>设置头部内容的布局和样式</h2><p>**<code>目标</code>**设置头部内容的布局和样式</p>
<blockquote>
<p>我们需要把页面设置成如图样式</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200714172602305.png" alt="image-20200714172602305"></p>
<p><strong>头部组件位置</strong> <strong><code>layout/components/Navbar.vue</code></strong></p>
<p><strong>添加公司名称</strong>，<strong>注释面包屑</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"app-breadcrumb"</span>&gt;</span></span><br><span class="line">     江苏传智播客教育科技股份有限公司</span><br><span class="line">     <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"breadBtn"</span>&gt;</span>体验版<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;breadcrumb class="breadcrumb-container" /&gt; --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>公司样式</strong></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.app-breadcrumb</span> {</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: text;</span><br><span class="line">  <span class="selector-class">.breadBtn</span> {</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#84a9fe</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">15px</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>头部背景渐变色</strong></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.navbar</span> {</span><br><span class="line">    <span class="attribute">background-image</span>: -webkit-linear-gradient(left, <span class="number">#3d6df8</span>, <span class="number">#5b8cff</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>汉堡组件图标颜色</strong>  <strong><code>src/components/Hamburger/index.vue</code></strong></p>
<p><strong><code>注意</code><strong>这里的图标我们使用了</strong><code>svg</code><strong>，设置颜色需要使用svg标签的</strong><code>fill属性</code></strong></p>
<blockquote>
<p>设置svg图标为白色</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg</span><br><span class="line">      :class="{'is-active':isActive}"</span><br><span class="line">      class="hamburger"</span><br><span class="line">      viewBox="0 0 1024 1024"</span><br><span class="line">      xmlns="http://www.w3.org/2000/svg"</span><br><span class="line">      width="64"</span><br><span class="line">      height="64"</span><br><span class="line">      fill="#fff" </span><br><span class="line">    &gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>右侧下拉菜单设置</strong></p>
<blockquote>
<p>将下拉菜单调节成**<code>首页/项目地址/退出登录</code>**</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="right-menu"&gt;</span><br><span class="line">  &lt;el-dropdown class="avatar-container" trigger="click"&gt;</span><br><span class="line">    &lt;div class="avatar-wrapper"&gt;</span><br><span class="line">      &lt;img src="@/assets/common/bigUserHeader.png" class="user-avatar"&gt;</span><br><span class="line">      &lt;span class="name"&gt;管理员&lt;/span&gt;</span><br><span class="line">      &lt;i class="el-icon-caret-bottom" style="color:#fff" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;el-dropdown-menu slot="dropdown" class="user-dropdown"&gt;</span><br><span class="line">      &lt;router-link to="/"&gt;</span><br><span class="line">        &lt;el-dropdown-item&gt;</span><br><span class="line">          首页</span><br><span class="line">        &lt;/el-dropdown-item&gt;</span><br><span class="line">      &lt;/router-link&gt;</span><br><span class="line">      &lt;a target="_blank" href="https://gitee.com/shuiruohanyu/hrsaas53"&gt;</span><br><span class="line">        &lt;el-dropdown-item&gt;项目地址&lt;/el-dropdown-item&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">      &lt;el-dropdown-item divided @click.native="logout"&gt;</span><br><span class="line">        &lt;span style="display:block;"&gt;退出登录&lt;/span&gt;</span><br><span class="line">      &lt;/el-dropdown-item&gt;</span><br><span class="line">    &lt;/el-dropdown-menu&gt;</span><br><span class="line">  &lt;/el-dropdown&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>头像和下拉菜单样式</strong></p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.user-avatar</span> {</span><br><span class="line">        <span class="attribute">cursor</span>: pointer;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">15px</span>;</span><br><span class="line">        <span class="attribute">vertical-align</span>: middle;</span><br><span class="line"></span><br><span class="line"> }</span><br><span class="line"> <span class="selector-class">.name</span> {</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">        <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">        <span class="attribute">margin-left</span>:<span class="number">5px</span>;</span><br><span class="line"> }</span><br><span class="line"> <span class="selector-class">.user-dropdown</span> {</span><br><span class="line">         <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p>用户名和头像我们先用了假数据进行，下小章节，会进行这份数据的获取</p>
<p><strong>最终效果</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716015113164.png"></p>
<p><strong>提交代码</strong></p>
<h1 id="3-主页模块"><a href="#3-主页模块" class="headerlink" title="3.主页模块"></a>3.主页模块</h1><h2 id="获取用户资料接口和token注入"><a href="#获取用户资料接口和token注入" class="headerlink" title="获取用户资料接口和token注入"></a>获取用户资料接口和token注入</h2><p><strong><code>目标</code></strong> 封装获取用户资料的资料信息</p>
<blockquote>
<p>上小节中，我们完成了头部菜单的基本布局，但是用户的头像和名称并没有，我们需要通过接口调用的方式获取当前用户的资料信息</p>
</blockquote>
<p><strong>获取用户资料接口</strong></p>
<p>在**<code>src/api/user.js</code>**中封装获取用户资料的方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  获取用户的基本资料</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/profile'</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'post'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>我们忽略了一个问题！我们的headers参数并没有在这里传入，为什么呢</p>
</blockquote>
<p>headers中的<strong>Authorization</strong>相当于我们<strong>开门</strong>（<strong>调用接口</strong>）时**<code>钥匙(token)</code><strong>，我们在打开任何带安全权限的门的时候都需要</strong><code>钥匙(token)</code>** 如图</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200715233339927.png" alt="image-20200715233339927"></p>
<p>每次在接口中携带**<code>钥匙（token）</code>**很麻烦，所以我们可以在axios拦截器中统一注入token </p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716000203862.png" alt="image-20200716000203862"></p>
<p><strong>统一注入token</strong> <strong><code>src/utils/request.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">service.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> {</span><br><span class="line">  <span class="comment">// 在这个位置需要统一的去注入token</span></span><br><span class="line">  <span class="keyword">if</span> (store.getters.token) {</span><br><span class="line">    <span class="comment">// 如果token存在 注入token</span></span><br><span class="line">    config.headers[<span class="string">'Authorization'</span>] = <span class="string">`Bearer <span class="subst">${store.getters.token}</span>`</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> config <span class="comment">// 必须返回配置</span></span><br><span class="line">}, <span class="function"><span class="params">error</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">}) </span><br></pre></td></tr></tbody></table></figure>

<p>**<code>本节任务</code>**： 完成获取用户资料接口和token注入</p>
<h2 id="封装获取用户资料的action并共享用户状态"><a href="#封装获取用户资料的action并共享用户状态" class="headerlink" title="封装获取用户资料的action并共享用户状态"></a>封装获取用户资料的action并共享用户状态</h2><p>**<code>目标</code>**： 在用户的vuex模块中封装获取用户资料的action，并设置相关状态</p>
<blockquote>
<p>用户状态会在后续的开发中，频繁用到，所以我们将用户状态同样的封装到action中</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200827111324564.png" alt="image-20200827111324564"></p>
<p><strong>封装获取用户资料action</strong>   <strong><code>action</code></strong>  <strong><code>src/store/modules/user.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { login, getUserInfo } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取用户资料action</span></span><br><span class="line">  <span class="keyword">async</span> getUserInfo (context) {</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> getUserInfo()  <span class="comment">// 获取返回值</span></span><br><span class="line">    context.commit(<span class="string">'setUserInfo'</span>, result) <span class="comment">// 将整个的个人信息设置到用户的vuex数据中</span></span><br><span class="line">    <span class="keyword">return</span> result <span class="comment">// 这里为什么要返回 为后面埋下伏笔</span></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>同时，配套的我们还进行了关于用户状态的mutations方法的设计</p>
</blockquote>
<p><strong>初始化state</strong>  <strong><code>state</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = {</span><br><span class="line">  <span class="attr">token</span>: getToken(), <span class="comment">// 设置token初始状态   token持久化 =&gt; 放到缓存中</span></span><br><span class="line">  <span class="attr">userInfo</span>: {} <span class="comment">// 定义一个空的对象 不是null 因为后边我要开发userInfo的属性给别人用  userInfo.name</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>userInfo为什么我们不设置为null，而是设置为 {} </p>
</blockquote>
<p>因为我们会在**<code>getters</code>**中引用userinfo的变量，如果设置为null，则会引起异常和报错</p>
<p><strong>设置和删除用户资料</strong>   <strong><code>mutations</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置用户信息</span></span><br><span class="line"> <span class="function"><span class="title">setUserInfo</span>(<span class="params">state, userInfo</span>)</span> {</span><br><span class="line">   state.userInfo = { ...userInfo } <span class="comment">// 用 浅拷贝的方式去赋值对象 因为这样数据更新之后，才会触发组件的更新</span></span><br><span class="line"> },</span><br><span class="line"> <span class="comment">// 删除用户信息</span></span><br><span class="line"> <span class="function"><span class="title">reomveUserInfo</span>(<span class="params">state</span>)</span> {</span><br><span class="line">   state.userInfo = {}</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>同学们，我们将所有的资料设置到了<strong>userInfo</strong>这个对象中，如果想要取其中一个值，我们还可以在getters中建立相应的映射</p>
</blockquote>
<p>因为我们要做映射，如果初始值为null，一旦引用了getters，就会报错</p>
<p><strong>建立用户名的映射</strong>  <strong><code>src/store/getters.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = {</span><br><span class="line">  <span class="attr">sidebar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.sidebar,</span><br><span class="line">  <span class="attr">device</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.device,</span><br><span class="line">  <span class="attr">token</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.token,</span><br><span class="line">  <span class="attr">name</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.userInfo.username <span class="comment">// 建立用户名称的映射</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>到现在为止，我们将用户资料的<strong>action =&gt;  mutation =&gt; state =&gt;  getters</strong> 都设置好了， 那么我们应该在什么位置来调用这个action呢 ？</p>
<blockquote>
<p>别着急，先提交代码，下个小节，我们来揭晓答案</p>
</blockquote>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**封装获取用户资料的action并共享用户状态</p>
<h2 id="权限拦截处调用获取资料action"><a href="#权限拦截处调用获取资料action" class="headerlink" title="权限拦截处调用获取资料action"></a>权限拦截处调用获取资料action</h2><p>**<code>目标</code>**在权限拦截处调用aciton</p>
<h3 id="权限拦截器调用action"><a href="#权限拦截器调用action" class="headerlink" title="权限拦截器调用action"></a>权限拦截器调用action</h3><blockquote>
<p>在上小节中，我们完成了用户资料的整个流程，那么这个action在哪里调用呢？</p>
</blockquote>
<p>用户资料有个硬性要求，**<code>必须有token</code>**才可以获取，那么我们就可以在确定有token的位置去获取用户资料</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716004526838.png" alt="image-20200716004526838"></p>
<blockquote>
<p>由上图可以看出，一旦确定我们进行了放行，就可以获取用户资料</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200813013009294.png" alt="image-20200813013009294"></p>
<p><strong>调用action</strong> <strong><code>src/permission.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!store.state.user.userInfo.userId) {</span><br><span class="line">      <span class="keyword">await</span> store.dispatch(<span class="string">'user/getUserInfo'</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>如果我们觉得获取用户id的方式写了太多层级，可以在vuex中的getters中设置一个映射 <strong><code>src/store/getters.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userId: <span class="function"><span class="params">state</span> =&gt;</span> state.user.userInfo.userId <span class="comment">// 建立用户id的映射</span></span><br></pre></td></tr></tbody></table></figure>

<p>代码就变成了</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!store.getters.userId) {</span><br><span class="line">       <span class="comment">// 如果没有id这个值 才会调用 vuex的获取资料的action</span></span><br><span class="line">       <span class="keyword">await</span> store.dispatch(<span class="string">'user/getUserInfo'</span>)</span><br><span class="line">       <span class="comment">// 为什么要写await 因为我们想获取完资料再去放行</span></span><br><span class="line">     }</span><br></pre></td></tr></tbody></table></figure>

<p>此时，我们可以通过dev-tools工具在控制台清楚的看到数据已经获取</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716012120619.png" alt="image-20200716012120619"></p>
<blockquote>
<p>最后一步，只需要将头部菜单中的名称换成真实的用户名即可</p>
</blockquote>
<h3 id="获取头像接口合并数据"><a href="#获取头像接口合并数据" class="headerlink" title="获取头像接口合并数据"></a>获取头像接口合并数据</h3><p><strong>头像怎么办？</strong></p>
<blockquote>
<p>我们发现头像并不在接口的返回体中（接口原因），我们可以通过另一个接口来获取头像，并把头像合并到当前的资料中</p>
</blockquote>
<p><strong>封装获取用户信息接口</strong>  <strong><code>src/api/user.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 获取用户的基本信息  现在写它 完全是为了显示头像</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserDetailById</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/user/<span class="subst">${id}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>这个接口需要用户的userId，在前一个接口处，我们已经获取到了，所以可以直接在后面的内容去衔接</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { login, getUserInfo, getUserDetailById } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取用户资料action</span></span><br><span class="line"> <span class="keyword">async</span> <span class="function"><span class="title">getUserInfo</span>(<span class="params">context</span>)</span> {</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> getUserInfo() <span class="comment">// result就是用户的基本资料</span></span><br><span class="line">    <span class="keyword">const</span> baseInfo = <span class="keyword">await</span> getUserDetailById(result.userId) <span class="comment">// 为了获取头像</span></span><br><span class="line">    <span class="keyword">const</span> baseResult = { ...result, ...baseInfo } <span class="comment">// 将两个接口结果合并</span></span><br><span class="line">    <span class="comment">// 此时已经获取到了用户的基本资料 迫不得已 为了头像再次调用一个接口</span></span><br><span class="line">    context.commit(<span class="string">'setUserInfo'</span>, baseResult) <span class="comment">// 提交mutations</span></span><br><span class="line">    <span class="comment">// 加一个点睛之笔  这里这一步，暂时用不到，但是请注意，这给我们后边会留下伏笔</span></span><br><span class="line">    <span class="keyword">return</span> baseResult</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>为了更好地获取头像，同样可以把头像放于getters中</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">staffPhoto: <span class="function"><span class="params">state</span> =&gt;</span> state.user.userInfo.staffPhoto <span class="comment">// 建立用户头像的映射</span></span><br></pre></td></tr></tbody></table></figure>

<p>此时，我们的头像和名称已经获取到了，可以直接将之前的假数据换成真正的头像和名称</p>
<p><strong>用户名</strong>  <strong><code>layout/components/Navbar.vue</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...mapGetters([</span><br><span class="line">     <span class="string">'sidebar'</span>,</span><br><span class="line">     <span class="string">'name'</span>,</span><br><span class="line">     <span class="string">'staffPhoto'</span></span><br><span class="line">   ])</span><br><span class="line">    &lt;img :src=<span class="string">"staffPhoto"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"user-avatar"</span>&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"name"</span>&gt;</span>{{ name }}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>通过设置，用户名已经显示，头像依然没有显示，这是因为虽然有地址，但是地址来源是私有云，目前已经失效，所以需要额外处理下图片的异常</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200827140451144.png" alt="image-20200827140451144"></p>
<p>至于处理图片的异常，我们在下一节中，可采用自定义指令的形式来进行处理</p>
<p>**<code>本节任务</code>**：实现权限拦截处调用获取资料action</p>
<h2 id="自定义指令-解决异常图片情况"><a href="#自定义指令-解决异常图片情况" class="headerlink" title="自定义指令-解决异常图片情况"></a>自定义指令-解决异常图片情况</h2><p>**<code>目标</code>**： 通过自定义指令的形式解决异常图片的处理</p>
<h3 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h3><p>注册自定义指令</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'指令名称'</span>, {</span><br><span class="line">    <span class="comment">// 会在当前指令作用的dom元素 插入之后执行</span></span><br><span class="line">    <span class="comment">// options 里面是指令的表达式</span></span><br><span class="line">    <span class="attr">inserted</span>: <span class="function"><span class="keyword">function</span> (<span class="params">dom,options</span>) </span>{</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>自定义指令可以采用统一的文件来管理  <strong><code>src/directives/index.js</code></strong>,这个文件负责管理所有的自定义指令</p>
</blockquote>
<p>首先定义第一个自定义指令  <strong><code>v-imagerror</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> imagerror = {</span><br><span class="line">  <span class="comment">// 指令对象 会在当前的dom元素插入到节点之后执行</span></span><br><span class="line">  <span class="function"><span class="title">inserted</span>(<span class="params">dom, options</span>)</span> {</span><br><span class="line">    <span class="comment">// options是 指令中的变量的解释  其中有一个属性叫做 value</span></span><br><span class="line">    <span class="comment">// dom 表示当前指令作用的dom对象</span></span><br><span class="line">    <span class="comment">// dom认为此时就是图片</span></span><br><span class="line">    <span class="comment">// 当图片有地址 但是地址没有加载成功的时候 会报错 会触发图片的一个事件 =&gt; onerror</span></span><br><span class="line">    dom.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">      <span class="comment">// 当图片出现异常的时候 会将指令配置的默认图片设置为该图片的内容</span></span><br><span class="line">      <span class="comment">// dom可以注册error事件</span></span><br><span class="line">      dom.src = options.value <span class="comment">// 这里不能写死</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="在main-js完成自定义指令全局注册"><a href="#在main-js完成自定义指令全局注册" class="headerlink" title="在main.js完成自定义指令全局注册"></a>在main.js完成自定义指令全局注册</h3><p>然后，在**<code>main.js</code>**中完成对于该文件中所有指令的全局注册 </p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> directives <span class="keyword">from</span> <span class="string">'@/directives'</span></span><br><span class="line"><span class="comment">// 注册自定义指令</span></span><br><span class="line"><span class="comment">// 遍历所有的导出的指令对象 完成自定义全局注册</span></span><br><span class="line"><span class="built_in">Object</span>.keys(directives).forEach(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">  <span class="comment">// 注册自定义指令</span></span><br><span class="line">  Vue.directive(key, directives[key])</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>针对上面的引入语法  <strong><code>import *  as  变量</code></strong>  得到的是一个对象**<code>{ 变量1：对象1，变量2： 对象2 ...   }</code>**, 所以可以采用对象遍历的方法进行处理</p>
<p>指令注册成功，可以在**<code>navbar.vue</code>**中直接使用了</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img v-imageerror="defaultImg" :src="staffPhoto" class="user-avatar"&gt;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">   <span class="keyword">return</span> {</span><br><span class="line">     <span class="attr">defaultImg</span>: <span class="built_in">require</span>(<span class="string">'@/assets/common/head.jpg'</span>)</span><br><span class="line">   }</span><br><span class="line"> },</span><br></pre></td></tr></tbody></table></figure>

<p>**<code>本节任务</code>**：实现一个自定义指令，解决图片加载异常的问题</p>
<h2 id="实现登出功能"><a href="#实现登出功能" class="headerlink" title="实现登出功能"></a>实现登出功能</h2><p>**<code>目标</code>**：实现用户的登出操作</p>
<blockquote>
<p>登出仅仅是跳到登录页吗？</p>
</blockquote>
<p>不，当然不是，我们要处理如下</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200827143847893.png" alt="image-20200827143847893"></p>
<p>同样的，登出功能，我们在vuex中的用户模块中实现对应的<strong>action</strong></p>
<p><strong>登出action</strong>  <strong><code>src/store/modules/user.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登出的action</span></span><br><span class="line">  <span class="function"><span class="title">logout</span>(<span class="params">context</span>)</span> {</span><br><span class="line">    <span class="comment">// 删除token</span></span><br><span class="line">    context.commit(<span class="string">'removeToken'</span>) <span class="comment">// 不仅仅删除了vuex中的 还删除了缓存中的</span></span><br><span class="line">    <span class="comment">// 删除用户资料</span></span><br><span class="line">    context.commit(<span class="string">'removeUserInfo'</span>) <span class="comment">// 删除用户信息</span></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>头部菜单调用action</strong>  <strong><code>src/layout/components/Navbar.vue</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">logout</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">'user/logout'</span>) <span class="comment">// 这里不论写不写 await 登出方法都是同步的</span></span><br><span class="line">    <span class="built_in">this</span>.$router.push(<span class="string">`/login`</span>) <span class="comment">// 跳到登录</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>**<code>注意</code>**我们这里也可以采用vuex中的模块化引入辅助函数</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { mapGetters, createNamespacedHelpers  } <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">const</span> {  mapActions } = createNamespacedHelpers(<span class="string">'user'</span>) <span class="comment">// 这是的mapAction直接对应模块下的action辅助函数</span></span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    ...mapActions([<span class="string">'lgout'</span>]),</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p>以上代码，实际上直接对user模块下的action进行了引用，</p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**： 实现登出功能</p>
<h2 id="Token失效的主动介入"><a href="#Token失效的主动介入" class="headerlink" title="Token失效的主动介入"></a>Token失效的主动介入</h2><p>**<code>目标</code>**： 处理当token失效时业务</p>
<h3 id="主动介入token处理的业务逻辑"><a href="#主动介入token处理的业务逻辑" class="headerlink" title="主动介入token处理的业务逻辑"></a>主动介入token处理的业务逻辑</h3><blockquote>
<p>开门的钥匙不是一直有效的，如果一直有效，会有安全风险，所以我们尝试在客户端进行一下token的时间检查</p>
</blockquote>
<p>具体业务图如下</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716231205153.png" alt="image-20200716231205153"></p>
<h3 id="流程图转化代码-1"><a href="#流程图转化代码-1" class="headerlink" title="流程图转化代码"></a>流程图转化代码</h3><p><strong>流程图转化代码</strong> <strong><code>src/utils/auth.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeKey = <span class="string">'hrsaas-timestamp-key'</span> <span class="comment">// 设置一个独一无二的key</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取时间戳</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getTimeStamp</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> Cookies.get(timeKey)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 设置时间戳</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setTimeStamp</span>(<span class="params"></span>) </span>{</span><br><span class="line">  Cookies.set(timeKey, <span class="built_in">Date</span>.now())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong><code>src/utils/request.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'@/router'</span></span><br><span class="line"><span class="keyword">import</span> { Message } <span class="keyword">from</span> <span class="string">'element-ui'</span></span><br><span class="line"><span class="keyword">import</span> { getTimeStamp } <span class="keyword">from</span> <span class="string">'@/utils/auth'</span></span><br><span class="line"><span class="keyword">const</span> TimeOut = <span class="number">3600</span> <span class="comment">// 定义超时时间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.create({</span><br><span class="line"><span class="comment">// 当执行 npm run dev  =&gt; .evn.development =&gt; /api =&gt; 跨域代理</span></span><br><span class="line">  <span class="attr">baseURL</span>: process.env.VUE_APP_BASE_API, <span class="comment">// npm  run dev  =&gt; /api npm run build =&gt;  /prod-api</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">// 设置超时时间</span></span><br><span class="line">})</span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">service.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> {</span><br><span class="line">  <span class="comment">// config 是请求的配置信息</span></span><br><span class="line">  <span class="comment">// 注入token</span></span><br><span class="line">  <span class="keyword">if</span> (store.getters.token) {</span><br><span class="line">    <span class="comment">// 只有在有token的情况下 才有必要去检查时间戳是否超时</span></span><br><span class="line">    <span class="keyword">if</span> (IsCheckTimeOut()) {</span><br><span class="line">      <span class="comment">// 如果它为true表示 过期了</span></span><br><span class="line">      <span class="comment">// token没用了 因为超时了</span></span><br><span class="line">      store.dispatch(<span class="string">'user/logout'</span>) <span class="comment">// 登出操作</span></span><br><span class="line">      <span class="comment">// 跳转到登录页</span></span><br><span class="line">      router.push(<span class="string">'/login'</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'token超时了'</span>))</span><br><span class="line">    }</span><br><span class="line">    config.headers[<span class="string">'Authorization'</span>] = <span class="string">`Bearer <span class="subst">${store.getters.token}</span>`</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> config <span class="comment">// 必须要返回的</span></span><br><span class="line">}, <span class="function"><span class="params">error</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">})</span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> {</span><br><span class="line">  <span class="comment">// axios默认加了一层data</span></span><br><span class="line">  <span class="keyword">const</span> { success, message, data } = response.data</span><br><span class="line">  <span class="comment">//   要根据success的成功与否决定下面的操作</span></span><br><span class="line">  <span class="keyword">if</span> (success) {</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// 业务已经错误了 还能进then ? 不能 ！ 应该进catch</span></span><br><span class="line">    Message.error(message) <span class="comment">// 提示错误消息</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(message))</span><br><span class="line">  }</span><br><span class="line">}, <span class="function"><span class="params">error</span> =&gt;</span> {</span><br><span class="line">  Message.error(error.message) <span class="comment">// 提示错误信息</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error) <span class="comment">// 返回执行错误 让当前的执行链跳出成功 直接进入 catch</span></span><br><span class="line">})</span><br><span class="line"><span class="comment">// 是否超时</span></span><br><span class="line"><span class="comment">// 超时逻辑  (当前时间  - 缓存中的时间) 是否大于 时间差</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsCheckTimeOut</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> currentTime = <span class="built_in">Date</span>.now() <span class="comment">// 当前时间戳</span></span><br><span class="line">  <span class="keyword">var</span> timeStamp = getTimeStamp() <span class="comment">// 缓存时间戳</span></span><br><span class="line">  <span class="keyword">return</span> (currentTime - timeStamp) / <span class="number">1000</span> &gt; TimeOut</span><br><span class="line">}</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>**<code>本节注意</code>**：我们在调用登录接口的时候 一定是没有token的，所以token检查不会影响登录接口的调用</p>
<blockquote>
<p>同理，在登录的时候，如果登录成功，我们应该设置时间戳</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义login action  也需要参数 调用action时 传递过来的参数</span></span><br><span class="line"><span class="comment">// async 标记的函数其实就是一个异步函数 -&gt; 本质是还是 一个promise</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">login</span>(<span class="params">context, data</span>)</span> {</span><br><span class="line">  <span class="comment">// 经过响应拦截器的处理之后 这里的result实际上就是 token</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> login(data) <span class="comment">// 实际上就是一个promise  result就是执行的结果</span></span><br><span class="line">  <span class="comment">// axios默认给数据加了一层data</span></span><br><span class="line">  <span class="comment">// 表示登录接口调用成功 也就是意味着你的用户名和密码是正确的</span></span><br><span class="line">  <span class="comment">// 现在有用户token</span></span><br><span class="line">  <span class="comment">// actions 修改state 必须通过mutations</span></span><br><span class="line">  context.commit(<span class="string">'setToken'</span>, result)</span><br><span class="line">  <span class="comment">// 写入时间戳</span></span><br><span class="line">  setTimeStamp() <span class="comment">// 将当前的最新时间写入缓存</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<blockquote>
<p>有主动处理就有被动处理，也就是后端告诉我们超时了，我们被迫做出反应，如果后端接口没有做处理，主动介入就是一种简单的方式</p>
</blockquote>
<p>**<code>本节任务</code>**：完成token超时的主动介入</p>
<h2 id="Token失效的被动处理"><a href="#Token失效的被动处理" class="headerlink" title="Token失效的被动处理"></a>Token失效的被动处理</h2><p>**<code>目标</code>**： 实现token失效的被动处理</p>
<blockquote>
<p>除了token的主动介入之外，我们还可以对token进行被动的处理，如图</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200818155842864.png" alt="image-20200818155842864"></p>
<p>token超时的错误码是**<code>10002</code>**</p>
<p><strong>代码实现</strong>  <strong><code>src/utils/request.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">error =&gt; {</span><br><span class="line">  <span class="comment">// error 信息 里面 response的对象</span></span><br><span class="line">  <span class="keyword">if</span> (error.response &amp;&amp; error.response.data &amp;&amp; error.response.data.code === <span class="number">10002</span>) {</span><br><span class="line">    <span class="comment">// 当等于10002的时候 表示 后端告诉我token超时了</span></span><br><span class="line">    store.dispatch(<span class="string">'user/logout'</span>) <span class="comment">// 登出action 删除token</span></span><br><span class="line">    router.push(<span class="string">'/login'</span>)</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    Message.error(error.message) <span class="comment">// 提示错误信息</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>无论是主动介入还是被动处理，这些操作都是为了更好地处理token，减少错误异常的可能性</p>
</blockquote>
<p><strong><code>本节任务</code></strong>  Token失效的被动处理</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本章节我一步步实现了如下的效果</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716015113164.png" alt="image-20200716015113164"></p>
<p>实际的业务走向</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200827152601712.png" alt="image-20200827152601712"></p>
<p>实际上，我们的主页功能有一个重要的**<code>角色权限</code>**功能还没有完成，此功能等到我们完成基本业务之后再进行展开</p>
<p>中台大型后端平台的深入是一个**<code>抽丝剥茧</code>**的过程，循序渐进的明白每一步的操作是非常关键的。</p>
<h1 id="4-路由和页面"><a href="#4-路由和页面" class="headerlink" title="4.路由和页面"></a>4.路由和页面</h1><h2 id="路由页面整理"><a href="#路由页面整理" class="headerlink" title="路由页面整理"></a>路由页面整理</h2><p><strong><code>目标</code></strong> 删除基础模板中附带的多余页面</p>
<blockquote>
<p>基础模板帮我们提前内置了一些页面，本章节我们进行一下整理</p>
</blockquote>
<p>首先，我们需要知道类似这种大型中台项目的页面路由是如何设置的。</p>
<p><strong>简单项目</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200827153753307.png" alt="image-20200827153753307"></p>
<p><strong>当前项目结构</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200827155342126.png" alt="image-20200827155342126"></p>
<blockquote>
<p>为什么要拆成若干个路由模块呢？ </p>
</blockquote>
<p>因为复杂中台项目的页面众多，不可能把所有的业务都集中在一个文件上进行管理和维护，并且还有最重要的，前端的页面中主要分为两部分，一部分是所有人都可以访问的， 一部分是只有有权限的人才可以访问的，拆分多个模块便于更好的控制</p>
<p><strong>静态路由和动态路由</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716150421791.png" alt="image-20200716150421791"></p>
<p>**<code>注意</code>**这里的动态路由并不是 <strong>路由传参</strong>的动态路由</p>
<p>了解完成路由设计之后，我们对当前的路由进行一下整理</p>
<p><strong>删除多余的静态路由表</strong>   <strong><code>src/router/index.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * constantRoutes</span></span><br><span class="line"><span class="comment"> * a base page that does not have permission requirements</span></span><br><span class="line"><span class="comment"> * all roles can be accessed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> constantRoutes = [</span><br><span class="line">  {</span><br><span class="line">    <span class="attr">path</span>: <span class="string">'/login'</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/login/index'</span>),</span><br><span class="line">    <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  {</span><br><span class="line">    <span class="attr">path</span>: <span class="string">'/404'</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/404'</span>),</span><br><span class="line">    <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  {</span><br><span class="line">    <span class="attr">path</span>: <span class="string">'/'</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">'/dashboard'</span>,</span><br><span class="line">    <span class="attr">children</span>: [{</span><br><span class="line">      <span class="attr">path</span>: <span class="string">'dashboard'</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">'Dashboard'</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/dashboard/index'</span>),</span><br><span class="line">      <span class="attr">meta</span>: { <span class="attr">title</span>: <span class="string">'Dashboard'</span>, <span class="attr">icon</span>: <span class="string">'dashboard'</span> }</span><br><span class="line">    }]</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 404 page must be placed at the end !!!</span></span><br><span class="line">  { <span class="attr">path</span>: <span class="string">'*'</span>, <span class="attr">redirect</span>: <span class="string">'/404'</span>, <span class="attr">hidden</span>: <span class="literal">true</span> }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>上面代码，我们只对登录页/404/主页进行了保留</p>
</blockquote>
<p>并且我们发现，删除了其他页面之后，左侧导航菜单的数据也只剩下了首页</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716153900077.png" alt="image-20200716153900077"></p>
<p><strong>这是因为左侧导航菜单的数据来源于路由信息</strong></p>
<p><strong>删除多余的路由组件</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716154315430.png" alt="image-20200716154315430"></p>
<blockquote>
<p>只保留以上三个路由组件的内容，后续慢慢增加</p>
</blockquote>
<p>同样的在api目录下，存在多余的api-table.js 一并删除</p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：完成业务路由页面的整理</p>
<h2 id="业务模块页面的快速搭建"><a href="#业务模块页面的快速搭建" class="headerlink" title="业务模块页面的快速搭建"></a>业务模块页面的快速搭建</h2><p>**<code>目标</code>**： 快速搭建人资项目的常规业务模块</p>
<h3 id="新建模块的页面和路由文件"><a href="#新建模块的页面和路由文件" class="headerlink" title="新建模块的页面和路由文件"></a>新建模块的页面和路由文件</h3><blockquote>
<p>截止到现在，我们已经完成了一个中台系统的基本轮廓，如图</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200716224038544.png" alt="image-20200716224038544"></p>
<p>接下来，我们可以将人力资源需要做的模块快速搭建相应的页面和路由</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">├── dashboard           <span class="comment"># 首页</span></span><br><span class="line">├── login               <span class="comment"># 登录</span></span><br><span class="line">├── 404                 <span class="comment"># 404</span></span><br><span class="line">├── departments         <span class="comment"># 组织架构</span></span><br><span class="line">├── employees           <span class="comment"># 员工</span></span><br><span class="line">├── setting             <span class="comment"># 公司设置</span></span><br><span class="line">├── salarys             <span class="comment"># 工资</span></span><br><span class="line">├── social              <span class="comment"># 社保</span></span><br><span class="line">├── attendances         <span class="comment"># 考勤</span></span><br><span class="line">├── approvals           <span class="comment"># 审批</span></span><br><span class="line">├── permission          <span class="comment"># 权限管理</span></span><br></pre></td></tr></tbody></table></figure>

<p>根据上图中的结构，在views目录下，建立对应的目录，给每个模块新建一个**<code>index.vue</code>**，作为每个模块的主页</p>
<p><strong>快速新建文件夹</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir departments employees setting salarys social attendances approvals permission</span><br></pre></td></tr></tbody></table></figure>

<p>每个模块的内容，可以先按照标准的模板建立，如</p>
<p><strong>员工</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="dashboard-container"&gt;</span><br><span class="line">    &lt;div class="app-container"&gt;</span><br><span class="line">      &lt;h2&gt;</span><br><span class="line">        员工</span><br><span class="line">      &lt;/h2&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>根据以上的标准建立好对应页面之后，接下来建立每个模块的路由规则</p>
</blockquote>
<p>路由模块目录结构</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">├── router               <span class="comment"># 路由目录</span></span><br><span class="line"> ├── index.js            <span class="comment"># 路由主文件</span></span><br><span class="line"> ├── modules             <span class="comment"># 模块目录</span></span><br><span class="line">  ├── departments.js     <span class="comment"># 组织架构</span></span><br><span class="line">  ├── employees.js       <span class="comment"># 员工 </span></span><br><span class="line">  ├── setting.js         <span class="comment"># 公司设置</span></span><br><span class="line">  ├── salarys.js         <span class="comment"># 工资</span></span><br><span class="line">  ├── social.js          <span class="comment"># 社保</span></span><br><span class="line">  ├── attendances.js     <span class="comment"># 考勤</span></span><br><span class="line">  ├── approvals.js       <span class="comment"># 审批</span></span><br><span class="line">  ├── permission.js      <span class="comment"># 权限管理</span></span><br></pre></td></tr></tbody></table></figure>

<p>快速创建命令</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch departments.js employees.js setting.js salarys.js salarys.js social.js attendances.js approvals.js permission.js</span><br></pre></td></tr></tbody></table></figure>

<h3 id="设置每个模块的路由规则"><a href="#设置每个模块的路由规则" class="headerlink" title="设置每个模块的路由规则"></a>设置每个模块的路由规则</h3><blockquote>
<p>每个模块导出的内容表示该模块下的路由规则</p>
</blockquote>
<p>如员工 <strong>employees.js</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出属于员工的路由规则</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'@/layout'</span></span><br><span class="line"><span class="comment">//  {  path: '', component: '' }</span></span><br><span class="line"><span class="comment">// 每个子模块 其实 都是外层是layout  组件位于layout的二级路由里面</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">path</span>: <span class="string">'/employees'</span>, <span class="comment">// 路径</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">'employees'</span>, <span class="comment">// 给路由规则加一个name</span></span><br><span class="line">  <span class="attr">component</span>: Layout, <span class="comment">// 组件</span></span><br><span class="line">  <span class="comment">// 配置二级路的路由表</span></span><br><span class="line">  <span class="attr">children</span>: [{</span><br><span class="line">    <span class="attr">path</span>: <span class="string">''</span>, <span class="comment">// 这里当二级路由的path什么都不写的时候 表示该路由为当前二级路由的默认路由</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/employees'</span>),</span><br><span class="line">    <span class="comment">// 路由元信息  其实就是存储数据的对象 我们可以在这里放置一些信息</span></span><br><span class="line">    <span class="attr">meta</span>: {</span><br><span class="line">      <span class="attr">title</span>: <span class="string">'员工管理'</span> <span class="comment">// meta属性的里面的属性 随意定义 但是这里为什么要用title呢， 因为左侧导航会读取我们的路由里的meta里面的title作为显示菜单名称</span></span><br><span class="line">    }</span><br><span class="line">  }]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当你的访问地址 是 /employees的时候 layout组件会显示 此时 你的二级路由的默认组件  也会显示</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>上述代码中，我们用到了meta属性，该属性为一个对象，里面可放置自定义属性，主要用于读取一些配置和参数，并且值得**<code>注意</code><strong>的是：我们的meta写了二级默认路由上面，而不是一级路由，因为当存在二级路由的时候，访问当前路由信息访问的就是</strong><code>二级默认路由</code>**</p>
</blockquote>
<p>大家针对上述的设计，对上面的模块进行快速的搭建</p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：完成其他模块的页面和路由的快速搭建</p>
<h2 id="静态路由和动态路由临时合并，形成左侧菜单"><a href="#静态路由和动态路由临时合并，形成左侧菜单" class="headerlink" title="静态路由和动态路由临时合并，形成左侧菜单"></a>静态路由和动态路由临时合并，形成左侧菜单</h2><p>**<code>目标</code>**： 将静态路由和动态路由的路由表进行临时合并</p>
<blockquote>
<p>什么叫临时合并？</p>
</blockquote>
<p>在第一个小节中，我们讲过了，动态路由是需要权限进行访问的，但是权限的动态路由访问是很复杂的，我们稍后在进行讲解，所以为了更好地看到效果，我们可以先将 静态路由和动态路由进行合并</p>
<p><strong>路由主文件</strong>  <strong><code>src/router/index.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入多个模块的规则</span></span><br><span class="line"><span class="keyword">import</span> approvalsRouter <span class="keyword">from</span> <span class="string">'./modules/approvals'</span></span><br><span class="line"><span class="keyword">import</span> departmentsRouter <span class="keyword">from</span> <span class="string">'./modules/departments'</span></span><br><span class="line"><span class="keyword">import</span> employeesRouter <span class="keyword">from</span> <span class="string">'./modules/employees'</span></span><br><span class="line"><span class="keyword">import</span> permissionRouter <span class="keyword">from</span> <span class="string">'./modules/permission'</span></span><br><span class="line"><span class="keyword">import</span> attendancesRouter <span class="keyword">from</span> <span class="string">'./modules/attendances'</span></span><br><span class="line"><span class="keyword">import</span> salarysRouter <span class="keyword">from</span> <span class="string">'./modules/salarys'</span></span><br><span class="line"><span class="keyword">import</span> settingRouter <span class="keyword">from</span> <span class="string">'./modules/setting'</span></span><br><span class="line"><span class="keyword">import</span> socialRouter <span class="keyword">from</span> <span class="string">'./modules/social'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> asyncRoutes = [</span><br><span class="line">  approvalsRouter,</span><br><span class="line">  departmentsRouter,</span><br><span class="line">  employeesRouter,</span><br><span class="line">  permissionRouter,</span><br><span class="line">  attendancesRouter,</span><br><span class="line">  salarysRouter,</span><br><span class="line">  settingRouter,</span><br><span class="line">  socialRouter</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> createRouter = <span class="function">() =&gt;</span> <span class="keyword">new</span> Router({</span><br><span class="line">  <span class="comment">// mode: 'history', // require service support</span></span><br><span class="line">  <span class="attr">scrollBehavior</span>: <span class="function">() =&gt;</span> ({ <span class="attr">y</span>: <span class="number">0</span> }), <span class="comment">// 管理滚动行为 如果出现滚动 切换就让 让页面回到顶部</span></span><br><span class="line">  <span class="attr">routes</span>: [...constantRoutes, ...asyncRoutes] <span class="comment">// 临时合并所有的路由</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>通过上面的操作，我们将静态路由和动态路由进行了合并</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200827170403463.png" alt="image-20200827170403463"></p>
<p>当我们合并权限完成，我们惊奇的发现页面效果已经左侧的导航菜单 =》 路由页面</p>
<p>这是之前基础模板中对于左侧导航菜单的封装</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200720003233026.png" alt="image-20200720003233026"></p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**： 将静态路由和动态路由临时合并，形成左侧菜单 </p>
<h2 id="左侧菜单的显示逻辑，设置菜单图标"><a href="#左侧菜单的显示逻辑，设置菜单图标" class="headerlink" title="左侧菜单的显示逻辑，设置菜单图标"></a>左侧菜单的显示逻辑，设置菜单图标</h2><p><strong><code>目标</code></strong>  解析左侧菜单的显示逻辑，  设置左侧导航菜单的图标内容</p>
<blockquote>
<p>上小节中，我们集成了路由，菜单就显示内容了，这是为什么 ？</p>
</blockquote>
<p><strong>阅读左侧菜单代码</strong></p>
<blockquote>
<p>我们发现如图的逻辑</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200828103109646.png" alt="image-20200828103109646"></p>
<p>由于，该项目不需要二级菜单的显示，所以对代码进行一下处理，只保留一级菜单路由</p>
<p><strong><code>src/layout/components/Sidebar/SidebarItem.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div v-if="!item.hidden"&gt;</span><br><span class="line">    &lt;template v-if="hasOneShowingChild(item.children,item) &amp;&amp; (!onlyOneChild.children||onlyOneChild.noShowingChildren)&amp;&amp;!item.alwaysShow"&gt;</span><br><span class="line">      &lt;app-link v-if="onlyOneChild.meta" :to="resolvePath(onlyOneChild.path)"&gt;</span><br><span class="line">        &lt;el-menu-item :index="resolvePath(onlyOneChild.path)" :class="{'submenu-title-noDropdown':!isNest}"&gt;</span><br><span class="line">          &lt;item :icon="onlyOneChild.meta.icon||(item.meta&amp;&amp;item.meta.icon)" :title="onlyOneChild.meta.title" /&gt;</span><br><span class="line">        &lt;/el-menu-item&gt;</span><br><span class="line">      &lt;/app-link&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- &lt;el-submenu v-else ref="subMenu" :index="resolvePath(item.path)" popper-append-to-body&gt;</span><br><span class="line">      &lt;template slot="title"&gt;</span><br><span class="line">        &lt;item v-if="item.meta" :icon="item.meta &amp;&amp; item.meta.icon" :title="item.meta.title" /&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">      &lt;sidebar-item</span><br><span class="line">        v-for="child in item.children"</span><br><span class="line">        :key="child.path"</span><br><span class="line">        :is-nest="true"</span><br><span class="line">        :item="child"</span><br><span class="line">        :base-path="resolvePath(child.path)"</span><br><span class="line">        class="nest-menu"</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/el-submenu&gt; --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>**<code>本节注意</code><strong>：通过代码发现，当路由中的属性</strong><code>hidden</code>**为true时，表示该路由不显示在左侧菜单中</p>
<blockquote>
<p>与此同时，我们发现左侧菜单并不协调，是因为缺少图标。在本项目中，我们的图标采用了SVG的组件</p>
</blockquote>
<p>左侧菜单的图标实际上读取的是meta属性的icon，这个icon需要我们提前放置在**<code>src/icons/svg</code>**目录下</p>
<blockquote>
<p>该资源已经在菜单svg目录中提供，请将该目录下的所有svg放到**<code>src/icons/svg</code>**目录下</p>
</blockquote>
<p> 具体的icon名称可参考<a target="_blank" rel="noopener" href="https://panjiachen.github.io/vue-element-admin/#/icon/index">线上地址</a></p>
<p>functional为true，表示该组件为一个函数式组件</p>
<p>函数式组件： 没有data状态，没有响应式数据，只会接收props属性， 没有this， 他就是一个函数</p>
<p><strong>模块对应icon</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├── dashboard           <span class="comment"># dashboard</span></span><br><span class="line">├── departments         <span class="comment"># tree</span></span><br><span class="line">├── employees           <span class="comment"># people</span></span><br><span class="line">├── setting             <span class="comment"># setting</span></span><br><span class="line">├── salarys             <span class="comment"># money</span></span><br><span class="line">├── social              <span class="comment"># table</span></span><br><span class="line">├── attendances         <span class="comment"># skill</span></span><br><span class="line">├── approvals           <span class="comment"># tree-table</span></span><br><span class="line">├── permission          <span class="comment"># lock</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200720010016813.png" alt="image-20200720010016813"></p>
<p>按照对应的icon设置图标</p>
<p><strong><code>本节任务：</code></strong> 理解左侧菜单的生成逻辑，并设置左侧菜单的图标</p>
<h1 id="5-组织结构"><a href="#5-组织结构" class="headerlink" title="5.组织结构"></a>5.组织结构</h1><h2 id="组织架构树形结构布局"><a href="#组织架构树形结构布局" class="headerlink" title="组织架构树形结构布局"></a>组织架构树形结构布局</h2><p>**<code>目标</code>**：使用element-UI组件布局组织架构的基本布局</p>
<h3 id="认识组织架构"><a href="#认识组织架构" class="headerlink" title="认识组织架构"></a>认识组织架构</h3><p><a href="%5Bhttp://czpm.itcast.cn/ihrm/#g=1&amp;p=%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%5D(http://czpm.itcast.cn/ihrm/#g=1&amp;p=%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84)">组织架构产品prd</a></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200828105046683.png" alt="image-20200828105046683"></p>
<blockquote>
<p>一个企业的组织架构是该企业的灵魂，组织架构多常采用树形金字塔式结构，本章节，我们布局出页面的基本结构</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200720010954202.png" alt="image-20200720010954202"> </p>
<h3 id="实现组织架构的头部内容"><a href="#实现组织架构的头部内容" class="headerlink" title="实现组织架构的头部内容"></a>实现组织架构的头部内容</h3><p>首先实现头部的结构，采用element的<strong>行列布局</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-card class="tree-card"&gt;</span><br><span class="line">     &lt;!-- 用了一个行列布局 --&gt;</span><br><span class="line">     &lt;el-row type="flex" justify="space-between" align="middle" style="height: 40px"&gt;</span><br><span class="line">       &lt;el-col&gt;</span><br><span class="line">         &lt;span&gt;江苏传智播客教育科技股份有限公司&lt;/span&gt;</span><br><span class="line">       &lt;/el-col&gt;</span><br><span class="line">       &lt;el-col :span="4"&gt;</span><br><span class="line">         &lt;el-row type="flex" justify="end"&gt;</span><br><span class="line">           &lt;!-- 两个内容 --&gt;</span><br><span class="line">           &lt;el-col&gt;负责人&lt;/el-col&gt;</span><br><span class="line">           &lt;el-col&gt;</span><br><span class="line">             &lt;!-- 下拉菜单 element --&gt;</span><br><span class="line">             &lt;el-dropdown&gt;</span><br><span class="line">               &lt;span&gt;</span><br><span class="line">                 操作&lt;i class="el-icon-arrow-down" /&gt;</span><br><span class="line">               &lt;/span&gt;</span><br><span class="line">               &lt;!-- 下拉菜单 --&gt;</span><br><span class="line">               &lt;el-dropdown-menu slot="dropdown"&gt;</span><br><span class="line">                 &lt;el-dropdown-item&gt;添加子部门&lt;/el-dropdown-item&gt;</span><br><span class="line">               &lt;/el-dropdown-menu&gt;</span><br><span class="line">             &lt;/el-dropdown&gt;</span><br><span class="line">           &lt;/el-col&gt;</span><br><span class="line">         &lt;/el-row&gt;</span><br><span class="line">       &lt;/el-col&gt;</span><br><span class="line">     &lt;/el-row&gt;</span><br><span class="line">   &lt;/el-card&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>样式</strong></p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line"><span class="selector-class">.tree-card</span> {</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">30px</span>  <span class="number">140px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">14px</span>;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200720180221662.png" alt="image-20200720180221662"></p>
<h3 id="树形组件认识"><a href="#树形组件认识" class="headerlink" title="树形组件认识"></a>树形组件认识</h3><p>接下来，实现树形的结构，采用element的**<a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/tree">tree组件</a>**， 如图效果</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200828105634138.png" alt="image-20200828105634138"></p>
<blockquote>
<p>树形组件属性</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
<th align="left">类型</th>
<th align="left">可选值</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">default-expand-all</td>
<td align="left">是否默认展开所有节点</td>
<td align="left">boolean</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">data</td>
<td align="left">展示数据</td>
<td align="left">array</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">node-key</td>
<td align="left">每个树节点用来作为唯一标识的属性，整棵树应该是唯一的</td>
<td align="left">String</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">props</td>
<td align="left">配置选项，具体看下表</td>
<td align="left">object</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
</tbody></table>
<p><strong>props属性</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
<th align="left">类型</th>
<th align="left">可选值</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">label</td>
<td align="left">指定节点标签为节点对象的某个属性值</td>
<td align="left">string, function(data, node)</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">children</td>
<td align="left">指定子树为节点对象的某个属性值</td>
<td align="left">string</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">disabled</td>
<td align="left">指定节点选择框是否禁用为节点对象的某个属性值</td>
<td align="left">boolean, function(data, node)</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">isLeaf</td>
<td align="left">指定节点是否为叶子节点，仅在指定了 lazy 属性的情况下生效</td>
<td align="left">boolean, function(data, node)</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
</tbody></table>
<p><strong>data</strong>是组成树形数据的关键，如下的数据便能构建树形数据</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[{</span><br><span class="line">         label: '一级 <span class="number">1</span>',</span><br><span class="line">         children: [{</span><br><span class="line">           label: '二级 <span class="number">1</span><span class="number">-1</span>',</span><br><span class="line">           children: [{</span><br><span class="line">             label: '三级 <span class="number">1</span><span class="number">-1</span><span class="number">-1</span>'</span><br><span class="line">           }]</span><br><span class="line">         }]</span><br><span class="line">       }, {</span><br><span class="line">         label: '一级 <span class="number">2</span>',</span><br><span class="line">         children: [{</span><br><span class="line">           label: '二级 <span class="number">2</span><span class="number">-1</span>',</span><br><span class="line">           children: [{</span><br><span class="line">             label: '三级 <span class="number">2</span><span class="number">-1</span><span class="number">-1</span>'</span><br><span class="line">           }]</span><br><span class="line">         }, {</span><br><span class="line">           label: '二级 <span class="number">2</span><span class="number">-2</span>',</span><br><span class="line">           children: [{</span><br><span class="line">             label: '三级 <span class="number">2</span><span class="number">-2</span><span class="number">-1</span>'</span><br><span class="line">           }]</span><br><span class="line">         }]</span><br><span class="line">       }, {</span><br><span class="line">         label: '一级 <span class="number">3</span>',</span><br><span class="line">         children: [{</span><br><span class="line">           label: '二级 <span class="number">3</span><span class="number">-1</span>',</span><br><span class="line">           children: [{</span><br><span class="line">             label: '三级 <span class="number">3</span><span class="number">-1</span><span class="number">-1</span>'</span><br><span class="line">           }]</span><br><span class="line">         }, {</span><br><span class="line">           label: '二级 <span class="number">3</span><span class="number">-2</span>',</span><br><span class="line">           children: [{</span><br><span class="line">             label: '三级 <span class="number">3</span><span class="number">-2</span><span class="number">-1</span>'</span><br><span class="line">           }]</span><br><span class="line">         }]</span><br><span class="line">       }]</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200720232914114.png" alt="image-20200720232914114"></p>
<h3 id="实现树形的静态组织架构"><a href="#实现树形的静态组织架构" class="headerlink" title="实现树形的静态组织架构"></a>实现树形的静态组织架构</h3><p>由此，我们首先实现静态数据的组织架构</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!--放置一个属性   这里的props和我们之前学习的父传子 的props没关系--&gt;</span><br><span class="line"> &lt;el-tree :data="departs" :props="defaultProps" /&gt;</span><br><span class="line">export default {</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      defaultProps: {</span><br><span class="line">        label: 'name'</span><br><span class="line">      },</span><br><span class="line">      departs: [{ name: '总裁办', children: [{ name: '董事会' }] },</span><br><span class="line">        { name: '行政部' }, { name: '人事部' }]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>接下来，对每个层级节点增加显示内容，此时需要用到tree的插槽</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"> &lt;el-tree :data="departs" :props="defaultProps" :default-expand-all="true"&gt;</span><br><span class="line">          &lt;!-- 传入内容 插槽内容 会循环多次 有多少节点 就循环多少次 --&gt;</span><br><span class="line">          &lt;!-- 作用域插槽 slot-scope="obj" 接收传递给插槽的数据   data 每个节点的数据对象--&gt;</span><br><span class="line">          &lt;el-row slot-scope="{ data }" type="flex" justify="space-between" align="middle" style="height: 40px; width: 100%"&gt;</span><br><span class="line">            &lt;el-col&gt;</span><br><span class="line">              &lt;!-- 左侧内容 --&gt;</span><br><span class="line">              &lt;span&gt;{{ data.name }}&lt;/span&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">            &lt;el-col :span="4"&gt;</span><br><span class="line">              &lt;el-row type="flex" justify="end"&gt;</span><br><span class="line">                &lt;el-col&gt;{{ data.manager }}&lt;/el-col&gt;</span><br><span class="line">                &lt;el-col&gt;</span><br><span class="line">                  &lt;!-- 放置下拉菜单 --&gt;</span><br><span class="line">                  &lt;el-dropdown&gt;</span><br><span class="line">                    &lt;!-- 内容 --&gt;</span><br><span class="line">                    &lt;span&gt;操作</span><br><span class="line">                      &lt;i class="el-icon-arrow-down" /&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                    &lt;!-- 具名插槽 --&gt;</span><br><span class="line">                    &lt;el-dropdown-menu slot="dropdown"&gt;</span><br><span class="line">                      &lt;!-- 下拉选项 --&gt;</span><br><span class="line">                      &lt;el-dropdown-item&gt;添加子部门&lt;/el-dropdown-item&gt;</span><br><span class="line">                      &lt;el-dropdown-item&gt;编辑部门&lt;/el-dropdown-item&gt;</span><br><span class="line">                      &lt;el-dropdown-item&gt;删除部门&lt;/el-dropdown-item&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;/el-dropdown-menu&gt;</span><br><span class="line">                  &lt;/el-dropdown&gt;</span><br><span class="line">                &lt;/el-col&gt;</span><br><span class="line">              &lt;/el-row&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 右侧内容 --&gt;</span><br><span class="line">            &lt;/el-col&gt;</span><br><span class="line">          &lt;/el-row&gt;        &lt;/el-tree&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      departs: [{ name: '总裁办', manager: '曹操', children: [{ name: '董事会', manager: '曹丕' }] },</span><br><span class="line">        { name: '行政部', manager: '刘备' },</span><br><span class="line">        { name: '人事部', manager: '孙权' }],</span><br><span class="line">      defaultProps: {</span><br><span class="line">        label: 'name' // 表示 从这个属性显示内容</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>最终形成静态结构效果</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200912150032528.png" alt="image-20200912150032528"></p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：完成树形结构的显示</p>
<h2 id="将树形的操作内容单独抽提成组件"><a href="#将树形的操作内容单独抽提成组件" class="headerlink" title="将树形的操作内容单独抽提成组件"></a>将树形的操作内容单独抽提成组件</h2><p>**<code>目标</code>**： 将树形的操作内容单独抽提成组件</p>
<h3 id="封装单独的树操作栏组件"><a href="#封装单独的树操作栏组件" class="headerlink" title="封装单独的树操作栏组件"></a>封装单独的树操作栏组件</h3><blockquote>
<p>通过第一个章节，我们发现，树形的顶级内容实际和子节点的内容是一致的，此时可以将该部分抽提成一个组件，节省代码</p>
</blockquote>
<p>组件 <strong><code>src/views/departments/components/tree-tools.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-row type="flex" justify="space-between" align="middle" style="height: 40px;width: 100%"&gt;</span><br><span class="line">    &lt;el-col&gt;</span><br><span class="line">      &lt;!-- 名称应该变成 对应的节点中的name --&gt;</span><br><span class="line">      &lt;span&gt;{{ treeNode.name }}&lt;/span&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">    &lt;el-col :span="4"&gt;</span><br><span class="line">      &lt;el-row type="flex" justify="end"&gt;</span><br><span class="line">        &lt;!-- 两个内容 --&gt;</span><br><span class="line">        &lt;el-col&gt;{{ treeNode.manager }}&lt;/el-col&gt;</span><br><span class="line">        &lt;el-col&gt;</span><br><span class="line">          &lt;!-- 下拉菜单 element --&gt;</span><br><span class="line">          &lt;el-dropdown&gt;</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">              操作&lt;i class="el-icon-arrow-down" /&gt;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">            &lt;!-- 下拉菜单 --&gt;</span><br><span class="line">            &lt;el-dropdown-menu slot="dropdown"&gt;</span><br><span class="line">              &lt;el-dropdown-item&gt;添加子部门&lt;/el-dropdown-item&gt;</span><br><span class="line">              &lt;el-dropdown-item&gt;编辑部门&lt;/el-dropdown-item&gt;</span><br><span class="line">              &lt;el-dropdown-item&gt;删除部门&lt;/el-dropdown-item&gt;</span><br><span class="line">            &lt;/el-dropdown-menu&gt;</span><br><span class="line">          &lt;/el-dropdown&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 该组件需要对外开放属性 外部需要提供一个对象 对象里需要有name  manager</span><br><span class="line">export default {</span><br><span class="line">  // props可以用数组来接收数据 也可以用对象来接收</span><br><span class="line">  // props: {   props属性: {  配置选项 }  }</span><br><span class="line">  props: {</span><br><span class="line">    //   定义一个props属性</span><br><span class="line">    treeNode: {</span><br><span class="line">      type: Object, // 对象类型</span><br><span class="line">      required: true // 要求对方使用您的组件的时候 必须传treeNode属性 如果不传 就会报错</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="在组织架构中应用操作栏组件"><a href="#在组织架构中应用操作栏组件" class="headerlink" title="在组织架构中应用操作栏组件"></a>在组织架构中应用操作栏组件</h3><p>接下来，在**<code>src/views/departments/index.vue</code>**进行代码的简化</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="dashboard-container"&gt;</span><br><span class="line">    &lt;div class="app-container"&gt;</span><br><span class="line">      &lt;!-- 实现页面的基本布局 --&gt;</span><br><span class="line">      &lt;el-card class="tree-card"&gt;</span><br><span class="line">        &lt;!-- 用了一个行列布局 --&gt;</span><br><span class="line">        &lt;!-- 缺少treeNode --&gt;</span><br><span class="line">        &lt;tree-tools :tree-node="company" /&gt;</span><br><span class="line">        &lt;!--放置一个属性   这里的props和我们之前学习的父传子 的props没关系--&gt;</span><br><span class="line">        &lt;el-tree :data="departs" :props="defaultProps" default-expand-all&gt;</span><br><span class="line">          &lt;!-- 说明el-tree里面的这个内容 就是插槽内容 =&gt; 填坑内容  =&gt; 有多少个节点循环多少次 --&gt;</span><br><span class="line">          &lt;!-- scope-scope 是 tree组件传给每个节点的插槽的内容的数据 --&gt;</span><br><span class="line">          &lt;!-- 顺序一定是 执行slot-scope的赋值 才去执行 props的传值 --&gt;</span><br><span class="line">          &lt;tree-tools slot-scope="{ data }" :tree-node="data" /&gt;</span><br><span class="line">        &lt;/el-tree&gt;</span><br><span class="line">      &lt;/el-card&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>上面代码中，company变量需要在data中定义</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">company: { <span class="attr">name</span>: <span class="string">'江苏传智播客教育科技股份有限公司'</span>, <span class="attr">manager</span>: <span class="string">'负责人'</span> },</span><br></pre></td></tr></tbody></table></figure>

<p>同时，由于在两个位置都使用了该组件，但是放置在最上层的组件是不需要显示 **<code>删除部门</code><strong>和</strong><code>编辑部门</code>**的</p>
<p>所以，增加一个新的属性 **<code>isRoot（是否根节点）</code>**进行控制</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">props: {</span><br><span class="line">   <span class="attr">treeNode</span>: {</span><br><span class="line">     <span class="attr">required</span>: <span class="literal">true</span>, <span class="comment">// 设置当前数据为必填</span></span><br><span class="line">     <span class="attr">type</span>: <span class="built_in">Object</span> <span class="comment">// 类型是Object</span></span><br><span class="line">   },</span><br><span class="line">   <span class="attr">isRoot</span>: {</span><br><span class="line">     <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">     <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">   }</span><br><span class="line"> }</span><br><span class="line">&lt;tree-tools :tree-node=<span class="string">"company"</span> :is-root=<span class="string">"true"</span> /&gt;</span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure>

<p>组件中， 根据isRoot判断显示</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 编辑部门和删除部门只会在子节点上显示 --&gt;</span><br><span class="line">     &lt;el-dropdown-item v-if="!isRoot"&gt;编辑部门&lt;/el-dropdown-item&gt;</span><br><span class="line">    &lt;el-dropdown-item v-if="!isRoot"&gt;删除部门&lt;/el-dropdown-item&gt;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>通过封装，代码看上去更加紧凑，简洁，这就是封装的魅力</p>
</blockquote>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：将树形内容单独抽提组件</p>
<h2 id="获取组织架构数据，并进行树形处理"><a href="#获取组织架构数据，并进行树形处理" class="headerlink" title="获取组织架构数据，并进行树形处理"></a>获取组织架构数据，并进行树形处理</h2><p>**<code>目标</code>**获取真实的组织架构数据，并将其转化成树形数据显示在页面上</p>
<h3 id="封装API接口，获取组织架构数据"><a href="#封装API接口，获取组织架构数据" class="headerlink" title="封装API接口，获取组织架构数据"></a>封装API接口，获取组织架构数据</h3><blockquote>
<p>现在基本的静态结构已经形成，接下来需要获取真实的数据</p>
</blockquote>
<p>首先，<strong>封装获取组织架构的请求</strong> <strong><code>src/api/departments.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 获取组织架构数据</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getDepartments</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/company/department'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>在钩子函数中调用接口</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> TreeTools <span class="keyword">from</span> <span class="string">'./components/tree-tools'</span></span><br><span class="line"><span class="keyword">import</span> { getDepartments } <span class="keyword">from</span> <span class="string">'@/api/departments'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">components</span>: {</span><br><span class="line">    TreeTools</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">company</span>: { }, <span class="comment">// 就是头部的数据结构</span></span><br><span class="line">      <span class="attr">departs</span>: [],</span><br><span class="line">      <span class="attr">defaultProps</span>: {</span><br><span class="line">        <span class="attr">label</span>: <span class="string">'name'</span> <span class="comment">// 表示 从这个属性显示内容</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="built_in">this</span>.getDepartments() <span class="comment">// 调用自身的方法</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getDepartments</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> getDepartments()</span><br><span class="line">      <span class="built_in">this</span>.company = { <span class="attr">name</span>: result.companyName, <span class="attr">manager</span>: <span class="string">'负责人'</span> }</span><br><span class="line">      <span class="built_in">this</span>.departs = result.depts <span class="comment">// 需要将其转化成树形结构</span></span><br><span class="line">      <span class="built_in">console</span>.log(result)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="将数组数据转化成树形结构"><a href="#将数组数据转化成树形结构" class="headerlink" title="将数组数据转化成树形结构"></a>将数组数据转化成树形结构</h3><p>然后，我们需要将列表型的数据，转化成树形数据，这里需要用到<strong>递归算法</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200721010931214.png" alt="image-20200721010931214"></p>
<p>封装一个工具方法，**<code>src/utils/index.js</code>**</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  将列表型的数据转化成树形数据 =&gt; 递归算法 =&gt; 自身调用自身 =&gt; 一定条件不能一样， 否则就会死循环</span></span><br><span class="line"><span class="comment"> *  遍历树形 有一个重点 要先找一个头儿</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">tranListToTreeData</span>(<span class="params">list, rootValue</span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> arr = []</span><br><span class="line">  list.forEach(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">    <span class="keyword">if</span> (item.pid === rootValue) {</span><br><span class="line">      <span class="comment">// 找到之后 就要去找 item 下面有没有子节点</span></span><br><span class="line">      <span class="keyword">const</span> children = tranListToTreeData(list, item.id)</span><br><span class="line">      <span class="keyword">if</span> (children.length) {</span><br><span class="line">        <span class="comment">// 如果children的长度大于0 说明找到了子节点</span></span><br><span class="line">        item.children = children</span><br><span class="line">      }</span><br><span class="line">      arr.push(item) <span class="comment">// 将内容加入到数组中</span></span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">  <span class="keyword">return</span> arr</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>调用转化方法，转化树形结构</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.company = { <span class="attr">name</span>: result.companyName, <span class="attr">manager</span>: <span class="string">'负责人'</span> } <span class="comment">// 这里定义一个空串  因为 它是根 所有的子节点的数据pid 都是 ""</span></span><br><span class="line"> <span class="built_in">this</span>.departs = transListToTreeData(result.depts, <span class="string">''</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>这样一来，树形数据就有了，下一章节，就可以针对部门进行操作</p>
<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 获取组织架构数据，并进行树形处理</p>
<h2 id="删除部门功能实现"><a href="#删除部门功能实现" class="headerlink" title="删除部门功能实现"></a>删除部门功能实现</h2><p>**<code>目标</code>**实现操作功能的删除功能</p>
<h3 id="封装删除接口，注册下拉菜单事件"><a href="#封装删除接口，注册下拉菜单事件" class="headerlink" title="封装删除接口，注册下拉菜单事件"></a>封装删除接口，注册下拉菜单事件</h3><p>首先，封装删除功能模块 <strong><code>src/api/departments.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> *  根据id根据部门  接口是根据restful的规则设计的   删除 delete  新增 post  修改put 获取 get</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">delDepartments</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/company/department/<span class="subst">${id}</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'delete'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>然后，在tree-tools组件中，监听下拉菜单的点击事件  <strong><code>src/views/departments/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dropdown @command="operateDepts"&gt;</span><br><span class="line">  &lt;span&gt;</span><br><span class="line">    操作&lt;i class="el-icon-arrow-down" /&gt;</span><br><span class="line">  &lt;/span&gt;</span><br><span class="line">  &lt;!-- 下拉菜单 --&gt;</span><br><span class="line">  &lt;el-dropdown-menu slot="dropdown"&gt;</span><br><span class="line">    &lt;el-dropdown-item command="add"&gt;添加子部门&lt;/el-dropdown-item&gt;</span><br><span class="line">    &lt;!-- 编辑部门和删除部门只会在子节点上显示 --&gt;</span><br><span class="line">    &lt;el-dropdown-item v-if="!isRoot" command="edit"&gt;编辑部门&lt;/el-dropdown-item&gt;</span><br><span class="line">    &lt;el-dropdown-item v-if="!isRoot" command="del"&gt;删除部门&lt;/el-dropdown-item&gt;</span><br><span class="line">  &lt;/el-dropdown-menu&gt;</span><br><span class="line">&lt;/el-dropdown&gt;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>dropdown下拉菜单的监听事件command</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 操作节点调用的方法</span></span><br><span class="line"><span class="function"><span class="title">operateDepts</span>(<span class="params">type</span>)</span> {</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'add'</span>) {</span><br><span class="line">    <span class="comment">// 添加子部门的操作</span></span><br><span class="line">  } <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'edit'</span>) {</span><br><span class="line">    <span class="comment">//  编辑部门的操作</span></span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">//  删除操作</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="调用删除接口，通知父组件更新数据"><a href="#调用删除接口，通知父组件更新数据" class="headerlink" title="调用删除接口，通知父组件更新数据"></a>调用删除接口，通知父组件更新数据</h3><blockquote>
<p>删除之前，提示用户是否删除，然后调用删除接口</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 操作节点调用的方法</span></span><br><span class="line"><span class="function"><span class="title">operateDepts</span>(<span class="params">type</span>)</span> {</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'add'</span>) {</span><br><span class="line">    <span class="comment">// 添加子部门的操作</span></span><br><span class="line">  } <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'edit'</span>) {</span><br><span class="line">    <span class="comment">//  编辑部门的操作</span></span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">//  删除操作</span></span><br><span class="line">    <span class="built_in">this</span>.$confirm(<span class="string">'确定要删除该部门吗'</span>).then(<span class="function">() =&gt;</span> {</span><br><span class="line">      <span class="comment">// 如果点击了确定就会进入then</span></span><br><span class="line">      <span class="keyword">return</span> delDepartments(<span class="built_in">this</span>.treeNode.id) <span class="comment">// 返回promise对象</span></span><br><span class="line">    }).then(<span class="function">() =&gt;</span> {</span><br><span class="line">      <span class="comment">//  如果删除成功了  就会进入这里</span></span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>上面代码中，我们已经成功删除了员工数据，但是怎么通知父组件进行更新呢</p>
</blockquote>
<p>在前面的课程中，我们已经学习过可以通过自定义事件**<code>this.$emit</code>**的方式来进行</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  如果删除成功了  就会进入这里</span></span><br><span class="line">        <span class="built_in">this</span>.$emit(<span class="string">'delDepts'</span>) <span class="comment">// 触发自定义事件</span></span><br><span class="line">        <span class="built_in">this</span>.$message.success(<span class="string">'删除部门成功'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>父组件监听事件 <strong><code>src/views/department/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;tree-tools slot-scope="obj" :tree-node="obj.data" @delDepts="getDepartments" /&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：删除部门功能实现</p>
<h2 id="新增部门功能-建立组件"><a href="#新增部门功能-建立组件" class="headerlink" title="新增部门功能-建立组件"></a>新增部门功能-建立组件</h2><p>**<code>目标</code>**：实现新增部门功能的组件建立</p>
<h3 id="封装新增接口，新建组件中的弹层结构"><a href="#封装新增接口，新建组件中的弹层结构" class="headerlink" title="封装新增接口，新建组件中的弹层结构"></a>封装新增接口，新建组件中的弹层结构</h3><p>首先， 封装新增部门的api模块  <strong><code>src/api/departments.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  新增部门接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ****/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addDepartments</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/company/department'</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'post'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>然后，我们需要构建一个新增部门的窗体组件 <strong><code>src/views/department/components/add-dept.vue</code></strong></p>
<p>其中的交互设计如下</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200828162901390.png" alt="image-20200828162901390"></p>
<p><a href="%5Bhttp://czpm.itcast.cn/ihrm/#g=1&amp;p=%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%5D(http://czpm.itcast.cn/ihrm/#g=1&amp;p=%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84)">设计要求</a></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 新增部门的弹层 --&gt;</span><br><span class="line">  &lt;el-dialog title="新增部门"&gt;</span><br><span class="line">    &lt;!-- 表单组件  el-form   label-width设置label的宽度   --&gt;</span><br><span class="line">    &lt;!-- 匿名插槽 --&gt;</span><br><span class="line">    &lt;el-form label-width="120px"&gt;</span><br><span class="line">      &lt;el-form-item label="部门名称"&gt;</span><br><span class="line">        &lt;el-input style="width:80%" placeholder="1-50个字符" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="部门编码"&gt;</span><br><span class="line">        &lt;el-input style="width:80%" placeholder="1-50个字符" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="部门负责人"&gt;</span><br><span class="line">        &lt;el-select style="width:80%" placeholder="请选择" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="部门介绍"&gt;</span><br><span class="line">        &lt;el-input style="width:80%" placeholder="1-300个字符" type="textarea" :rows="3" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;!-- el-dialog有专门放置底部操作栏的 插槽  具名插槽 --&gt;</span><br><span class="line">    &lt;el-row slot="footer" type="flex" justify="center"&gt;</span><br><span class="line">      &lt;!-- 列被分为24 --&gt;</span><br><span class="line">      &lt;el-col :span="6"&gt;</span><br><span class="line">        &lt;el-button type="primary" size="small"&gt;确定&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button size="small"&gt;取消&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="点击新增子部门显示弹层组件"><a href="#点击新增子部门显示弹层组件" class="headerlink" title="点击新增子部门显示弹层组件"></a>点击新增子部门显示弹层组件</h3><p>然后，我们需要用属性控制组件的显示或者隐藏</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要传入一个props变量来控制 显示或者隐藏</span></span><br><span class="line"><span class="attr">props</span>: {</span><br><span class="line">  <span class="attr">showDialog</span>: {</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog title="新增部门" :visible="showDialog"&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>在**<code>departments/index.vue</code>** 中引入该组件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AddDept <span class="keyword">from</span> <span class="string">'./components/add-dept'</span> <span class="comment">// 引入新增部门组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">components</span>: { AddDept }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>定义控制窗体显示的变量**<code>showDialog</code>**</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">   <span class="keyword">return</span> {</span><br><span class="line">     <span class="attr">showDialog</span>: <span class="literal">false</span> <span class="comment">// 显示窗体</span></span><br><span class="line">   }</span><br><span class="line"> },</span><br><span class="line">   &lt;!-- 放置新增弹层组件  --&gt;</span><br><span class="line">   <span class="xml"><span class="tag">&lt;<span class="name">add-dept</span> <span class="attr">:show-dialog</span>=<span class="string">"showDialog"</span> /&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>当点击新增部门时，弹出组件</p>
<blockquote>
<p> 注意，点击新增时tree-tools组件，所以这里，我们依然需要子组件调用父组件</p>
</blockquote>
<p><strong>子组件触发新增事件</strong>· <strong><code>src/views/departments/tree-tools.vue</code></strong> </p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (type === <span class="string">'add'</span>) {</span><br><span class="line">      <span class="comment">// 添加子部门的操作</span></span><br><span class="line">      <span class="comment">// 告诉父组件 显示弹层</span></span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">'addDepts'</span>, <span class="built_in">this</span>.treeNode) <span class="comment">// 为何传出treeNode 因为是添加子部门 需要当前部门的数据</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>父组件监听事件</strong>   </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;tree-tools slot-scope="obj" :tree-node="obj.data" @delDepts="getDepartments" @addDepts="addDepts"  /&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>方法中弹出层,记录在哪个节点下添加子部门</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">addDepts</span>(<span class="params">node</span>)</span> {</span><br><span class="line">     <span class="built_in">this</span>.showDialog = <span class="literal">true</span> <span class="comment">// 显示弹层</span></span><br><span class="line">     <span class="comment">// 因为node是当前的点击的部门， 此时这个部门应该记录下来,</span></span><br><span class="line">     <span class="built_in">this</span>.node = node</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200722084707863.png" alt="image-20200722084707863"></p>
<p>**<code>本节任务</code>**：新增部门功能-建立组件</p>
<h2 id="完成新增部门的规则校验"><a href="#完成新增部门的规则校验" class="headerlink" title="完成新增部门的规则校验"></a>完成新增部门的规则校验</h2><p><strong><code>目标</code></strong> 完成新增部门功能的规则校验和数据提交部分</p>
<h3 id="完成新增表单的基本校验条件"><a href="#完成新增表单的基本校验条件" class="headerlink" title="完成新增表单的基本校验条件"></a>完成新增表单的基本校验条件</h3><p>部门名称（name）：必填 1-50个字符  / 同级部门中禁止出现重复部门</p>
<p>部门编码（code）：必填 1-50个字符  / 部门编码在整个模块中都不允许重复</p>
<p>部门负责人（manager）：必填</p>
<p>部门介绍 ( introduce)：必填 1-300个字符</p>
<blockquote>
<p>定义数据结构</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">formData: {</span><br><span class="line">      <span class="attr">name</span>: <span class="string">''</span>, <span class="comment">// 部门名称</span></span><br><span class="line">      <span class="attr">code</span>: <span class="string">''</span>, <span class="comment">// 部门编码</span></span><br><span class="line">      <span class="attr">manager</span>: <span class="string">''</span>, <span class="comment">// 部门管理者</span></span><br><span class="line">      <span class="attr">introduce</span>: <span class="string">''</span> <span class="comment">// 部门介绍</span></span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>完成表单校验需要的前置条件</p>
</blockquote>
<ul>
<li>el-form配置model和rules属性</li>
<li>el-form-item配置prop属性</li>
<li>表单进行v-model双向绑定</li>
</ul>
<h3 id="配置新增表单的基本校验规则"><a href="#配置新增表单的基本校验规则" class="headerlink" title="配置新增表单的基本校验规则"></a>配置新增表单的基本校验规则</h3><blockquote>
<p>根据这些要求，校验规则</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="comment">// 定义表单数据</span></span><br><span class="line">    <span class="attr">formData</span>: {</span><br><span class="line">      <span class="attr">name</span>: <span class="string">''</span>, <span class="comment">// 部门名称</span></span><br><span class="line">      <span class="attr">code</span>: <span class="string">''</span>, <span class="comment">// 部门编码</span></span><br><span class="line">      <span class="attr">manager</span>: <span class="string">''</span>, <span class="comment">// 部门管理者</span></span><br><span class="line">      <span class="attr">introduce</span>: <span class="string">''</span> <span class="comment">// 部门介绍</span></span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 定义校验规则</span></span><br><span class="line">    <span class="attr">rules</span>: {</span><br><span class="line">      <span class="attr">name</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'部门名称不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> },</span><br><span class="line">        { <span class="attr">min</span>: <span class="number">1</span>, <span class="attr">max</span>: <span class="number">50</span>, <span class="attr">message</span>: <span class="string">'部门名称要求1-50个字符'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }],</span><br><span class="line">      <span class="attr">code</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'部门编码不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> },</span><br><span class="line">        { <span class="attr">min</span>: <span class="number">1</span>, <span class="attr">max</span>: <span class="number">50</span>, <span class="attr">message</span>: <span class="string">'部门编码要求1-50个字符'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }],</span><br><span class="line">      <span class="attr">manager</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'部门负责人不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }],</span><br><span class="line">      <span class="attr">introduce</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'部门介绍不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> },</span><br><span class="line">        { <span class="attr">trigger</span>: <span class="string">'blur'</span>, <span class="attr">min</span>: <span class="number">1</span>, <span class="attr">max</span>: <span class="number">300</span>, <span class="attr">message</span>: <span class="string">'部门介绍要求1-50个字符'</span> }]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="部门名称和部门编码的自定义校验"><a href="#部门名称和部门编码的自定义校验" class="headerlink" title="部门名称和部门编码的自定义校验"></a>部门名称和部门编码的自定义校验</h3><p>**<code>注意</code><strong>：部门名称和部门编码的规则 有两条我们需要通过</strong><code>自定义校验函数validator</code>**来实现</p>
<blockquote>
<p>首先，在校验名称和编码时，要获取最新的组织架构，这也是我们这里trigger采用blur的原因，因为change对于访问的频率过高，我们需要控制访问频率</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先获取最新的组织架构数据</span></span><br><span class="line"><span class="keyword">const</span> { depts } = <span class="keyword">await</span> getDepartments()</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>部门名称不能和**<code>同级别</code>**的重复，这里注意，我们需要找到所有同级别的数据，进行校验，所以还需要另一个参数pid</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">props: {</span><br><span class="line">    <span class="comment">//   用来控制窗体是否显示或者隐藏</span></span><br><span class="line">    <span class="attr">showDialog</span>: {</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 当前操作的节点</span></span><br><span class="line">    <span class="attr">treeNode</span>: {</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Object</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">null</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">add-dept</span> <span class="attr">:show-dialog</span>=<span class="string">"showDialog"</span> <span class="attr">:tree-node</span>=<span class="string">"node"</span> /&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>根据当前部门id，找到所有子部门相关的数据，判断是否重复</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 现在定义一个函数 这个函数的目的是 去找 同级部门下 是否有重复的部门名称</span></span><br><span class="line">   <span class="keyword">const</span> checkNameRepeat = <span class="keyword">async</span>(rule, value, callback) =&gt; {</span><br><span class="line">     <span class="comment">// 先要获取最新的组织架构数据</span></span><br><span class="line">     <span class="keyword">const</span> { depts } = <span class="keyword">await</span> getDepartments()</span><br><span class="line">     <span class="comment">// depts是所有的部门数据</span></span><br><span class="line">     <span class="comment">// 如何去找技术部所有的子节点</span></span><br><span class="line">     <span class="keyword">const</span> isRepeat = depts.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.pid === <span class="built_in">this</span>.treeNode.id).some(<span class="function"><span class="params">item</span> =&gt;</span> item.name === value)</span><br><span class="line">     isRepeat ? callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`同级部门下已经有<span class="subst">${value}</span>的部门了`</span>)) : callback()</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<p>检查部门编码的过程同理</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检查编码重复</span></span><br><span class="line">   <span class="keyword">const</span> checkCodeRepeat = <span class="keyword">async</span>(rule, value, callback) =&gt; {</span><br><span class="line">     <span class="comment">// 先要获取最新的组织架构数据</span></span><br><span class="line">     <span class="keyword">const</span> { depts } = <span class="keyword">await</span> getDepartments()</span><br><span class="line">     <span class="keyword">const</span> isRepeat = depts.some(<span class="function"><span class="params">item</span> =&gt;</span> item.code === value &amp;&amp; value) <span class="comment">// 这里加一个 value不为空 因为我们的部门有可能没有code</span></span><br><span class="line">     isRepeat ? callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`组织架构中已经有部门使用<span class="subst">${value}</span>编码`</span>)) : callback()</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<p>在规则中定义</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义校验规则</span></span><br><span class="line"> rules: {</span><br><span class="line">   name: [{ required: <span class="literal">true</span>, message: '部门名称不能为空', trigger: 'blur' },</span><br><span class="line">     { min: <span class="number">1</span>, max: <span class="number">50</span>, message: '部门名称要求<span class="number">1</span><span class="number">-50</span>个字符', trigger: 'blur' }, {</span><br><span class="line">       trigger: 'blur',</span><br><span class="line">       validator: checkNameRepeat <span class="comment">// 自定义函数的形式校验</span></span><br><span class="line">     }],</span><br><span class="line">   code: [{ required: <span class="literal">true</span>, message: '部门编码不能为空', trigger: 'blur' },</span><br><span class="line">     { min: <span class="number">1</span>, max: <span class="number">50</span>, message: '部门编码要求<span class="number">1</span><span class="number">-50</span>个字符', trigger: 'blur' }, {</span><br><span class="line">       trigger: 'blur',</span><br><span class="line">       validator: checkCodeRepeat</span><br><span class="line">     }],</span><br><span class="line">   manager: [{ required: <span class="literal">true</span>, message: '部门负责人不能为空', trigger: 'blur' }],</span><br><span class="line">   introduce: [{ required: <span class="literal">true</span>, message: '部门介绍不能为空', trigger: 'blur' },</span><br><span class="line">     { trigger: 'blur', min: <span class="number">1</span>, max: <span class="number">300</span>, message: '部门介绍要求<span class="number">1</span><span class="number">-50</span>个字符' }]</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="处理首部内容的pid数据"><a href="#处理首部内容的pid数据" class="headerlink" title="处理首部内容的pid数据"></a>处理首部内容的pid数据</h3><p>**<code>需要注意</code><strong>：在最根级的</strong><code>tree-tools</code>**组件中，由于treenode属性中没有id，id便是undefined，但是通过undefined进行等值判断是寻找不到对应的根节点的， 所以在传值时，我们将id属性设置为 <strong><code>“”</code></strong></p>
<p><strong><code>src/views/departments/index.vue</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getDepartments</span>(<span class="params"></span>)</span> {</span><br><span class="line">     <span class="keyword">const</span> result = <span class="keyword">await</span> getDepartments()</span><br><span class="line">     <span class="built_in">this</span>.departs = transListToTreeData(result.depts, <span class="string">''</span>)</span><br><span class="line">     <span class="built_in">this</span>.company = { <span class="attr">name</span>: result.companyName, <span class="attr">manager</span>: <span class="string">'负责人'</span>, <span class="attr">id</span>: <span class="string">''</span> }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：完成新增部门的规则校验</p>
<h2 id="新增部门功能-部门负责人数据"><a href="#新增部门功能-部门负责人数据" class="headerlink" title="新增部门功能-部门负责人数据"></a>新增部门功能-部门负责人数据</h2><p>**<code>目标</code>**：获取新增表单中的部门负责人下拉数据</p>
<blockquote>
<p>在上节的表单中，部门负责人是下拉数据，我们应该从**<code>员工接口</code>**中获取该数据</p>
</blockquote>
<p>首先，封装获取简单员工列表的模块 <strong><code>src/api/employees.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'@/utils/request'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  获取员工的简单列表</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getEmployeeSimple</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/user/simple'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>然后，在**<code>add-dept.vue</code><strong>中的select聚焦事件</strong><code>focus</code>**中调用该接口，因为我们要获取实时的最新数据</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-select v-model="formData.manager" style="width:80%" placeholder="请选择" @focus="getEmployeeSimple"&gt;</span><br><span class="line">       &lt;!-- 需要循环生成选项   这里做一下简单的处理 显示的是用户名 存的也是用户名--&gt;</span><br><span class="line">       &lt;el-option v-for="item in peoples" :key="item.id" :label="item.username" :value="item.username" /&gt;</span><br><span class="line">     &lt;/el-select&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>获取员工列表</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  { getEmployeeSimple }   <span class="keyword">from</span> <span class="string">'@/api/employees'</span></span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="comment">// 获取员工简单列表数据</span></span><br><span class="line">    <span class="keyword">async</span>  <span class="function"><span class="title">getEmployeeSimple</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.peoples = <span class="keyword">await</span> getEmployeeSimple()</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="attr">peoples</span>: [] <span class="comment">// 接收获取的员工简单列表的数据</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：新增部门功能-部门负责人数据</p>
<h2 id="新增功能-提交-取消-关闭"><a href="#新增功能-提交-取消-关闭" class="headerlink" title="新增功能-提交-取消-关闭"></a>新增功能-提交-取消-关闭</h2><p>**<code>目标</code>**： 完成新增模块的提交-取消-关闭等功能</p>
<h3 id="校验通过，调用新增接口"><a href="#校验通过，调用新增接口" class="headerlink" title="校验通过，调用新增接口"></a>校验通过，调用新增接口</h3><blockquote>
<p>当点击新增页面的确定按钮时，我们需要完成对表单的整体校验，如果校验成功，进行提交</p>
</blockquote>
<p>首先，在点击确定时，校验表单</p>
<p><strong>给el-form定义一个ref属性</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form ref="deptForm" :model="formData" :rules="rules" label-width="120px"&gt;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击确定时触发</span></span><br><span class="line"><span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="built_in">this</span>.$refs.deptForm.validate(<span class="function"><span class="params">isOK</span> =&gt;</span> {</span><br><span class="line">    <span class="keyword">if</span> (isOK) {</span><br><span class="line">      <span class="comment">// 表示可以提交了</span></span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>然后，在校验通过时，调用新增接口</p>
<blockquote>
<p>因为是添加子部门，所以我们需要将新增的部门pid设置成当前部门的id，新增的部门就成了自己的子部门</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击确定时触发</span></span><br><span class="line"><span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="built_in">this</span>.$refs.deptForm.validate(<span class="keyword">async</span> isOK =&gt; {</span><br><span class="line">    <span class="keyword">if</span> (isOK) {</span><br><span class="line">      <span class="comment">// 表示可以提交了</span></span><br><span class="line">      <span class="keyword">await</span> addDepartments({ ...this.formData, <span class="attr">pid</span>: <span class="built_in">this</span>.treeNode.id }) <span class="comment">// 调用新增接口 添加父部门的id</span></span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>同样，在新增成功之后，调用告诉父组件，重新拉取数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$emit(<span class="string">'addDepts'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>父组件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;add-dept :show-dialog="showDialog" :tree-node="node" @addDepts="getDepartments" /&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong><code>本节注意</code><strong>：同学们可能会疑惑，我们</strong><code>tree-tools.vue</code></strong> 和**<code>add-dept.vue</code>**两个组件都触发了addDepts事件，不冲突吗？</p>
<p>这里，我们触发的自定义事件都是组件自身的，他们之间没有任何关系，只是名字相同而已，大家不要混淆</p>
<h3 id="利用sync修饰符关闭新增弹层"><a href="#利用sync修饰符关闭新增弹层" class="headerlink" title="利用sync修饰符关闭新增弹层"></a>利用sync修饰符关闭新增弹层</h3><blockquote>
<p>这里我们学习一个新的技巧，**<code>sync修饰符</code>**</p>
</blockquote>
<p> 按照常规，想要让父组件更新**<code>showDialog</code>**的话，需要这样做 </p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="built_in">this</span>.$emit(<span class="string">'changedialog'</span>, <span class="literal">false</span>) <span class="comment">//触发事件</span></span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line">&lt;child @changedialog=<span class="string">"method"</span> :showDialog=<span class="string">"showDialog"</span> /&gt;</span><br><span class="line"> <span class="function"><span class="title">method</span>(<span class="params">value</span>)</span> {</span><br><span class="line">    <span class="built_in">this</span>.showDialog = value</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>但是，vuejs为我们提供了**<code>sync修饰符</code>**，它提供了一种简写模式 也就是</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件 update:固定写法 (update:props名称, 值)</span></span><br><span class="line"><span class="built_in">this</span>.$emit(<span class="string">'update:showDialog'</span>, <span class="literal">false</span>) <span class="comment">//触发事件</span></span><br><span class="line"><span class="comment">// 父组件 sync修饰符</span></span><br><span class="line">&lt;child  :showDialog.sync=<span class="string">"showDialog"</span> /&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>只要用sync修饰，就可以省略父组件的监听和方法，直接将值赋值给showDialog</p>
<p><strong>取消按钮和关闭</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击确定时触发</span></span><br><span class="line">    <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.$refs.deptForm.validate(<span class="keyword">async</span> isOK =&gt; {</span><br><span class="line">        <span class="keyword">if</span> (isOK) {</span><br><span class="line">          <span class="comment">// 表示可以提交了</span></span><br><span class="line">          <span class="keyword">await</span> addDepartments({ ...this.formData, <span class="attr">pid</span>: <span class="built_in">this</span>.treeNode.id }) <span class="comment">// 调用新增接口 添加父部门的id</span></span><br><span class="line">          <span class="built_in">this</span>.$emit(<span class="string">'addDepts'</span>) <span class="comment">// 告诉父组件 新增数据成功 重新拉取数据</span></span><br><span class="line">          <span class="comment">// update:props名称</span></span><br><span class="line">          <span class="built_in">this</span>.$emit(<span class="string">'update:showDialog'</span>, <span class="literal">false</span>)</span><br><span class="line">        }</span><br><span class="line">      })</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="取消时重置数据和校验"><a href="#取消时重置数据和校验" class="headerlink" title="取消时重置数据和校验"></a>取消时重置数据和校验</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">btnCancel</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.$refs.deptForm.resetFields() <span class="comment">// 重置校验字段</span></span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">'update:showDialog'</span>, <span class="literal">false</span>) <span class="comment">// 关闭</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>需要在el-dialog中监听其close事件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog title="新增部门" :visible="showDialog" @close="btnCancel"&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong><code>本节任务</code></strong> 新增功能-提交-取消-关闭</p>
<h2 id="编辑部门功能实现数据回写"><a href="#编辑部门功能实现数据回写" class="headerlink" title="编辑部门功能实现数据回写"></a>编辑部门功能实现数据回写</h2><p>**<code>目标</code>**：实现编辑部门的功能</p>
<h3 id="点击编辑弹出层，记录当前节点"><a href="#点击编辑弹出层，记录当前节点" class="headerlink" title="点击编辑弹出层，记录当前节点"></a>点击编辑弹出层，记录当前节点</h3><blockquote>
<p>编辑部门功能实际上和新增窗体采用的是一个组件，只不过我们需要将新增场景变成编辑场景</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200831112149246.png" alt="image-20200831112149246"></p>
<p>首先点击编辑部门时， 调用<strong>父组件编辑方法</strong> <strong><code>tree-tools.vue</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$emit(<span class="string">'editDepts'</span>, <span class="built_in">this</span>.treeNode)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>父组件弹层，赋值当前编辑节点</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">         &lt;tree-tools slot-scope="obj" :tree-node="obj.data" @delDepts="getDepartments" @editDepts="editDepts" /&gt;</span><br><span class="line"></span><br><span class="line">// 编辑部门节点</span><br><span class="line">    editDepts(node) {</span><br><span class="line">      // 首先打开弹层</span><br><span class="line">      this.showDialog = true</span><br><span class="line">      this.node = node // 赋值操作的节点</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="父组件调用子组件的获取详情方法"><a href="#父组件调用子组件的获取详情方法" class="headerlink" title="父组件调用子组件的获取详情方法"></a>父组件调用子组件的获取详情方法</h3><blockquote>
<p>编辑时，我们需要获取点击部门的信息</p>
</blockquote>
<p><strong>封装获取部门信息的模块</strong> <strong><code>src/api/departments.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> * 获取部门详情</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getDepartDetail</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/company/department/<span class="subst">${id}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>在什么时候获取部门详情?</p>
</blockquote>
<p>我们可以在调用<strong>编辑方法</strong> **<code>editDepts</code><strong>中通过</strong><code>ref</code><strong>调用</strong><code>add-dept.vue</code>**的实例方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取部门详情</span></span><br><span class="line">   <span class="keyword">async</span>  <span class="function"><span class="title">getDepartDetail</span>(<span class="params">id</span>)</span> {</span><br><span class="line">     <span class="built_in">this</span>.formData = <span class="keyword">await</span> getDepartDetail(id)</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击编辑触发的父组件的方法</span></span><br><span class="line"> <span class="function"><span class="title">editDepts</span>(<span class="params">node</span>)</span> {</span><br><span class="line">   <span class="built_in">this</span>.showDialog = <span class="literal">true</span> <span class="comment">// 显示新增组件弹层</span></span><br><span class="line">   <span class="built_in">this</span>.node = node <span class="comment">// 存储传递过来的node数据</span></span><br><span class="line">   <span class="comment">// 我们需要在这个位置 调用子组件的方法</span></span><br><span class="line">   <span class="comment">// 父组件 调用子组件的方法</span></span><br><span class="line">   <span class="built_in">this</span>.$refs.addDept.getDepartDetail(node.id) <span class="comment">// 直接调用子组件中的方法 传入一个id</span></span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="根据计算属性显示控制标题"><a href="#根据计算属性显示控制标题" class="headerlink" title="根据计算属性显示控制标题"></a>根据计算属性显示控制标题</h3><blockquote>
<p>需要根据当前的场景区分显示的标题</p>
</blockquote>
<p>计算属性</p>
<blockquote>
<p>如何判断新增还是编辑</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">computed: {</span><br><span class="line">    <span class="function"><span class="title">showTitle</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.formData.id ? <span class="string">'编辑部门'</span> : <span class="string">'新增子部门'</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>

<p>同时发现，el-form中的resetFields不能重置非表单中的数据，所以在取消的位置需要强制加上 重置数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">btnCancel</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="comment">// 重置数据  因为resetFields 只能重置 表单上的数据 非表单上的 比如 编辑中id 不能重置</span></span><br><span class="line">  <span class="built_in">this</span>.formData = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">code</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">manager</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">introduce</span>: <span class="string">''</span></span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 关闭弹层</span></span><br><span class="line">  <span class="built_in">this</span>.$emit(<span class="string">'update:showDialog'</span>, <span class="literal">false</span>)</span><br><span class="line">  <span class="comment">// 清除之前的校验  可以重置数据 只能重置 定义在data中的数据</span></span><br><span class="line">  <span class="built_in">this</span>.$refs.deptForm.resetFields()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="同时支持编辑和新增场景"><a href="#同时支持编辑和新增场景" class="headerlink" title="同时支持编辑和新增场景"></a>同时支持编辑和新增场景</h2><h3 id="封装编辑接口，保存区分场景"><a href="#封装编辑接口，保存区分场景" class="headerlink" title="封装编辑接口，保存区分场景"></a>封装编辑接口，保存区分场景</h3><blockquote>
<p>接下来，需要在点击确定时，同时支持新增部门和编辑部门两个场景，我们可以根据formData是否有id进行区分</p>
</blockquote>
<p><strong>封装编辑部门接口</strong>   <strong><code>src/api/departments.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编辑部门</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateDepartments</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/company/department/<span class="subst">${data.id}</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'put'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>点击确定时，进行场景区分</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击确定时触发</span></span><br><span class="line"> <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">   <span class="built_in">this</span>.$refs.deptForm.validate(<span class="keyword">async</span> isOK =&gt; {</span><br><span class="line">     <span class="keyword">if</span> (isOK) {</span><br><span class="line">       <span class="comment">// 要分清楚现在是编辑还是新增</span></span><br><span class="line">       <span class="keyword">if</span> (<span class="built_in">this</span>.formData.id) {</span><br><span class="line">         <span class="comment">// 编辑模式  调用编辑接口</span></span><br><span class="line">         <span class="keyword">await</span> updateDepartments(<span class="built_in">this</span>.formData)</span><br><span class="line">       } <span class="keyword">else</span> {</span><br><span class="line">         <span class="comment">// 新增模式</span></span><br><span class="line">         <span class="keyword">await</span> addDepartments({ ...this.formData, <span class="attr">pid</span>: <span class="built_in">this</span>.treeNode.id }) <span class="comment">// 调用新增接口 添加父部门的id</span></span><br><span class="line">       }</span><br><span class="line">       <span class="comment">// 表示可以提交了</span></span><br><span class="line">       <span class="built_in">this</span>.$emit(<span class="string">'addDepts'</span>) <span class="comment">// 告诉父组件 新增数据成功 重新拉取数据</span></span><br><span class="line">       <span class="comment">// update:props名称</span></span><br><span class="line">       <span class="built_in">this</span>.$emit(<span class="string">'update:showDialog'</span>, <span class="literal">false</span>)</span><br><span class="line">     }</span><br><span class="line">   })</span><br><span class="line"> },</span><br></pre></td></tr></tbody></table></figure>

<h3 id="校验规则支持编辑场景下的校验"><a href="#校验规则支持编辑场景下的校验" class="headerlink" title="校验规则支持编辑场景下的校验"></a>校验规则支持编辑场景下的校验</h3><blockquote>
<p>除此之外，我们发现原来的校验规则实际和编辑部门有些冲突，所以需要进一步处理</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 现在定义一个函数 这个函数的目的是 去找 同级部门下 是否有重复的部门名称</span></span><br><span class="line"> <span class="keyword">const</span> checkNameRepeat = <span class="keyword">async</span>(rule, value, callback) =&gt; {</span><br><span class="line">   <span class="comment">// 先要获取最新的组织架构数据</span></span><br><span class="line">   <span class="keyword">const</span> { depts } = <span class="keyword">await</span> getDepartments()</span><br><span class="line">   <span class="comment">//  检查重复规则 需要支持两种 新增模式 / 编辑模式</span></span><br><span class="line">   <span class="comment">// depts是所有的部门数据</span></span><br><span class="line">   <span class="comment">// 如何去找技术部所有的子节点</span></span><br><span class="line">   <span class="keyword">let</span> isRepeat = <span class="literal">false</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.formData.id) {</span><br><span class="line">     <span class="comment">// 有id就是编辑模式</span></span><br><span class="line">     <span class="comment">// 编辑 张三 =&gt; 校验规则 除了我之外 同级部门下 不能有叫张三的</span></span><br><span class="line">     isRepeat = depts.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.id !== <span class="built_in">this</span>.formData.id &amp;&amp; item.pid === <span class="built_in">this</span>.treeNode.pid).some(<span class="function"><span class="params">item</span> =&gt;</span> item.name === value)</span><br><span class="line">   } <span class="keyword">else</span> {</span><br><span class="line">     <span class="comment">// 没id就是新增模式</span></span><br><span class="line">     isRepeat = depts.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.pid === <span class="built_in">this</span>.treeNode.id).some(<span class="function"><span class="params">item</span> =&gt;</span> item.name === value)</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   isRepeat ? callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`同级部门下已经有<span class="subst">${value}</span>的部门了`</span>)) : callback()</span><br><span class="line"> }</span><br><span class="line"> <span class="comment">// 检查编码重复</span></span><br><span class="line"> <span class="keyword">const</span> checkCodeRepeat = <span class="keyword">async</span>(rule, value, callback) =&gt; {</span><br><span class="line">   <span class="comment">// 先要获取最新的组织架构数据</span></span><br><span class="line">   <span class="comment">//  检查重复规则 需要支持两种 新增模式 / 编辑模式</span></span><br><span class="line">   <span class="keyword">const</span> { depts } = <span class="keyword">await</span> getDepartments()</span><br><span class="line">   <span class="keyword">let</span> isRepeat = <span class="literal">false</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.formData.id) {</span><br><span class="line">     <span class="comment">// 编辑模式  因为编辑模式下 不能算自己</span></span><br><span class="line">     isRepeat = depts.some(<span class="function"><span class="params">item</span> =&gt;</span> item.id !== <span class="built_in">this</span>.formData.id &amp;&amp; item.code === value &amp;&amp; value)</span><br><span class="line">   } <span class="keyword">else</span> {</span><br><span class="line">     <span class="comment">// 新增模式</span></span><br><span class="line">     isRepeat = depts.some(<span class="function"><span class="params">item</span> =&gt;</span> item.code === value &amp;&amp; value) <span class="comment">// 这里加一个 value不为空 因为我们的部门有可能没有code</span></span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   isRepeat ? callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`组织架构中已经有部门使用<span class="subst">${value}</span>编码`</span>)) : callback()</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>至此，整个组织架构， 我们完成了，组织架构读取 /  新增部门 / 删除部门  / 编辑部门</p>
</blockquote>
<p>如图</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200722134415195.png" alt="image-20200722134415195"></p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**编辑部门功能实现</p>
<h2 id="给数据获取添加加载进度条"><a href="#给数据获取添加加载进度条" class="headerlink" title="给数据获取添加加载进度条"></a>给数据获取添加加载进度条</h2><p><strong><code>目标</code></strong>  给当前组织架构添加加载进度条</p>
<p>由于获取数据的延迟性，为了更好的体验，可以给页面增加一个Loading进度条，采用element的指令解决方案即可</p>
<p><strong>定义loading变量</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loading: <span class="literal">false</span> <span class="comment">// 用来控制进度弹层的显示和隐藏</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>赋值变量给指令</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-loading="loading" class="dashboard-container"&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>获取方法前后设置变量</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getDepartments</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> getDepartments()</span><br><span class="line">      <span class="built_in">this</span>.departs = transListToTreeData(result.depts, <span class="string">''</span>)</span><br><span class="line">      <span class="built_in">this</span>.company = { <span class="attr">name</span>: result.companyName, <span class="attr">manager</span>: <span class="string">'负责人'</span>, <span class="attr">id</span>: <span class="string">''</span> }</span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="6-公司和角色"><a href="#6-公司和角色" class="headerlink" title="6.公司和角色"></a>6.公司和角色</h1><h2 id="建立公司角色页面的基本结构"><a href="#建立公司角色页面的基本结构" class="headerlink" title="建立公司角色页面的基本结构"></a>建立公司角色页面的基本结构</h2><p>**<code>目标</code>**建立公司页面的基本结构</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200722221903217.png" alt="image-20200722221903217"></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200722221910776.png" alt="image-20200722221910776"></p>
<p>根据以上的结构，我们采用element-ui的组件实现</p>
<p><strong><code>src/views/setting/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="dashboard-container"&gt;</span><br><span class="line">    &lt;div class="app-container"&gt;</span><br><span class="line">      &lt;el-card&gt;</span><br><span class="line">        &lt;el-tabs&gt;</span><br><span class="line">          &lt;!-- 放置页签 --&gt;</span><br><span class="line">          &lt;el-tab-pane label="角色管理"&gt;</span><br><span class="line">            &lt;!-- 新增角色按钮 --&gt;</span><br><span class="line">            &lt;el-row style="height:60px"&gt;</span><br><span class="line">              &lt;el-button</span><br><span class="line">                icon="el-icon-plus"</span><br><span class="line">                size="small"</span><br><span class="line">                type="primary"</span><br><span class="line">              &gt;新增角色&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-row&gt;</span><br><span class="line">            &lt;!-- 表格 --&gt;</span><br><span class="line">            &lt;el-table border=""&gt;</span><br><span class="line">              &lt;el-table-column label="序号" width="120" /&gt;</span><br><span class="line">              &lt;el-table-column label="角色名称" width="240" /&gt;</span><br><span class="line">              &lt;el-table-column label="描述" /&gt;</span><br><span class="line">              &lt;el-table-column label="操作"&gt;</span><br><span class="line">                &lt;el-button size="small" type="success"&gt;分配权限&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button size="small" type="primary"&gt;编辑&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button size="small" type="danger"&gt;删除&lt;/el-button&gt;</span><br><span class="line">              &lt;/el-table-column&gt;</span><br><span class="line">            &lt;/el-table&gt;</span><br><span class="line">            &lt;!-- 分页组件 --&gt;</span><br><span class="line">            &lt;el-row type="flex" justify="center" align="middle" style="height: 60px"&gt;</span><br><span class="line">              &lt;!-- 分页组件 --&gt;</span><br><span class="line">              &lt;el-pagination layout="prev,pager,next" /&gt;</span><br><span class="line">            &lt;/el-row&gt;</span><br><span class="line">          &lt;/el-tab-pane&gt;</span><br><span class="line">          &lt;el-tab-pane label="公司信息"&gt;</span><br><span class="line">            &lt;el-alert</span><br><span class="line">              title="对公司名称、公司地址、营业执照、公司地区的更新，将使得公司资料被重新审核，请谨慎修改"</span><br><span class="line">              type="info"</span><br><span class="line">              show-icon</span><br><span class="line">              :closable="false"</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;el-form label-width="120px" style="margin-top:50px"&gt;</span><br><span class="line">              &lt;el-form-item label="公司名称"&gt;</span><br><span class="line">                &lt;el-input disabled style="width:400px" /&gt;</span><br><span class="line">              &lt;/el-form-item&gt;</span><br><span class="line">              &lt;el-form-item label="公司地址"&gt;</span><br><span class="line">                &lt;el-input disabled style="width:400px" /&gt;</span><br><span class="line">              &lt;/el-form-item&gt;</span><br><span class="line">              &lt;el-form-item label="邮箱"&gt;</span><br><span class="line">                &lt;el-input disabled style="width:400px" /&gt;</span><br><span class="line">              &lt;/el-form-item&gt;</span><br><span class="line">              &lt;el-form-item label="备注"&gt;</span><br><span class="line">                &lt;el-input type="textarea" :rows="3" disabled style="width:400px" /&gt;</span><br><span class="line">              &lt;/el-form-item&gt;</span><br><span class="line">            &lt;/el-form&gt;</span><br><span class="line">          &lt;/el-tab-pane&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/el-tabs&gt;</span><br><span class="line">      &lt;/el-card&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**建立公司页面的基本结构</p>
<h2 id="读取公司角色信息"><a href="#读取公司角色信息" class="headerlink" title="读取公司角色信息"></a>读取公司角色信息</h2><p>**<code>目标</code>**： 封装公司角色请求，读取公司角色信息</p>
<h3 id="读取角色列表数据"><a href="#读取角色列表数据" class="headerlink" title="读取角色列表数据"></a>读取角色列表数据</h3><p>首先，封装读取角色的信息的请求 <strong><code>src/api/setting.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取角色列表</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRoleList</span>(<span class="params">params</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/role'</span>,</span><br><span class="line">    params</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>params是查询参数，里面需要携带分页信息</p>
</blockquote>
<p>然后，在页面中调用接口获取数据，绑定表格数据 <strong><code>src/views/setting/index.vue</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getRoleList } <span class="keyword">from</span> <span class="string">'@/api/setting'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">list</span>: [], <span class="comment">// 承接数组</span></span><br><span class="line">      <span class="attr">page</span>: {</span><br><span class="line">        <span class="comment">// 放置页码及相关数据</span></span><br><span class="line">        <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pagesize</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">total</span>: <span class="number">0</span> <span class="comment">// 记录总数</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="built_in">this</span>.getRoleList() <span class="comment">// 获取角色列表</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getRoleList</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="keyword">const</span> { total, rows } = <span class="keyword">await</span> getRoleList(<span class="built_in">this</span>.page)</span><br><span class="line">      <span class="built_in">this</span>.page.total = total</span><br><span class="line">      <span class="built_in">this</span>.list = rows</span><br><span class="line">    },</span><br><span class="line">    <span class="function"><span class="title">changePage</span>(<span class="params">newPage</span>)</span> {</span><br><span class="line">      <span class="comment">// newPage是当前点击的页码</span></span><br><span class="line">      <span class="built_in">this</span>.page.page = newPage <span class="comment">// 将当前页码赋值给当前的最新页码</span></span><br><span class="line">      <span class="built_in">this</span>.getRoleList()</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p> <strong>绑定表格数据</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table border="" :data="list"&gt;</span><br><span class="line">            &lt;el-table-column align="center" type="index" label="序号" width="120" /&gt;</span><br><span class="line">            &lt;el-table-column align="center" prop="name" label="名称" width="240" /&gt;</span><br><span class="line">            &lt;el-table-column align="center" prop="description" label="描述" /&gt;</span><br><span class="line">            &lt;el-table-column align="center" label="操作"&gt;</span><br><span class="line">              &lt;el-button size="small" type="success"&gt;分配权限&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button size="small" type="primary"&gt;编辑&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button size="small" type="danger"&gt;删除&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">          &lt;/el-table&gt;</span><br><span class="line">      </span><br></pre></td></tr></tbody></table></figure>

<p><strong>绑定分页数据</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 放置分页组件 --&gt;</span><br><span class="line">        &lt;el-row type="flex" justify="center" align="middle" style="height:60px"&gt;</span><br><span class="line">          &lt;el-pagination</span><br><span class="line">            :current-page="page.page"</span><br><span class="line">            :page-size="page.pagesize"</span><br><span class="line">            :total="page.total"</span><br><span class="line">            layout="prev, pager, next"</span><br><span class="line">            @current-change="changePage"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="读取公司信息数据"><a href="#读取公司信息数据" class="headerlink" title="读取公司信息数据"></a>读取公司信息数据</h3><blockquote>
<p>第二个tab页，我们同样需要读取数据</p>
</blockquote>
<p>封装读取公司信息的api  <strong><code>src/api/setting.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取公司信息</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getCompanyInfo</span>(<span class="params">companyId</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/company/<span class="subst">${companyId}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>绑定公司表单数据</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form label-width="120px" style="margin-top:50px"&gt;</span><br><span class="line">           &lt;el-form-item label="公司名称"&gt;</span><br><span class="line">             &lt;el-input v-model="formData.name" disabled style="width:400px" /&gt;</span><br><span class="line">           &lt;/el-form-item&gt;</span><br><span class="line">           &lt;el-form-item label="公司地址"&gt;</span><br><span class="line">             &lt;el-input v-model="formData.companyAddress" disabled style="width:400px" /&gt;</span><br><span class="line">           &lt;/el-form-item&gt;</span><br><span class="line">           &lt;el-form-item label="邮箱"&gt;</span><br><span class="line">             &lt;el-input v-model="formData.mailbox" disabled style="width:400px" /&gt;</span><br><span class="line">           &lt;/el-form-item&gt;</span><br><span class="line">           &lt;el-form-item label="备注"&gt;</span><br><span class="line">             &lt;el-input v-model="formData.remarks" type="textarea" :rows="3" disabled style="width:400px" /&gt;</span><br><span class="line">           &lt;/el-form-item&gt;</span><br><span class="line">         &lt;/el-form&gt;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>请求中的companyId来自哪里？它来自我们登录成功之后的用户资料，所以我们需要在该组件中使用vuex数据</p>
</blockquote>
<p> <strong><code>src/store/getters.js</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">companyId: state =&gt; state.user.userInfo.companyId // 建立对于user模块的companyId的快捷访问</span><br><span class="line">computed: {</span><br><span class="line">  ...mapGetters(['companyId'])</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>

<p><strong>初始化时调用接口</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// 获取的公司的信息</span></span><br><span class="line">   <span class="keyword">async</span> <span class="function"><span class="title">getCompanyInfo</span>(<span class="params"></span>)</span> {</span><br><span class="line">     <span class="built_in">this</span>.formData = <span class="keyword">await</span> getCompanyInfo(<span class="built_in">this</span>.companyId)</span><br><span class="line">   }</span><br><span class="line"><span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {</span><br><span class="line">   <span class="built_in">this</span>.getRoleList() <span class="comment">// 获取角色列表</span></span><br><span class="line">   <span class="built_in">this</span>.getCompanyInfo()</span><br><span class="line"> },</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**读取公司角色信息</p>
<h2 id="删除角色功能"><a href="#删除角色功能" class="headerlink" title="删除角色功能"></a>删除角色功能</h2><p><strong><code>目标</code></strong>  实现删除角色的功能</p>
<p><strong>封装删除角色的api</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** **</span></span><br><span class="line"><span class="comment"> *  删除角色</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ****/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteRole</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/role/<span class="subst">${id}</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'delete'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>删除功能实现</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">deleteRole</span>(<span class="params">id</span>)</span> {</span><br><span class="line">  <span class="comment">//  提示</span></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.$confirm(<span class="string">'确认删除该角色吗'</span>)</span><br><span class="line">    <span class="comment">// 只有点击了确定 才能进入到下方</span></span><br><span class="line">    <span class="keyword">await</span> deleteRole(id) <span class="comment">// 调用删除接口</span></span><br><span class="line">    <span class="built_in">this</span>.getRoleList() <span class="comment">// 重新加载数据</span></span><br><span class="line">    <span class="built_in">this</span>.$message.success(<span class="string">'删除角色成功'</span>)</span><br><span class="line">  } <span class="keyword">catch</span> (error) {</span><br><span class="line">    <span class="built_in">console</span>.log(error)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>删除按钮注册事件</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 作用域插槽 --&gt;</span><br><span class="line">         &lt;template slot-scope="{ row }"&gt;</span><br><span class="line">                 &lt;el-button size="small" type="success"&gt;分配权限&lt;/el-button&gt;</span><br><span class="line">                 &lt;el-button size="small" type="primary"&gt;编辑&lt;/el-button&gt;</span><br><span class="line">                 &lt;el-button size="small" type="danger" @click="deleteRole(row.id)"&gt;删除&lt;/el-button&gt;</span><br><span class="line">         &lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<h2 id="编辑角色功能"><a href="#编辑角色功能" class="headerlink" title="编辑角色功能"></a>编辑角色功能</h2><p>**<code>目标</code>**： 实现编辑角色的功能</p>
<h3 id="封装编辑接口，新建编辑弹层"><a href="#封装编辑接口，新建编辑弹层" class="headerlink" title="封装编辑接口，新建编辑弹层"></a>封装编辑接口，新建编辑弹层</h3><p><strong>封装编辑角色的功能api</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> * 修改角色</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateRole</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/role/<span class="subst">${data.id}</span>`</span>,</span><br><span class="line">    data,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'put'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取角色详情</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRoleDetail</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/role/<span class="subst">${id}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>定义编辑弹层数据</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">showDialog: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">// 专门接收新增或者编辑的编辑的表单数据</span></span><br><span class="line"><span class="attr">roleForm</span>: {},</span><br><span class="line"><span class="attr">rules</span>: {</span><br><span class="line">  <span class="attr">name</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'角色名称不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }]</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>

<p><strong>编辑弹层结构</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog title="编辑弹层" :visible="showDialog" @close="btnCancel"&gt;</span><br><span class="line">     &lt;el-form ref="roleForm" :model="roleForm" :rules="rules" label-width="120px"&gt;</span><br><span class="line">       &lt;el-form-item label="角色名称" prop="name"&gt;</span><br><span class="line">         &lt;el-input v-model="roleForm.name" /&gt;</span><br><span class="line">       &lt;/el-form-item&gt;</span><br><span class="line">       &lt;el-form-item label="角色描述"&gt;</span><br><span class="line">         &lt;el-input v-model="roleForm.description" /&gt;</span><br><span class="line">       &lt;/el-form-item&gt;</span><br><span class="line">     &lt;/el-form&gt;</span><br><span class="line">     &lt;!-- 底部 --&gt;</span><br><span class="line">     &lt;el-row slot="footer" type="flex" justify="center"&gt;</span><br><span class="line">       &lt;el-col :span="6"&gt;</span><br><span class="line">         &lt;el-button size="small" @click="btnCancel"&gt;取消&lt;/el-button&gt;</span><br><span class="line">         &lt;el-button size="small" type="primary" @click="btnOK"&gt;确定&lt;/el-button&gt;</span><br><span class="line">       &lt;/el-col&gt;</span><br><span class="line">     &lt;/el-row&gt;</span><br><span class="line">   &lt;/el-dialog&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="实现编辑功能，为新增功能留口"><a href="#实现编辑功能，为新增功能留口" class="headerlink" title="实现编辑功能，为新增功能留口"></a>实现编辑功能，为新增功能留口</h3><p><strong>编辑功能实现（为新增功能留口）</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">editRole</span>(<span class="params">id</span>)</span> {</span><br><span class="line">  <span class="built_in">this</span>.roleForm = <span class="keyword">await</span> getRoleDetail(id)</span><br><span class="line">  <span class="built_in">this</span>.showDialog = <span class="literal">true</span> <span class="comment">// 为了不出现闪烁的问题 先获取数据 再弹出层</span></span><br><span class="line">},</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.$refs.roleForm.validate()</span><br><span class="line">    <span class="comment">// 只有校验通过的情况下 才会执行await的下方内容</span></span><br><span class="line">    <span class="comment">// roleForm这个对象有id就是编辑 没有id就是新增</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.roleForm.id) {</span><br><span class="line">      <span class="keyword">await</span> updateRole(<span class="built_in">this</span>.roleForm)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 新增业务</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 重新拉取数据</span></span><br><span class="line">    <span class="built_in">this</span>.getRoleList()</span><br><span class="line">    <span class="built_in">this</span>.$message.success(<span class="string">'操作成功'</span>)</span><br><span class="line">    <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">  } <span class="keyword">catch</span> (error) {</span><br><span class="line">    <span class="built_in">console</span>.log(error)</span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>

<p><strong>编辑按钮注册事件</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button size="small" type="primary" @click="editRole(row.id)"&gt;编辑&lt;/el-button&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<h2 id="新增角色功能"><a href="#新增角色功能" class="headerlink" title="新增角色功能"></a>新增角色功能</h2><p>**<code>目标</code>**实现新增角色功能</p>
<p><strong>封装新增角色功能api</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> * 新增角色</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addRole</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/role'</span>,</span><br><span class="line">    data,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'post'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>新增功能实现和编辑功能合并（处理关闭）</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.$refs.roleForm.validate()</span><br><span class="line">    <span class="comment">// 只有校验通过的情况下 才会执行await的下方内容</span></span><br><span class="line">    <span class="comment">// roleForm这个对象有id就是编辑 没有id就是新增</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.roleForm.id) {</span><br><span class="line">      <span class="keyword">await</span> updateRole(<span class="built_in">this</span>.roleForm)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 新增业务</span></span><br><span class="line">      <span class="keyword">await</span> addRole(<span class="built_in">this</span>.roleForm)</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 重新拉取数据</span></span><br><span class="line">    <span class="built_in">this</span>.getRoleList()</span><br><span class="line">    <span class="built_in">this</span>.$message.success(<span class="string">'操作成功'</span>)</span><br><span class="line">    <span class="built_in">this</span>.showDialog = <span class="literal">false</span> <span class="comment">// 关闭弹层  =&gt;  触发el-dialog的事件close事件</span></span><br><span class="line">  } <span class="keyword">catch</span> (error) {</span><br><span class="line">    <span class="built_in">console</span>.log(error)</span><br><span class="line">  }</span><br><span class="line">},</span><br><span class="line"><span class="function"><span class="title">btnCancel</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="built_in">this</span>.roleForm = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">description</span>: <span class="string">''</span></span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 移除校验</span></span><br><span class="line">  <span class="built_in">this</span>.$refs.roleForm.resetFields()</span><br><span class="line">  <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>新增按钮注册事件</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type="primary" size="small" @click="showDialog = true"&gt;新增角色&lt;/el-button&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 新增角色功能</p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200831160134281.png" alt="image-20200831160134281"></p>
<p>我们完成了公司中角色管理的部分，但是并没有完成分配权限的部分，该部门会在权限设计和管理的部门重点提及</p>
<h1 id="7-员工管理"><a href="#7-员工管理" class="headerlink" title="7.员工管理"></a>7.员工管理</h1><h2 id="封装一个通用的工具栏"><a href="#封装一个通用的工具栏" class="headerlink" title="封装一个通用的工具栏"></a>封装一个通用的工具栏</h2><p>**<code>目标</code>**：封装一个通用的工具栏供大家使用</p>
<h3 id="通用工具栏的组件结构"><a href="#通用工具栏的组件结构" class="headerlink" title="通用工具栏的组件结构"></a>通用工具栏的组件结构</h3><blockquote>
<p>在后续的业务开发中，经常会用到一个类似下图的工具栏，作为公共组件，进行一下封装</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200723223704401.png" alt="image-20200723223704401"></p>
<p>组件 <strong><code>src/components/PageTools/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-card class="page-tools"&gt;</span><br><span class="line">    &lt;el-row type="flex" justify="space-between" align="middle"&gt;</span><br><span class="line">      &lt;el-col&gt;</span><br><span class="line">        &lt;div  v-if="showBefore" class="before"&gt;</span><br><span class="line">          &lt;i class="el-icon-info" /&gt;</span><br><span class="line">          &lt;!-- 定义前面得插槽 --&gt;</span><br><span class="line">          &lt;slot name="before" /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">      &lt;el-col&gt;</span><br><span class="line">        &lt;el-row type="flex" justify="end"&gt;</span><br><span class="line">           &lt;!-- 定义后面的插槽 --&gt;</span><br><span class="line">           &lt;slot name="after" /&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  props: {</span><br><span class="line">    showBefore: {</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang='scss'&gt;</span><br><span class="line"> .page-tools {</span><br><span class="line">    margin: 10px 0;</span><br><span class="line">    .before {</span><br><span class="line">      line-height: 34px;</span><br><span class="line">    i {</span><br><span class="line">      margin-right: 5px;</span><br><span class="line">      color: #409eff;</span><br><span class="line">    }</span><br><span class="line">    display: inline-block;</span><br><span class="line">    padding: 0px 10px;</span><br><span class="line">    border-radius: 3px;</span><br><span class="line">    border: 1px solid rgba(145, 213, 255, 1);</span><br><span class="line">    background: rgba(230, 247, 255, 1);</span><br><span class="line">  }</span><br><span class="line"> }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="组件统一注册"><a href="#组件统一注册" class="headerlink" title="组件统一注册"></a>组件统一注册</h3><blockquote>
<p>为了方便所有的页面都可以不用引用该组件，可以进行全局注册</p>
</blockquote>
<p>提供注册入口 <strong><code>src/componets/index.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该文件负责所有的公共的组件的全局注册   Vue.use</span></span><br><span class="line"><span class="keyword">import</span> PageTools <span class="keyword">from</span> <span class="string">'./PageTools'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="function"><span class="title">install</span>(<span class="params">Vue</span>)</span> {</span><br><span class="line">    <span class="comment">//  注册全局的通用栏组件对象</span></span><br><span class="line">    Vue.component(<span class="string">'PageTools'</span>, PageTools)</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>在入口处进行注册 <strong><code>src/main.js</code></strong></p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Component <span class="keyword">from</span> <span class="string">'@/components'</span></span><br><span class="line">Vue.use(Component) <span class="comment">// 注册自己的插件</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**： 封装一个通用的工具栏</p>
<h2 id="员工列表页面的基本布局和结构"><a href="#员工列表页面的基本布局和结构" class="headerlink" title="员工列表页面的基本布局和结构"></a>员工列表页面的基本布局和结构</h2><p>**<code>目标</code>**：实现员工列表页面的基本布局和结构</p>
<p><strong>结构代码</strong> <strong><code>src/employees/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="dashboard-container"&gt;</span><br><span class="line">    &lt;div class="app-container"&gt;</span><br><span class="line">      &lt;page-tools :show-before="true"&gt;</span><br><span class="line">        &lt;span slot="before"&gt;共166条记录&lt;/span&gt;</span><br><span class="line">        &lt;template slot="after"&gt;</span><br><span class="line">          &lt;el-button size="small" type="warning"&gt;导入&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button size="small" type="danger"&gt;导出&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button size="small" type="primary"&gt;新增员工&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/page-tools&gt;</span><br><span class="line">      &lt;!-- 放置表格和分页 --&gt;</span><br><span class="line">      &lt;el-card&gt;</span><br><span class="line">        &lt;el-table border&gt;</span><br><span class="line">          &lt;el-table-column label="序号" sortable="" /&gt;</span><br><span class="line">          &lt;el-table-column label="姓名" sortable="" /&gt;</span><br><span class="line">          &lt;el-table-column label="工号" sortable="" /&gt;</span><br><span class="line">          &lt;el-table-column label="聘用形式" sortable="" /&gt;</span><br><span class="line">          &lt;el-table-column label="部门" sortable="" /&gt;</span><br><span class="line">          &lt;el-table-column label="入职时间" sortable="" /&gt;</span><br><span class="line">          &lt;el-table-column label="账户状态" sortable="" /&gt;</span><br><span class="line">          &lt;el-table-column label="操作" sortable="" fixed="right" width="280"&gt;</span><br><span class="line">            &lt;template&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;查看&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;转正&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;调岗&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;离职&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;角色&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;删除&lt;/el-button&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">        &lt;!-- 分页组件 --&gt;</span><br><span class="line">        &lt;el-row type="flex" justify="center" align="middle" style="height: 60px"&gt;</span><br><span class="line">          &lt;el-pagination layout="prev, pager, next" /&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">      &lt;/el-card&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200831162222975.png" alt="image-20200831162222975"></p>
<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：员工列表页面的基本布局和结构</p>
<h2 id="员工列表数据请求和分页加载"><a href="#员工列表数据请求和分页加载" class="headerlink" title="员工列表数据请求和分页加载"></a>员工列表数据请求和分页加载</h2><p>**<code>目标</code>**实现员工数据的加载和分页请求</p>
<p>首先，封装员工的加载请求 <strong><code>src/api/employees.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取员工的综合列表数据</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getEmployeeList</span>(<span class="params">params</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/user'</span>,</span><br><span class="line">    params</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>然后，实现加载数据和分页的逻辑</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getEmployeeList } <span class="keyword">from</span> <span class="string">'@/api/employees'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">list</span>: [], <span class="comment">// 接数据的</span></span><br><span class="line">      <span class="attr">page</span>: {</span><br><span class="line">        <span class="attr">page</span>: <span class="number">1</span>, <span class="comment">// 当前页码</span></span><br><span class="line">        <span class="attr">size</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">total</span>: <span class="number">0</span> <span class="comment">// 总数</span></span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="built_in">this</span>.getEmployeeList()</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="function"><span class="title">changePage</span>(<span class="params">newPage</span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.page.page = newPage</span><br><span class="line">      <span class="built_in">this</span>.getEmployeeList()</span><br><span class="line">    },</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getEmployeeList</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">const</span> { total, rows } = <span class="keyword">await</span> getEmployeeList(<span class="built_in">this</span>.page)</span><br><span class="line">      <span class="built_in">this</span>.page.total = total</span><br><span class="line">      <span class="built_in">this</span>.list = rows</span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>绑定表格</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-card v-loading="loading"&gt;</span><br><span class="line">  &lt;el-table border :data="list"&gt;</span><br><span class="line">    &lt;el-table-column label="序号" sortable="" type="index" /&gt;</span><br><span class="line">    &lt;el-table-column label="姓名" sortable="" prop="username" /&gt;</span><br><span class="line">    &lt;el-table-column label="工号" sortable="" prop="workNumber" /&gt;</span><br><span class="line">    &lt;el-table-column label="聘用形式" sortable="" prop="formOfEmployment" /&gt;</span><br><span class="line">    &lt;el-table-column label="部门" sortable="" prop="departmentName" /&gt;</span><br><span class="line">    &lt;el-table-column label="入职时间" sortable="" prop="timeOfEntry" /&gt;</span><br><span class="line">    &lt;el-table-column label="账户状态" sortable="" prop="enableState" /&gt;</span><br><span class="line">    &lt;el-table-column label="操作" sortable="" fixed="right" width="280"&gt;</span><br><span class="line">      &lt;template&gt;</span><br><span class="line">        &lt;el-button type="text" size="small"&gt;查看&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type="text" size="small"&gt;转正&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type="text" size="small"&gt;调岗&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type="text" size="small"&gt;离职&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type="text" size="small"&gt;角色&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type="text" size="small"&gt;删除&lt;/el-button&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">  &lt;/el-table&gt;</span><br><span class="line">  &lt;!-- 分页组件 --&gt;</span><br><span class="line">  &lt;el-row type="flex" justify="center" align="middle" style="height: 60px"&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      layout="prev, pager, next"</span><br><span class="line">      :page-size="page.size"</span><br><span class="line">      :current-page="page.page"</span><br><span class="line">      :total="page.total"</span><br><span class="line">      @current-change="changePage"</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br><span class="line">&lt;/el-card&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**员工列表数据请求和分页加载</p>
<h2 id="员工列表中的数据进行格式化"><a href="#员工列表中的数据进行格式化" class="headerlink" title="员工列表中的数据进行格式化"></a>员工列表中的数据进行格式化</h2><p>**<code>目标</code>**：将列表中的内容进行格式化</p>
<h3 id="利用列格式化属性处理聘用形式"><a href="#利用列格式化属性处理聘用形式" class="headerlink" title="利用列格式化属性处理聘用形式"></a>利用列格式化属性处理聘用形式</h3><p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200724001315166.png" alt="image-20200724001315166"></p>
<blockquote>
<p>上小节中，列表中的<strong>聘用形式</strong>/<strong>入职时间</strong>和<strong>账户状态</strong>需要进行显示内容的处理</p>
</blockquote>
<p>那么聘用形式中<strong>1</strong>代表什么含义，这实际上是我们需要的枚举数据，该数据的存放文件位于我们提供的**<code>资源/枚举</code><strong>中，可以将枚举下的文件夹放于</strong><code>src/api</code>**文件夹下</p>
<p>针对<strong>聘用形式</strong>，可以使用<strong>el-table-column</strong>的<strong>formatter</strong>属性进行设置</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span>    EmployeeEnum <span class="keyword">from</span> <span class="string">'@/api/constant/employees'</span></span><br><span class="line">&lt;!-- 格式化聘用形式 --&gt;</span><br><span class="line">   <span class="xml"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">"聘用形式"</span> <span class="attr">sortable</span> <span class="attr">:formatter</span>=<span class="string">"formatEmployment"</span> /&gt;</span></span></span><br><span class="line">  <span class="comment">// 格式化聘用形式</span></span><br><span class="line">   <span class="function"><span class="title">formatEmployment</span>(<span class="params">row, column, cellValue, index</span>)</span> {</span><br><span class="line">     <span class="comment">// 要去找 1所对应的值</span></span><br><span class="line">     <span class="keyword">const</span> obj = EmployeeEnum.hireType.find(<span class="function"><span class="params">item</span> =&gt;</span> item.id === cellValue)</span><br><span class="line">     <span class="keyword">return</span> obj ? obj.value : <span class="string">'未知'</span></span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="过滤器解决时间格式的处理"><a href="#过滤器解决时间格式的处理" class="headerlink" title="过滤器解决时间格式的处理"></a>过滤器解决时间格式的处理</h3><p>针对入职时间，我们可以采用<strong>作用域插槽</strong>进行处理</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column label="入职时间" sortable prop="timeOfEntry"&gt;</span><br><span class="line">           &lt;template slot-scope="obj"&gt;</span><br><span class="line">             {{</span><br><span class="line">               obj.row.timeOfEntry | 过滤器</span><br><span class="line">             }}</span><br><span class="line">           &lt;/template&gt;</span><br><span class="line"> &lt;/el-table-column&gt;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>问题来了，过滤器从哪里呢？</p>
</blockquote>
<p>在**<code>资源/过滤器</code><strong>中，我们提供了若干工具方法，我们可以将其转化成过滤器，首先将其拷贝到</strong><code>src</code>**</p>
<p>在**<code>main.js</code>**中将工具方法转化成过滤器</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> filters <span class="keyword">from</span> <span class="string">'@/filters'</span> <span class="comment">// 引入工具类</span></span><br><span class="line"><span class="comment">// 注册全局的过滤器</span></span><br><span class="line"><span class="built_in">Object</span>.keys(filters).forEach(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">  <span class="comment">// 注册过滤器</span></span><br><span class="line">  Vue.filter(key, filters[key])</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>好了，现在可以愉快的用过滤器的方式使用工具类的方法了</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column label="入职时间" sortable="" align="center"&gt;</span><br><span class="line">     &lt;!-- 作用域插槽 --&gt;</span><br><span class="line">     &lt;template slot-scope="{ row }"&gt;{{ row.timeOfEntry | formatDate }}&lt;/template&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>最后一项，账户状态，可以用开关组件switch进行显示</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column label="账户状态" align="center" sortable="" prop="enableState"&gt;</span><br><span class="line">           &lt;template slot-scope="{ row }"&gt;</span><br><span class="line">             &lt;!-- 根据当前状态来确定 是否打开开关 --&gt;</span><br><span class="line">             &lt;el-switch :value="row.enableState === 1" /&gt;</span><br><span class="line">           &lt;/template&gt;</span><br><span class="line">   &lt;/el-table-column&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 员工列表中的数据进行格式化</p>
<h2 id="删除员工功能"><a href="#删除员工功能" class="headerlink" title="删除员工功能"></a>删除员工功能</h2><p>**<code>目标</code>**实现删除员工的功能</p>
<p>首先封装 删除员工的请求</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除员工接口</span></span><br><span class="line"><span class="comment"> * ****/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">delEmployee</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/user/<span class="subst">${id}</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'delete'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>删除功能</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> &lt;template slot-scope="{ row }"&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;查看&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;转正&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;调岗&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;离职&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small"&gt;角色&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type="text" size="small" @click="deleteEmployee(row.id)"&gt;删除&lt;/el-button&gt;</span><br><span class="line">            &lt;/template&gt; </span><br><span class="line">    // 删除员工</span><br><span class="line">    async deleteEmployee(id) {</span><br><span class="line">      try {</span><br><span class="line">        await this.$confirm('您确定删除该员工吗')</span><br><span class="line">        await delEmployee(id)</span><br><span class="line">        this.getEmployeeList()</span><br><span class="line">        this.$message.success('删</span><br><span class="line">除员工成功')</span><br><span class="line">      } catch (error) {</span><br><span class="line">        console.log(error)</span><br><span class="line">      }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**： 删除员工功能</p>
<h2 id="新增员工功能-弹层-校验-部门"><a href="#新增员工功能-弹层-校验-部门" class="headerlink" title="新增员工功能-弹层-校验-部门"></a>新增员工功能-弹层-校验-部门</h2><p>**<code>目标</code>**：实现新增员工的功能</p>
<h3 id="新建员工弹层组件"><a href="#新建员工弹层组件" class="headerlink" title="新建员工弹层组件"></a>新建员工弹层组件</h3><blockquote>
<p>当我们点击新增员工时，我们需要一个类似的弹层</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200917110516195.png" alt="image-20200917110516195"></p>
<p>类似**<code>组织架构</code>**的组件，同样新建一个弹层组件 <strong><code>src/views/employees/components/add-employee.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog title="新增员工" :visible="showDialog"&gt;</span><br><span class="line">    &lt;!-- 表单 --&gt;</span><br><span class="line">    &lt;el-form label-width="120px"&gt;</span><br><span class="line">      &lt;el-form-item label="姓名"&gt;</span><br><span class="line">        &lt;el-input style="width:50%" placeholder="请输入姓名" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="手机"&gt;</span><br><span class="line">        &lt;el-input style="width:50%" placeholder="请输入手机号" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="入职时间"&gt;</span><br><span class="line">        &lt;el-date-picker style="width:50%" placeholder="请选择入职时间" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="聘用形式"&gt;</span><br><span class="line">        &lt;el-select style="width:50%" placeholder="请选择" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="工号"&gt;</span><br><span class="line">        &lt;el-input style="width:50%" placeholder="请输入工号" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="部门"&gt;</span><br><span class="line">        &lt;el-input style="width:50%" placeholder="请选择部门" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="转正时间"&gt;</span><br><span class="line">        &lt;el-date-picker style="width:50%" placeholder="请选择转正时间" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;!-- footer插槽 --&gt;</span><br><span class="line">    &lt;template v-slot:footer&gt;</span><br><span class="line">      &lt;el-row type="flex" justify="center"&gt;</span><br><span class="line">        &lt;el-col :span="6"&gt;</span><br><span class="line">          &lt;el-button size="small"&gt;取消&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type="primary" size="small"&gt;确定&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  props: {</span><br><span class="line">    showDialog: {</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="引用弹出层，点击弹出"><a href="#引用弹出层，点击弹出" class="headerlink" title="引用弹出层，点击弹出"></a>引用弹出层，点击弹出</h3><p>父组件中引用，弹出层</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import AddDemployee from './components/add-employee'</span><br><span class="line">&lt;!-- 放置新增组件 --&gt;</span><br><span class="line"> &lt;add-employee :show-dialog.sync="showDialog" /&gt;</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 放置新增组件 --&gt;</span><br><span class="line"> &lt;add-employee :show-dialog.sync="showDialog" /&gt;</span><br><span class="line"></span><br><span class="line"> &lt;el-button icon="plus" type="primary" size="small" @click="showDialog = true"&gt;新增员工&lt;/el-button&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="新增员工的表单校验"><a href="#新增员工的表单校验" class="headerlink" title="新增员工的表单校验"></a>新增员工的表单校验</h3><p><strong>封装新增员工</strong>api <strong><code>src/api/employees.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** **</span></span><br><span class="line"><span class="comment"> *  新增员工的接口</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addEmployee</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'post'</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/user'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>针对员工属性，添加校验规则</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> EmployeeEnum <span class="keyword">from</span> <span class="string">'@/api/constant/employees'</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      EmployeeEnum, <span class="comment">// 在data中定义数据</span></span><br><span class="line">      <span class="comment">// 表单数据</span></span><br><span class="line">      <span class="attr">treeData</span>: [], <span class="comment">// 定义数组接收树形数据</span></span><br><span class="line">      <span class="attr">showTree</span>: <span class="literal">false</span>, <span class="comment">// 控制树形的显示或者隐藏</span></span><br><span class="line">      <span class="attr">loading</span>: <span class="literal">false</span>, <span class="comment">// 控制树的显示或者隐藏进度条</span></span><br><span class="line">      <span class="attr">formData</span>: {</span><br><span class="line">        <span class="attr">username</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">mobile</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">formOfEmployment</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">workNumber</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">departmentName</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">timeOfEntry</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">correctionTime</span>: <span class="string">''</span></span><br><span class="line">      },</span><br><span class="line">      <span class="attr">rules</span>: {</span><br><span class="line">        <span class="attr">username</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'用户姓名不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }, {</span><br><span class="line">          <span class="attr">min</span>: <span class="number">1</span>, <span class="attr">max</span>: <span class="number">4</span>, <span class="attr">message</span>: <span class="string">'用户姓名为1-4位'</span></span><br><span class="line">        }],</span><br><span class="line">        <span class="attr">mobile</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'手机号不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }, {</span><br><span class="line">          <span class="attr">pattern</span>: <span class="regexp">/^1[3-9]\d{9}$/</span>, message: <span class="string">'手机号格式不正确'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span></span><br><span class="line">        }],</span><br><span class="line">        <span class="attr">formOfEmployment</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'聘用形式不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }],</span><br><span class="line">        <span class="attr">workNumber</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'工号不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }],</span><br><span class="line">        <span class="attr">departmentName</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'部门不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'change'</span> }],</span><br><span class="line">        <span class="attr">timeOfEntry</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'入职时间'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }]</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p>绑定数据和规则校验</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form :model="formData" :rules="rules" label-width="120px"&gt;</span><br><span class="line">  &lt;el-form-item label="姓名" prop="username"&gt;</span><br><span class="line">    &lt;el-input v-model="formData.username" style="width:50%" placeholder="请输入姓名" /&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;el-form-item label="手机" prop="mobile"&gt;</span><br><span class="line">    &lt;el-input v-model="formData.mobile" style="width:50%" placeholder="请输入手机号" /&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;el-form-item label="入职时间" prop="timeOfEntry"&gt;</span><br><span class="line">    &lt;el-date-picker v-model="formData.timeOfEntry" style="width:50%" placeholder="请选择日期" /&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;el-form-item label="聘用形式" prop="formOfEmployment"&gt;</span><br><span class="line">    &lt;el-select v-model="formData.formOfEmployment" style="width:50%" placeholder="请选择" /&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;el-form-item label="工号" prop="workNumber"&gt;</span><br><span class="line">    &lt;el-input v-model="formData.workNumber" style="width:50%" placeholder="请输入工号" /&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;el-form-item label="部门" prop="departmentName"&gt;</span><br><span class="line">    &lt;el-input v-model="formData.departmentName" style="width:50%" placeholder="请选择部门" /&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;el-form-item label="转正时间" prop="correctionTime"&gt;</span><br><span class="line">    &lt;el-date-picker v-model="formData.correctionTime" style="width:50%" placeholder="请选择日期" /&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">&lt;/el-form&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="加载部门数据转化树形"><a href="#加载部门数据转化树形" class="headerlink" title="加载部门数据转化树形"></a>加载部门数据转化树形</h3><p><strong>聘用形式和选择部门的处理</strong></p>
<blockquote>
<p> 员工的部门是从树形部门中选择一个部门</p>
</blockquote>
<p><strong>获取部门数据，转化树形</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getDepartments } <span class="keyword">from</span> <span class="string">'@/api/departments'</span></span><br><span class="line"><span class="keyword">import</span> { transListToTreeData } <span class="keyword">from</span> <span class="string">'@/utils'</span></span><br><span class="line">  data () {</span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">             <span class="comment">// 表单数据</span></span><br><span class="line">       <span class="attr">treeData</span>: [], <span class="comment">// 定义数组接收树形数据</span></span><br><span class="line">       <span class="attr">showTree</span>: <span class="literal">false</span>, <span class="comment">// 控制树形的显示或者隐藏</span></span><br><span class="line">       <span class="attr">loading</span>: <span class="literal">false</span>, <span class="comment">// 控制树的显示或者隐藏进度条</span></span><br><span class="line">      }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">      <span class="keyword">async</span> <span class="function"><span class="title">getDepartments</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.showTree = <span class="literal">true</span></span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">const</span> { depts } = <span class="keyword">await</span> getDepartments()</span><br><span class="line">      <span class="comment">// depts是数组 但不是树形</span></span><br><span class="line">      <span class="built_in">this</span>.treeData = transListToTreeData(depts, <span class="string">''</span>)</span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line">    },</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="点击部门赋值表单数据"><a href="#点击部门赋值表单数据" class="headerlink" title="点击部门赋值表单数据"></a>点击部门赋值表单数据</h3><p><strong>选择部门，赋值表单数据</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label="部门" prop="departmentName"&gt;</span><br><span class="line">        &lt;el-input v-model="formData.departmentName" style="width:50%" placeholder="请选择部门" @focus="getDepartments" /&gt;</span><br><span class="line">        &lt;!-- 放置一个tree组件 --&gt;</span><br><span class="line">        &lt;el-tree</span><br><span class="line">          v-if="showTree"</span><br><span class="line">          v-loading="loading"</span><br><span class="line">          :data="treeData"</span><br><span class="line">          default-expand-all=""</span><br><span class="line">          :props="{ label: 'name' }"</span><br><span class="line">          @node-click="selectNode"</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br></pre></td></tr></tbody></table></figure>



<p><strong>点击部门时触发</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">selectNode</span>(<span class="params">node</span>)</span> {</span><br><span class="line">  <span class="built_in">this</span>.formData.departmentName = node.name</span><br><span class="line">  <span class="built_in">this</span>.showTree = <span class="literal">false</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>聘用形式</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label="聘用形式" prop="formOfEmployment"&gt;</span><br><span class="line">    &lt;el-select v-model="formData.formOfEmployment" style="width:50%" placeholder="请选择"&gt;</span><br><span class="line">      &lt;!-- 遍历只能遍历组件的数据 --&gt;</span><br><span class="line">      &lt;el-option v-for="item in EmployeeEnum.hireType" :key="item.id" :label="item.value" :value="item.id" /&gt;</span><br><span class="line">    &lt;/el-select&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br></pre></td></tr></tbody></table></figure>



<h2 id="新增员工功能-确定-取消"><a href="#新增员工功能-确定-取消" class="headerlink" title="新增员工功能-确定-取消"></a>新增员工功能-确定-取消</h2><p><strong>调用新增接口</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击确定时 校验整个表单</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.$refs.addEmployee.validate()</span><br><span class="line">    <span class="comment">// 调用新增接口</span></span><br><span class="line">    <span class="keyword">await</span> addEmployee(<span class="built_in">this</span>.formData) <span class="comment">// 新增员工</span></span><br><span class="line">    <span class="comment">// 告诉父组件更新数据</span></span><br><span class="line">    <span class="comment">// this.$parent 可以直接调用到父组件的实例 实际上就是父组件this</span></span><br><span class="line">    <span class="comment">// this.$emit</span></span><br><span class="line">    <span class="built_in">this</span>.$parent.getEmployeeList()</span><br><span class="line">    <span class="built_in">this</span>.$parent.showDialog = <span class="literal">false</span></span><br><span class="line">  } <span class="keyword">catch</span> (error) {</span><br><span class="line">    <span class="built_in">console</span>.log(error)</span><br><span class="line">  }</span><br><span class="line">},</span><br><span class="line"><span class="function"><span class="title">btnCancel</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="comment">// 重置原来的数据</span></span><br><span class="line">  <span class="built_in">this</span>.formData = {</span><br><span class="line">    <span class="attr">username</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">mobile</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">formOfEmployment</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">workNumber</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">departmentName</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">timeOfEntry</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="attr">correctionTime</span>: <span class="string">''</span></span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">this</span>.$refs.addEmployee.resetFields() <span class="comment">// 重置校验结果</span></span><br><span class="line">  <span class="built_in">this</span>.$emit(<span class="string">'update:showDialog'</span>, <span class="literal">false</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>新增员工的功能和组织架构的功能极其类似，这里不做过多阐述</p>
</blockquote>
<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 新增员工功能和弹层</p>
<h2 id="员工导入组件封装"><a href="#员工导入组件封装" class="headerlink" title="员工导入组件封装"></a>员工导入组件封装</h2><p>**<code>目标</code>**：封装一个导入excel数据的文件</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200726005308648.png" alt="image-20200726005308648"></p>
<p>首先封装一个类似的组件，首先需要注意的是，类似功能，vue-element-admin已经提供了，我们只需要改造即可 <a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin/blob/master/src/components/UploadExcel/index.vue">代码地址</a></p>
<blockquote>
<p>类似功能性的组件，我们只需要会使用和封装即可 </p>
</blockquote>
<p>excel导入功能需要使用npm包**<code>xlsx</code><strong>，所以需要安装</strong><code>xlsx</code>**插件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i xlsx</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>将vue-element-admin提供的导入功能新建一个组件，位置： <strong><code>src/components/UploadExcel</code></strong></p>
</blockquote>
<p><strong>注册全局的导入excel组件</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PageTools <span class="keyword">from</span> <span class="string">'./PageTools'</span></span><br><span class="line"><span class="keyword">import</span> UploadExcel <span class="keyword">from</span> <span class="string">'./UploadExcel'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="function"><span class="title">install</span>(<span class="params">Vue</span>)</span> {</span><br><span class="line">    Vue.component(<span class="string">'PageTools'</span>, PageTools) <span class="comment">// 注册工具栏组件</span></span><br><span class="line">    Vue.component(<span class="string">'UploadExcel'</span>, UploadExcel) <span class="comment">// 注册导入excel组件</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>修改样式和布局</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div class="upload-excel"&gt;</span><br><span class="line">    &lt;div class="btn-upload"&gt;</span><br><span class="line">      &lt;el-button :loading="loading" size="mini" type="primary" @click="handleUpload"&gt;</span><br><span class="line">        点击上传</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input ref="excel-upload-input" class="excel-upload-input" type="file" accept=".xlsx, .xls" @change="handleClick"&gt;</span><br><span class="line">    &lt;div class="drop" @drop="handleDrop" @dragover="handleDragover" @dragenter="handleDragover"&gt;</span><br><span class="line">      &lt;i class="el-icon-upload" /&gt;</span><br><span class="line">      &lt;span&gt;将文件拖到此处&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style scoped lang="scss"&gt;</span><br><span class="line">.upload-excel {</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: center;</span><br><span class="line">   margin-top: 100px;</span><br><span class="line">   .excel-upload-input{</span><br><span class="line">       display: none;</span><br><span class="line">        z-index: -9999;</span><br><span class="line">     }</span><br><span class="line">   .btn-upload , .drop{</span><br><span class="line">      border: 1px dashed #bbb;</span><br><span class="line">      width: 350px;</span><br><span class="line">      height: 160px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      line-height: 160px;</span><br><span class="line">   }</span><br><span class="line">   .drop{</span><br><span class="line">       line-height: 80px;</span><br><span class="line">       color: #bbb;</span><br><span class="line">      i {</span><br><span class="line">        font-size: 60px;</span><br><span class="line">        display: block;</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**：员工导入组件封装</p>
<h2 id="员工的导入"><a href="#员工的导入" class="headerlink" title="员工的导入"></a>员工的导入</h2><p>**<code>目标</code>**：实现员工的导入</p>
<h3 id="建立公共导入的页面路由"><a href="#建立公共导入的页面路由" class="headerlink" title="建立公共导入的页面路由"></a>建立公共导入的页面路由</h3><p><strong>新建一个公共的导入页面，挂载路由</strong> <strong><code>src/router/index.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">path</span>: <span class="string">'/import'</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">hidden</span>: <span class="literal">true</span>, <span class="comment">// 隐藏在左侧菜单中</span></span><br><span class="line">    <span class="attr">children</span>: [{</span><br><span class="line">      <span class="attr">path</span>: <span class="string">''</span>, <span class="comment">// 二级路由path什么都不写 表示二级默认路由</span></span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/import'</span>)</span><br><span class="line">    }]</span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>

<p><strong>创建import路由组件</strong> <strong><code>src/views/import/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 公共导入组件 --&gt; </span><br><span class="line">  &lt;upload-excel :on-success="success" /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="分析excel导入代码，封装接口"><a href="#分析excel导入代码，封装接口" class="headerlink" title="分析excel导入代码，封装接口"></a>分析excel导入代码，封装接口</h3><blockquote>
<p>封装导入员工的api接口  </p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> *  封装一个导入员工的接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">importEmployee</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/user/batch'</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'post'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="实现excel导入"><a href="#实现excel导入" class="headerlink" title="实现excel导入"></a>实现excel导入</h3><p><strong>获取导入的excel数据, 导入excel接口</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span>  <span class="function"><span class="title">success</span>(<span class="params">{ header, results }</span>)</span> {</span><br><span class="line">  <span class="comment">// 如果是导入员工</span></span><br><span class="line">    <span class="keyword">const</span> userRelations = {</span><br><span class="line">      <span class="string">'入职日期'</span>: <span class="string">'timeOfEntry'</span>,</span><br><span class="line">      <span class="string">'手机号'</span>: <span class="string">'mobile'</span>,</span><br><span class="line">      <span class="string">'姓名'</span>: <span class="string">'username'</span>,</span><br><span class="line">      <span class="string">'转正日期'</span>: <span class="string">'correctionTime'</span>,</span><br><span class="line">      <span class="string">'工号'</span>: <span class="string">'workNumber'</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">const</span> arr = []</span><br><span class="line">   results.forEach(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">      <span class="keyword">const</span> userInfo = {}</span><br><span class="line">      <span class="built_in">Object</span>.keys(item).forEach(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">        userInfo[userRelations[key]] = item[key]</span><br><span class="line">      })</span><br><span class="line">     arr.push(userInfo) </span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">await</span> importEmployee(arr) <span class="comment">// 调用导入接口</span></span><br><span class="line">    <span class="built_in">this</span>.$router.back()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>为了让这个页面可以服务更多的导入功能，我们可以在页面中用参数来判断，是否是导入员工</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">   <span class="keyword">return</span> {</span><br><span class="line">     <span class="attr">type</span>: <span class="built_in">this</span>.$route.query.type</span><br><span class="line">   }</span><br><span class="line"> },</span><br></pre></td></tr></tbody></table></figure>

<p>当excel中有日期格式的时候，实际转化的值为一个数字，我们需要一个方法进行转化</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">formatDate</span>(<span class="params">numb, format</span>)</span> {</span><br><span class="line">  <span class="keyword">const</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>((numb - <span class="number">1</span>) * <span class="number">24</span> * <span class="number">3600000</span> + <span class="number">1</span>)</span><br><span class="line">  time.setYear(time.getFullYear() - <span class="number">70</span>)</span><br><span class="line">  <span class="keyword">const</span> year = time.getFullYear() + <span class="string">''</span></span><br><span class="line">  <span class="keyword">const</span> month = time.getMonth() + <span class="number">1</span> + <span class="string">''</span></span><br><span class="line">  <span class="keyword">const</span> date = time.getDate() - <span class="number">1</span> + <span class="string">''</span></span><br><span class="line">  <span class="keyword">if</span> (format &amp;&amp; format.length === <span class="number">1</span>) {</span><br><span class="line">    <span class="keyword">return</span> year + format + month + format + date</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> year + (month &lt; <span class="number">10</span> ? <span class="string">'0'</span> + month : month) + (date &lt; <span class="number">10</span> ? <span class="string">'0'</span> + date : date)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>需要注意，**<code>导入的手机号不能和之前的存在的手机号重复</code>**</p>
</blockquote>
<p><strong>逻辑判断</strong> </p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span>  <span class="function"><span class="title">success</span>(<span class="params">{ header, results }</span>)</span> {</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.type === <span class="string">'user'</span>) {</span><br><span class="line">       <span class="keyword">const</span> userRelations = {</span><br><span class="line">         <span class="string">'入职日期'</span>: <span class="string">'timeOfEntry'</span>,</span><br><span class="line">         <span class="string">'手机号'</span>: <span class="string">'mobile'</span>,</span><br><span class="line">         <span class="string">'姓名'</span>: <span class="string">'username'</span>,</span><br><span class="line">         <span class="string">'转正日期'</span>: <span class="string">'correctionTime'</span>,</span><br><span class="line">         <span class="string">'工号'</span>: <span class="string">'workNumber'</span></span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">const</span> arr = []</span><br><span class="line">       <span class="comment">// 遍历所有的数组</span></span><br><span class="line">       results.forEach(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">       <span class="comment">// 需要将每一个条数据里面的中文都换成英文</span></span><br><span class="line">         <span class="keyword">const</span> userInfo = {}</span><br><span class="line">         <span class="built_in">Object</span>.keys(item).forEach(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">         <span class="comment">// key是当前的中文名 找到对应的英文名</span></span><br><span class="line">           <span class="keyword">if</span> (userRelations[key] === <span class="string">'timeOfEntry'</span> || userRelations[key] === <span class="string">'correctionTime'</span>) {</span><br><span class="line">             userInfo[userRelations[key]] = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">this</span>.formatDate(item[key], <span class="string">'/'</span>)) <span class="comment">// 只有这样, 才能入库</span></span><br><span class="line">             <span class="keyword">return</span></span><br><span class="line">           }</span><br><span class="line">           userInfo[userRelations[key]] = item[key]</span><br><span class="line">         })</span><br><span class="line">         <span class="comment">// 最终userInfo变成了全是英文</span></span><br><span class="line">         arr.push(userInfo)</span><br><span class="line">       })</span><br><span class="line">       <span class="keyword">await</span> importEmployee(arr)</span><br><span class="line">       <span class="built_in">this</span>.$message.success(<span class="string">'导入成功'</span>)</span><br><span class="line">     }</span><br><span class="line">     <span class="built_in">this</span>.$router.back() <span class="comment">// 回到上一页</span></span><br><span class="line">   },</span><br><span class="line">   <span class="function"><span class="title">formatDate</span>(<span class="params">numb, format</span>)</span> {</span><br><span class="line">     <span class="keyword">const</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>((numb - <span class="number">1</span>) * <span class="number">24</span> * <span class="number">3600000</span> + <span class="number">1</span>)</span><br><span class="line">     time.setYear(time.getFullYear() - <span class="number">70</span>)</span><br><span class="line">     <span class="keyword">const</span> year = time.getFullYear() + <span class="string">''</span></span><br><span class="line">     <span class="keyword">const</span> month = time.getMonth() + <span class="number">1</span> + <span class="string">''</span></span><br><span class="line">     <span class="keyword">const</span> date = time.getDate() - <span class="number">1</span> + <span class="string">''</span></span><br><span class="line">     <span class="keyword">if</span> (format &amp;&amp; format.length === <span class="number">1</span>) {</span><br><span class="line">       <span class="keyword">return</span> year + format + month + format + date</span><br><span class="line">     }</span><br><span class="line">     <span class="keyword">return</span> year + (month &lt; <span class="number">10</span> ? <span class="string">'0'</span> + month : month) + (date &lt; <span class="number">10</span> ? <span class="string">'0'</span> + date : date)</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>员工页面跳转</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type="warning" size="small" @click="$router.push('/import?type=user')"&gt;导入&lt;/el-button&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>**<code>目标</code>**： 实现员工的导入</p>
<h2 id="员工导出excel功能"><a href="#员工导出excel功能" class="headerlink" title="员工导出excel功能"></a>员工导出excel功能</h2><p><strong>目标</strong>： 实现将员工数据导出功能</p>
<blockquote>
<p>日常业务中，我们经常遇到excel导出功能， 怎么使用呢</p>
</blockquote>
<p>Excel 的导入导出都是依赖于<a target="_blank" rel="noopener" href="https://github.com/SheetJS/js-xlsx">js-xlsx</a>来实现的。</p>
<p>在 <code>js-xlsx</code>的基础上又封装了<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin/blob/master/src/vendor/Export2Excel.js">Export2Excel.js</a>来方便导出数据。</p>
<h3 id="安装excel所需依赖和按需加载"><a href="#安装excel所需依赖和按需加载" class="headerlink" title="安装excel所需依赖和按需加载"></a>安装excel所需依赖和按需加载</h3><p>由于 <code>Export2Excel</code>不仅依赖<code>js-xlsx</code>还依赖<code>file-saver</code>和<code>script-loader</code>。</p>
<p>所以你先需要安装如下命令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install xlsx file-saver -S</span><br><span class="line">npm install script-loader -S -D</span><br></pre></td></tr></tbody></table></figure>

<p>由于<code>js-xlsx</code>体积还是很大的，导出功能也不是一个非常常用的功能，所以使用的时候建议使用懒加载。使用方法如下：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">'@/vendor/Export2Excel'</span>).then(<span class="function"><span class="params">excel</span> =&gt;</span> {</span><br><span class="line">  excel.export_json_to_excel({</span><br><span class="line">    <span class="attr">header</span>: tHeader, <span class="comment">//表头 必填</span></span><br><span class="line">    data, <span class="comment">//具体数据 必填</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">'excel-list'</span>, <span class="comment">//非必填</span></span><br><span class="line">    <span class="attr">autoWidth</span>: <span class="literal">true</span>, <span class="comment">//非必填</span></span><br><span class="line">    <span class="attr">bookType</span>: <span class="string">'xlsx'</span> <span class="comment">//非必填</span></span><br><span class="line">  })</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<h3 id="excel导出参数的介绍"><a href="#excel导出参数的介绍" class="headerlink" title="excel导出参数的介绍"></a>excel导出参数的介绍</h3><blockquote>
<p>vue-element-admin提供了导出的功能模块，在课程资源/excel导出目录下，放置到src目录下</p>
</blockquote>
<p><strong>参数</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>可选值</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>header</td>
<td>导出数据的表头</td>
<td>Array</td>
<td>/</td>
<td>[]</td>
</tr>
<tr>
<td>data</td>
<td>导出的具体数据</td>
<td>Array</td>
<td>/</td>
<td>[[]]</td>
</tr>
<tr>
<td>filename</td>
<td>导出文件名</td>
<td>String</td>
<td>/</td>
<td>excel-list</td>
</tr>
<tr>
<td>autoWidth</td>
<td>单元格是否要自适应宽度</td>
<td>Boolean</td>
<td>true / false</td>
<td>true</td>
</tr>
<tr>
<td>bookType</td>
<td>导出文件类型</td>
<td>String</td>
<td>xlsx, csv, txt, <a target="_blank" rel="noopener" href="https://github.com/SheetJS/js-xlsx#supported-output-formats">more</a></td>
<td>xlsx</td>
</tr>
</tbody></table>
<h3 id="excel导出基本的结构"><a href="#excel导出基本的结构" class="headerlink" title="excel导出基本的结构"></a>excel导出基本的结构</h3><blockquote>
<p>我们最重要的一件事，就是把表头和数据进行相应的对应</p>
</blockquote>
<p>因为数据中的key是英文，想要导出的表头是中文的话，需要将中文和英文做对应</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> headers = {</span><br><span class="line">     <span class="string">'手机号'</span>: <span class="string">'mobile'</span>,</span><br><span class="line">     <span class="string">'姓名'</span>: <span class="string">'username'</span>,</span><br><span class="line">     <span class="string">'入职日期'</span>: <span class="string">'timeOfEntry'</span>,</span><br><span class="line">     <span class="string">'聘用形式'</span>: <span class="string">'formOfEmployment'</span>,</span><br><span class="line">     <span class="string">'转正日期'</span>: <span class="string">'correctionTime'</span>,</span><br><span class="line">     <span class="string">'工号'</span>: <span class="string">'workNumber'</span>,</span><br><span class="line">     <span class="string">'部门'</span>: <span class="string">'departmentName'</span></span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<p>然后，<strong>完成导出代码</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出excel数据</span></span><br><span class="line"><span class="function"><span class="title">exportData</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="comment">//  做操作</span></span><br><span class="line">  <span class="comment">// 表头对应关系</span></span><br><span class="line">  <span class="keyword">const</span> headers = {</span><br><span class="line">    <span class="string">'姓名'</span>: <span class="string">'username'</span>,</span><br><span class="line">    <span class="string">'手机号'</span>: <span class="string">'mobile'</span>,</span><br><span class="line">    <span class="string">'入职日期'</span>: <span class="string">'timeOfEntry'</span>,</span><br><span class="line">    <span class="string">'聘用形式'</span>: <span class="string">'formOfEmployment'</span>,</span><br><span class="line">    <span class="string">'转正日期'</span>: <span class="string">'correctionTime'</span>,</span><br><span class="line">    <span class="string">'工号'</span>: <span class="string">'workNumber'</span>,</span><br><span class="line">    <span class="string">'部门'</span>: <span class="string">'departmentName'</span></span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 懒加载</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="string">'@/vendor/Export2Excel'</span>).then(<span class="keyword">async</span> excel =&gt; {</span><br><span class="line">    <span class="keyword">const</span> { rows } = <span class="keyword">await</span> getEmployeeList({ <span class="attr">page</span>: <span class="number">1</span>, <span class="attr">size</span>: <span class="built_in">this</span>.page.total })</span><br><span class="line">    <span class="keyword">const</span> data = <span class="built_in">this</span>.formatJson(headers, rows)</span><br><span class="line"></span><br><span class="line">    excel.export_json_to_excel({</span><br><span class="line">      <span class="attr">header</span>: <span class="built_in">Object</span>.keys(headers),</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">'员工信息表'</span>,</span><br><span class="line">      <span class="attr">autoWidth</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">bookType</span>: <span class="string">'xlsx'</span></span><br><span class="line"></span><br><span class="line">    })</span><br><span class="line">    <span class="comment">// 获取所有的数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// excel.export_json_to_excel({</span></span><br><span class="line">    <span class="comment">//   header: ['姓名', '薪资'],</span></span><br><span class="line">    <span class="comment">//   data: [['张三', 12000], ['李四', 5000]],</span></span><br><span class="line">    <span class="comment">//   filename: '员工薪资表',</span></span><br><span class="line">    <span class="comment">//   autoWidth: true,</span></span><br><span class="line">    <span class="comment">//   bookType: 'csv'</span></span><br><span class="line">    <span class="comment">// })</span></span><br><span class="line">  })</span><br><span class="line">},</span><br><span class="line"><span class="comment">// 该方法负责将数组转化成二维数组</span></span><br><span class="line"><span class="function"><span class="title">formatJson</span>(<span class="params">headers, rows</span>)</span> {</span><br><span class="line">  <span class="comment">// 首先遍历数组</span></span><br><span class="line">  <span class="comment">// [{ username: '张三'},{},{}]  =&gt; [[’张三'],[],[]]</span></span><br><span class="line">  <span class="keyword">return</span> rows.map(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.keys(headers).map(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">      <span class="keyword">if</span> (headers[key] === <span class="string">'timeOfEntry'</span> || headers[key] === <span class="string">'correctionTime'</span>) {</span><br><span class="line">        <span class="keyword">return</span> formatDate(item[headers[key]]) <span class="comment">// 返回格式化之前的时间</span></span><br><span class="line">      } <span class="keyword">else</span> <span class="keyword">if</span> (headers[key] === <span class="string">'formOfEmployment'</span>) {</span><br><span class="line">        <span class="keyword">var</span> en = EmployeeEnum.hireType.find(<span class="function"><span class="params">obj</span> =&gt;</span> obj.id === item[headers[key]])</span><br><span class="line">        <span class="keyword">return</span> en ? en.value : <span class="string">'未知'</span></span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> item[headers[key]]</span><br><span class="line">    }) <span class="comment">// =&gt; ["张三", "13811"，"2018","1", "2018", "10002"]</span></span><br><span class="line">  })</span><br><span class="line">  <span class="comment">// return data</span></span><br><span class="line">  <span class="comment">// return rows.map(item =&gt; {</span></span><br><span class="line">  <span class="comment">//   // item是对象  =&gt; 转化成只有值的数组 =&gt; 数组值的顺序依赖headers  {username: '张三'  }</span></span><br><span class="line">  <span class="comment">//   // Object.keys(headers)  =&gt; ["姓名", "手机号",...]</span></span><br><span class="line">  <span class="comment">//   return Object.keys(headers).map(key =&gt; {</span></span><br><span class="line">  <span class="comment">//     return item[headers[key]]</span></span><br><span class="line">  <span class="comment">//   }) // /  得到 ['张三'，’129‘，’dd‘,'dd']</span></span><br><span class="line">  <span class="comment">// })</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="导出时间格式的处理"><a href="#导出时间格式的处理" class="headerlink" title="导出时间格式的处理"></a>导出时间格式的处理</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">formatJson</span>(<span class="params">headers, rows</span>)</span> {</span><br><span class="line">  <span class="keyword">return</span> rows.map(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">    <span class="comment">// item是一个对象  { mobile: 132111,username: '张三'  }</span></span><br><span class="line">    <span class="comment">// ["手机号", "姓名", "入职日期" 。。]</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.keys(headers).map(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">      <span class="comment">// 需要判断 字段</span></span><br><span class="line">      <span class="keyword">if</span> (headers[key] === <span class="string">'timeOfEntry'</span> || headers[key] === <span class="string">'correctionTime'</span>) {</span><br><span class="line">        <span class="comment">// 格式化日期</span></span><br><span class="line">        <span class="keyword">return</span> formatDate(item[headers[key]])</span><br><span class="line">      } <span class="keyword">else</span> <span class="keyword">if</span> (headers[key] === <span class="string">'formOfEmployment'</span>) {</span><br><span class="line">        <span class="keyword">const</span> obj = EmployeeEnum.hireType.find(<span class="function"><span class="params">obj</span> =&gt;</span> obj.id === item[headers[key]])</span><br><span class="line">        <span class="keyword">return</span> obj ? obj.value : <span class="string">'未知'</span></span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> item[headers[key]]</span><br><span class="line">    })</span><br><span class="line">    <span class="comment">// ["132", '张三’， ‘’，‘’，‘’d]</span></span><br><span class="line">  })</span><br><span class="line">  <span class="comment">// return rows.map(item =&gt; Object.keys(headers).map(key =&gt; item[headers[key]]))</span></span><br><span class="line">  <span class="comment">// 需要处理时间格式问题</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="扩展-复杂表头的导出"><a href="#扩展-复杂表头的导出" class="headerlink" title="扩展  复杂表头的导出"></a><strong><code>扩展</code></strong>  复杂表头的导出</h3><blockquote>
<p>当需要导出复杂表头的时候，vue-element-admin同样支持该类操作</p>
</blockquote>
<p><strong>vue-element-admin</strong> 提供的导出方法中有 <strong>multiHeader</strong>和<strong>merges</strong> 的参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>可选值</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>multiHeader</td>
<td>复杂表头的部分</td>
<td>Array</td>
<td>/</td>
<td>[[]]</td>
</tr>
<tr>
<td>merges</td>
<td>需要合并的部分</td>
<td>Array</td>
<td>/</td>
<td>[]</td>
</tr>
</tbody></table>
<p>multiHeader里面是一个二维数组，里面的一个元素是一行表头，假设你想得到一个如图的结构</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20201014152302636.png" alt="image-20201014152302636"></p>
<p>mutiHeader应该这样定义</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multiHeader = [[<span class="string">'姓名'</span>, <span class="string">'主要信息'</span>, <span class="string">''</span>, <span class="string">''</span>, <span class="string">''</span>, <span class="string">''</span>, <span class="string">'部门'</span>]]</span><br></pre></td></tr></tbody></table></figure>

<p>multiHeader中的一行表头中的字段的个数需要和真正的列数相等，假设想要跨列，多余的空间需要定义成空串</p>
<p>它主要对应的是标准的表头</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> header = [<span class="string">'姓名'</span>, <span class="string">'手机号'</span>, <span class="string">'入职日期'</span>, <span class="string">'聘用形式'</span>, <span class="string">'转正日期'</span>, <span class="string">'工号'</span>, <span class="string">'部门'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>如果，我们要实现其合并的效果， 需要设定merges选项</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merges = [<span class="string">'A1:A2'</span>, <span class="string">'B1:F1'</span>, <span class="string">'G1:G2'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>merges的顺序是没关系的，只要配置这两个属性，就可以导出复杂表头的excel了</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">exportData</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">const</span> headers = {</span><br><span class="line">      <span class="string">'姓名'</span>: <span class="string">'username'</span>,</span><br><span class="line">      <span class="string">'手机号'</span>: <span class="string">'mobile'</span>,</span><br><span class="line">      <span class="string">'入职日期'</span>: <span class="string">'timeOfEntry'</span>,</span><br><span class="line">      <span class="string">'聘用形式'</span>: <span class="string">'formOfEmployment'</span>,</span><br><span class="line">      <span class="string">'转正日期'</span>: <span class="string">'correctionTime'</span>,</span><br><span class="line">      <span class="string">'工号'</span>: <span class="string">'workNumber'</span>,</span><br><span class="line">      <span class="string">'部门'</span>: <span class="string">'departmentName'</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 导出excel</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="string">'@/vendor/Export2Excel'</span>).then(<span class="keyword">async</span> excel =&gt; {</span><br><span class="line">      <span class="comment">//  excel是引入文件的导出对象</span></span><br><span class="line">      <span class="comment">// 导出  header从哪里来</span></span><br><span class="line">      <span class="comment">// data从哪里来</span></span><br><span class="line">      <span class="comment">// 现在没有一个接口获取所有的数据</span></span><br><span class="line">      <span class="comment">// 获取员工的接口 页码 每页条数    100   1 10000</span></span><br><span class="line">      <span class="keyword">const</span> { rows } = <span class="keyword">await</span> getEmployeeList({ <span class="attr">page</span>: <span class="number">1</span>, <span class="attr">size</span>: <span class="built_in">this</span>.page.total })</span><br><span class="line">      <span class="keyword">const</span> data = <span class="built_in">this</span>.formatJson(headers, rows) <span class="comment">// 返回的data就是 要导出的结构</span></span><br><span class="line">      <span class="keyword">const</span> multiHeader = [[<span class="string">'姓名'</span>, <span class="string">'主要信息'</span>, <span class="string">''</span>, <span class="string">''</span>, <span class="string">''</span>, <span class="string">''</span>, <span class="string">'部门'</span>]]</span><br><span class="line">      <span class="keyword">const</span> merges = [<span class="string">'A1:A2'</span>, <span class="string">'B1:F1'</span>, <span class="string">'G1:G2'</span>]</span><br><span class="line">      excel.export_json_to_excel({</span><br><span class="line">        <span class="attr">header</span>: <span class="built_in">Object</span>.keys(headers),</span><br><span class="line">        data,</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">'员工资料表'</span>,</span><br><span class="line">        multiHeader, <span class="comment">// 复杂表头</span></span><br><span class="line">        merges <span class="comment">// 合并选项</span></span><br><span class="line">      })</span><br><span class="line"></span><br><span class="line">      <span class="comment">// excel.export_json_to_excel({</span></span><br><span class="line">      <span class="comment">//   header: ['姓名', '工资'],</span></span><br><span class="line">      <span class="comment">//   data: [['张三', 3000], ['李四', 5000]],</span></span><br><span class="line">      <span class="comment">//   filename: '员工工资表'</span></span><br><span class="line">      <span class="comment">// })</span></span><br><span class="line">      <span class="comment">// [{ username: '张三',mobile: 13112345678 }]  =&gt; [[]]</span></span><br><span class="line">      <span class="comment">// 要转化 数据结构 还要和表头的顺序对应上</span></span><br><span class="line">      <span class="comment">// 要求转出的标题是中文</span></span><br><span class="line">    })</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 将表头数据和数据进行对应</span></span><br><span class="line">  <span class="comment">// [{}]  =&gt;   [[]]</span></span><br><span class="line">  <span class="function"><span class="title">formatJson</span>(<span class="params">headers, rows</span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> rows.map(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">      <span class="comment">// item是一个对象  { mobile: 132111,username: '张三'  }</span></span><br><span class="line">      <span class="comment">// ["手机号", "姓名", "入职日期" 。。]</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.keys(headers).map(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">        <span class="comment">// 需要判断 字段</span></span><br><span class="line">        <span class="keyword">if</span> (headers[key] === <span class="string">'timeOfEntry'</span> || headers[key] === <span class="string">'correctionTime'</span>) {</span><br><span class="line">          <span class="comment">// 格式化日期</span></span><br><span class="line">          <span class="keyword">return</span> formatDate(item[headers[key]])</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (headers[key] === <span class="string">'formOfEmployment'</span>) {</span><br><span class="line">          <span class="keyword">const</span> obj = EmployeeEnum.hireType.find(<span class="function"><span class="params">obj</span> =&gt;</span> obj.id === item[headers[key]])</span><br><span class="line">          <span class="keyword">return</span> obj ? obj.value : <span class="string">'未知'</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> item[headers[key]]</span><br><span class="line">      })</span><br><span class="line">      <span class="comment">// ["132", '张三’， ‘’，‘’，‘’d]</span></span><br><span class="line">    })</span><br><span class="line">    <span class="comment">// return rows.map(item =&gt; Object.keys(headers).map(key =&gt; item[headers[key]]))</span></span><br><span class="line">    <span class="comment">// 需要处理时间格式问题</span></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**实现将员工数据导出功能</p>
<h2 id="员工详情页创建和布局"><a href="#员工详情页创建和布局" class="headerlink" title="员工详情页创建和布局"></a>员工详情页创建和布局</h2><p>**<code>目标</code>**：创建员工详情的主要布局页面和基本布局</p>
<h3 id="详情页的基本布局和路由"><a href="#详情页的基本布局和路由" class="headerlink" title="详情页的基本布局和路由"></a>详情页的基本布局和路由</h3><p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200726130305221.png" alt="image-20200726130305221"></p>
<p><strong>建立详情页路由</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">path</span>: <span class="string">'detail/:id'</span>, <span class="comment">// query传参 动态路由传参</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/employees/detail'</span>),</span><br><span class="line">    <span class="attr">hidden</span>: <span class="literal">true</span>, <span class="comment">// 不在左侧菜单显示</span></span><br><span class="line">    <span class="attr">meta</span>: {</span><br><span class="line">      <span class="attr">title</span>: <span class="string">'员工详情'</span> <span class="comment">// 标记当前路由规则的中文名称 后续在做左侧菜单时 使用</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>建立基本架构</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="dashboard-container"&gt;</span><br><span class="line">    &lt;div class="app-container"&gt;</span><br><span class="line">      &lt;el-card&gt;</span><br><span class="line">        &lt;el-tabs&gt;</span><br><span class="line">          &lt;el-tab-pane label="登录账户设置"&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 放置表单 --&gt;</span><br><span class="line">            &lt;el-form label-width="120px" style="margin-left: 120px; margin-top:30px"&gt;</span><br><span class="line">              &lt;el-form-item label="姓名:"&gt;</span><br><span class="line">                &lt;el-input style="width:300px" /&gt;</span><br><span class="line">              &lt;/el-form-item&gt;</span><br><span class="line">              &lt;el-form-item label="密码:"&gt;</span><br><span class="line">                &lt;el-input style="width:300px" type="password" /&gt;</span><br><span class="line">              &lt;/el-form-item&gt;</span><br><span class="line">              &lt;el-form-item&gt;</span><br><span class="line">                &lt;el-button type="primary"&gt;更新&lt;/el-button&gt;</span><br><span class="line">              &lt;/el-form-item&gt;</span><br><span class="line">            &lt;/el-form&gt;</span><br><span class="line">          &lt;/el-tab-pane&gt;</span><br><span class="line">          &lt;el-tab-pane label="个人详情" /&gt;</span><br><span class="line">          &lt;el-tab-pane label="岗位信息" /&gt;</span><br><span class="line">        &lt;/el-tabs&gt;</span><br><span class="line">      &lt;/el-card&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>列表跳转到详情</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type="text" size="small" @click="$router.push(`/employees/detail/${obj.row.id}`)"&gt;查看&lt;/el-button&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="读取和保存用户信息的接口"><a href="#读取和保存用户信息的接口" class="headerlink" title="读取和保存用户信息的接口"></a>读取和保存用户信息的接口</h3><p><strong>加载个人基本信息</strong> &gt; 该接口已经在之前提供过了 <strong><code>src/api/user.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> *  获取某个用户的基本信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserDetailById</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/user/<span class="subst">${id}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>保存个人基本信息</strong>  <strong><code>src/api/employees.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 保存员工的基本信息</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">saveUserDetailById</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/user/<span class="subst">${data.id}</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'put'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="实现用户名和密码的修改"><a href="#实现用户名和密码的修改" class="headerlink" title="实现用户名和密码的修改"></a>实现用户名和密码的修改</h3><p><strong><code>注意</code><strong>：这里有个缺陷，接口中读取的是后端的密文，我们并不能解密，所以当我们没有任何修改就保存时，会校验失败，因为密文超过了规定的12位长度，为了真的修改密码，我们设定了一个临时的字段 <strong>password2</strong>，用它来存储我们的修改值，最后保存的时候，把</strong>password2</strong>传给<strong>password</strong></p>
<p><strong>用户名和密码的修改</strong>  <strong><code>src/views/employees/detail.vue</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getUserDetailById } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span><br><span class="line"><span class="keyword">import</span> { saveUserDetailById } <span class="keyword">from</span> <span class="string">'@/api/employees'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">userId</span>: <span class="built_in">this</span>.$route.params.id, <span class="comment">// 这样可以后面直接通过 this.userId进行获取数据</span></span><br><span class="line">      <span class="attr">userInfo</span>: {</span><br><span class="line">        <span class="comment">//   专门存放基本信息</span></span><br><span class="line">        <span class="attr">username</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">password2</span>: <span class="string">''</span></span><br><span class="line">      },</span><br><span class="line">      <span class="attr">rules</span>: {</span><br><span class="line">        <span class="attr">username</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'姓名不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }],</span><br><span class="line">        <span class="attr">password2</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'密码不能为空'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> },</span><br><span class="line">          { <span class="attr">min</span>: <span class="number">6</span>, <span class="attr">max</span>: <span class="number">9</span>, <span class="attr">message</span>: <span class="string">'密码长度6-9位'</span>, <span class="attr">trigger</span>: <span class="string">'blur'</span> }]</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="built_in">this</span>.getUserDetailById()</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getUserDetailById</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.userInfo = <span class="keyword">await</span> getUserDetailById(<span class="built_in">this</span>.userId)</span><br><span class="line">    },</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">saveUser</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">// 校验</span></span><br><span class="line">        <span class="keyword">await</span> <span class="built_in">this</span>.$refs.userForm.validate()</span><br><span class="line">        <span class="keyword">await</span> saveUserDetailById({ ...this.userInfo, <span class="attr">password</span>: <span class="built_in">this</span>.userInfo.password2 }) <span class="comment">// 将新密码的值替换原密码的值</span></span><br><span class="line">        <span class="built_in">this</span>.$message.success(<span class="string">'保存成功'</span>)</span><br><span class="line">      } <span class="keyword">catch</span> (error) {</span><br><span class="line">        <span class="built_in">console</span>.log(error)</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>绑定表单数据</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 放置表单 --&gt;</span><br><span class="line">           &lt;el-form ref="userForm" :model="userInfo" :rules="rules" label-width="120px" style="margin-left: 120px; margin-top:30px"&gt;</span><br><span class="line">             &lt;el-form-item label="姓名:" prop="username"&gt;</span><br><span class="line">               &lt;el-input v-model="userInfo.username" style="width:300px" /&gt;</span><br><span class="line">             &lt;/el-form-item&gt;</span><br><span class="line">             &lt;el-form-item label="新密码:" prop="password2"&gt;</span><br><span class="line">               &lt;el-input v-model="userInfo.password2" style="width:300px" type="password" /&gt;</span><br><span class="line">             &lt;/el-form-item&gt;</span><br><span class="line">             &lt;el-form-item&gt;</span><br><span class="line">               &lt;el-button type="primary" @click="saveUser"&gt;更新&lt;/el-button&gt;</span><br><span class="line">             &lt;/el-form-item&gt;</span><br><span class="line">           &lt;/el-form&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<h2 id="个人组件和岗位组件封装"><a href="#个人组件和岗位组件封装" class="headerlink" title="个人组件和岗位组件封装"></a>个人组件和岗位组件封装</h2><h3 id="封装个人详情组件"><a href="#封装个人详情组件" class="headerlink" title="封装个人详情组件"></a>封装个人详情组件</h3><blockquote>
<p>我们将员工个人信息分为三部分，账户，个人， 岗位，这个小节我们对个人组件和岗位组件进行封装</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200901105323305.png" alt="image-20200901105323305"></p>
<p><strong>封装个人组件</strong>   <strong><code>src/views/employees/components/user-info.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="user-info"&gt;</span><br><span class="line">    &lt;!-- 个人信息 --&gt;</span><br><span class="line">    &lt;el-form label-width="220px"&gt;</span><br><span class="line">      &lt;!-- 工号 入职时间 --&gt;</span><br><span class="line">      &lt;el-row class="inline-info"&gt;</span><br><span class="line">        &lt;el-col :span="12"&gt;</span><br><span class="line">          &lt;el-form-item label="工号"&gt;</span><br><span class="line">            &lt;el-input v-model="userInfo.workNumber" class="inputW" /&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">        &lt;el-col :span="12"&gt;</span><br><span class="line">          &lt;el-form-item label="入职时间"&gt;</span><br><span class="line">            &lt;el-date-picker</span><br><span class="line">              v-model="userInfo.timeOfEntry"</span><br><span class="line">              type="date"</span><br><span class="line">              class="inputW"</span><br><span class="line">              value-format="YYYY-MM-DD"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">      &lt;!-- 姓名 部门 --&gt;</span><br><span class="line">      &lt;el-row class="inline-info"&gt;</span><br><span class="line">        &lt;el-col :span="12"&gt;</span><br><span class="line">          &lt;el-form-item label="姓名"&gt;</span><br><span class="line">            &lt;el-input v-model="userInfo.username" class="inputW" /&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">        &lt;el-col :span="12"&gt;</span><br><span class="line">          &lt;el-form-item label="部门"&gt;</span><br><span class="line">            &lt;el-input v-model="userInfo.departmentName" class="inputW" /&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">      &lt;!--手机 聘用形式  --&gt;</span><br><span class="line">      &lt;el-row class="inline-info"&gt;</span><br><span class="line">        &lt;el-col :span="12"&gt;</span><br><span class="line">          &lt;el-form-item label="手机"&gt;</span><br><span class="line">            &lt;el-input v-model="userInfo.mobile" /&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">        &lt;el-col :span="12"&gt;</span><br><span class="line">          &lt;el-form-item label="聘用形式"&gt;</span><br><span class="line">            &lt;el-select v-model="userInfo.formOfEmployment" class="inputW"&gt;</span><br><span class="line">              &lt;el-option</span><br><span class="line">                v-for="item in EmployeeEnum.hireType"</span><br><span class="line">                :key="item.id"</span><br><span class="line">                :label="item.value"</span><br><span class="line">                :value="item.id"</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-select&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">      &lt;!-- 员工照片 --&gt;</span><br><span class="line">      &lt;el-row class="inline-info"&gt;</span><br><span class="line">        &lt;el-col :span="12"&gt;</span><br><span class="line">          &lt;el-form-item label="员工头像"&gt;</span><br><span class="line">            &lt;!-- 放置上传图片 --&gt;</span><br><span class="line">           </span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">      &lt;!-- 保存个人信息 --&gt;</span><br><span class="line">      &lt;el-row class="inline-info" type="flex" justify="center"&gt;</span><br><span class="line">        &lt;el-col :span="12"&gt;</span><br><span class="line">          &lt;el-button type="primary" @click="saveUser"&gt;保存更新&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button @click="$router.back()"&gt;返回&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;!-- 基础信息 --&gt;</span><br><span class="line">    &lt;el-form label-width="220px"&gt;</span><br><span class="line">      &lt;div class="block"&gt;</span><br><span class="line">        &lt;div class="title"&gt;基础信息&lt;/div&gt;</span><br><span class="line">        &lt;el-form-item label="最高学历"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.theHighestDegreeOfEducation" class="inputW2"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.highestDegree"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :label="item.label"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;!-- 个人头像 --&gt;</span><br><span class="line">        &lt;!-- 员工照片 --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item label="员工照片"&gt;</span><br><span class="line">          &lt;!-- 放置上传图片 --&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="国家/地区"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.nationalArea" class="inputW2"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.isOverseas"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :label="item.label"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="护照号"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.passportNo" placeholder="正规护照格式" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="身份证号"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.idNumber" placeholder="正规身份证格式" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="籍贯"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.nativePlace" placeholder="籍贯地址" class="inputW5" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="民族"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.nation" placeholder="请输入民族" class="inputW2" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="婚姻状况"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.maritalStatus" class="inputW2"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.maritaStatus"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :label="item.label"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="生日"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.birthday" placeholder="示例 0323" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="年龄"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.age" type="number" class="inputW2" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="星座"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.constellation" class="inputW2"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.constellation"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :label="item.label"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="血型"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.bloodType" class="inputW2"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.bloodType"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :label="item.label"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="户籍所在地"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.domicile" class="inputW5" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="政治面貌"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.politicalOutlook" class="inputW2" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="入党时间"&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model="formData.timeToJoinTheParty"</span><br><span class="line">            type="date"</span><br><span class="line">            placeholder="选择日期"</span><br><span class="line">            class="inputW"</span><br><span class="line">            value-format="yyyy-MM-dd"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="存档机构"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.archivingOrganization" placeholder="请输入" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="子女状态"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.stateOfChildren" placeholder="请输入" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="子女有无商业险"&gt;</span><br><span class="line">          &lt;el-radio-group v-model="formData.doChildrenHaveCommercialInsurance"&gt;</span><br><span class="line">            &lt;el-radio label="1"&gt;有&lt;/el-radio&gt;</span><br><span class="line">            &lt;el-radio label="2"&gt;无&lt;/el-radio&gt;</span><br><span class="line">          &lt;/el-radio-group&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="有无违法违纪状态"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.isThereAnyViolationOfLawOrDiscipline" placeholder="请输入" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="有无重大病史"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.areThereAnyMajorMedicalHistories" placeholder="请输入" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 通讯信息 --&gt;</span><br><span class="line">      &lt;div class="block"&gt;</span><br><span class="line">        &lt;div class="title"&gt;通讯信息&lt;/div&gt;</span><br><span class="line">        &lt;el-form-item label="QQ"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.qq" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="微信"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.wechat" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="现居住地"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.placeOfResidence" placeholder="请输入" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="通讯地址"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.postalAddress" placeholder="请输入" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="联系手机"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.contactTheMobilePhone" placeholder="11位字符" maxlength="11" class="inputW" @change.native="handlePhone(2)" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="个人邮箱"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.personalMailbox" placeholder="请输入" type="mail" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="紧急联系人"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.emergencyContact" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="紧急联系电话"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.emergencyContactNumber" placeholder="11位字符" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 账号信息 --&gt;</span><br><span class="line">      &lt;div class="block"&gt;</span><br><span class="line">        &lt;div class="title"&gt;账号信息&lt;/div&gt;</span><br><span class="line">        &lt;el-form-item label="社保电脑号"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.socialSecurityComputerNumber" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="公积金账号"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.providentFundAccount" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="银行卡号"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.bankCardNumber" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="开户行"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.openingBank" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 教育信息 --&gt;</span><br><span class="line">      &lt;div class="block"&gt;</span><br><span class="line">        &lt;div class="title"&gt;教育信息&lt;/div&gt;</span><br><span class="line">        &lt;el-form-item label="学历类型"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.educationalType" placeholder="请选择"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.educationType"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :label="item.label"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="毕业学校"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.graduateSchool" placeholder="请输入" class="inputW2" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="入学时间"&gt;</span><br><span class="line">          &lt;el-date-picker v-model="formData.enrolmentTime" type="data" placeholder="请输入时间" class="inputW" value-format="yyyy-MM-dd" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="毕业时间"&gt;</span><br><span class="line">          &lt;el-date-picker v-model="formData.graduationTime" type="data" placeholder="请输入时间" class="inputW" value-format="yyyy-MM-dd" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="专业"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.major" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 从业信息 --&gt;</span><br><span class="line">      &lt;div class="block"&gt;</span><br><span class="line">        &lt;div class="title"&gt;从业信息&lt;/div&gt;</span><br><span class="line">        &lt;el-form-item label="上家公司"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.homeCompany" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="职称"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.title" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="有无竞业限制"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.isThereAnyCompetitionRestriction" placeholder="请输入" style="width:80%" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="备注"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.remarks" type="textarea" placeholder="请输入备注" style="width:80%" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;!-- 保存员工信息 --&gt;</span><br><span class="line">        &lt;el-row class="inline-info" type="flex" justify="center"&gt;</span><br><span class="line">          &lt;el-col :span="12"&gt;</span><br><span class="line">            &lt;el-button type="primary" @click="savePersonal"&gt;保存更新&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button @click="$router.back()"&gt;返回&lt;/el-button&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>本章节个人数据过于**<code>繁杂，庞大</code>**，同学们在开发期间，拷贝代码即可，我们只写关键部位的代码</p>
</blockquote>
<p><strong>定义user-info的数据</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> EmployeeEnum <span class="keyword">from</span> <span class="string">'@/api/constant/employees'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">userId</span>: <span class="built_in">this</span>.$route.params.id,</span><br><span class="line">      EmployeeEnum, <span class="comment">// 员工枚举数据</span></span><br><span class="line">      <span class="attr">userInfo</span>: {},</span><br><span class="line">      <span class="attr">formData</span>: {</span><br><span class="line">        <span class="attr">userId</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">username</span>: <span class="string">''</span>, <span class="comment">// 用户名</span></span><br><span class="line">        <span class="attr">sex</span>: <span class="string">''</span>, <span class="comment">// 性别</span></span><br><span class="line">        <span class="attr">mobile</span>: <span class="string">''</span>, <span class="comment">// 手机</span></span><br><span class="line">        <span class="attr">companyId</span>: <span class="string">''</span>, <span class="comment">// 公司id</span></span><br><span class="line">        <span class="attr">departmentName</span>: <span class="string">''</span>, <span class="comment">// 部门名称</span></span><br><span class="line">        <span class="comment">//  onTheJobStatus: '', // 在职状态 no</span></span><br><span class="line">        <span class="attr">dateOfBirth</span>: <span class="string">''</span>, <span class="comment">// 出生日期</span></span><br><span class="line">        <span class="attr">timeOfEntry</span>: <span class="string">''</span>, <span class="comment">// 入职时间</span></span><br><span class="line">        <span class="attr">theHighestDegreeOfEducation</span>: <span class="string">''</span>, <span class="comment">// 最高学历</span></span><br><span class="line">        <span class="attr">nationalArea</span>: <span class="string">''</span>, <span class="comment">// 国家</span></span><br><span class="line">        <span class="attr">passportNo</span>: <span class="string">''</span>, <span class="comment">// 护照号</span></span><br><span class="line">        <span class="attr">idNumber</span>: <span class="string">''</span>, <span class="comment">// 身份证号</span></span><br><span class="line">        <span class="attr">idCardPhotoPositive</span>: <span class="string">''</span>, <span class="comment">// 身份证照正</span></span><br><span class="line">        <span class="attr">idCardPhotoBack</span>: <span class="string">''</span>, <span class="comment">// 身份证照正</span></span><br><span class="line">        <span class="attr">nativePlace</span>: <span class="string">''</span>, <span class="comment">// 籍贯</span></span><br><span class="line">        <span class="attr">nation</span>: <span class="string">''</span>, <span class="comment">// 民族</span></span><br><span class="line">        <span class="attr">englishName</span>: <span class="string">''</span>, <span class="comment">// 英文名字</span></span><br><span class="line">        <span class="attr">maritalStatus</span>: <span class="string">''</span>, <span class="comment">// 婚姻状况</span></span><br><span class="line">        <span class="attr">staffPhoto</span>: <span class="string">''</span>, <span class="comment">// 员工照片</span></span><br><span class="line">        <span class="attr">birthday</span>: <span class="string">''</span>, <span class="comment">// 生日</span></span><br><span class="line">        <span class="attr">zodiac</span>: <span class="string">''</span>, <span class="comment">// 属相</span></span><br><span class="line">        <span class="attr">age</span>: <span class="string">''</span>, <span class="comment">// 年龄</span></span><br><span class="line">        <span class="attr">constellation</span>: <span class="string">''</span>, <span class="comment">// 星座</span></span><br><span class="line">        <span class="attr">bloodType</span>: <span class="string">''</span>, <span class="comment">// 血型</span></span><br><span class="line">        <span class="attr">domicile</span>: <span class="string">''</span>, <span class="comment">// 户籍所在地</span></span><br><span class="line">        <span class="attr">politicalOutlook</span>: <span class="string">''</span>, <span class="comment">// 政治面貌</span></span><br><span class="line">        <span class="attr">timeToJoinTheParty</span>: <span class="string">''</span>, <span class="comment">// 入党时间</span></span><br><span class="line">        <span class="attr">archivingOrganization</span>: <span class="string">''</span>, <span class="comment">// 存档机构</span></span><br><span class="line">        <span class="attr">stateOfChildren</span>: <span class="string">''</span>, <span class="comment">// 子女状态</span></span><br><span class="line">        <span class="attr">doChildrenHaveCommercialInsurance</span>: <span class="string">'1'</span>, <span class="comment">// 保险状态</span></span><br><span class="line">        <span class="attr">isThereAnyViolationOfLawOrDiscipline</span>: <span class="string">''</span>, <span class="comment">// 违法违纪状态</span></span><br><span class="line">        <span class="attr">areThereAnyMajorMedicalHistories</span>: <span class="string">''</span>, <span class="comment">// 重大病史</span></span><br><span class="line">        <span class="attr">qq</span>: <span class="string">''</span>, <span class="comment">// QQ</span></span><br><span class="line">        <span class="attr">wechat</span>: <span class="string">''</span>, <span class="comment">// 微信</span></span><br><span class="line">        <span class="attr">residenceCardCity</span>: <span class="string">''</span>, <span class="comment">// 居住证城市</span></span><br><span class="line">        <span class="attr">dateOfResidencePermit</span>: <span class="string">''</span>, <span class="comment">// 居住证办理日期</span></span><br><span class="line">        <span class="attr">residencePermitDeadline</span>: <span class="string">''</span>, <span class="comment">// 居住证截止日期</span></span><br><span class="line">        <span class="attr">placeOfResidence</span>: <span class="string">''</span>, <span class="comment">// 现居住地</span></span><br><span class="line">        <span class="attr">postalAddress</span>: <span class="string">''</span>, <span class="comment">// 通讯地址</span></span><br><span class="line">        <span class="attr">contactTheMobilePhone</span>: <span class="string">''</span>, <span class="comment">// 联系手机</span></span><br><span class="line">        <span class="attr">personalMailbox</span>: <span class="string">''</span>, <span class="comment">// 个人邮箱</span></span><br><span class="line">        <span class="attr">emergencyContact</span>: <span class="string">''</span>, <span class="comment">// 紧急联系人</span></span><br><span class="line">        <span class="attr">emergencyContactNumber</span>: <span class="string">''</span>, <span class="comment">// 紧急联系电话</span></span><br><span class="line">        <span class="attr">socialSecurityComputerNumber</span>: <span class="string">''</span>, <span class="comment">// 社保电脑号</span></span><br><span class="line">        <span class="attr">providentFundAccount</span>: <span class="string">''</span>, <span class="comment">// 公积金账号</span></span><br><span class="line">        <span class="attr">bankCardNumber</span>: <span class="string">''</span>, <span class="comment">// 银行卡号</span></span><br><span class="line">        <span class="attr">openingBank</span>: <span class="string">''</span>, <span class="comment">// 开户行</span></span><br><span class="line">        <span class="attr">educationalType</span>: <span class="string">''</span>, <span class="comment">// 学历类型</span></span><br><span class="line">        <span class="attr">graduateSchool</span>: <span class="string">''</span>, <span class="comment">// 毕业学校</span></span><br><span class="line">        <span class="attr">enrolmentTime</span>: <span class="string">''</span>, <span class="comment">// 入学时间</span></span><br><span class="line">        <span class="attr">graduationTime</span>: <span class="string">''</span>, <span class="comment">// 毕业时间</span></span><br><span class="line">        <span class="attr">major</span>: <span class="string">''</span>, <span class="comment">// 专业</span></span><br><span class="line">        <span class="attr">graduationCertificate</span>: <span class="string">''</span>, <span class="comment">// 毕业证书</span></span><br><span class="line">        <span class="attr">certificateOfAcademicDegree</span>: <span class="string">''</span>, <span class="comment">// 学位证书</span></span><br><span class="line">        <span class="attr">homeCompany</span>: <span class="string">''</span>, <span class="comment">// 上家公司</span></span><br><span class="line">        <span class="attr">title</span>: <span class="string">''</span>, <span class="comment">// 职称</span></span><br><span class="line">        <span class="attr">resume</span>: <span class="string">''</span>, <span class="comment">// 简历</span></span><br><span class="line">        <span class="attr">isThereAnyCompetitionRestriction</span>: <span class="string">''</span>, <span class="comment">// 有无竞业限制</span></span><br><span class="line">        <span class="attr">proofOfDepartureOfFormerCompany</span>: <span class="string">''</span>, <span class="comment">// 前公司离职证明</span></span><br><span class="line">        <span class="attr">remarks</span>: <span class="string">''</span> <span class="comment">// 备注</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>在detail.vue组件中，注册并使用</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tab-pane label="个人详情"&gt;</span><br><span class="line">           &lt;!-- 放置个人详情 --&gt;</span><br><span class="line">           &lt;component :is="userComponent" /&gt;</span><br><span class="line">           &lt;!-- &lt;user-info /&gt; --&gt;</span><br><span class="line"> &lt;/el-tab-pane&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>在以上代码中，我们使用了动态组件<strong>component</strong>，它通过 **<code>is</code><strong>属性来绑定需要显示在该位置的组件，is属性可以直接为</strong><code>注册组件</code>**的组件名称即可</p>
<h3 id="封装岗位组件"><a href="#封装岗位组件" class="headerlink" title="封装岗位组件"></a>封装岗位组件</h3><p>同理，封装岗位组件</p>
<p><strong>封装岗位组件</strong>  <strong><code>src/views/employee/components/job-info.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class="job-info"&gt;</span><br><span class="line">    &lt;!-- 基础信息 --&gt;</span><br><span class="line">    &lt;el-form label-width="220px"&gt;</span><br><span class="line">      &lt;div class="block"&gt;</span><br><span class="line">        &lt;div class="title"&gt;基础信息&lt;/div&gt;</span><br><span class="line">        &lt;el-form-item label="岗位"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.post" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;!-- &lt;el-form-item label="转正日期"&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model="formData.dateOfCorrection"</span><br><span class="line">            type="date"</span><br><span class="line">            placeholder="选择日期"</span><br><span class="line">            value-format="yyyy-MM-dd"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-form-item&gt; --&gt;</span><br><span class="line">        &lt;el-form-item label="转正状态"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.stateOfCorrection" placeholder="请选择" disabled&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.stateOfCorrection"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="职级"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.rank" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="转正评价"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.correctionEvaluation" type="textarea" placeholder="1-300位字符" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="汇报对象"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.reportId" filterable placeholder="请选择" class="inputW"&gt;</span><br><span class="line">            &lt;el-option v-for="item in depts" :key="item.id" :label="item.username" :value="item.id" /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="HRBP"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.hrbp" filterable placeholder="请选择" class="inputW"&gt;</span><br><span class="line">            &lt;el-option v-for="item in depts" :key="item.id" :label="item.username" :value="item.id" class="inputW" /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item class="formInfo" label="调整司龄(天)："&gt;</span><br><span class="line">          &lt;el-input v-model="formData.adjustmentAgedays" type="number" placeholder="请输入" class="inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="首次参加工作时间"&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model="formData.workingTimeForTheFirstTime"</span><br><span class="line">            type="date"</span><br><span class="line">            placeholder="选择日期"</span><br><span class="line">            value-format="yyyy-MM-dd"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="调整工龄"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.adjustmentOfLengthOfService" placeholder="0.00年" class="inputW" disabled /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 合同信息 --&gt;</span><br><span class="line">      &lt;div class="block"&gt;</span><br><span class="line">        &lt;div class="title"&gt;合同信息&lt;/div&gt;</span><br><span class="line">        &lt;el-form-item class="formInfo" label="首次合同开始时间："&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model="formData.initialContractStartTime"</span><br><span class="line">            type="date"</span><br><span class="line">            placeholder="选择日期"</span><br><span class="line">            value-format="yyyy-MM-dd"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="首次合同结束时间"&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model="formData.firstContractTerminationTime"</span><br><span class="line">            type="date"</span><br><span class="line">            placeholder="选择日期"</span><br><span class="line">            value-format="yyyy-MM-dd"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="现合同开始时间"&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model="formData.currentContractStartTime"</span><br><span class="line">            type="date"</span><br><span class="line">            placeholder="选择日期"</span><br><span class="line">            value-format="yyyy-MM-dd"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="现合同结束时间"&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model="formData.closingTimeOfCurrentContract  "</span><br><span class="line">            type="date"</span><br><span class="line">            placeholder="选择日期"</span><br><span class="line">            value-format="yyyy-MM-dd"</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="合同期限"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.contractPeriod" class="filter-item"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.contractPeriod"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :label="item.label"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="续签次数"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.renewalNumber" class="filter-item"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.renewalCount"</span><br><span class="line">              :key="item.id"</span><br><span class="line">              :label="item.value"</span><br><span class="line">              :value="item.id"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 招聘信息 --&gt;</span><br><span class="line">      &lt;div class="block"&gt;</span><br><span class="line">        &lt;div class="title"&gt;招聘信息&lt;/div&gt;</span><br><span class="line">        &lt;el-form-item label="其他招聘渠道"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.otherRecruitmentChannels" placeholder="请选择"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.resumeSource"</span><br><span class="line">              :key="item.id"</span><br><span class="line">              :label="item.value"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="招聘渠道"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.recruitmentChannels" placeholder="请选择"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.resumeSource"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :label="item.label"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="社招/校招"&gt;</span><br><span class="line">          &lt;el-select v-model="formData.socialRecruitment" placeholder="请选择"&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for="item in EmployeeEnum.hireSourceType"</span><br><span class="line">              :key="item.value"</span><br><span class="line">              :label="item.label"</span><br><span class="line">              :value="item.value"</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label="推荐企业/人"&gt;</span><br><span class="line">          &lt;el-input v-model="formData.recommenderBusinessPeople" placeholder="请输入" class="infoPosition inputW" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 从业信息 --&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button type="primary" @click="saveJob"&gt;保存更新&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button @click="$router.back()"&gt;返回&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>定义岗位数据</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> EmployeeEnum <span class="keyword">from</span> <span class="string">'@/api/constant/employees'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">userId</span>: <span class="built_in">this</span>.$route.params.id,</span><br><span class="line">      <span class="attr">depts</span>: [],</span><br><span class="line">      EmployeeEnum,</span><br><span class="line">      <span class="attr">formData</span>: {</span><br><span class="line">        <span class="attr">adjustmentAgedays</span>: <span class="string">''</span>, <span class="comment">// 调整司龄天</span></span><br><span class="line">        <span class="attr">adjustmentOfLengthOfService</span>: <span class="string">''</span>, <span class="comment">// 调整工龄天</span></span><br><span class="line">        <span class="attr">closingTimeOfCurrentContract</span>: <span class="string">''</span>, <span class="comment">// 现合同结束时间</span></span><br><span class="line">        <span class="attr">companyId</span>: <span class="string">''</span>, <span class="comment">// 公司ID</span></span><br><span class="line">        <span class="attr">contractDocuments</span>: <span class="string">''</span>, <span class="comment">// 合同文件</span></span><br><span class="line">        <span class="attr">contractPeriod</span>: <span class="string">''</span>, <span class="comment">// 合同期限</span></span><br><span class="line">        <span class="attr">correctionEvaluation</span>: <span class="string">''</span>, <span class="comment">//  转正评价</span></span><br><span class="line">        <span class="attr">currentContractStartTime</span>: <span class="string">''</span>, <span class="comment">// 现合同开始时间</span></span><br><span class="line">        <span class="attr">firstContractTerminationTime</span>: <span class="string">''</span>, <span class="comment">// 首次合同结束时间</span></span><br><span class="line">        <span class="attr">hrbp</span>: <span class="string">''</span>, <span class="comment">// HRBP</span></span><br><span class="line">        <span class="attr">initialContractStartTime</span>: <span class="string">''</span>, <span class="comment">// 首次合同开始时间</span></span><br><span class="line">        <span class="attr">otherRecruitmentChannels</span>: <span class="string">''</span>, <span class="comment">// 其他招聘渠道</span></span><br><span class="line">        <span class="attr">post</span>: <span class="string">''</span>, <span class="comment">// 岗位</span></span><br><span class="line">        <span class="attr">rank</span>: <span class="literal">null</span>, <span class="comment">// 职级</span></span><br><span class="line">        <span class="attr">recommenderBusinessPeople</span>: <span class="string">''</span>, <span class="comment">// 推荐企业人</span></span><br><span class="line">        <span class="attr">recruitmentChannels</span>: <span class="string">''</span>, <span class="comment">// 招聘渠道</span></span><br><span class="line">        <span class="attr">renewalNumber</span>: <span class="string">''</span>, <span class="comment">// 续签次数</span></span><br><span class="line">        <span class="attr">reportId</span>: <span class="string">''</span>, <span class="comment">// 汇报对象</span></span><br><span class="line">        <span class="attr">reportName</span>: <span class="literal">null</span>, <span class="comment">// 汇报对象</span></span><br><span class="line">        <span class="attr">socialRecruitment</span>: <span class="string">''</span>, <span class="comment">// 社招校招</span></span><br><span class="line">        <span class="attr">stateOfCorrection</span>: <span class="string">''</span>, <span class="comment">// 转正状态</span></span><br><span class="line">        <span class="attr">taxableCity</span>: <span class="string">''</span>, <span class="comment">// 纳税城市</span></span><br><span class="line">        <span class="attr">userId</span>: <span class="string">''</span>, <span class="comment">// 员工ID</span></span><br><span class="line">        <span class="attr">workMailbox</span>: <span class="string">''</span>, <span class="comment">// 工作邮箱</span></span><br><span class="line">        <span class="attr">workingCity</span>: <span class="string">''</span>, <span class="comment">// 工作城市</span></span><br><span class="line">        <span class="attr">workingTimeForTheFirstTime</span>: <span class="string">''</span> <span class="comment">// 首次参加工作时间</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>在detail.vue组件中，注册并使用</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tab-pane label="岗位详情"&gt;</span><br><span class="line">           &lt;!-- 放置岗位详情 --&gt;</span><br><span class="line">           &lt;component :is="JobInfo" /&gt;</span><br><span class="line"> &lt;/el-tab-pane&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>**<code>本节任务</code>**：完成个人组件和岗位组件封装</p>
<h2 id="员工个人信息和岗位信息-读取-保存"><a href="#员工个人信息和岗位信息-读取-保存" class="headerlink" title="员工个人信息和岗位信息-读取-保存"></a>员工个人信息和岗位信息-读取-保存</h2><p>**<code>目标</code>**：实现个人信息的岗位信息的读取和校验，保存</p>
<h3 id="读取个人保存个人信息"><a href="#读取个人保存个人信息" class="headerlink" title="读取个人保存个人信息"></a>读取个人保存个人信息</h3><blockquote>
<p>这个环节里面大部分都是繁杂的属性和重复的过程，所以该环节直接将过程代码拷贝到项目中即可</p>
</blockquote>
<p>封装 <strong>读取个人信息</strong> <strong>保存个人信息</strong>  <strong>读取岗位信息</strong> <strong>保存岗位信息</strong>  </p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> *  读取用户详情的基础信息</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getPersonalDetail</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/employees/<span class="subst">${id}</span>/personalInfo`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> *  更新用户详情的基础信息</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updatePersonal</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/employees/<span class="subst">${data.userId}</span>/personalInfo`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'put'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** **</span></span><br><span class="line"><span class="comment"> * 获取用户的岗位信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ****/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getJobDetail</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/employees/<span class="subst">${id}</span>/jobs`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存岗位信息</span></span><br><span class="line"><span class="comment"> * ****/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateJob</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/employees/<span class="subst">${data.userId}</span>/jobs`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'put'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>读取，保存个人信息</strong>  <strong><code>user-info</code></strong>  需要注意：这里的保存实际上分成了两个接口，这是接口的设计，我们只能遵守</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getPersonalDetail, updatePersonal, saveUserDetailById } <span class="keyword">from</span> <span class="string">'@/api/employees'</span></span><br><span class="line"><span class="keyword">import</span> { getUserDetailById } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span><br><span class="line"> <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="built_in">this</span>.getPersonalDetail()</span><br><span class="line">    <span class="built_in">this</span>.getUserDetailById()</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getPersonalDetail</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.formData = <span class="keyword">await</span> getPersonalDetail(<span class="built_in">this</span>.userId) <span class="comment">// 获取员工数据</span></span><br><span class="line">    },</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">savePersonal</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="keyword">await</span> updatePersonal({ ...this.formData, <span class="attr">id</span>: <span class="built_in">this</span>.userId })</span><br><span class="line">      <span class="built_in">this</span>.$message.success(<span class="string">'保存成功'</span>)</span><br><span class="line">    },</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">saveUser</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="comment">//  调用父组件</span></span><br><span class="line">      <span class="keyword">await</span> saveUserDetailById(<span class="built_in">this</span>.userInfo)</span><br><span class="line">      <span class="built_in">this</span>.$message.success(<span class="string">'保存成功'</span>)</span><br><span class="line">    },</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getUserDetailById</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.userInfo = <span class="keyword">await</span> getUserDetailById(<span class="built_in">this</span>.userId)</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="读取保存岗位信息"><a href="#读取保存岗位信息" class="headerlink" title="读取保存岗位信息"></a>读取保存岗位信息</h3><p><strong>读取，保存岗位信息</strong>  <strong><code>job-info</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getEmployeeSimple, updateJob, getJobDetail } <span class="keyword">from</span> <span class="string">'@/api/employees'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {</span><br><span class="line">  <span class="built_in">this</span>.getJobDetail()</span><br><span class="line">  <span class="built_in">this</span>.getEmployeeSimple()</span><br><span class="line">},</span><br><span class="line"><span class="attr">methods</span>: {</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">getJobDetail</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="built_in">this</span>.formData = <span class="keyword">await</span> getJobDetail(<span class="built_in">this</span>.userId)</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 获取员工列表</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">getEmployeeSimple</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="built_in">this</span>.depts = <span class="keyword">await</span> getEmployeeSimple()</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 保存岗位信息</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">saveJob</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">await</span> updateJob(<span class="built_in">this</span>.formData)</span><br><span class="line">    <span class="built_in">this</span>.$message.success(<span class="string">'保存岗位信息成功'</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 实现个人信息的岗位信息的读取和校验，保存</p>
<h2 id="配置腾讯云Cos"><a href="#配置腾讯云Cos" class="headerlink" title="配置腾讯云Cos"></a>配置腾讯云Cos</h2><p>**<code>目标</code>**： 配置一个腾讯云cos</p>
<blockquote>
<p>由于上课的开发的特殊性，我们不希望把所有的图片都上传到我们自己的官方服务器上，这里我们可以采用一个腾讯云的图片方案</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805200831035.png" alt="image-20200805200831035"></p>
<blockquote>
<p>上边图的意思就是说，我们找一个可以免费上传图片的服务器，帮我们**<code>代管图片</code><strong>，我们在自己的数据库里只保存一个地址就行， 这其实也是很多项目的处理方案，会有一个</strong><code>公共的文件服务器</code>**</p>
</blockquote>
<p>第一步，我们必须先拥有一个<a target="_blank" rel="noopener" href="https://cloud.tencent.com/login?s_url=https://console.cloud.tencent.com/">腾迅云</a>的开发者账号(<strong>小心腾讯云的广告电话</strong>)</p>
<blockquote>
<p>请按照腾讯云的注册方式，注册自己的账号</p>
</blockquote>
<p>第二步，实名认证</p>
<blockquote>
<p>选择个人账户</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805201013078.png" alt="image-20200805201013078"></p>
<p><strong>填写个人身份信息</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805201230001.png" alt="image-20200805201230001"></p>
<p>下一步，扫描二维码授权</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805201318977.png" alt="image-20200805201318977"></p>
<p><strong>手机端授权</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805201422567.png" alt="image-20200805201422567"></p>
<p>点击<strong>领取免费产品</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805201513338.png" alt="image-20200805201513338"></p>
<p><strong>选择对象存储COS</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805201559233.png" alt="image-20200805201559233"></p>
<blockquote>
<p>我们免费拥有**<code>6个月的50G流量</code>**的对象存储空间使用权限，足够我们上传用户头像的使用了</p>
</blockquote>
<p><strong>点击0元试用，开通服务</strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805201750662.png" alt="image-20200805201750662"></p>
<p>到这一步，账号的部分就操作完毕，接下来，我们需要来创建一个存储图片的存储桶</p>
<p>登录 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/cos5">对象存储控制台</a> ，<a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/436/13309">创建存储桶</a>。设置存储桶的权限为 <strong><code>公有读，私有写</code></strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200806135409338.png" alt="image-20200806135409338"></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200916231600661.png" alt="image-20200916231600661"></p>
<p>设置cors规则</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200916231949174.png" alt="image-20200916231949174"></p>
<p>AllowHeader 需配成<code>*</code>，如下图所示。</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805211749522.png" alt="image-20200805211749522"></p>
<blockquote>
<p>因为我们本身没有域名，所以这里设置成**<code>*</code>**，仅限于测试，正式环境的话，这里需要配置真实的域名地址</p>
</blockquote>
<p>到这里，我们的腾讯云存储桶就设置好了。</p>
<h2 id="封装上传图片组件-上传组件需求分析"><a href="#封装上传图片组件-上传组件需求分析" class="headerlink" title="封装上传图片组件-上传组件需求分析"></a>封装上传图片组件-上传组件需求分析</h2><p><strong><code>目标</code></strong> 梳理整个的上传过程</p>
<p><strong>初始化cos对象参数</strong></p>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SecretId</td>
<td align="left">开发者拥有的项目身份识别 ID，用以身份认证，可在 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/capi">API 密钥管理</a> 页面获取</td>
</tr>
<tr>
<td align="left">SecretKey</td>
<td align="left">开发者拥有的项目身份密钥，可在 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/capi">API 密钥管理</a> 页面获取</td>
</tr>
</tbody></table>
<blockquote>
<p>注意，上述的参数我们在本次开发过程中，直接将参数放置在前端代码中存储，但是腾讯云本身是不建议这么做的，因为**<code>敏感信息</code>**放在前端很容易被捕获，由于我们本次是测试研发，所以这个过程可以忽略</p>
<p>正确的做法应该是，通过网站调用接口换取敏感信息</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/436/11459">相关文档</a></p>
<p>实例化 上传sdk</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cos = <span class="keyword">new</span> COS({</span><br><span class="line">    <span class="attr">SecretId</span>: <span class="string">'COS_SECRETID'</span>, <span class="comment">// 身份识别 ID</span></span><br><span class="line">    <span class="attr">SecretKey</span>: <span class="string">'COS_SECRETKEY'</span>, <span class="comment">// 身份密钥</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>到目前为止，我们上传图片准备的内容就已经OK，接下来，我们在**<code>src/componets</code>** 新建一个**<code>ImageUpload</code>** 组件</p>
</blockquote>
<p>该组件需要满足什么要求呢？</p>
<ol>
<li>可以显示传入的图片地址</li>
<li>可以删除传入的图片地址</li>
<li>可以上传图片到云服务器</li>
<li>上传到腾讯云之后，可以返回图片地址，显示  </li>
<li>上传成功之后，可以回调成功函数</li>
</ol>
<p>这个上传组件简单吗？</p>
<p><strong><code>no ! ! !</code></strong></p>
<p>看似需求很明确，但是它真正的实现很复杂，我们通过一个图来看一下</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200806174643390.png" alt="image-20200806174643390"></p>
<p>从上图中，我们可以看到，实际上是有两种场景的，本地场景和已经上传的场景</p>
<p>下个章节，针对这个场景我们进行开发</p>
<h2 id="封装上传组件-代码实现"><a href="#封装上传组件-代码实现" class="headerlink" title="封装上传组件-代码实现"></a>封装上传组件-代码实现</h2><p>**<code>目标</code>**实现上传组件的代码部分</p>
<blockquote>
<p>JavaScript SDK 需浏览器支持基本的 HTML5 特性（支持 IE10 以上浏览器），以便支持 ajax 上传文件和计算文件 MD5 值。</p>
</blockquote>
<h3 id="新建文件上传组件"><a href="#新建文件上传组件" class="headerlink" title="新建文件上传组件"></a>新建文件上传组件</h3><p><strong>安装JavaScript SDK</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i cos-js-sdk-v5 --save</span><br></pre></td></tr></tbody></table></figure>

<p><strong>新建上传图片组件</strong> <strong><code>src/components/ImageUpload/index.vue</code></strong></p>
<blockquote>
<p>上传组件，我们可以沿用element的el-upload组件,并且采用照片墙的模式 <strong><code>list-type="picture-card"</code></strong></p>
</blockquote>
<p><strong>放置el-upload组件</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-upload list-type="picture-card"&gt;</span><br><span class="line">     &lt;i class="el-icon-plus" /&gt;</span><br><span class="line">  &lt;/el-upload&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>全局注册组件</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PageTools <span class="keyword">from</span> <span class="string">'./PageTools'</span></span><br><span class="line"><span class="keyword">import</span> UploadExcel <span class="keyword">from</span> <span class="string">'./UploadExcel'</span></span><br><span class="line"><span class="keyword">import</span> ImageUpload <span class="keyword">from</span> <span class="string">'./ImageUpload'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="function"><span class="title">install</span>(<span class="params">Vue</span>)</span> {</span><br><span class="line">    Vue.component(<span class="string">'PageTools'</span>, PageTools) <span class="comment">// 注册工具栏组件</span></span><br><span class="line">    Vue.component(<span class="string">'UploadExcel'</span>, UploadExcel) <span class="comment">// 注册导入excel组件</span></span><br><span class="line">    Vue.component(<span class="string">'ImageUpload'</span>, ImageUpload) <span class="comment">// 注册导入上传组件</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="点击图片进行预览"><a href="#点击图片进行预览" class="headerlink" title="点击图片进行预览"></a>点击图片进行预览</h3><p><strong>限定上传的图片数量和action</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-upload list-type="picture-card" :limit="1" action="#"&gt;</span><br><span class="line">  &lt;/el-upload&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>action为什么给#， 因为前面我们讲过了，我们要上传到腾讯云，需要自定义的上传方式,action给个#防止报错</p>
</blockquote>
<p><strong>预览</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">fileList</span>: [], <span class="comment">// 图片地址设置为数组 </span></span><br><span class="line">      <span class="attr">showDialog</span>: <span class="literal">false</span>, <span class="comment">// 控制显示弹层</span></span><br><span class="line">      <span class="attr">imgUrl</span>: <span class="string">''</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="title">preview</span>(<span class="params">file</span>)</span> {</span><br><span class="line">    <span class="comment">// 这里应该弹出一个层 层里是点击的图片地址</span></span><br><span class="line">    <span class="built_in">this</span>.imgUrl = file.url</span><br><span class="line">    <span class="built_in">this</span>.showDialog = <span class="literal">true</span></span><br><span class="line">},  </span><br></pre></td></tr></tbody></table></figure>

<p><strong>预览弹层</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog title="图片" :visible.sync="showDialog"&gt;</span><br><span class="line">    &lt;img :src="imgUrl" style="width:100%" alt=""&gt;</span><br><span class="line"> &lt;/el-dialog&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="根据上传数量控制上传按钮"><a href="#根据上传数量控制上传按钮" class="headerlink" title="根据上传数量控制上传按钮"></a>根据上传数量控制上传按钮</h3><p><strong>控制上传显示</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">computed: {</span><br><span class="line">   <span class="comment">// 设定一个计算属性 判断是否已经上传完了一张</span></span><br><span class="line">   <span class="function"><span class="title">fileComputed</span>(<span class="params"></span>)</span> {</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">this</span>.fileList.length === <span class="number">1</span></span><br><span class="line">   }</span><br><span class="line"> },</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> &lt;el-upload</span><br><span class="line">      :on-preview=<span class="string">"preview"</span></span><br><span class="line">      :on-remove=<span class="string">"handleRemove"</span></span><br><span class="line">      :on-change=<span class="string">"changeFile"</span></span><br><span class="line">      :file-list=<span class="string">"fileList"</span></span><br><span class="line">      list-type=<span class="string">"picture-card"</span></span><br><span class="line">      action=<span class="string">"#"</span></span><br><span class="line">      :limit=<span class="string">"1"</span></span><br><span class="line">      :class=<span class="string">"{disabled: fileComputed }"</span></span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.disabled .el-upload--picture-card {</span><br><span class="line">  display: none</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="删除图片和添加图片"><a href="#删除图片和添加图片" class="headerlink" title="删除图片和添加图片"></a>删除图片和添加图片</h3><p><strong>删除文件</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleRemove</span>(<span class="params">file</span>)</span> {</span><br><span class="line">   <span class="comment">// file是点击删除的文件</span></span><br><span class="line"> <span class="comment">//   将原来的文件给排除掉了 剩下的就是最新的数组了</span></span><br><span class="line">   <span class="built_in">this</span>.fileList = <span class="built_in">this</span>.fileList.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.uid !== file.uid)</span><br><span class="line"> },</span><br></pre></td></tr></tbody></table></figure>

<p><strong>添加文件</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改文件时触发</span></span><br><span class="line"><span class="comment">// 此时可以用fileList 因为该方法会进来很多遍 不能每次都去push</span></span><br><span class="line"><span class="comment">// fileList因为fileList参数是当前传进来的最新参数 我们只需要将其转化成数组即可 需要转化成一个新的数组</span></span><br><span class="line"><span class="comment">// [] =&gt; [...fileList] [] =&gt; fileList.map()</span></span><br><span class="line"><span class="comment">// 上传成功之后 还会进来 需要实现上传代码的逻辑 这里才会成功</span></span><br><span class="line"><span class="function"><span class="title">changeFile</span>(<span class="params">file, fileList</span>)</span> {</span><br><span class="line">  <span class="built_in">this</span>.fileList = fileList.map(<span class="function"><span class="params">item</span> =&gt;</span> item)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="上传之前检查"><a href="#上传之前检查" class="headerlink" title="上传之前检查"></a>上传之前检查</h3><blockquote>
<p>控制上传图片的类型和上传大小， 如果不满足条件 返回false上传就会停止</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">beforeUpload</span>(<span class="params">file</span>)</span> {</span><br><span class="line">  <span class="comment">// 要开始做文件上传的检查了</span></span><br><span class="line">  <span class="comment">// 文件类型 文件大小</span></span><br><span class="line">  <span class="keyword">const</span> types = [<span class="string">'image/jpeg'</span>, <span class="string">'image/gif'</span>, <span class="string">'image/bmp'</span>, <span class="string">'image/png'</span>]</span><br><span class="line">  <span class="keyword">if</span> (!types.includes(file.type)) {</span><br><span class="line">    <span class="built_in">this</span>.$message.error(<span class="string">'上传图片只能是 JPG、GIF、BMP、PNG 格式!'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  检查大小</span></span><br><span class="line">  <span class="keyword">const</span> maxSize = <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line">  <span class="keyword">if</span> (maxSize &lt; file.size) {</span><br><span class="line">    <span class="built_in">this</span>.$message.error(<span class="string">'图片大小最大不能超过5M'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="上传动作调用上传腾讯云"><a href="#上传动作调用上传腾讯云" class="headerlink" title="上传动作调用上传腾讯云"></a>上传动作调用上传腾讯云</h3><p><strong>上传动作为el-upload的http-request属性</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">:http-request=<span class="string">"upload"</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// 自定义上传动作 有个参数 有个file对象，是我们需要上传到腾讯云服务器的内容</span></span><br><span class="line">   <span class="function"><span class="title">upload</span>(<span class="params">params</span>)</span> {</span><br><span class="line">     <span class="built_in">console</span>.log(params.file)</span><br><span class="line">   }</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>我们需要在该方法中，调用腾讯云的上传方法</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/436/35649#.E7.AE.80.E5.8D.95.E4.B8.8A.E4.BC.A0.E5.AF.B9.E8.B1.A1">腾讯云文档地址</a></p>
<p>身份ID和密钥可以通过腾讯云平台获取</p>
<p>登录 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/capi">访问管理控制台</a> ，获取您的项目 SecretId 和 SecretKey。</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805211539544.png" alt="image-20200805211539544"></p>
<p>实现代码</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 进行上传操作</span></span><br><span class="line"><span class="function"><span class="title">upload</span>(<span class="params">params</span>)</span> {</span><br><span class="line"><span class="comment">//   console.log(params.file)</span></span><br><span class="line">  <span class="keyword">if</span> (params.file) {</span><br><span class="line">    <span class="comment">// 执行上传操作</span></span><br><span class="line">    cos.putObject({</span><br><span class="line">      <span class="attr">Bucket</span>: <span class="string">'shuiruohanyu-106-1302806742'</span>, <span class="comment">// 存储桶</span></span><br><span class="line">      <span class="attr">Region</span>: <span class="string">'ap-beijing'</span>, <span class="comment">// 地域</span></span><br><span class="line">      <span class="attr">Key</span>: params.file.name, <span class="comment">// 文件名</span></span><br><span class="line">      <span class="attr">Body</span>: params.file, <span class="comment">// 要上传的文件对象</span></span><br><span class="line">      <span class="attr">StorageClass</span>: <span class="string">'STANDARD'</span> <span class="comment">// 上传的模式类型 直接默认 标准模式即可</span></span><br><span class="line">      <span class="comment">// 上传到腾讯云 =》 哪个存储桶 哪个地域的存储桶 文件  格式  名称 回调</span></span><br><span class="line">    }, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>{</span><br><span class="line">      <span class="comment">// data返回数据之后 应该如何处理</span></span><br><span class="line">      <span class="built_in">console</span>.log(err || data)</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="上传成功之后处理返回数据"><a href="#上传成功之后处理返回数据" class="headerlink" title="上传成功之后处理返回数据"></a>上传成功之后处理返回数据</h3><blockquote>
<p>如何处理返回成功的返回数据</p>
</blockquote>
<p>确定要上传记录id</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">beforeUpload</span>(<span class="params">file</span>)</span> {</span><br><span class="line">    <span class="comment">//   先检查文件类型</span></span><br><span class="line">    <span class="keyword">const</span> types = [<span class="string">'image/jpeg'</span>, <span class="string">'image/gif'</span>, <span class="string">'image/bmp'</span>, <span class="string">'image/png'</span>]</span><br><span class="line">    <span class="keyword">if</span> (!types.some(<span class="function"><span class="params">item</span> =&gt;</span> item === file.type)) {</span><br><span class="line">      <span class="comment">//   如果不存在</span></span><br><span class="line">      <span class="built_in">this</span>.$message.error(<span class="string">'上传图片只能是 JPG、GIF、BMP、PNG 格式!'</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// 上传终止</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 检查文件大小  5M 1M = 1024KB 1KB = 1024B</span></span><br><span class="line">    <span class="keyword">const</span> maxSize = <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line">    <span class="keyword">if</span> (file.size &gt; maxSize) {</span><br><span class="line">      <span class="comment">//   超过了限制的文件大小</span></span><br><span class="line">      <span class="built_in">this</span>.$message.error(<span class="string">'上传的图片大小不能大于5M'</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//   已经确定当前上传的就是当前的这个file了</span></span><br><span class="line">    <span class="built_in">this</span>.currentFileUid = file.uid</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// 最后一定要return  true</span></span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>处理返回数据</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 进行上传操作</span></span><br><span class="line"><span class="function"><span class="title">upload</span>(<span class="params">params</span>)</span> {</span><br><span class="line"><span class="comment">//   console.log(params.file)</span></span><br><span class="line">  <span class="keyword">if</span> (params.file) {</span><br><span class="line">    <span class="comment">// 执行上传操作</span></span><br><span class="line">    cos.putObject({</span><br><span class="line">      <span class="attr">Bucket</span>: <span class="string">'shuiruohanyu-106-1302806742'</span>, <span class="comment">// 存储桶</span></span><br><span class="line">      <span class="attr">Region</span>: <span class="string">'ap-beijing'</span>, <span class="comment">// 地域</span></span><br><span class="line">      <span class="attr">Key</span>: params.file.name, <span class="comment">// 文件名</span></span><br><span class="line">      <span class="attr">Body</span>: params.file, <span class="comment">// 要上传的文件对象</span></span><br><span class="line">      <span class="attr">StorageClass</span>: <span class="string">'STANDARD'</span> <span class="comment">// 上传的模式类型 直接默认 标准模式即可</span></span><br><span class="line">      <span class="comment">// 上传到腾讯云 =》 哪个存储桶 哪个地域的存储桶 文件  格式  名称 回调</span></span><br><span class="line">    }, <span class="function">(<span class="params">err, data</span>) =&gt;</span> {</span><br><span class="line">      <span class="comment">// data返回数据之后 应该如何处理</span></span><br><span class="line">      <span class="built_in">console</span>.log(err || data)</span><br><span class="line">      <span class="comment">// data中有一个statusCode === 200 的时候说明上传成功</span></span><br><span class="line">      <span class="keyword">if</span> (!err &amp;&amp; data.statusCode === <span class="number">200</span>) {</span><br><span class="line">        <span class="comment">//   此时说明文件上传成功  要获取成功的返回地址</span></span><br><span class="line">        <span class="comment">// fileList才能显示到上传组件上 此时我们要将fileList中的数据的url地址变成 现在上传成功的地址</span></span><br><span class="line">        <span class="comment">// 目前虽然是一张图片 但是请注意 我们的fileList是一个数组</span></span><br><span class="line">        <span class="comment">// 需要知道当前上传成功的是哪一张图片</span></span><br><span class="line">        <span class="built_in">this</span>.fileList = <span class="built_in">this</span>.fileList.map(<span class="function"><span class="params">item</span> =&gt;</span> {</span><br><span class="line">          <span class="comment">// 去找谁的uid等于刚刚记录下来的id</span></span><br><span class="line">          <span class="keyword">if</span> (item.uid === <span class="built_in">this</span>.currentFileUid) {</span><br><span class="line">            <span class="comment">// 将成功的地址赋值给原来的url属性</span></span><br><span class="line">            <span class="keyword">return</span> { <span class="attr">url</span>: <span class="string">'http://'</span> + data.Location, <span class="attr">upload</span>: <span class="literal">true</span> }</span><br><span class="line">            <span class="comment">// upload 为true 表示这张图片已经上传完毕 这个属性要为我们后期应用的时候做标记</span></span><br><span class="line">            <span class="comment">// 保存  =&gt; 图片有大有小 =&gt; 上传速度有快又慢 =&gt;要根据有没有upload这个标记来决定是否去保存</span></span><br><span class="line">          }</span><br><span class="line">          <span class="keyword">return</span> item</span><br><span class="line">        })</span><br><span class="line">        <span class="comment">// 将上传成功的地址 回写到了fileList中 fileList变化  =》 upload组件 就会根据fileList的变化而去渲染视图</span></span><br><span class="line">      }</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>我们在fileList中设置了属性为upload为true的属性，表示该图片已经上传成功了，如果fileList还有upload不为true的数据，那就表示该图片还没有上传完毕</p>
</blockquote>
<h3 id="上传的进度条显示"><a href="#上传的进度条显示" class="headerlink" title="上传的进度条显示"></a>上传的进度条显示</h3><blockquote>
<p>为了再上传图片过程中显示进度条，我们可以使用element-ui的进度条显示当前的上传进度</p>
</blockquote>
<p><strong>放置进度条</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-progress v-if="showPercent" style="width: 180px" :percentage="percent" /&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>通过腾讯云sdk监听上传进度</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cos.putObject({</span><br><span class="line">         <span class="comment">// 配置</span></span><br><span class="line">         <span class="attr">Bucket</span>: <span class="string">'laogao-1302806742'</span>, <span class="comment">// 存储桶名称</span></span><br><span class="line">         <span class="attr">Region</span>: <span class="string">'ap-guangzhou'</span>, <span class="comment">// 存储桶地域</span></span><br><span class="line">         <span class="attr">Key</span>: params.file.name, <span class="comment">// 文件名作为key</span></span><br><span class="line">         <span class="attr">StorageClass</span>: <span class="string">'STANDARD'</span>, <span class="comment">// 此类写死</span></span><br><span class="line">         <span class="attr">Body</span>: params.file, <span class="comment">// 将本地的文件赋值给腾讯云配置</span></span><br><span class="line">         <span class="comment">// 进度条</span></span><br><span class="line">         <span class="attr">onProgress</span>: <span class="function">(<span class="params">params</span>) =&gt;</span> {</span><br><span class="line">           <span class="built_in">this</span>.percent = params.percent * <span class="number">100</span></span><br><span class="line">         }</span><br><span class="line">       }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 放置一个上传组件 --&gt;</span><br><span class="line">    &lt;!-- action这里不写上传地址 因为我们是调用腾讯云cos 不是一个地址可以搞定的 要用自定义的上传 --&gt;</span><br><span class="line">    &lt;el-upload</span><br><span class="line">      :on-preview="preview"</span><br><span class="line">      :on-remove="handleRemove"</span><br><span class="line">      :on-change="changeFile"</span><br><span class="line">      :before-upload="beforeUpload"</span><br><span class="line">      :file-list="fileList"</span><br><span class="line">      :http-request="upload"</span><br><span class="line">      list-type="picture-card"</span><br><span class="line">      action="#"</span><br><span class="line">      :limit="1"</span><br><span class="line">      :class="{disabled: fileComputed }"</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;i class="el-icon-plus" /&gt;</span><br><span class="line">    &lt;/el-upload&gt;</span><br><span class="line">    &lt;!-- 进度条 --&gt;</span><br><span class="line">    &lt;el-progress v-if="showPercent" style="width: 180px" :percentage="percent" /&gt;</span><br><span class="line">    &lt;!-- 放置一个弹层 --&gt;</span><br><span class="line">    &lt;!-- sync修饰符自动将弹层关闭了 --&gt;</span><br><span class="line">    &lt;el-dialog title="图片" :visible.sync="showDialog"&gt;</span><br><span class="line">      &lt;img :src="imgUrl" style="width:100%" alt=""&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import COS from 'cos-js-sdk-v5' // 引入腾讯云的包</span><br><span class="line">// 需要实例化</span><br><span class="line">const cos = new COS({</span><br><span class="line">  SecretId: 'AKID0mqfEWqlUzIbeSkGRL6c7ML6c0B93To9',</span><br><span class="line">  SecretKey: 'JFwNZdeRF2iOp03FFsGNDm44vWFitmNF'</span><br><span class="line">}) // 实例化的包 已经具有了上传的能力 可以上传到该账号里面的存储桶了</span><br><span class="line">export default {</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      fileList: [],</span><br><span class="line">      showDialog: false, // 控制图片的显示或者隐藏</span><br><span class="line">      imgUrl: '', // 存储点击的图片地址</span><br><span class="line">      currentFileUid: '', // 用一个变量 记住当前上传的图片id</span><br><span class="line">      percent: 0,</span><br><span class="line">      showPercent: false // 默认不显示进度条</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    // 设定一个计算属性 判断是否已经上传完了一张</span><br><span class="line">    fileComputed() {</span><br><span class="line">      return this.fileList.length === 1</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    preview(file) {</span><br><span class="line">      // 这里应该弹出一个层 层里是点击的图片地址</span><br><span class="line">      this.imgUrl = file.url</span><br><span class="line">      this.showDialog = true</span><br><span class="line">    },</span><br><span class="line">    handleRemove(file) {</span><br><span class="line">      // file是点击删除的文件</span><br><span class="line">    //   将原来的文件给排除掉了 剩下的就是最新的数组了</span><br><span class="line">      this.fileList = this.fileList.filter(item =&gt; item.uid !== file.uid)</span><br><span class="line">    },</span><br><span class="line">    // 修改文件时触发</span><br><span class="line">    // 此时可以用fileList 因为该方法会进来很多遍 不能每次都去push</span><br><span class="line">    // fileList因为fileList参数是当前传进来的最新参数 我们只需要将其转化成数组即可 需要转化成一个新的数组</span><br><span class="line">    // [] =&gt; [...fileList] [] =&gt; fileList.map()</span><br><span class="line">    // 上传成功之后 还会进来 需要实现上传代码的逻辑 这里才会成功</span><br><span class="line">    changeFile(file, fileList) {</span><br><span class="line">      this.fileList = fileList.map(item =&gt; item)</span><br><span class="line">    },</span><br><span class="line">    beforeUpload(file) {</span><br><span class="line">      // 要开始做文件上传的检查了</span><br><span class="line">      // 文件类型 文件大小</span><br><span class="line">      const types = ['image/jpeg', 'image/gif', 'image/bmp', 'image/png']</span><br><span class="line">      if (!types.includes(file.type)) {</span><br><span class="line">        this.$message.error('上传图片只能是 JPG、GIF、BMP、PNG 格式!')</span><br><span class="line">        return false</span><br><span class="line">      }</span><br><span class="line">      //  检查大小</span><br><span class="line">      const maxSize = 5 * 1024 * 1024</span><br><span class="line">      if (maxSize &lt; file.size) {</span><br><span class="line">        this.$message.error('图片大小最大不能超过5M')</span><br><span class="line">        return false</span><br><span class="line">      }</span><br><span class="line">      // file.uid</span><br><span class="line">      this.currentFileUid = file.uid // 记住当前的uid</span><br><span class="line">      this.showPercent = true</span><br><span class="line">      return true</span><br><span class="line">    },</span><br><span class="line">    // 自定义上传动作 有个参数 有个file对象，是我们需要上传到腾讯云服务器的内容</span><br><span class="line">    upload(params) {</span><br><span class="line">      if (params.file) {</span><br><span class="line">        //  上传文件到腾讯云</span><br><span class="line">        cos.putObject({</span><br><span class="line">          // 配置</span><br><span class="line">          Bucket: 'laogao-1302806742', // 存储桶名称</span><br><span class="line">          Region: 'ap-guangzhou', // 存储桶地域</span><br><span class="line">          Key: params.file.name, // 文件名作为key</span><br><span class="line">          StorageClass: 'STANDARD', // 此类写死</span><br><span class="line">          Body: params.file, // 将本地的文件赋值给腾讯云配置</span><br><span class="line">          // 进度条</span><br><span class="line">          onProgress: (params) =&gt; {</span><br><span class="line">            this.percent = params.percent * 100</span><br><span class="line">          }</span><br><span class="line">        }, (err, data) =&gt; {</span><br><span class="line">          // 需要判断错误与成功</span><br><span class="line">          if (!err &amp;&amp; data.statusCode === 200) {</span><br><span class="line">            // 如果没有失败表示成功了</span><br><span class="line">            // 此时认为上传成功了</span><br><span class="line">            // this.currentFileUid</span><br><span class="line">            // 仍然有个小问题， 比如此时我们正在上传，但是调用了保存，保存在上传过程中进行，</span><br><span class="line">            // 此时上传还没有完成  此时可以这样做 ： 给所有上传成功的图片 加一个属性 upload: true</span><br><span class="line">            this.fileList = this.fileList.map(item =&gt; {</span><br><span class="line">              if (item.uid === this.currentFileUid) {</span><br><span class="line">                //   upload为true表示 该图片已经成功上传到服务器，地址已经是腾讯云的地址了  就不可以执行保存了</span><br><span class="line">                return { url: 'http://' + data.Location, upload: true } // 将本地的地址换成腾讯云地址</span><br><span class="line">              }</span><br><span class="line">              return item</span><br><span class="line">            })</span><br><span class="line">            setTimeout(() =&gt; {</span><br><span class="line">              this.showPercent = false // 隐藏进度条</span><br><span class="line">              this.percent = 0 // 进度归0</span><br><span class="line">            }, 2000)</span><br><span class="line"></span><br><span class="line">            // 将腾讯云地址写入到fileList上 ，保存的时候 就可以从fileList中直接获取图片地址</span><br><span class="line"></span><br><span class="line">            // 此时注意，我们应该记住 当前上传的是哪个图片  上传成功之后，将图片的地址赋值回去</span><br><span class="line">          }</span><br><span class="line">        })</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.disabled .el-upload--picture-card {</span><br><span class="line">  display: none</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>上传动作中，用到了上个小节中，我们注册的腾讯云cos的**<code>存储桶名称</code><strong>和</strong><code>地域名称</code>**</p>
</blockquote>
<p>通过上面的代码，我们会发现，我们把上传之后的图片信息都给了**<code>fileList数据</code><strong>，那么在应用时，就可以直接获取该实例的</strong><code>fileList数据即可</code>**</p>
<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 完成上传组件的封装</p>
<h2 id="在员工详情中应用上传组件"><a href="#在员工详情中应用上传组件" class="headerlink" title="在员工详情中应用上传组件"></a>在员工详情中应用上传组件</h2><p>**<code>目标</code>**：应用封装好的上传组件</p>
<h3 id="将员工的头像和证件照赋值给上传组件"><a href="#将员工的头像和证件照赋值给上传组件" class="headerlink" title="将员工的头像和证件照赋值给上传组件"></a>将员工的头像和证件照赋值给上传组件</h3><p>在**<code>user-info.vue</code>**中放置上传组件</p>
<p><strong>员工头像</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 员工照片 --&gt;</span><br><span class="line">    &lt;el-row class="inline-info"&gt;</span><br><span class="line">      &lt;el-col :span="12"&gt;</span><br><span class="line">        &lt;el-form-item label="员工头像"&gt;</span><br><span class="line">          &lt;!-- 放置上传图片 --&gt;</span><br><span class="line">          &lt;image-upload ref="staffPhoto" /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>读取时赋值头像</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取上半部分的内容</span></span><br><span class="line">   <span class="keyword">async</span> <span class="function"><span class="title">getUserDetailById</span>(<span class="params"></span>)</span> {</span><br><span class="line">     <span class="built_in">this</span>.userInfo = <span class="keyword">await</span> getUserDetailById(<span class="built_in">this</span>.userId)</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.userInfo.staffPhoto) {</span><br><span class="line">       <span class="comment">// 这里我们赋值，同时需要给赋值的地址一个标记 upload: true</span></span><br><span class="line">       <span class="built_in">this</span>.$refs.staffPhoto.fileList = [{ <span class="attr">url</span>: <span class="built_in">this</span>.userInfo.staffPhoto, <span class="attr">upload</span>: <span class="literal">true</span> }]</span><br><span class="line">     }</span><br><span class="line">   },</span><br></pre></td></tr></tbody></table></figure>

<p><strong>员工证件照</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label="员工照片"&gt;</span><br><span class="line">        &lt;!-- 放置上传图片 --&gt;</span><br><span class="line">        &lt;!-- ref不要重名 --&gt;</span><br><span class="line">        &lt;image-upload ref="myStaffPhoto" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>读取时赋值照片</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取下半部分内容</span></span><br><span class="line">   <span class="keyword">async</span>  <span class="function"><span class="title">getPersonalDetail</span>(<span class="params"></span>)</span> {</span><br><span class="line">     <span class="built_in">this</span>.formData = <span class="keyword">await</span> getPersonalDetail(<span class="built_in">this</span>.userId)</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.formData.staffPhoto) {</span><br><span class="line">       <span class="built_in">this</span>.$refs.myStaffPhoto.fileList = [{ <span class="attr">url</span>: <span class="built_in">this</span>.formData.staffPhoto, <span class="attr">upload</span>: <span class="literal">true</span> }]</span><br><span class="line">     }</span><br><span class="line">   },</span><br></pre></td></tr></tbody></table></figure>

<h3 id="保存时处理头像和证件照的保存"><a href="#保存时处理头像和证件照的保存" class="headerlink" title="保存时处理头像和证件照的保存"></a>保存时处理头像和证件照的保存</h3><p><strong>当点击保存更新时，获取图片的内容</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span>  <span class="function"><span class="title">saveUser</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="comment">// 去读取 员工上传的头像</span></span><br><span class="line">    <span class="keyword">const</span> fileList = <span class="built_in">this</span>.$refs.staffPhoto.fileList <span class="comment">// 读取上传组件的数据</span></span><br><span class="line">    <span class="keyword">if</span> (fileList.some(<span class="function"><span class="params">item</span> =&gt;</span> !item.upload)) {</span><br><span class="line">      <span class="comment">//  如果此时去找 upload为false的图片 找到了说明 有图片还没有上传完成</span></span><br><span class="line">      <span class="built_in">this</span>.$message.warning(<span class="string">'您当前还有图片没有上传完成！'</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 通过合并 得到一个新对象</span></span><br><span class="line">    <span class="keyword">await</span> saveUserDetailById({ ...this.userInfo, <span class="attr">staffPhoto</span>: fileList &amp;&amp; fileList.length ? fileList[<span class="number">0</span>].url : <span class="string">''</span> })</span><br><span class="line">    <span class="built_in">this</span>.$message.success(<span class="string">'保存基本信息成功'</span>)</span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>上面代码中，upload如果为true，表示该图片已经完成上传，以此来判断图片是否已经上传完成</p>
</blockquote>
<p><strong>保存时读取头像</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">savePersonal</span>(<span class="params"></span>)</span> {</span><br><span class="line">   <span class="keyword">const</span> fileList = <span class="built_in">this</span>.$refs.myStaffPhoto.fileList</span><br><span class="line">   <span class="keyword">if</span> (fileList.some(<span class="function"><span class="params">item</span> =&gt;</span> !item.upload)) {</span><br><span class="line">     <span class="comment">//  如果此时去找 upload为false的图片 找到了说明 有图片还没有上传完成</span></span><br><span class="line">     <span class="built_in">this</span>.$message.warning(<span class="string">'您当前还有图片没有上传完成！'</span>)</span><br><span class="line">     <span class="keyword">return</span></span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">await</span> updatePersonal({ ...this.formData, <span class="attr">staffPhoto</span>: fileList &amp;&amp; fileList.length ? fileList[<span class="number">0</span>].url : <span class="string">''</span> })</span><br><span class="line">   <span class="built_in">this</span>.$message.success(<span class="string">'保存基础信息成功'</span>)</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> ： 在员工详情中应用上传组件</p>
<h2 id="员工列表显示图片"><a href="#员工列表显示图片" class="headerlink" title="员工列表显示图片"></a>员工列表显示图片</h2><p>**<code>目标</code>**：在员工列表中心显示图片</p>
<blockquote>
<p>员工的头像可以在列表项中添加一列来进行显示</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column label="头像" align="center"&gt;</span><br><span class="line">            &lt;template slot-scope="{row}"&gt;</span><br><span class="line">              &lt;img</span><br><span class="line">                slot="reference"</span><br><span class="line">                v-imageerror="require('@/assets/common/bigUserHeader.png')"</span><br><span class="line">                :src="row.staffPhoto "</span><br><span class="line">                style="border-radius: 50%; width: 100px; height: 100px; padding: 10px"</span><br><span class="line">                alt=""</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>我们尝试用之前的指令来处理图片的异常问题，但是发现只有两三张图片能显示</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20201028172654637.png" alt="image-20201028172654637"></p>
<blockquote>
<p>这是因为有的员工的头像的地址为空，给img赋值空的src不能触发错误事件，针对这一特点，我们需要对指令进行升级</p>
</blockquote>
<p>插入节点的钩子里面判断空， 然后在组件更新之后的钩子中同样判断空</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> imageerror = {</span><br><span class="line">  <span class="function"><span class="title">inserted</span>(<span class="params">dom, options</span>)</span> {</span><br><span class="line">    <span class="comment">//   图片异常的逻辑</span></span><br><span class="line">    <span class="comment">//  监听img标签的错误事件  因为图片加载失败 会触发  onerror事件</span></span><br><span class="line">    dom.src = dom.src || options.value</span><br><span class="line"></span><br><span class="line">    dom.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">      <span class="comment">// 图片失败  赋值一个默认的图片</span></span><br><span class="line">      dom.src = options.value</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="title">componentUpdated</span>(<span class="params">dom, options</span>)</span> {</span><br><span class="line">    dom.src = dom.src || options.value</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>这样我们可以看到每个用户的头像了，如果没有头像则显示默认图片</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20201028173333103.png" alt="image-20201028173333103"></p>
<p>**<code>任务</code>**：员工列表显示图片</p>
<h2 id="图片地址生成二维码"><a href="#图片地址生成二维码" class="headerlink" title="图片地址生成二维码"></a>图片地址生成二维码</h2><p><strong><code>目标</code></strong> 将图片地址生成二维码显示</p>
<blockquote>
<p>我们想完成这样一个功能，当我们拥有头像地址时，将头像地址生成一个二维码，用手机扫码来访问</p>
</blockquote>
<p>首先，需要安装生成二维码的插件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i qrcode</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>qrcode的用法是</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QrCode.toCanvas(dom, info)</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>dom为一个canvas的dom对象， info为转化二维码的信息</p>
</blockquote>
<p>我们尝试将canvas标签放到dialog的弹层中</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog title="二维码" :visible.sync="showCodeDialog" @opened="showQrCode" @close="imgUrl=''"&gt;</span><br><span class="line">  &lt;el-row type="flex" justify="center"&gt;</span><br><span class="line">    &lt;canvas ref="myCanvas" /&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>在点击员工的图片时，显示弹层，并将图片地址转化成二维码</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">showQrCode</span>(<span class="params">url</span>)</span> {</span><br><span class="line">  <span class="comment">// url存在的情况下 才弹出层</span></span><br><span class="line">  <span class="keyword">if</span> (url) {</span><br><span class="line">    <span class="built_in">this</span>.showCodeDialog = <span class="literal">true</span> <span class="comment">// 数据更新了 但是我的弹层会立刻出现吗 ？页面的渲染是异步的！！！！</span></span><br><span class="line">    <span class="comment">// 有一个方法可以在上一次数据更新完毕，页面渲染完毕之后</span></span><br><span class="line">    <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> {</span><br><span class="line">      <span class="comment">// 此时可以确认已经有ref对象了</span></span><br><span class="line">      QrCode.toCanvas(<span class="built_in">this</span>.$refs.myCanvas, url) <span class="comment">// 将地址转化成二维码</span></span><br><span class="line">      <span class="comment">// 如果转化的二维码后面信息 是一个地址的话 就会跳转到该地址 如果不是地址就会显示内容</span></span><br><span class="line">    })</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="built_in">this</span>.$message.warning(<span class="string">'该用户还未上传头像'</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20201028180651472.png" alt="image-20201028180651472"></p>
<h2 id="打印员工信息"><a href="#打印员工信息" class="headerlink" title="打印员工信息"></a>打印员工信息</h2><p><strong><code>目标</code></strong> 完成个人信息和工作信息的打印功能</p>
<h3 id="新建打印页面及路由"><a href="#新建打印页面及路由" class="headerlink" title="新建打印页面及路由"></a>新建打印页面及路由</h3><p><strong>创建页面组件</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="dashboard-container" id="myPrint"&gt;</span><br><span class="line">    &lt;div class="app-container"&gt;</span><br><span class="line">      &lt;el-card&gt;</span><br><span class="line">        &lt;el-breadcrumb separator="/" class="titInfo "&gt;</span><br><span class="line">          &lt;el-breadcrumb-item :to="{ path: '/' }"&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">          &lt;el-breadcrumb-item&gt;</span><br><span class="line">            &lt;router-link :to="{'path':'/employees'}"&gt;员工管理&lt;/router-link&gt;</span><br><span class="line">          &lt;/el-breadcrumb-item&gt;</span><br><span class="line">          &lt;el-breadcrumb-item&gt;打印&lt;/el-breadcrumb-item&gt;</span><br><span class="line">        &lt;/el-breadcrumb&gt;</span><br><span class="line">        &lt;div v-if="type === 'personal'"&gt;</span><br><span class="line">          &lt;h2 class="centInfo"&gt;员工信息表&lt;/h2&gt;</span><br><span class="line">          &lt;table cellspacing="0" width="100%" class="tableList"&gt;</span><br><span class="line">            &lt;tr class="title"&gt;</span><br><span class="line">              &lt;td colspan="8" class="centInfo"&gt;基本信息&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th style="width:10%"&gt;姓名&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="6" style="width:80%"&gt;{{ formData.username }}&lt;/td&gt;</span><br><span class="line">              &lt;td rowspan="5" style="width:10%"&gt;&lt;img style="width:155px;height:218px" :src="formData.staffPhoto"&gt;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;性别&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="6"&gt;{{ formData.sex }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;手机&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="6"&gt;{{ formData.mobile }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;出生日期&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="6"&gt;{{ formData.dateOfBirth | formatDate }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;最高学历&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="6"&gt;{{ formData.theHighestDegreeOfEducation }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th style="width:10%"&gt;是否可编辑&lt;/th&gt;</span><br><span class="line">              &lt;td style="width:35%"&gt;{{ formData.isItEditable }}&lt;/td&gt;</span><br><span class="line">              &lt;th style="width:10%"&gt;是否隐藏号码&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5" style="width:45%"&gt;{{ formData.doYouHideNumbers }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;国家地区&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.nationalArea }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;护照号&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.passportNo }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;身份证号&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.idNumber }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;身份证照片&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.iDCardPhoto }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;籍贯&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.nativePlace }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;民族&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.nation }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;英文名&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.englishName }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;婚姻状况&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.maritalStatus }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;员工照片&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.staffPhoto }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;生日&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.birthday }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;属相&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.zodiac }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;年龄&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.age }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;星座&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.constellation }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;血型&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.bloodType }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;户籍所在地&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.domicile }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;政治面貌&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.politicalOutlook }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;入党时间&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.timeToJoinTheParty }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;存档机构&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.archivingOrganization }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;子女状态&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.stateOfChildren }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;子女有无商业保险&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.doChildrenHaveCommercialInsurance }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;有无违法违纪行为&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.isThereAnyViolationOfLawOrDiscipline }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;有无重大病史&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.areThereAnyMajorMedicalHistories }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr class="title"&gt;</span><br><span class="line">              &lt;td colspan="8" class="centInfo"&gt;通讯信息&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;QQ&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.qQ }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;微信&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.weChat }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;居住证城市&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.residenceCardCity }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;居住证办理日期&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.dateOfResidencePermit }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;居住证截止日期&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.residencePermitDeadline }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;现居住地&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.placeOfResidence }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;通讯地址&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.postalAddress }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;联系手机&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.contactTheMobilePhone }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;个人邮箱&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.personalMailbox }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;紧急联系人&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.emergencyContact }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;紧急联系电话&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="7"&gt;{{ formData.emergencyContactNumber }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr class="title"&gt;</span><br><span class="line">              &lt;td colspan="8" class="centInfo"&gt;账号信息&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;社保电脑号&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.socialSecurityComputerNumber }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;公积金账号&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.providentFundAccount }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;银行卡号&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.bankCardNumber }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;开户行&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.openingBank }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr class="title"&gt;</span><br><span class="line">              &lt;td colspan="8" class="centInfo"&gt;教育信息&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;学历类型&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.educationalType }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;毕业学校&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.graduateSchool }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;入学时间&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.enrolmentTime }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;毕业时间&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.graduationTime }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;专业&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.major }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;毕业证书&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.graduationCertificate }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;学位证书&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="7"&gt;{{ formData.certificateOfAcademicDegree }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr class="title"&gt;</span><br><span class="line">              &lt;td colspan="8" class="centInfo"&gt;从业信息&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;上家公司&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.homeCompany }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;职称&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.title }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;简历&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.resume }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;有无竞业限制&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.isThereAnyCompetitionRestriction }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;前公司离职证明&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.proofOfDepartureOfFormerCompany }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;备注&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="5"&gt;{{ formData.remarks }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">          &lt;/table&gt;</span><br><span class="line">          &lt;div class="foot"&gt;签字：___________日期:___________&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div v-else&gt;</span><br><span class="line">          &lt;h2 class="centInfo"&gt;岗位信息表&lt;/h2&gt;</span><br><span class="line">          &lt;table cellspacing="0" width="100%" class="tableList"&gt;</span><br><span class="line">            &lt;tr class="title"&gt;</span><br><span class="line">              &lt;td colspan="4" class="centInfo"&gt;基本信息&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th style="width:10%"&gt;姓名&lt;/th&gt;</span><br><span class="line">              &lt;td style="width:40%"&gt;{{ formData.username }}&lt;/td&gt;</span><br><span class="line">              &lt;th style="width:10%"&gt;入职日期&lt;/th&gt;</span><br><span class="line">              &lt;td style="width:40%"&gt;{{ formData.dateOfEntry }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;部门&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.departmentName }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;岗位&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.post }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;工作邮箱&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.workMailbox }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;工号&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.workNumber }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;转正日期&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.dateOfCorrection }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;转正状态&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.stateOfCorrection }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;职级&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.rank }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;汇报对象&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.reportName }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;HRBP&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.hRBP }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;聘用形式&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.formOfEmployment }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;管理形式&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.formOfManagement }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;调整司龄&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.adjustmentAgedays }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;司龄&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.ageOfDivision }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;首次参加工作时间&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.workingTimeForTheFirstTime }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;调整工龄天&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.adjustmentOfLengthOfService }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;工龄&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.workingYears }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;纳税城市&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.taxableCity }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;转正评价&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.correctionEvaluation }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr class="title"&gt;</span><br><span class="line">              &lt;td colspan="4" class="centInfo"&gt;合同信息&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;首次合同开始时间&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.initialContractStartTime }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;首次合同结束时间&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.firstContractTerminationTime }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;现合同开始时间&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.currentContractStartTime }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;现合同结束时间&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.closingTimeOfCurrentContract }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;合同期限&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.contractPeriod }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;合同文件&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.contractDocuments }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;续签次数&lt;/th&gt;</span><br><span class="line">              &lt;td colspan="3"&gt;{{ formData.renewalNumber }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr class="title"&gt;</span><br><span class="line">              &lt;td colspan="4" class="centInfo"&gt;招聘信息&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;其他招聘渠道&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.otherRecruitmentChannels }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;招聘渠道&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.recruitmentChannels }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">              &lt;th&gt;社招校招&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.socialRecruitment }}&lt;/td&gt;</span><br><span class="line">              &lt;th&gt;推荐企业人&lt;/th&gt;</span><br><span class="line">              &lt;td&gt;{{ formData.recommenderBusinessPeople }}&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">          &lt;/table&gt;</span><br><span class="line">          &lt;div class="foot"&gt;签字：___________日期:___________&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-card&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { getPersonalDetail, getJobDetail } from '@/api/employees'</span><br><span class="line">import { getUserDetailById } from '@/api/user'</span><br><span class="line">export default {</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      formData: {},</span><br><span class="line">      userId: this.$route.params.id,</span><br><span class="line">      type: this.$route.query.type // 打印类型</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  // 创建完毕状态</span><br><span class="line">  created() {</span><br><span class="line">    this.type === 'personal' ? this.getPersonalDetail() : this.getJobDetail()</span><br><span class="line">  },</span><br><span class="line">  // 组件更新</span><br><span class="line">  methods: {</span><br><span class="line">    async getPersonalDetail() {</span><br><span class="line">      this.formData = await getPersonalDetail(this.userId) // 获取个人基本信息</span><br><span class="line">    },</span><br><span class="line">    async getJobDetail() {</span><br><span class="line">      const userInfo = await getUserDetailById(this.userId)</span><br><span class="line">      const jobInfo = await getJobDetail(this.userId) // 获取个人基本信息</span><br><span class="line">      this.formData = { ...userInfo, ...jobInfo }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="scss"&gt;</span><br><span class="line">.foot {</span><br><span class="line">  padding: 30px 0;</span><br><span class="line">  text-align: right;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>该页面内容实际上就是读取个人和详情的接口数据，根据传入的type类型决定显示个人还是岗位</p>
</blockquote>
<p>type为**<code>personal</code><strong>时显示个人，为</strong><code>job</code>**时显示岗位</p>
<p><strong>新建打印页面路由</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">path</span>: <span class="string">'print/:id'</span>, <span class="comment">// 二级默认路由</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/employees/print'</span>), <span class="comment">// 按需加载</span></span><br><span class="line">    <span class="attr">hidden</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">meta</span>: {</span><br><span class="line">      <span class="attr">title</span>: <span class="string">'打印'</span>, <span class="comment">// 标记当前路由规则的中文名称 后续在做左侧菜单时 使用</span></span><br><span class="line">      <span class="attr">icon</span>: <span class="string">'people'</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p>完成详情到打印的跳转</p>
<p><strong>个人</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-row type="flex" justify="end"&gt;</span><br><span class="line">           &lt;el-tooltip content="打印个人基本信息"&gt;</span><br><span class="line">               &lt;router-link :to="`/employees/print/${userId}?type=personal`"&gt;</span><br><span class="line">                 &lt;i class="el-icon-printer" /&gt;</span><br><span class="line">               &lt;/router-link&gt;</span><br><span class="line">            &lt;/el-tooltip&gt;</span><br><span class="line"> &lt;/el-row&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>岗位</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-row type="flex" justify="end"&gt;</span><br><span class="line">            &lt;el-tooltip content="打印岗位信息"&gt;</span><br><span class="line">              &lt;router-link :to="`/employees/print/${userId}?type=job`"&gt;</span><br><span class="line">                &lt;i class="el-icon-printer"  /&gt;</span><br><span class="line">              &lt;/router-link&gt;</span><br><span class="line">            &lt;/el-tooltip&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="利用vue-print-nb进行打印"><a href="#利用vue-print-nb进行打印" class="headerlink" title="利用vue-print-nb进行打印"></a>利用vue-print-nb进行打印</h3><p>首先，打印功能我们借助一个比较流行的插件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i vue-print-nb</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>它的用法是 </p>
</blockquote>
<p>首先注册该插件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Print <span class="keyword">from</span> <span class="string">'vue-print-nb'</span></span><br><span class="line">Vue.use(Print);</span><br></pre></td></tr></tbody></table></figure>

<p>使用v-print指令的方式进行打印</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-row type="flex" justify="end"&gt;</span><br><span class="line">        &lt;el-button v-print="printObj" size="small" type="primary"&gt;打印&lt;/el-button&gt;</span><br><span class="line"> &lt;/el-row&gt;</span><br><span class="line"> printObj: {</span><br><span class="line">      id: 'myPrint'</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<p>最终，我们看到的效果</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200728013006535.png" alt="image-20200728013006535"></p>
<p><strong>提交代码</strong></p>
<h1 id="8-权限设计和管理"><a href="#8-权限设计和管理" class="headerlink" title="8.权限设计和管理"></a>8.权限设计和管理</h1><h2 id="权限设计-RBAC的权限设计思想"><a href="#权限设计-RBAC的权限设计思想" class="headerlink" title="权限设计-RBAC的权限设计思想"></a>权限设计-RBAC的权限设计思想</h2><blockquote>
<p>首先，我们先了解下什么是传统的权限设计</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200901150655343.png" alt="image-20200901150655343"></p>
<p>从上面的图中，我们发现，传统的权限设计是对每个人进行单独的权限设置，但这种方式已经不适合目前企业的高效管控权限的发展需求，因为每个人都要单独去设置权限</p>
<blockquote>
<p>  基于此，RBAC的权限模型就应运而生了，RBAC(Role-Based Access control) ，也就是基于角色的权限分配解决方案，相对于传统方案，RBAC提供了中间层Role（角色），其权限模式如下</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200901151025021.png" alt="image-20200901151025021"></p>
<p>RBAC实现了用户和权限点的分离，想对某个用户设置权限，只需要对该用户设置相应的角色即可，而该角色就拥有了对应的权限，这样一来，权限的分配和设计就做到了极简，高效，当想对用户收回权限时，只需要收回角色即可，接下来，我们就在该项目中实施这一设想</p>
<h2 id="给分配员工角色"><a href="#给分配员工角色" class="headerlink" title="给分配员工角色"></a>给分配员工角色</h2><p>**<code>目标</code>**在员工管理页面，分配角色</p>
<h3 id="新建分配角色窗体"><a href="#新建分配角色窗体" class="headerlink" title="新建分配角色窗体"></a>新建分配角色窗体</h3><blockquote>
<p>在上一节章节中，员工管理的角色功能，我们并没有实现，此章节我们实现给员工分配角色</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200901151151286.png" alt="image-20200901151151286"></p>
<p>从上图中，可以看出，用户和角色是**<code>1对多</code>**的关系，即一个用户可以拥有多个角色，比如公司的董事长可以拥有总经理和系统管理员一样的角色</p>
<p>首先，新建分配角色窗体 <strong><code>assign-role.vue</code></strong>   </p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200728172853451.png" alt="image-20200728172853451"></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog title="分配角色" :visible="showRoleDialog"&gt;</span><br><span class="line">    &lt;!-- el-checkbox-group选中的是 当前用户所拥有的角色  需要绑定 当前用户拥有的角色--&gt;</span><br><span class="line">    &lt;el-checkbox-group&gt;</span><br><span class="line">      &lt;!-- 选项 --&gt;</span><br><span class="line">    &lt;/el-checkbox-group&gt;</span><br><span class="line">    &lt;el-row slot="footer" type="flex" justify="center"&gt;</span><br><span class="line">      &lt;el-col :span="6"&gt;</span><br><span class="line">        &lt;el-button type="primary" size="small"&gt;确定&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button size="small"&gt;取消&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  props: {</span><br><span class="line">    showRoleDialog: {</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    },</span><br><span class="line">    // 用户的id 用来查询当前用户的角色信息</span><br><span class="line">    userId: {</span><br><span class="line">      type: String,</span><br><span class="line">      default: null</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="获取角色列表和当前用户角色"><a href="#获取角色列表和当前用户角色" class="headerlink" title="获取角色列表和当前用户角色"></a>获取角色列表和当前用户角色</h3><p><strong>获取所有角色列表</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 分配角色 --&gt;</span><br><span class="line">  &lt;el-checkbox-group v-model="roleIds"&gt;</span><br><span class="line">    &lt;el-checkbox v-for="item in list" :key="item.id" :label="item.id"&gt;</span><br><span class="line">      {{</span><br><span class="line">        item.name</span><br><span class="line">      }}</span><br><span class="line">    &lt;/el-checkbox&gt;</span><br><span class="line">  &lt;/el-checkbox-group&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>获取角色列表</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getRoleList } <span class="keyword">from</span> <span class="string">'@/api/setting'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">props</span>: {</span><br><span class="line">    <span class="attr">showRoleDialog</span>: {</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">    },</span><br><span class="line">    <span class="attr">userId</span>: {</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">null</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">list</span>: [], <span class="comment">// 角色列表</span></span><br><span class="line">      <span class="attr">roleIds</span>: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="built_in">this</span>.getRoleList()</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="comment">//  获取所有角色</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getRoleList</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="keyword">const</span> { rows } = <span class="keyword">await</span> getRoleList()</span><br><span class="line">      <span class="built_in">this</span>.list = rows</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>获取用户的当前角色</strong>  </p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { getUserDetailById } <span class="keyword">from</span> <span class="string">'@/api/user'</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">async</span> <span class="function"><span class="title">getUserDetailById</span>(<span class="params">id</span>)</span> {</span><br><span class="line">      <span class="keyword">const</span> { roleIds } = <span class="keyword">await</span> getUserDetailById(id)</span><br><span class="line">      <span class="built_in">this</span>.roleIds = roleIds <span class="comment">// 赋值本用户的角色</span></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>点击角色弹出层</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 编辑角色</span><br><span class="line"> async  editRole(id) {</span><br><span class="line">      this.userId = id // props传值 是异步的</span><br><span class="line">      await this.$refs.assignRole.getUserDetailById(id) // 父组件调用子组件方法</span><br><span class="line">      this.showRoleDialog = true</span><br><span class="line">    },</span><br><span class="line">  &lt;!-- 放置角色分配组件 --&gt;</span><br><span class="line"> &lt;assign-role ref="assignRole" :show-role-dialog.sync="showRoleDialog" :user-id="userId" /&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="给员工分配角色"><a href="#给员工分配角色" class="headerlink" title="给员工分配角色"></a>给员工分配角色</h3><p><strong>分配角色接口</strong>  <strong><code>api/employees.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> * 给用户分配角色</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">assignRoles</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/user/assignRoles'</span>,</span><br><span class="line">    data,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'put'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>确定保存</strong>  <strong><code>assign-role</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="keyword">await</span> assignRoles({ <span class="attr">id</span>: <span class="built_in">this</span>.userId, <span class="attr">roleIds</span>: <span class="built_in">this</span>.roleIds })</span><br><span class="line">      <span class="comment">//   关闭窗体</span></span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">'update:showRoleDialog'</span>, <span class="literal">false</span>)</span><br><span class="line">    },</span><br></pre></td></tr></tbody></table></figure>

<p>**取消或者关闭 **  <strong><code>assign-role</code></strong> </p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">btnCancel</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.roleIds = [] <span class="comment">// 清空原来的数组</span></span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">'update:showRoleDialog'</span>, <span class="literal">false</span>)</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 分配员工权限</p>
<h2 id="权限点管理页面开发"><a href="#权限点管理页面开发" class="headerlink" title="权限点管理页面开发"></a>权限点管理页面开发</h2><p>**<code>目标</code>**： 完成权限点页面的开发和管理</p>
<h3 id="新建权限点管理页面"><a href="#新建权限点管理页面" class="headerlink" title="新建权限点管理页面"></a>新建权限点管理页面</h3><blockquote>
<p>人已经有了角色， 那么权限是什么</p>
</blockquote>
<p>在企业服务中，权限一般分割为 <strong>页面访问权限</strong>，<strong>按钮操作权限</strong>，<strong>API访问权限</strong></p>
<blockquote>
<p>API权限多见于在后端进行拦截，所以我们这一版本只做**<code>页面访问</code><strong>和</strong><code>按钮操作授权</code>/**</p>
</blockquote>
<p>由此，我们可以根据业务需求设计权限管理页面</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200901160508382.png" alt="image-20200901160508382"></p>
<p><strong>完成权限页面结构</strong> <strong><code>src/views/permission/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="dashboard-container"&gt;</span><br><span class="line">    &lt;div class="app-container"&gt;</span><br><span class="line">      &lt;!-- 靠右的按钮 --&gt;</span><br><span class="line">      &lt;page-tools&gt;</span><br><span class="line">        &lt;template v-slot:after&gt;</span><br><span class="line">          &lt;el-button type="primary" size="small"&gt;添加权限&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/page-tools&gt;</span><br><span class="line">      &lt;!-- 表格 --&gt;</span><br><span class="line">      &lt;el-table border&gt;</span><br><span class="line">        &lt;el-table-column align="center" label="名称" /&gt;</span><br><span class="line">        &lt;el-table-column align="center" label="标识" /&gt;</span><br><span class="line">        &lt;el-table-column align="center" label="描述" /&gt;</span><br><span class="line">        &lt;el-table-column align="center" label="操作"&gt;</span><br><span class="line">          &lt;template&gt;</span><br><span class="line">            &lt;el-button type="text"&gt;添加&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type="text"&gt;编辑&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type="text"&gt;删除&lt;/el-button&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">      &lt;/el-table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>封装权限管理的增删改查请求</strong>  <strong><code>src/api/permisson.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getPermissionList</span>(<span class="params">params</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/permission'</span>,</span><br><span class="line">    params</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 新增权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addPermission</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/permission'</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'post'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updatePermission</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">${data.id}</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'put'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">delPermission</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">${id}</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'delete'</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 获取权限详情</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getPermissionDetail</span>(<span class="params">id</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">${id}</span>`</span></span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="获取权限数据并转化树形"><a href="#获取权限数据并转化树形" class="headerlink" title="获取权限数据并转化树形"></a>获取权限数据并转化树形</h3><p>这里，我们通过树形操作方法，将列表转化成层级数据</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import { getPermissionList } from '@/api/permission'</span><br><span class="line">import { transListToTreeData } from '@/utils'</span><br><span class="line">export default {</span><br><span class="line">data() {</span><br><span class="line">    return {</span><br><span class="line">      list: [],</span><br><span class="line">      formData: {</span><br><span class="line">        name: '', // 名称</span><br><span class="line">        code: '', // 标识</span><br><span class="line">        description: '', // 描述</span><br><span class="line">        type: '', // 类型 该类型 不需要显示 因为点击添加的时候已经知道类型了</span><br><span class="line">        pid: '', // 因为做的是树 需要知道添加到哪个节点下了</span><br><span class="line">        enVisible: '0' // 开启</span><br><span class="line">      },</span><br><span class="line">      rules: {</span><br><span class="line">        name: [{ required: true, message: '权限名称不能为空', trigger: 'blur' }],</span><br><span class="line">        code: [{ required: true, message: '权限标识不能为空', trigger: 'blur' }]</span><br><span class="line">      },</span><br><span class="line">      showDialog: false</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created() {</span><br><span class="line">    this.getPermissionList()</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    showText() {</span><br><span class="line">      return this.formData.id ? '编辑' : '新增'</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    async  getPermissionList() {</span><br><span class="line">      this.list = transListToTreeData(await getPermissionList(), '0')</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>绑定表格数据</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table :data="list" border="" row-key="id"&gt;</span><br><span class="line">        &lt;el-table-column label="名称" prop="name" /&gt;</span><br><span class="line">        &lt;el-table-column label="标识" prop="code" /&gt;</span><br><span class="line">        &lt;el-table-column label="描述" prop="description" /&gt;</span><br><span class="line">        &lt;el-table-column label="操作"&gt;</span><br><span class="line">          &lt;template slot-scope="{ row }"&gt;</span><br><span class="line">            &lt;el-button v-if="row.type === 1" type="text" @click="addPermission(row.id, 2)"&gt;添加&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type="text" @click="editPermission(row.id)"&gt;编辑&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type="text" @click="delPermission(row.id)"&gt; 删除&lt;/el-button&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/el-table&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>需要注意的是， 如果需要树表， 需要给<strong>el-table</strong>配置<strong>row-key</strong>属性  id</p>
<blockquote>
<p>当type为1时为访问权限，type为2时为功能权限</p>
</blockquote>
<blockquote>
<p>和前面内容一样，我们需要完成 新增权限 / 删除权限 / 编辑权限</p>
</blockquote>
<h3 id="新增编辑权限的弹层"><a href="#新增编辑权限的弹层" class="headerlink" title="新增编辑权限的弹层"></a>新增编辑权限的弹层</h3><p><strong>新增权限/编辑权限弹层</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 放置一个弹层 用来编辑新增节点 --&gt;</span><br><span class="line"> &lt;el-dialog :title="`${showText}权限点`" :visible="showDialog" @close="btnCancel"&gt;</span><br><span class="line">    &lt;!-- 表单 --&gt;</span><br><span class="line">    &lt;el-form ref="perForm" :model="formData" :rules="rules" label-width="120px"&gt;</span><br><span class="line">      &lt;el-form-item label="权限名称" prop="name"&gt;</span><br><span class="line">        &lt;el-input v-model="formData.name" style="width:90%" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="权限标识" prop="code"&gt;</span><br><span class="line">        &lt;el-input v-model="formData.code" style="width:90%" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="权限描述"&gt;</span><br><span class="line">        &lt;el-input v-model="formData.description" style="width:90%" /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label="开启"&gt;</span><br><span class="line">        &lt;el-switch</span><br><span class="line">          v-model="formData.enVisible"</span><br><span class="line">          active-value="1"</span><br><span class="line">          inactive-value="0"</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;el-row slot="footer" type="flex" justify="center"&gt;</span><br><span class="line">      &lt;el-col :span="6"&gt;</span><br><span class="line">        &lt;el-button size="small" type="primary" @click="btnOK"&gt;确定&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button size="small" @click="btnCancel"&gt;取消&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="新增，编辑，删除权限点"><a href="#新增，编辑，删除权限点" class="headerlink" title="新增，编辑，删除权限点"></a>新增，编辑，删除权限点</h3><p><strong>新增/删除/编辑逻辑</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { updatePermission, addPermission, getPermissionDetail, delPermission, getPermissionList } <span class="keyword">from</span> <span class="string">'@/api/permission'</span></span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">     <span class="comment">// 删除操作</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">delPermission</span>(<span class="params">id</span>)</span> {</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">await</span> <span class="built_in">this</span>.$confirm(<span class="string">'确定要删除该数据吗'</span>)</span><br><span class="line">        <span class="keyword">await</span> delPermission(id)</span><br><span class="line">        <span class="built_in">this</span>.getPermissionList()</span><br><span class="line">        <span class="built_in">this</span>.$message.success(<span class="string">'删除成功'</span>)</span><br><span class="line">      } <span class="keyword">catch</span> (error) {</span><br><span class="line">        <span class="built_in">console</span>.log(error)</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.$refs.perForm.validate().then(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.formData.id) {</span><br><span class="line">          <span class="keyword">return</span> updatePermission(<span class="built_in">this</span>.formData)</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> addPermission(<span class="built_in">this</span>.formData)</span><br><span class="line">      }).then(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="comment">//  提示消息</span></span><br><span class="line">        <span class="built_in">this</span>.$message.success(<span class="string">'新增成功'</span>)</span><br><span class="line">        <span class="built_in">this</span>.getPermissionList()</span><br><span class="line">        <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    <span class="function"><span class="title">btnCancel</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.formData = {</span><br><span class="line">        <span class="attr">name</span>: <span class="string">''</span>, <span class="comment">// 名称</span></span><br><span class="line">        <span class="attr">code</span>: <span class="string">''</span>, <span class="comment">// 标识</span></span><br><span class="line">        <span class="attr">description</span>: <span class="string">''</span>, <span class="comment">// 描述</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">''</span>, <span class="comment">// 类型 该类型 不需要显示 因为点击添加的时候已经知道类型了</span></span><br><span class="line">        <span class="attr">pid</span>: <span class="string">''</span>, <span class="comment">// 因为做的是树 需要知道添加到哪个节点下了</span></span><br><span class="line">        <span class="attr">enVisible</span>: <span class="string">'0'</span> <span class="comment">// 开启</span></span><br><span class="line">      }</span><br><span class="line">      <span class="built_in">this</span>.$refs.perForm.resetFields()</span><br><span class="line">      <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">    },</span><br><span class="line">    <span class="function"><span class="title">addPermission</span>(<span class="params">pid, type</span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.formData.pid = pid</span><br><span class="line">      <span class="built_in">this</span>.formData.type = type</span><br><span class="line">      <span class="built_in">this</span>.showDialog = <span class="literal">true</span></span><br><span class="line">    },</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">editPermission</span>(<span class="params">id</span>)</span> {</span><br><span class="line">      <span class="comment">// 根据获取id获取详情</span></span><br><span class="line">      <span class="built_in">this</span>.formData = <span class="keyword">await</span> getPermissionDetail(id)</span><br><span class="line">      <span class="built_in">this</span>.showDialog = <span class="literal">true</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"> </span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong>: 权限点管理页面开发</p>
<h2 id="给角色分配权限"><a href="#给角色分配权限" class="headerlink" title="给角色分配权限"></a>给角色分配权限</h2><p>**<code>目标</code>**： 完成给角色分配权限的业务</p>
<h3 id="新建分配权限弹出层"><a href="#新建分配权限弹出层" class="headerlink" title="新建分配权限弹出层"></a>新建分配权限弹出层</h3><blockquote>
<p>在公司设置的章节中，我们没有实现分配权限的功能，在这里我们来实现一下</p>
</blockquote>
<p><strong>封装分配权限的api</strong>  <strong><code>src/api/setting.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给角色分配权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">assignPerm</span>(<span class="params">data</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> request({</span><br><span class="line">    <span class="attr">url</span>: <span class="string">'/sys/role/assignPrem'</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">'put'</span>,</span><br><span class="line">    data</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p><strong>给角色分配权限弹出层</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog title="分配权限" :visible="showPermDialog" @close="btnPermCancel"&gt;</span><br><span class="line">      &lt;!-- 权限是一颗树 --&gt;</span><br><span class="line">      &lt;!-- 将数据绑定到组件上 --&gt;</span><br><span class="line">      &lt;!-- check-strictly 如果为true 那表示父子勾选时  不互相关联 如果为false就互相关联 --&gt;</span><br><span class="line">      &lt;!-- id作为唯一标识 --&gt;</span><br><span class="line">      &lt;el-tree</span><br><span class="line">        ref="permTree"</span><br><span class="line">        :data="permData"</span><br><span class="line">        :props="defaultProps"</span><br><span class="line">        :show-checkbox="true"</span><br><span class="line">        :check-strictly="true"</span><br><span class="line">        :default-expand-all="true"</span><br><span class="line">        :default-checked-keys="selectCheck"</span><br><span class="line">        node-key="id"</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!-- 确定 取消 --&gt;</span><br><span class="line">      &lt;el-row slot="footer" type="flex" justify="center"&gt;</span><br><span class="line">        &lt;el-col :span="6"&gt;</span><br><span class="line">          &lt;el-button type="primary" size="small" @click="btnPermOK"&gt;确定&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button size="small" @click="btnPermCancel"&gt;取消&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>定义数据</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">showPermDialog: <span class="literal">false</span>, <span class="comment">// 控制分配权限弹层的显示后者隐藏</span></span><br><span class="line"><span class="attr">defaultProps</span>: {</span><br><span class="line">  <span class="attr">label</span>: <span class="string">'name'</span></span><br><span class="line">},</span><br><span class="line"> <span class="attr">permData</span>: [], <span class="comment">// 专门用来接收权限数据 树形数据</span></span><br><span class="line"><span class="attr">selectCheck</span>: [], <span class="comment">// 定义一个数组来接收 已经选中的节点</span></span><br><span class="line"><span class="attr">roleId</span>: <span class="literal">null</span> <span class="comment">// 用来记录分配角色的id</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>点击分配权限</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button size="small" type="success" @click="assignPerm(row.id)"&gt;分配权限&lt;/el-button&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="给角色分配权限-1"><a href="#给角色分配权限-1" class="headerlink" title="给角色分配权限"></a>给角色分配权限</h3><p><strong>分配权限</strong>/<strong>树形数据</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> { transListToTreeData } <span class="keyword">from</span> <span class="string">'@/utils'</span></span><br><span class="line"><span class="keyword">import</span> { getPermissionList } <span class="keyword">from</span> <span class="string">'@/api/permission'</span></span><br><span class="line"><span class="attr">methods</span>: {</span><br><span class="line">    <span class="comment">// 点击分配权限</span></span><br><span class="line">  <span class="comment">// 获取权限点数据 在点击的时候调用 获取权限点数据</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">assignPerm</span>(<span class="params">id</span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.permData = tranListToTreeData(<span class="keyword">await</span> getPermissionList(), <span class="string">'0'</span>) <span class="comment">// 转化list到树形数据</span></span><br><span class="line">      <span class="built_in">this</span>.roleId = id</span><br><span class="line">      <span class="comment">// 应该去获取 这个id的 权限点</span></span><br><span class="line">      <span class="comment">// 有id 就可以 id应该先记录下来</span></span><br><span class="line">      <span class="keyword">const</span> { permIds } = <span class="keyword">await</span> getRoleDetail(id) <span class="comment">// permIds是当前角色所拥有的权限点数据</span></span><br><span class="line">      <span class="built_in">this</span>.selectCheck = permIds <span class="comment">// 将当前角色所拥有的权限id赋值</span></span><br><span class="line">      <span class="built_in">this</span>.showPermDialog = <span class="literal">true</span></span><br><span class="line">    },</span><br><span class="line">    <span class="keyword">async</span>  <span class="function"><span class="title">btnPermOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="comment">// 调用el-tree的方法</span></span><br><span class="line">      <span class="comment">// console.log(this.$refs.permTree.getCheckedKeys())</span></span><br><span class="line">      <span class="keyword">await</span> assignPerm({ <span class="attr">permIds</span>: <span class="built_in">this</span>.$refs.permTree.getCheckedKeys(), <span class="attr">id</span>: <span class="built_in">this</span>.roleId })</span><br><span class="line">      <span class="built_in">this</span>.$message.success(<span class="string">'分配权限成功'</span>)</span><br><span class="line">      <span class="built_in">this</span>.showPermDialog = <span class="literal">false</span></span><br><span class="line">    },</span><br><span class="line">    <span class="function"><span class="title">btnPermCancel</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.selectCheck = [] <span class="comment">// 重置数据</span></span><br><span class="line">      <span class="built_in">this</span>.showPermDialog = <span class="literal">false</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 给角色分配权限</p>
<h2 id="前端权限应用-页面访问和菜单"><a href="#前端权限应用-页面访问和菜单" class="headerlink" title="前端权限应用-页面访问和菜单"></a>前端权限应用-页面访问和菜单</h2><p>**<code>目标</code>**： 在当前项目应用用户的页面访问权限</p>
<h3 id="权限受控的主体思路"><a href="#权限受控的主体思路" class="headerlink" title="权限受控的主体思路"></a>权限受控的主体思路</h3><blockquote>
<p>到了最关键的环节，我们设置的权限如何应用？</p>
</blockquote>
<p>在上面的几个小节中，我们已经把给用户分配了角色， 给角色分配了权限，那么在用户登录获取资料的时候，会自动查出该用户拥有哪些权限，这个权限需要和我们的菜单还有路由有效结合起来</p>
<blockquote>
<p>我们在路由和页面章节中，已经介绍过，动态权限其实就是根据用户的实际权限来访问的，接下来我们操作一下</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200730002842243.png" alt="image-20200730002842243"></p>
<p>在权限管理页面中，我们设置了一个<strong>标识</strong>， 这个标识可以和我们的路由模块进行关联，也就是说，如果用户拥有这个标识，那么用户就可以<strong>拥有这个路由模块</strong>，如果没有这个标识，就不能<strong>访问路由模块</strong></p>
<blockquote>
<p>用什么来实现？</p>
</blockquote>
<p>vue-router提供了一个叫做<a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/api/#router-addroutes">addRoutes</a>的API方法，这个方法的含义是<strong>动态添加路由规则</strong></p>
<p>思路如下</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200901164312005.png" alt="image-20200901164312005"></p>
<h3 id="新建Vuex中管理权限的模块"><a href="#新建Vuex中管理权限的模块" class="headerlink" title="新建Vuex中管理权限的模块"></a>新建Vuex中管理权限的模块</h3><blockquote>
<p> 在<strong>主页模块</strong>章节中，我们将用户的资料设置到vuex中，其中便有权限数据，我们可以就此进行操作</p>
</blockquote>
<p>我们可以在vuex中新增一个permission模块</p>
<p><strong><code>src/store/modules/permission.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vuex的权限模块</span></span><br><span class="line"><span class="keyword">import</span> { constantRoutes } <span class="keyword">from</span> <span class="string">'@/router'</span></span><br><span class="line"><span class="comment">// vuex中的permission模块用来存放当前的 静态路由 + 当前用户的 权限路由</span></span><br><span class="line"><span class="keyword">const</span> state = {</span><br><span class="line">  <span class="attr">routes</span>: constantRoutes <span class="comment">// 所有人默认拥有静态路由</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">const</span> mutations = {</span><br><span class="line">  <span class="comment">// newRoutes可以认为是 用户登录 通过权限所得到的动态路由的部分</span></span><br><span class="line">  <span class="function"><span class="title">setRoutes</span>(<span class="params">state, newRoutes</span>)</span> {</span><br><span class="line">    <span class="comment">// 下面这么写不对 不是语法不对 是业务不对</span></span><br><span class="line">    <span class="comment">// state.routes = [...state.routes, ...newRoutes]</span></span><br><span class="line">    <span class="comment">// 有一种情况  张三 登录 获取了动态路由 追加到路由上  李四登录 4个动态路由</span></span><br><span class="line">    <span class="comment">// 应该是每次更新 都应该在静态路由的基础上进行追加</span></span><br><span class="line">    state.routes = [...constantRoutes, ...newRoutes]</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">const</span> actions = {}</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>在Vuex管理模块中引入permisson模块</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> permission <span class="keyword">from</span> <span class="string">'./modules/permission'</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store({</span><br><span class="line">  <span class="attr">modules</span>: {</span><br><span class="line">    <span class="comment">// 子模块   $store.state.app.</span></span><br><span class="line">    <span class="comment">// mapGetters([])</span></span><br><span class="line">    app,</span><br><span class="line">    settings,</span><br><span class="line">    user,</span><br><span class="line">    permission</span><br><span class="line">  },</span><br><span class="line">  getters</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Vuex筛选权限路由"><a href="#Vuex筛选权限路由" class="headerlink" title="Vuex筛选权限路由"></a>Vuex筛选权限路由</h3><blockquote>
<p> OK， 那么我们在哪将用户的标识和权限进行关联呢 ？</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200815184203715.png" alt="image-20200815184203715"></p>
<p>我们可以在这张图中，进一步的进行操作</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200815184407204.png" alt="image-20200815184407204"></p>
<p>访问权限的数据在用户属性**<code>menus</code><strong>中，</strong><code>menus</code>**中的标识该怎么和路由对应呢？</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200815185230597.png" alt="image-20200815185230597"></p>
<blockquote>
<p>  可以将路由模块的根节点**<code>name</code>**属性命名和权限标识一致，这样只要标识能对上，就说明用户拥有了该权限</p>
</blockquote>
<p>这一步，在我们命名路由的时候已经操作过了</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200730011629326.png" alt="image-20200730011629326"></p>
<p>接下来， vuex的permission中提供一个action，进行关联</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { asyncRoutes, constantRoutes } <span class="keyword">from</span> <span class="string">'@/router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = {</span><br><span class="line">  <span class="comment">// 筛选权限路由</span></span><br><span class="line">  <span class="comment">// 第二个参数为当前用户的所拥有的菜单权限</span></span><br><span class="line">  <span class="comment">// menus: ["settings","permissions"]</span></span><br><span class="line">  <span class="comment">// asyncRoutes是所有的动态路由</span></span><br><span class="line">  <span class="comment">// asyncRoutes  [{path: 'setting',name: 'setting'},{}]</span></span><br><span class="line">  <span class="function"><span class="title">filterRoutes</span>(<span class="params">context, menus</span>)</span> {</span><br><span class="line">    <span class="keyword">const</span> routes = []</span><br><span class="line">    <span class="comment">//   筛选出 动态路由中和menus中能够对上的路由</span></span><br><span class="line">    menus.forEach(<span class="function"><span class="params">key</span> =&gt;</span> {</span><br><span class="line">      <span class="comment">// key就是标识</span></span><br><span class="line">      <span class="comment">// asyncRoutes 找 有没有对象中的name属性等于 key的 如果找不到就没权限 如果找到了 要筛选出来</span></span><br><span class="line">      routes.push(...asyncRoutes.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.name === key)) <span class="comment">// 得到一个数组 有可能 有元素 也有可能是空数组</span></span><br><span class="line">    })</span><br><span class="line">    <span class="comment">// 得到的routes是所有模块中满足权限要求的路由数组</span></span><br><span class="line">    <span class="comment">// routes就是当前用户所拥有的 动态路由的权限</span></span><br><span class="line">    context.commit(<span class="string">'setRoutes'</span>, routes) <span class="comment">// 将动态路由提交给mutations</span></span><br><span class="line">    <span class="keyword">return</span> routes <span class="comment">// 这里为什么还要return  state数据 是用来 显示左侧菜单用的  return  是给路由addRoutes用的</span></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="权限拦截出调用筛选权限Action"><a href="#权限拦截出调用筛选权限Action" class="headerlink" title="权限拦截出调用筛选权限Action"></a>权限拦截出调用筛选权限Action</h3><p>在拦截的位置，调用关联action， 获取新增routes，并且<strong>addRoutes</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 权限拦截在路由跳转  导航守卫</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'@/router'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span> <span class="comment">// 引入store实例 和组件中的this.$store是一回事</span></span><br><span class="line"><span class="keyword">import</span> nprogress <span class="keyword">from</span> <span class="string">'nprogress'</span> <span class="comment">// 引入进度条</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'nprogress/nprogress.css'</span> <span class="comment">// 引入进度条样式</span></span><br><span class="line"><span class="comment">// 不需要导出  因为只需要让代码执行即可</span></span><br><span class="line"><span class="comment">// 前置守卫</span></span><br><span class="line"><span class="comment">// next是前置守卫必须必须必须执行的钩子  next必须执行 如果不执行 页面就死了</span></span><br><span class="line"><span class="comment">// next()  放过</span></span><br><span class="line"><span class="comment">// next(false) 跳转终止</span></span><br><span class="line"><span class="comment">// next(地址) 跳转到某个地址</span></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">'/login'</span>, <span class="string">'/404'</span>] <span class="comment">// 定义白名单</span></span><br><span class="line">router.beforeEach(<span class="keyword">async</span>(to, <span class="keyword">from</span>, next) =&gt; {</span><br><span class="line">  nprogress.start() <span class="comment">// 开启进度条的意思</span></span><br><span class="line">  <span class="keyword">if</span> (store.getters.token) {</span><br><span class="line">    <span class="comment">// 只有有token的情况下 才能获取资料</span></span><br><span class="line">    <span class="comment">//   如果有token</span></span><br><span class="line">    <span class="keyword">if</span> (to.path === <span class="string">'/login'</span>) {</span><br><span class="line">      <span class="comment">// 如果要访问的是 登录页</span></span><br><span class="line">      next(<span class="string">'/'</span>) <span class="comment">// 跳到主页  // 有token 用处理吗？不用</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// 只有放过的时候才去获取用户资料</span></span><br><span class="line">      <span class="comment">// 是每次都获取吗</span></span><br><span class="line">      <span class="comment">// 如果当前vuex中有用户的资料的id 表示 已经有资料了 不需要获取了 如果没有id才需要获取</span></span><br><span class="line">      <span class="keyword">if</span> (!store.getters.userId) {</span><br><span class="line">        <span class="comment">// 如果没有id才表示当前用户资料没有获取过</span></span><br><span class="line">        <span class="comment">// async 函数所return的内容 用 await就可以接收到</span></span><br><span class="line">        <span class="keyword">const</span> { roles } = <span class="keyword">await</span> store.dispatch(<span class="string">'user/getUserInfo'</span>)</span><br><span class="line">        <span class="comment">// 如果说后续 需要根据用户资料获取数据的话 这里必须改成 同步</span></span><br><span class="line">        <span class="comment">// 筛选用户的可用路由</span></span><br><span class="line">        <span class="comment">// actions中函数 默认是Promise对象 调用这个对象 想要获取返回的值话 必须 加 await或者是then</span></span><br><span class="line">        <span class="comment">// actions是做异步操作的</span></span><br><span class="line">        <span class="keyword">const</span> routes = <span class="keyword">await</span> store.dispatch(<span class="string">'permission/filterRoutes'</span>, roles.menus)</span><br><span class="line">        <span class="comment">// routes就是筛选得到的动态路由</span></span><br><span class="line">        <span class="comment">// 动态路由 添加到 路由表中 默认的路由表 只有静态路由 没有动态路由</span></span><br><span class="line">        <span class="comment">// addRoutes  必须 用 next(地址) 不能用next()</span></span><br><span class="line">        router.addRoutes(routes) <span class="comment">// 添加动态路由到路由表  铺路</span></span><br><span class="line">        <span class="comment">// 添加完动态路由之后</span></span><br><span class="line">        next(to.path) <span class="comment">// 相当于跳到对应的地址  相当于多做一次跳转 为什么要多做一次跳转</span></span><br><span class="line">        <span class="comment">// 进门了，但是进门之后我要去的地方的路还没有铺好，直接走，掉坑里，多做一次跳转，再从门外往里进一次，跳转之前 把路铺好，再次进来的时候，路就铺好了</span></span><br><span class="line">      } <span class="keyword">else</span> {</span><br><span class="line">        next()</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">//   没有token的情况下</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.indexOf(to.path) &gt; -<span class="number">1</span>) {</span><br><span class="line">      <span class="comment">//  表示要去的地址在白名单</span></span><br><span class="line">      next()</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      next(<span class="string">'/login'</span>)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  nprogress.done() <span class="comment">// 解决手动切换地址时 进度条不关闭的问题</span></span><br><span class="line">})</span><br><span class="line"><span class="comment">// 后置守卫</span></span><br><span class="line">router.afterEach(<span class="function">() =&gt;</span> {</span><br><span class="line">  nprogress.done() <span class="comment">// 关闭进度条</span></span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="静态路由动态路由解除合并"><a href="#静态路由动态路由解除合并" class="headerlink" title="静态路由动态路由解除合并"></a>静态路由动态路由解除合并</h3><p><strong>注意</strong>： 这里有个非常容易出问题的位置，当我们判断用户是否已经添加路由的前后，不能都是用**next()**，</p>
<p>在添加路由之后应该使用 <strong>next(to.path)<strong>， 否则会使刷新页面之后 权限消失，这属于一个vue-router的</strong>已知缺陷</strong></p>
<p>同时，不要忘记，我们将原来的静态路由 + 动态路由合体的模式 改成 只有静态路由  <strong><code>src/router/index.js</code></strong></p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200730012805239.png" alt="image-20200730012805239"></p>
<blockquote>
<p>  此时，我们已经完成了权限设置的一半， 此时我们发现左侧菜单失去了内容，这是因为左侧菜单读取的是固定的路由，我们要把它换成实时的最新路由</p>
</blockquote>
<p>在**<code>src/store/getters.js</code>**配置导出routes</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = {</span><br><span class="line">  <span class="attr">sidebar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.sidebar,</span><br><span class="line">  <span class="attr">device</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.device,</span><br><span class="line">  <span class="attr">token</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.token,</span><br><span class="line">  <span class="attr">name</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.userInfo.username, <span class="comment">// 建立用户名称的映射</span></span><br><span class="line">  <span class="attr">userId</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.userInfo.userId, <span class="comment">// 建立用户id的映射</span></span><br><span class="line">  <span class="attr">companyId</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.userInfo.companyId, <span class="comment">// 建立用户的公司Id映射</span></span><br><span class="line">  <span class="attr">routes</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.permission.routes <span class="comment">// 导出当前的路由</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>在左侧菜单组件中， 引入routes</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">computed: {</span><br><span class="line">  ...mapGetters([</span><br><span class="line">    <span class="string">'sidebar'</span>, <span class="string">'routes'</span></span><br><span class="line">  ]),</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p> OK，到现在为止，我们已经可以实现不同用户登录的时候，菜单是动态的了</p>
</blockquote>
<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 前端权限应用-页面访问和菜单</p>
<h2 id="登出时，重置路由权限和-404问题"><a href="#登出时，重置路由权限和-404问题" class="headerlink" title="登出时，重置路由权限和 404问题"></a>登出时，重置路由权限和 404问题</h2><p><strong>目标</strong>： 处理当登出页面时，路由不正确的问题</p>
<blockquote>
<p> 上一小节，我们看似完成了访问权限的功能，实则不然，因为当我们登出操作之后，虽然看不到菜单，但是用户实际上可以访问页面，直接在地址栏输入地址就能访问</p>
</blockquote>
<p>这是怎么回事？</p>
<blockquote>
<p> 这是因为我们前面在<strong>addRoutes</strong>的时候，一直都是在<strong>加</strong>，登出的时候，我们并没有删，也没有重置，也就是说，我们之前加的路由在登出之后一直在，这怎么处理？</p>
</blockquote>
<p>大家留意我们的<strong>router/index.js</strong>文件，发现一个重置路由方法</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resetRouter</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">const</span> newRouter = createRouter()</span><br><span class="line">  router.matcher = newRouter.matcher <span class="comment">// 重新设置路由的可匹配路径</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>没错，这个方法就是将路由重新实例化，相当于换了一个新的路由，之前**<code>加的路由</code>**自然不存在了，只需要在登出的时候， 处理一下即可</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登出的action</span></span><br><span class="line"><span class="function"><span class="title">lgout</span>(<span class="params">context</span>)</span> {</span><br><span class="line">  <span class="comment">// 删除token</span></span><br><span class="line">  context.commit(<span class="string">'removeToken'</span>) <span class="comment">// 不仅仅删除了vuex中的 还删除了缓存中的</span></span><br><span class="line">  <span class="comment">// 删除用户资料</span></span><br><span class="line">  context.commit(<span class="string">'removeUserInfo'</span>) <span class="comment">// 删除用户信息</span></span><br><span class="line">  <span class="comment">// 重置路由</span></span><br><span class="line">  resetRouter()</span><br><span class="line">  <span class="comment">// 还有一步  vuex中的数据是不是还在</span></span><br><span class="line">  <span class="comment">// 要清空permission模块下的state数据</span></span><br><span class="line">  <span class="comment">// vuex中 user子模块  permission子模块</span></span><br><span class="line">  <span class="comment">// 子模块调用子模块的action  默认情况下 子模块的context是子模块的</span></span><br><span class="line">  <span class="comment">// 父模块 调用 子模块的action</span></span><br><span class="line">  context.commit(<span class="string">'permission/setRoutes'</span>, [], { <span class="attr">root</span>: <span class="literal">true</span> })</span><br><span class="line">  <span class="comment">// 子模块调用子模块的action 可以 将 commit的第三个参数 设置成  { root: true } 就表示当前的context不是子模块了 而是父模块</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>除此之外，我们发现在页面刷新的时候，本来应该拥有权限的页面出现了404，这是因为404的匹配权限放在了静态路由，而动态路由在没有addRoutes之前，找不到对应的地址，就会显示404，所以我们需要将404放置到动态路由的最后</p>
<p><strong><code>src/permission.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.addRoutes([...routes, { <span class="attr">path</span>: <span class="string">'*'</span>, <span class="attr">redirect</span>: <span class="string">'/404'</span>, <span class="attr">hidden</span>: <span class="literal">true</span> }]) <span class="comment">// 添加到路由表</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<h2 id="功能权限应用"><a href="#功能权限应用" class="headerlink" title="功能权限应用"></a>功能权限应用</h2><p><strong>目标</strong>： 实现功能权限的应用</p>
<h3 id="功能权限的受控思路"><a href="#功能权限的受控思路" class="headerlink" title="功能权限的受控思路"></a>功能权限的受控思路</h3><blockquote>
<p> 上小节中，当我们拥有了一个模块，一个页面的访问权限之后，页面中的某些功能，用户可能有，也可能没有，这就是功能权限</p>
</blockquote>
<p>这就是上小节，查询出来的数据中的**<code>points</code>**</p>
<blockquote>
<p> 比如，我们想对员工管理的删除功能做个权限怎么做？</p>
</blockquote>
<p>首先需要在员工管理的权限点下， 新增一个删除权限点，启用</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200730020732919.png" alt="image-20200730020732919"></p>
<blockquote>
<p>  我们要做的就是看看用户，是否拥有<strong>point-user-delete</strong>这个point，有就可以让删除能用，没有就隐藏或者禁用</p>
</blockquote>
<h3 id="使用Mixin技术将检查方法注入"><a href="#使用Mixin技术将检查方法注入" class="headerlink" title="使用Mixin技术将检查方法注入"></a>使用Mixin技术将检查方法注入</h3><p>所以，我们可以采用一个新的技术 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/mixins.html">mixin(混入)</a>来让所有的组件可以拥有一个公共的方法</p>
<p><strong><code>src/mixin/checkPermission.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="function"><span class="title">checkPermission</span>(<span class="params">key</span>)</span> {</span><br><span class="line">      <span class="keyword">const</span> { userInfo } = store.state.user</span><br><span class="line">      <span class="keyword">if</span> (userInfo.roles.points &amp;&amp; userInfo.roles.points.length) {</span><br><span class="line">        <span class="keyword">return</span> userInfo.roles.points.some(<span class="function"><span class="params">item</span> =&gt;</span> item === key)</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p><strong>在员工组件中检查权限点</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button :disabled="!checkPermission('POINT-USER-UPDATE')" type="text" size="small" @click="$router.push(`/employees/detail/${obj.row.id}`)"&gt;查看&lt;/el-button&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>此时，可以通过配置权限的方式，检查权限的可用性了</p>
<p><strong>提交代码</strong></p>
<h1 id="9-其他模块集成"><a href="#9-其他模块集成" class="headerlink" title="9.其他模块集成"></a>9.其他模块集成</h1><h2 id="全模块集成"><a href="#全模块集成" class="headerlink" title="全模块集成"></a>全模块集成</h2><p><strong>目标</strong>： 将其他业务模块代码集成到该项目中</p>
<blockquote>
<p>到目前为止，我们已经完成了一个基本项目框架 + 组织架构 + 公司 + 员工  +  权限的 业务联调， 时间关系，我们不可能将所有的业务都去编写一遍，这里提供大家 其余模块的集成代码，最终的目的是让大家得到一个完成的业务模块</p>
</blockquote>
<p>要集成的模块业务，包括工资模块，社保模块，考勤模块，审批模块</p>
<blockquote>
<p>在我们提供的资源集成模块中，我们提供了四个模块的**<code>路由</code><strong>/</strong><code>页面</code><strong>/</strong><code>api</code>*, 按照下面的路径拷贝即可</p>
</blockquote>
<p>路由 =&gt;  <strong><code>src/router/modules</code></strong></p>
<p>页面 =&gt;  <strong><code>src/views</code></strong></p>
<p>api  =&gt;  <strong><code>src/api</code></strong></p>
<p>除此之外，我们需要将 <strong><code>router/modules/user.js </code></strong> 导入到静态路由中，因为这个模块是所有模块都可以访问的</p>
<p>最终，我们将得到一个较为完整的系统业务。</p>
<h1 id="10-主页审批"><a href="#10-主页审批" class="headerlink" title="10.主页审批"></a>10.主页审批</h1><h2 id="首页的页面结构"><a href="#首页的页面结构" class="headerlink" title="首页的页面结构"></a>首页的页面结构</h2><p>**<code>目标</code>**： 实现系统首页的页面结构</p>
<blockquote>
<p>目前，我们的页面还剩下首页，这里我们可以按照如图实现一下的结构</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200802002002229.png" alt="image-20200802002002229"></p>
<p>首页页面结构，<strong>src/views/dashboard/index.vue</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="dashboard-container"&gt;</span><br><span class="line">    &lt;!-- 头部内容 --&gt;</span><br><span class="line">    &lt;el-card class="header-card"&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div class="fl headL"&gt;</span><br><span class="line">          &lt;div class="headImg"&gt;</span><br><span class="line">            &lt;img src="@/assets/common/head.jpg"&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="headInfoTip"&gt;</span><br><span class="line">            &lt;p class="firstChild"&gt;早安，管理员，祝你开心每一天！&lt;/p&gt;</span><br><span class="line">            &lt;p class="lastChild"&gt;早安，管理员，祝你开心每一天！&lt;/p&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="fr" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">    &lt;!-- 主要内容 --&gt;</span><br><span class="line">    &lt;el-row type="flex" justify="space-between"&gt;</span><br><span class="line">      &lt;!-- 左侧内容 --&gt;</span><br><span class="line">      &lt;el-col :span="13" style="padding-right:26px"&gt;</span><br><span class="line">        &lt;!-- 工作日历 --&gt;</span><br><span class="line">        &lt;el-card class="box-card"&gt;</span><br><span class="line">          &lt;div slot="header" class="header"&gt;</span><br><span class="line">            &lt;span&gt;工作日历&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;!-- 放置日历组件 --&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br><span class="line">        &lt;!-- 公告 --&gt;</span><br><span class="line">        &lt;el-card class="box-card"&gt;</span><br><span class="line">          &lt;div class="advContent"&gt;</span><br><span class="line">            &lt;div class="title"&gt; 公告&lt;/div&gt;</span><br><span class="line">            &lt;div class="contentItem"&gt;</span><br><span class="line">              &lt;ul class="noticeList"&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                  &lt;div class="item"&gt;</span><br><span class="line">                    &lt;img src="@/assets/common/img.jpeg" alt=""&gt;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                      &lt;p&gt;&lt;span class="col"&gt;朱继柳&lt;/span&gt; 发布了 第1期“传智大讲堂”互动讨论获奖名单公布&lt;/p&gt;</span><br><span class="line">                      &lt;p&gt;2018-07-21 15:21:38&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                  &lt;div class="item"&gt;</span><br><span class="line">                    &lt;img src="@/assets/common/img.jpeg" alt=""&gt;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                      &lt;p&gt;&lt;span class="col"&gt;朱继柳&lt;/span&gt; 发布了 第2期“传智大讲堂”互动讨论获奖名单公布&lt;/p&gt;</span><br><span class="line">                      &lt;p&gt;2018-07-21 15:21:38&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                  &lt;div class="item"&gt;</span><br><span class="line">                    &lt;img src="@/assets/common/img.jpeg" alt=""&gt;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                      &lt;p&gt;&lt;span class="col"&gt;朱继柳&lt;/span&gt; 发布了 第3期“传智大讲堂”互动讨论获奖名单公布&lt;/p&gt;</span><br><span class="line">                      &lt;p&gt;2018-07-21 15:21:38&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">              &lt;/ul&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">      &lt;!-- 右侧内容 --&gt;</span><br><span class="line">      &lt;el-col :span="11"&gt;</span><br><span class="line">        &lt;el-card class="box-card"&gt;</span><br><span class="line">          &lt;div class="header headTit"&gt;</span><br><span class="line">            &lt;span&gt;流程申请&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="sideNav"&gt;</span><br><span class="line">            &lt;el-button class="sideBtn"&gt;加班离职&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button class="sideBtn"&gt;请假调休&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button class="sideBtn"&gt;审批列表&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button class="sideBtn"&gt;我的信息&lt;/el-button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 绩效指数 --&gt;</span><br><span class="line">        &lt;el-card class="box-card"&gt;</span><br><span class="line">          &lt;div slot="header" class="header"&gt;</span><br><span class="line">            &lt;span&gt;绩效指数&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;!-- 放置雷达图 --&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br><span class="line">        &lt;!-- 帮助连接 --&gt;</span><br><span class="line">        &lt;el-card class="box-card"&gt;</span><br><span class="line">          &lt;div class="header headTit"&gt;</span><br><span class="line">            &lt;span&gt;帮助链接&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="sideLink"&gt;</span><br><span class="line">            &lt;el-row&gt;</span><br><span class="line">              &lt;el-col :span="8"&gt;</span><br><span class="line">                &lt;a href="#"&gt;</span><br><span class="line">                  &lt;span class="icon iconGuide" /&gt;</span><br><span class="line">                  &lt;p&gt;入门指南&lt;/p&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/el-col&gt;</span><br><span class="line">              &lt;el-col :span="8"&gt;</span><br><span class="line">                &lt;a href="#"&gt;</span><br><span class="line">                  &lt;span class="icon iconHelp" /&gt;</span><br><span class="line">                  &lt;p&gt;在线帮助手册&lt;/p&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/el-col&gt;</span><br><span class="line">              &lt;el-col :span="8"&gt;</span><br><span class="line">                &lt;a href="#"&gt;</span><br><span class="line">                  &lt;span class="icon iconTechnology" /&gt;</span><br><span class="line">                  &lt;p&gt;联系技术支持&lt;/p&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/el-col&gt;</span><br><span class="line">            &lt;/el-row&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-card&gt;</span><br><span class="line">      &lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { mapGetters } from 'vuex'</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: 'Dashboard',</span><br><span class="line">  computed: {</span><br><span class="line">    ...mapGetters([</span><br><span class="line">      'name'</span><br><span class="line">    ])</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang="scss" scoped&gt;</span><br><span class="line">.dashboard-container {</span><br><span class="line">  margin: 10px;</span><br><span class="line">  li {</span><br><span class="line">    list-style: none;</span><br><span class="line">  }</span><br><span class="line">  .headImg {</span><br><span class="line">    float: left;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    background: #999;</span><br><span class="line">          img {</span><br><span class="line">      width: 100%;</span><br><span class="line">      height: 100%;</span><br><span class="line">      border-radius: 50%;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  .headInfoTip {</span><br><span class="line">    padding: 25px 0 0;</span><br><span class="line">    margin-left: 120px;</span><br><span class="line">    p {</span><br><span class="line">      padding: 0 0 15px;</span><br><span class="line">      margin: 0;</span><br><span class="line">      &amp;.firstChild {</span><br><span class="line">        font-size: 24px;</span><br><span class="line">      }</span><br><span class="line">      &amp;.lastChild {</span><br><span class="line">        font-size: 20px;</span><br><span class="line">        color: #7f8c8d;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.box-card {</span><br><span class="line">  padding: 5px 10px;</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">  .header {</span><br><span class="line">    span {</span><br><span class="line">      color: #2c3e50;</span><br><span class="line">      font-size: 24px;</span><br><span class="line">    }</span><br><span class="line">    .item {</span><br><span class="line">      color: #97a8be;</span><br><span class="line">      float: right;</span><br><span class="line">      padding: 3px 0;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .headTit {</span><br><span class="line">    span {</span><br><span class="line">      border-bottom: 4px solid #8a97f8;</span><br><span class="line">      padding-bottom: 10px;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">.header-card{</span><br><span class="line">  position: relative;</span><br><span class="line">  .header {</span><br><span class="line">    position: absolute;</span><br><span class="line">    right: 20px;</span><br><span class="line">    top: 15px;</span><br><span class="line">    z-index: 1;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">.advContent {</span><br><span class="line">  background: #fff;</span><br><span class="line">  border-radius: 5px 5px 0px 0px;</span><br><span class="line">  .title {</span><br><span class="line">    font-size: 16px;</span><br><span class="line">    padding: 20px;</span><br><span class="line">    font-weight: bold;</span><br><span class="line">    border-bottom: solid 1px #ccc;</span><br><span class="line">  }</span><br><span class="line">  .contentItem {</span><br><span class="line">    padding: 0 30px;</span><br><span class="line">    min-height: 350px;</span><br><span class="line">    .item {</span><br><span class="line">      display: flex;</span><br><span class="line">      padding:18px 0 10px;</span><br><span class="line">      border-bottom: solid 1px #ccc;</span><br><span class="line">      .col {</span><br><span class="line">        color: #8a97f8;</span><br><span class="line">      }</span><br><span class="line">      img {</span><br><span class="line">        width: 56px;</span><br><span class="line">        height: 56px;</span><br><span class="line">        border-radius: 50%;</span><br><span class="line">        margin-right: 10px;</span><br><span class="line">      }</span><br><span class="line">      p{</span><br><span class="line">        padding: 0 0 8px;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">.noticeList {</span><br><span class="line">  margin: 0;</span><br><span class="line">  padding: 0;</span><br><span class="line">}</span><br><span class="line">.sideNav,</span><br><span class="line">.sideLink {</span><br><span class="line">  padding: 30px 0 12px;</span><br><span class="line">  .sideBtn {</span><br><span class="line">    padding: 16px 26px;</span><br><span class="line">    font-size:16px;</span><br><span class="line">    margin: 10px 5px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">.sideLink {</span><br><span class="line">  text-align: center;</span><br><span class="line">  .icon {</span><br><span class="line">    display: inline-block;</span><br><span class="line">    width: 76px;</span><br><span class="line">    height: 76px;</span><br><span class="line">    background: url('./../../assets/common/icon.png') no-repeat;</span><br><span class="line">  }</span><br><span class="line">  .iconGuide {</span><br><span class="line">    background-position: 0 0;</span><br><span class="line">  }</span><br><span class="line">  .iconHelp {</span><br><span class="line">    background-position: -224px 0;</span><br><span class="line">  }</span><br><span class="line">  .iconTechnology {</span><br><span class="line">    background-position: -460px 0;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>通过上面的代码，我们得到了如下的页面</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200802015023168.png" alt="image-20200802015023168"></p>
<p>大家发现，我们预留了**<code>工作日历</code><strong>和</strong><code>绩效指数</code>**两个组件，我们会在后续的组件中进行开发</p>
<p><strong>提交代码</strong></p>
<h2 id="首页用户资料显示"><a href="#首页用户资料显示" class="headerlink" title="首页用户资料显示"></a>首页用户资料显示</h2><p>​ **<code>目标</code>**：将首页的信息换成真实的用户资料</p>
<blockquote>
<p>直接获取Vuex的用户资料即可</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import { createNamespacedHelpers } from 'vuex'</span><br><span class="line">const { mapState } = createNamespacedHelpers('user')</span><br><span class="line">export default {</span><br><span class="line">  name: 'Dashboard',</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      defaultImg: require('@/assets/common/head.jpg'),</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    ...mapState(['userInfo'])</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>在 vue视图中绑定</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="fl headL"&gt;</span><br><span class="line">          &lt;div class="headImg"&gt;</span><br><span class="line">            &lt;img :src="userInfo.staffPhoto"&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="headInfoTip"&gt;</span><br><span class="line">            &lt;p class="firstChild"&gt;早安，{{ userInfo.username }}，祝你开心每一天！&lt;/p&gt;</span><br><span class="line">            &lt;p class="lastChild"&gt;{{ userInfo.username }}   |  {{ userInfo.companyName }}-{{ userInfo.departmentName }}&lt;/p&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>除此之外，当我们加载图片失败的时候，图片地址存在，但是却不能显示，之前我们封装的图片错误指令可以应用</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img  :src="userInfo.staffPhoto" v-imageerror="defaultImg"&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="工作日历组件封装"><a href="#工作日历组件封装" class="headerlink" title="工作日历组件封装"></a>工作日历组件封装</h2><p>**<code>目标</code>**封装一个工作日历组件在首页中展示</p>
<h3 id="新建工作日历组件结构"><a href="#新建工作日历组件结构" class="headerlink" title="新建工作日历组件结构"></a>新建工作日历组件结构</h3><blockquote>
<p> 工作日历的要求很简单，显示每个月的日期，可以设定日期的范围</p>
</blockquote>
<p>我们可以基于Element组件<a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/calendar">el-calendar</a>进行封装</p>
<p>代码如下  <strong><code>src/views/dashboard/components/work-calendar.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-row type="flex" justify="end"&gt;</span><br><span class="line">      &lt;el-select v-model="currentYear" size="small" style="width: 120px" @change="dateChange"&gt;</span><br><span class="line">        &lt;el-option v-for="item in yearList" :key="item" :label="item" :value="item"&gt;{{ item }}&lt;/el-option&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">      &lt;el-select v-model="currentMonth" size="small" style="width: 120px;margin-left:10px" @change="dateChange"&gt;</span><br><span class="line">        &lt;el-option v-for="item in 12" :key="item" :label="item" :value="item"&gt;{{ item }}&lt;/el-option&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">    &lt;el-calendar v-model="currentDate"&gt;</span><br><span class="line">      &lt;template v-slot:dateCell="{ date, data }" class="content"&gt;</span><br><span class="line">        &lt;div class="date-content"&gt;</span><br><span class="line">          &lt;span class="text"&gt; {{ data.day | getDay }}&lt;/span&gt;</span><br><span class="line">          &lt;span v-if="isWeek(date)" class="rest"&gt;休&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt; </span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-calendar&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  props: {</span><br><span class="line">    startDate: {</span><br><span class="line">      type: Date,</span><br><span class="line">      default: () =&gt; new Date()</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      currentMonth: null, // 当前月份</span><br><span class="line">      currentYear: null, // 当前年份</span><br><span class="line">      currentDate: null,</span><br><span class="line">      yearList: []</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style  scoped&gt;</span><br><span class="line"> /deep/ .el-calendar-day {</span><br><span class="line">  height:  auto;</span><br><span class="line"> }</span><br><span class="line"> /deep/ .el-calendar-table__row td,/deep/ .el-calendar-table tr td:first-child,  /deep/ .el-calendar-table__row td.prev{</span><br><span class="line">  border:none;</span><br><span class="line"> }</span><br><span class="line">.date-content {</span><br><span class="line">  height: 40px;</span><br><span class="line">  text-align: center;</span><br><span class="line">  line-height: 40px;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">}</span><br><span class="line">.date-content .rest {</span><br><span class="line">  color: #fff;</span><br><span class="line">  border-radius: 50%;</span><br><span class="line">  background: rgb(250, 124, 77);</span><br><span class="line">  width: 20px;</span><br><span class="line">  height: 20px;</span><br><span class="line">  line-height: 20px;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  font-size: 12px;</span><br><span class="line">  margin-left: 10px;</span><br><span class="line">}</span><br><span class="line">.date-content .text{</span><br><span class="line">  width: 20px;</span><br><span class="line">  height: 20px;</span><br><span class="line">  line-height: 20px;</span><br><span class="line"> display: inline-block;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"> /deep/ .el-calendar-table td.is-selected .text{</span><br><span class="line">   background: #409eff;</span><br><span class="line">   color: #fff;</span><br><span class="line">   border-radius: 50%;</span><br><span class="line"> }</span><br><span class="line"> /deep/ .el-calendar__header {</span><br><span class="line">   display: none</span><br><span class="line"> }</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="实现工作日历逻辑"><a href="#实现工作日历逻辑" class="headerlink" title="实现工作日历逻辑"></a>实现工作日历逻辑</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  <span class="attr">filters</span>: {</span><br><span class="line">    <span class="function"><span class="title">getDay</span>(<span class="params">value</span>)</span> {</span><br><span class="line">      <span class="keyword">const</span> day = value.split(<span class="string">'-'</span>)[<span class="number">2</span>]</span><br><span class="line">      <span class="keyword">return</span> day.startsWith(<span class="string">'0'</span>) ? day.substr(<span class="number">1</span>) : day</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">props</span>: {</span><br><span class="line">    <span class="attr">startDate</span>: {</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Date</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      <span class="attr">currentMonth</span>: <span class="literal">null</span>, <span class="comment">// 当前月份</span></span><br><span class="line">      <span class="attr">currentYear</span>: <span class="literal">null</span>, <span class="comment">// 当前年份</span></span><br><span class="line">      <span class="attr">currentDate</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">yearList</span>: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">//   初始化事件</span></span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> {</span><br><span class="line">    <span class="comment">//    处理起始时间</span></span><br><span class="line">    <span class="comment">// 组件要求起始时间必须是 周一开始 以一个月为开始</span></span><br><span class="line">    <span class="built_in">this</span>.currentMonth = <span class="built_in">this</span>.startDate.getMonth() + <span class="number">1</span></span><br><span class="line">    <span class="built_in">this</span>.currentYear = <span class="built_in">this</span>.startDate.getFullYear()</span><br><span class="line">    <span class="comment">// 根据当前的年 生成可选年份 前后各加5年</span></span><br><span class="line">    <span class="built_in">this</span>.yearList = <span class="built_in">Array</span>.from(<span class="built_in">Array</span>(<span class="number">11</span>), <span class="function">(<span class="params">value, index</span>) =&gt;</span>  <span class="built_in">this</span>.currentYear + index - <span class="number">5</span> )</span><br><span class="line">    <span class="comment">// 计算 当年当月的第一个周一 再加上 四周之后的一个月月份</span></span><br><span class="line">    <span class="built_in">this</span>.dateChange()</span><br><span class="line">  },</span><br><span class="line">  <span class="attr">methods</span>: {</span><br><span class="line">    <span class="comment">// 是否是休息日</span></span><br><span class="line">    <span class="function"><span class="title">isWeek</span>(<span class="params">value</span>)</span> {</span><br><span class="line">      <span class="keyword">return</span> value.getDay() === <span class="number">6</span> || value.getDay() === <span class="number">0</span></span><br><span class="line">    },</span><br><span class="line">    <span class="comment">// 年月份改变之后</span></span><br><span class="line">    <span class="function"><span class="title">dateChange</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="keyword">const</span> year = <span class="built_in">this</span>.currentYear</span><br><span class="line">      <span class="keyword">const</span> month = <span class="built_in">this</span>.currentMonth</span><br><span class="line">      <span class="built_in">this</span>.currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">`<span class="subst">${year}</span>-<span class="subst">${month}</span>-1`</span>) <span class="comment">// 以当前月的1号为起始</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>在主页中应用</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 放置日历组件 --&gt;</span><br><span class="line">&lt;work-calendar /&gt;</span><br></pre></td></tr></tbody></table></figure>



<p><strong>提交代码</strong></p>
<h2 id="封装雷达图图表显示在首页"><a href="#封装雷达图图表显示在首页" class="headerlink" title="封装雷达图图表显示在首页"></a>封装雷达图图表显示在首页</h2><p>**<code>目标</code>**：封装一个echarts中的雷达图表显示在首页的绩效指数的位置</p>
<h3 id="了解雷达图"><a href="#了解雷达图" class="headerlink" title="了解雷达图"></a>了解雷达图</h3><h3 id="封装雷达图插件"><a href="#封装雷达图插件" class="headerlink" title="封装雷达图插件"></a>封装雷达图插件</h3><blockquote>
<p>首页中，还有一个绩效指数的位置需要放置一个雷达图的图表，我们可以采用百度的echarts进行封装</p>
</blockquote>
<p>第一步， 安装echarts图表</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i echarts</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>echarts是一个很大的包，里面包含了众多图形，假设我们只使用雷达图，可以做按需加载</p>
</blockquote>
<p>第二步， 新建雷达图组件，**<code>src/views/dashboard/components/radar.vue</code>**</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 雷达图  图表必须给高和宽度--&gt;</span><br><span class="line">  &lt;div ref="myDiv" class="radar-echart" /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 完成加载过程</span><br><span class="line">// var echarts = require('echarts')</span><br><span class="line">var echarts = require('echarts/lib/echarts') // 引入echarts主模块</span><br><span class="line">require('echarts/lib/chart/radar') // 引入雷达图</span><br><span class="line">// 引入提示框和标题组件</span><br><span class="line">require('echarts/lib/component/tooltip')</span><br><span class="line">require('echarts/lib/component/title')</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  // 页面渲染完毕事件</span><br><span class="line">  mounted() {</span><br><span class="line">    const myChart = echarts.init(this.$refs.myDiv) // 得到图表实例</span><br><span class="line">    myChart.setOption({</span><br><span class="line">      title: {</span><br><span class="line">        text: '基础雷达图'</span><br><span class="line">      },</span><br><span class="line">      tooltip: {},</span><br><span class="line">      legend: {</span><br><span class="line">        data: ['预算分配（Allocated Budget）', '实际开销（Actual Spending）']</span><br><span class="line">      },</span><br><span class="line">      radar: {</span><br><span class="line">        // shape: 'circle',</span><br><span class="line">        name: {</span><br><span class="line">          textStyle: {</span><br><span class="line">            color: '#fff',</span><br><span class="line">            backgroundColor: '#999',</span><br><span class="line">            borderRadius: 3,</span><br><span class="line">            padding: [3, 5]</span><br><span class="line">          }</span><br><span class="line">        },</span><br><span class="line">        // 每个区域的最高值</span><br><span class="line">        indicator: [</span><br><span class="line">          { name: '工作效率', max: 100 },</span><br><span class="line">          { name: '考勤', max: 100 },</span><br><span class="line">          { name: '积极性', max: 100 },</span><br><span class="line">          { name: '帮助同事', max: 100 },</span><br><span class="line">          { name: '自主学习', max: 100 },</span><br><span class="line">          { name: '正确率', max: 100 }</span><br><span class="line">        ]</span><br><span class="line">      },</span><br><span class="line">      series: [{</span><br><span class="line">        name: '预算 vs 开销（Budget vs spending）',</span><br><span class="line">        type: 'radar',</span><br><span class="line">        // areaStyle: {normal: {}},</span><br><span class="line">        data: [</span><br><span class="line">          {</span><br><span class="line">            value: [10, 1, 100, 5, 100, 0],</span><br><span class="line">            name: '张三'</span><br><span class="line">          },</span><br><span class="line">          {</span><br><span class="line">            value: [50, 50, 50, 50, 50, 10],</span><br><span class="line">            name: '李四'</span><br><span class="line">          }</span><br><span class="line">        ]</span><br><span class="line">      }]</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.radar-echart {</span><br><span class="line">    width: 600px;</span><br><span class="line">    height: 400px;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>我们得到一个雷达图，对绩效指数进行统计</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200924111334856.png" alt="image-20200924111334856"></p>
<p>**<code>注意</code>**：相关数据的缺失，所以这里我们进行的是模拟数据</p>
<p><strong>在主页中引入使用</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import Radar from './components/radar'</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="审批流程业务的基本介绍"><a href="#审批流程业务的基本介绍" class="headerlink" title="审批流程业务的基本介绍"></a>审批流程业务的基本介绍</h2><blockquote>
<p>什么是审批流程</p>
</blockquote>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20201102215131402.png" alt="image-20201102215131402"></p>
<h2 id="提交一个离职审批"><a href="#提交一个离职审批" class="headerlink" title="提交一个离职审批"></a>提交一个离职审批</h2><p>**<code>目标</code>**： 提交一个离职的审批，并完成业务流转</p>
<p><strong>离职弹层</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 弹出层 --&gt;</span><br><span class="line">&lt;el-dialog :visible="showDialog" title="离职申请" @close="btnCancel"&gt;</span><br><span class="line">  &lt;el-form</span><br><span class="line">    ref="ruleForm"</span><br><span class="line">    :model="ruleForm"</span><br><span class="line">    status-icon</span><br><span class="line">    label-width="110px"</span><br><span class="line">    :rules="rules"</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!--离职表单--&gt;</span><br><span class="line">    &lt;el-form-item label="离职时间" prop="end_time"&gt;</span><br><span class="line">      &lt;el-date-picker</span><br><span class="line">        v-model="ruleForm.exceptTime"</span><br><span class="line">        type="datetime"</span><br><span class="line">        value-format="yyyy-MM-dd HH:mm:ss"</span><br><span class="line">        placeholder="选择日期时间"</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label="离职原因" prop="reason"&gt;</span><br><span class="line">      &lt;el-input</span><br><span class="line">        v-model="ruleForm.reason"</span><br><span class="line">        type="textarea"</span><br><span class="line">        :autosize="{ minRows: 3, maxRows: 8}"</span><br><span class="line">        style="width: 70%;"</span><br><span class="line">        placeholder="请输入内容"</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line">  &lt;el-row slot="footer" type="flex" justify="center"&gt;</span><br><span class="line">    &lt;el-col :span="6"&gt;</span><br><span class="line">      &lt;el-button size="small" type="primary" @click="btnOK"&gt;确定&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button size="small" @click="btnCancel"&gt;取消&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>显示弹层</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button class="sideBtn" @click="showDialog = true"&gt;加班离职&lt;/el-button&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>加班数据及校验</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">showDialog: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">ruleForm</span>: {</span><br><span class="line">  <span class="attr">exceptTime</span>: <span class="string">''</span>,</span><br><span class="line">  <span class="attr">reason</span>: <span class="string">''</span>,</span><br><span class="line">  <span class="attr">processKey</span>: <span class="string">'process_dimission'</span>, <span class="comment">// 特定的审批</span></span><br><span class="line">  <span class="attr">processName</span>: <span class="string">'离职'</span></span><br><span class="line">},</span><br><span class="line"><span class="attr">rules</span>: {</span><br><span class="line">  <span class="attr">exceptTime</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'离职时间不能为空'</span> }],</span><br><span class="line">  <span class="attr">reason</span>: [{ <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'离职原因不能为空'</span> }]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交审批逻辑</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { startProcess } <span class="keyword">from</span> <span class="string">'@/api/approvals'</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">methods</span>: {</span><br><span class="line">    <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.$refs.ruleForm.validate(<span class="keyword">async</span> validate =&gt; {</span><br><span class="line">        <span class="keyword">if</span> (validate) {</span><br><span class="line">          <span class="keyword">const</span> data = { ...this.ruleForm, <span class="attr">userId</span>: <span class="built_in">this</span>.userInfo.userId }</span><br><span class="line">          <span class="keyword">await</span> startProcess(data)</span><br><span class="line">          <span class="built_in">this</span>.$message.success(<span class="string">'提交流程成功'</span>)</span><br><span class="line">          <span class="built_in">this</span>.btnCancel()</span><br><span class="line">        }</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    <span class="function"><span class="title">btnCancel</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">      <span class="built_in">this</span>.$refs.ruleForm.resetFields()</span><br><span class="line">      <span class="built_in">this</span>.ruleForm = {</span><br><span class="line">        <span class="attr">exceptTime</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">reason</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="attr">processKey</span>: <span class="string">'process_dimission'</span>, <span class="comment">// 特定的审批</span></span><br><span class="line">        <span class="attr">processName</span>: <span class="string">'离职'</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>配置审批列表的导航</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button class="sideBtn" @click="$router.push('/users/approvals')"&gt;审批列表&lt;/el-button&gt;</span><br><span class="line">&lt;el-button class="sideBtn" @click="$router.push('/users/info')"&gt;我的信息&lt;/el-button&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>完成该流程的审批和流转</strong></p>
<p>注意： 审批接口中的同意接口存在一定问题，可以测试   提交 /撤销 驳回等操作</p>
<p><strong><code>提交代码</code></strong></p>
<h1 id="11-多语言tab页面全屏主题"><a href="#11-多语言tab页面全屏主题" class="headerlink" title="11.多语言tab页面全屏主题"></a>11.多语言tab页面全屏主题</h1><h2 id="全屏插件的引用"><a href="#全屏插件的引用" class="headerlink" title="全屏插件的引用"></a>全屏插件的引用</h2><p><strong>目标</strong>：实现页面的全屏功能</p>
<blockquote>
<p>全屏功能可以借助一个插件来实现</p>
</blockquote>
<p>第一步，安装全局插件<strong>screenfull</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i screenfull</span><br></pre></td></tr></tbody></table></figure>

<p>第二步，封装全屏显示的插件·· <strong><code>src/components/ScreenFull/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 放置一个图标 --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 放置一个svg的图标 --&gt;</span><br><span class="line">    &lt;svg-icon icon-class="fullscreen" style="color:#fff; width: 20px; height: 20px" @click="changeScreen" /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ScreenFull from 'screenfull'</span><br><span class="line">export default {</span><br><span class="line">  methods: {</span><br><span class="line">    //   改变全屏</span><br><span class="line">    changeScreen() {</span><br><span class="line">      if (!ScreenFull.isEnabled) {</span><br><span class="line">        // 此时全屏不可用</span><br><span class="line">        this.$message.warning('此时全屏组件不可用')</span><br><span class="line">        return</span><br><span class="line">      }</span><br><span class="line">      // document.documentElement.requestFullscreen()  原生js调用</span><br><span class="line">      //   如果可用 就可以全屏</span><br><span class="line">      ScreenFull.toggle()</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>第三步，全局注册该组件  <strong><code>src/components/index.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ScreenFull <span class="keyword">from</span> <span class="string">'./ScreenFull'</span></span><br><span class="line">Vue.component(<span class="string">'ScreenFull'</span>, ScreenFull) <span class="comment">// 注册全屏组件</span></span><br></pre></td></tr></tbody></table></figure>

<p>第四步，放置于**<code>layout/navbar.vue</code>**中</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;screen-full class="right-menu-item" /&gt;</span><br><span class="line">.right-menu-item {</span><br><span class="line">   vertical-align: middle;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<p>**<code>本节任务</code>**： 实现页面的全屏功能</p>
<h2 id="动态主题的设置"><a href="#动态主题的设置" class="headerlink" title="动态主题的设置"></a>动态主题的设置</h2><p>**<code>目标</code>**： 实现动态主题的设置</p>
<blockquote>
<p>我们想要实现在页面中实时的切换颜色，此时页面的主题可以跟着设置的颜色进行变化</p>
</blockquote>
<p><strong>简单说明一下它的原理：</strong> element-ui 2.0 版本之后所有的样式都是基于 SCSS 编写的，所有的颜色都是基于几个基础颜色<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/custom-element-theme/blob/master/element-variables.scss">变量</a>来设置的，所以就不难实现动态换肤了，只要找到那几个颜色变量修改它就可以了。 首先我们需要拿到通过 <code>package.json</code> 拿到 element-ui 的版本号，根据该版本号去请求相应的样式。拿到样式之后将样色，通过正则匹配和替换，将颜色变量替换成你需要的，之后动态添加 <code>style</code> 标签来覆盖原有的 css 样式。</p>
<p>第一步， 封装颜色选择组件 <strong><code>ThemePicker</code></strong> 代码地址：<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin/blob/master/src/components/ThemePicker/index.vue">@/components/ThemePicker</a>。</p>
<blockquote>
<p>注意：本章节重点在于集成，内部的更换主题可以先不用关心。</p>
</blockquote>
<p><strong>实现代码</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-color-picker</span><br><span class="line">    v-model="theme"</span><br><span class="line">    :predefine="['#409EFF', '#1890ff', '#304156','#212121','#11a983', '#13c2c2', '#6959CD', '#f5222d', ]"</span><br><span class="line">    class="theme-picker"</span><br><span class="line">    popper-class="theme-picker-dropdown"</span><br><span class="line">  /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const version = require('element-ui/package.json').version // element-ui version from node_modules</span><br><span class="line">const ORIGINAL_THEME = '#409EFF' // default color</span><br><span class="line">export default {</span><br><span class="line">  data() {</span><br><span class="line">    return {</span><br><span class="line">      chalk: '', // content of theme-chalk css</span><br><span class="line">      theme: ''</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    defaultTheme() {</span><br><span class="line">      return this.$store.state.settings.theme</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  watch: {</span><br><span class="line">    defaultTheme: {</span><br><span class="line">      handler: function(val, oldVal) {</span><br><span class="line">        this.theme = val</span><br><span class="line">      },</span><br><span class="line">      immediate: true</span><br><span class="line">    },</span><br><span class="line">    async theme(val) {</span><br><span class="line">      const oldVal = this.chalk ? this.theme : ORIGINAL_THEME</span><br><span class="line">      if (typeof val !== 'string') return</span><br><span class="line">      const themeCluster = this.getThemeCluster(val.replace('#', ''))</span><br><span class="line">      const originalCluster = this.getThemeCluster(oldVal.replace('#', ''))</span><br><span class="line">      console.log(themeCluster, originalCluster)</span><br><span class="line">      const $message = this.$message({</span><br><span class="line">        message: '  Compiling the theme',</span><br><span class="line">        customClass: 'theme-message',</span><br><span class="line">        type: 'success',</span><br><span class="line">        duration: 0,</span><br><span class="line">        iconClass: 'el-icon-loading'</span><br><span class="line">      })</span><br><span class="line">      const getHandler = (variable, id) =&gt; {</span><br><span class="line">        return () =&gt; {</span><br><span class="line">          const originalCluster = this.getThemeCluster(ORIGINAL_THEME.replace('#', ''))</span><br><span class="line">          const newStyle = this.updateStyle(this[variable], originalCluster, themeCluster)</span><br><span class="line">          let styleTag = document.getElementById(id)</span><br><span class="line">          if (!styleTag) {</span><br><span class="line">            styleTag = document.createElement('style')</span><br><span class="line">            styleTag.setAttribute('id', id)</span><br><span class="line">            document.head.appendChild(styleTag)</span><br><span class="line">          }</span><br><span class="line">          styleTag.innerText = newStyle</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      if (!this.chalk) {</span><br><span class="line">        const url = `https://unpkg.com/element-ui@${version}/lib/theme-chalk/index.css`</span><br><span class="line">        await this.getCSSString(url, 'chalk')</span><br><span class="line">      }</span><br><span class="line">      const chalkHandler = getHandler('chalk', 'chalk-style')</span><br><span class="line">      chalkHandler()</span><br><span class="line">      const styles = [].slice.call(document.querySelectorAll('style'))</span><br><span class="line">        .filter(style =&gt; {</span><br><span class="line">          const text = style.innerText</span><br><span class="line">          return new RegExp(oldVal, 'i').test(text) &amp;&amp; !/Chalk Variables/.test(text)</span><br><span class="line">        })</span><br><span class="line">      styles.forEach(style =&gt; {</span><br><span class="line">        const { innerText } = style</span><br><span class="line">        if (typeof innerText !== 'string') return</span><br><span class="line">        style.innerText = this.updateStyle(innerText, originalCluster, themeCluster)</span><br><span class="line">      })</span><br><span class="line">      this.$emit('change', val)</span><br><span class="line">      $message.close()</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    updateStyle(style, oldCluster, newCluster) {</span><br><span class="line">      let newStyle = style</span><br><span class="line">      oldCluster.forEach((color, index) =&gt; {</span><br><span class="line">        newStyle = newStyle.replace(new RegExp(color, 'ig'), newCluster[index])</span><br><span class="line">      })</span><br><span class="line">      return newStyle</span><br><span class="line">    },</span><br><span class="line">    getCSSString(url, variable) {</span><br><span class="line">      return new Promise(resolve =&gt; {</span><br><span class="line">        const xhr = new XMLHttpRequest()</span><br><span class="line">        xhr.onreadystatechange = () =&gt; {</span><br><span class="line">          if (xhr.readyState === 4 &amp;&amp; xhr.status === 200) {</span><br><span class="line">            this[variable] = xhr.responseText.replace(/@font-face{[^}]+}/, '')</span><br><span class="line">            resolve()</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        xhr.open('GET', url)</span><br><span class="line">        xhr.send()</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    getThemeCluster(theme) {</span><br><span class="line">      const tintColor = (color, tint) =&gt; {</span><br><span class="line">        let red = parseInt(color.slice(0, 2), 16)</span><br><span class="line">        let green = parseInt(color.slice(2, 4), 16)</span><br><span class="line">        let blue = parseInt(color.slice(4, 6), 16)</span><br><span class="line">        if (tint === 0) { // when primary color is in its rgb space</span><br><span class="line">          return [red, green, blue].join(',')</span><br><span class="line">        } else {</span><br><span class="line">          red += Math.round(tint * (255 - red))</span><br><span class="line">          green += Math.round(tint * (255 - green))</span><br><span class="line">          blue += Math.round(tint * (255 - blue))</span><br><span class="line">          red = red.toString(16)</span><br><span class="line">          green = green.toString(16)</span><br><span class="line">          blue = blue.toString(16)</span><br><span class="line">          return `#${red}${green}${blue}`</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      const shadeColor = (color, shade) =&gt; {</span><br><span class="line">        let red = parseInt(color.slice(0, 2), 16)</span><br><span class="line">        let green = parseInt(color.slice(2, 4), 16)</span><br><span class="line">        let blue = parseInt(color.slice(4, 6), 16)</span><br><span class="line">        red = Math.round((1 - shade) * red)</span><br><span class="line">        green = Math.round((1 - shade) * green)</span><br><span class="line">        blue = Math.round((1 - shade) * blue)</span><br><span class="line">        red = red.toString(16)</span><br><span class="line">        green = green.toString(16)</span><br><span class="line">        blue = blue.toString(16)</span><br><span class="line">        return `#${red}${green}${blue}`</span><br><span class="line">      }</span><br><span class="line">      const clusters = [theme]</span><br><span class="line">      for (let i = 0; i &lt;= 9; i++) {</span><br><span class="line">        clusters.push(tintColor(theme, Number((i / 10).toFixed(2))))</span><br><span class="line">      }</span><br><span class="line">      clusters.push(shadeColor(theme, 0.1))</span><br><span class="line">      return clusters</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.theme-message,</span><br><span class="line">.theme-picker-dropdown {</span><br><span class="line">  z-index: 99999 !important;</span><br><span class="line">}</span><br><span class="line">.theme-picker .el-color-picker__trigger {</span><br><span class="line">  height: 26px !important;</span><br><span class="line">  width: 26px !important;</span><br><span class="line">  padding: 2px;</span><br><span class="line">}</span><br><span class="line">.theme-picker-dropdown .el-color-dropdown__link-btn {</span><br><span class="line">  display: none;</span><br><span class="line">}</span><br><span class="line">.el-color-picker {</span><br><span class="line">  height: auto !important;</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>注册代码</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ThemePicker <span class="keyword">from</span> <span class="string">'./ThemePicker'</span></span><br><span class="line">Vue.component(<span class="string">'ThemePicker'</span>, ThemePicker)</span><br></pre></td></tr></tbody></table></figure>

<p>第二步，  放置于**<code>layout/navbar.vue</code>**中</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 放置全屏插件 --&gt;</span><br><span class="line"> &lt;theme-picker class="right-menu-item" /&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>提交代码</strong></p>
<h2 id="多语言实现"><a href="#多语言实现" class="headerlink" title="多语言实现"></a>多语言实现</h2><p>**<code>目标</code>**实现国际化语言切换</p>
<h3 id="初始化多语言包"><a href="#初始化多语言包" class="headerlink" title="初始化多语言包"></a>初始化多语言包</h3><p>本项目使用国际化 i18n 方案。通过 <a target="_blank" rel="noopener" href="https://github.com/kazupon/vue-i18n">vue-i18n</a>而实现。</p>
<p><strong>第一步，我们需要首先国际化的包</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i vue-i18n</span><br></pre></td></tr></tbody></table></figure>

<p><strong>第二步，需要单独一个多语言的实例化文件 <code>src/lang/index.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span> <span class="comment">// 引入Vue</span></span><br><span class="line"><span class="keyword">import</span> VueI18n <span class="keyword">from</span> <span class="string">'vue-i18n'</span> <span class="comment">// 引入国际化的包</span></span><br><span class="line"><span class="keyword">import</span> Cookie <span class="keyword">from</span> <span class="string">'js-cookie'</span> <span class="comment">// 引入cookie包</span></span><br><span class="line"><span class="keyword">import</span> elementEN <span class="keyword">from</span> <span class="string">'element-ui/lib/locale/lang/en'</span> <span class="comment">// 引入饿了么的英文包</span></span><br><span class="line"><span class="keyword">import</span> elementZH <span class="keyword">from</span> <span class="string">'element-ui/lib/locale/lang/zh-CN'</span> <span class="comment">// 引入饿了么的中文包</span></span><br><span class="line">Vue.use(VueI18n) <span class="comment">// 全局注册国际化包</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> VueI18n({</span><br><span class="line">  <span class="attr">locale</span>: Cookie.get(<span class="string">'language'</span>) || <span class="string">'zh'</span>, <span class="comment">// 从cookie中获取语言类型 获取不到就是中文</span></span><br><span class="line">  <span class="attr">messages</span>: {</span><br><span class="line">    <span class="attr">en</span>: {</span><br><span class="line">      ...elementEN <span class="comment">// 将饿了么的英文语言包引入</span></span><br><span class="line">    },</span><br><span class="line">    <span class="attr">zh</span>: {</span><br><span class="line">      ...elementZH <span class="comment">// 将饿了么的中文语言包引入</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>上面的代码的作用是将Element的两种语言导入了</p>
</blockquote>
<p><strong>第三步，在main.js中对挂载 i18n的插件，并设置element为当前的语言</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置element为当前的语言</span></span><br><span class="line">Vue.use(ElementUI, {</span><br><span class="line">  <span class="attr">i18n</span>: <span class="function">(<span class="params">key, value</span>) =&gt;</span> i18n.t(key, value)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">  <span class="attr">el</span>: <span class="string">'#app'</span>,</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  i18n,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="引入自定义语言包"><a href="#引入自定义语言包" class="headerlink" title="引入自定义语言包"></a>引入自定义语言包</h3><blockquote>
<p>此时，element已经变成了zh，也就是中文，但是我们常规的内容怎么根据当前语言类型显示？</p>
</blockquote>
<p>这里，针对英文和中文，我们可以提供两个不同的语言包 <strong><code>src/lang/zh.js , src/lang/en.js</code></strong></p>
<blockquote>
<p>该语言包，我们已经在资源中提供</p>
</blockquote>
<p><strong>第四步，在index.js中同样引入该语言包</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> customZH <span class="keyword">from</span> <span class="string">'./zh'</span> <span class="comment">// 引入自定义中文包</span></span><br><span class="line"><span class="keyword">import</span> customEN <span class="keyword">from</span> <span class="string">'./en'</span> <span class="comment">// 引入自定义英文包</span></span><br><span class="line">Vue.use(VueI18n) <span class="comment">// 全局注册国际化包</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> VueI18n({</span><br><span class="line">  <span class="attr">locale</span>: Cookie.get(<span class="string">'language'</span>) || <span class="string">'zh'</span>, <span class="comment">// 从cookie中获取语言类型 获取不到就是中文</span></span><br><span class="line">  <span class="attr">messages</span>: {</span><br><span class="line">    <span class="attr">en</span>: {</span><br><span class="line">      ...elementEN, <span class="comment">// 将饿了么的英文语言包引入</span></span><br><span class="line">      ...customEN</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">zh</span>: {</span><br><span class="line">      ...elementZH, <span class="comment">// 将饿了么的中文语言包引入</span></span><br><span class="line">      ...customZH</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<h3 id="在左侧菜单中应用多语言包"><a href="#在左侧菜单中应用多语言包" class="headerlink" title="在左侧菜单中应用多语言包"></a>在左侧菜单中应用多语言包</h3><blockquote>
<p> 自定义语言包的内容怎么使用?</p>
</blockquote>
<p><strong>第五步，在左侧菜单应用</strong></p>
<p>当我们全局注册i18n的时候，每个组件都会拥有一个**<code>$t</code>**的方法，它会根据传入的key，自动的去寻找当前语言的文本，我们可以将左侧菜单变成多语言展示文本</p>
<p><strong><code>layout/components/SidebarItem.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;item :icon="onlyOneChild.meta.icon||(item.meta&amp;&amp;item.meta.icon)" :title="$t('route.'+onlyOneChild.name)" /&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>注意：当文本的值为嵌套时，可以通过**<code>$t(key1.key2.key3...)</code>**的方式获取</p>
<blockquote>
<p>现在，我们已经完成了多语言的接入，现在封装切换多语言的组件</p>
</blockquote>
<h3 id="封装多语言插件"><a href="#封装多语言插件" class="headerlink" title="封装多语言插件"></a>封装多语言插件</h3><p><strong>第六步，封装多语言组件</strong>  <strong><code>src/components/lang/index.vue</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dropdown trigger="click" @command="changeLanguage"&gt;</span><br><span class="line">    &lt;!-- 这里必须加一个div --&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;svg-icon style="color:#fff;font-size:20px" icon-class="language" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;el-dropdown-menu slot="dropdown"&gt;</span><br><span class="line">      &lt;el-dropdown-item command="zh" :disabled="'zh'=== $i18n.locale "&gt;中文&lt;/el-dropdown-item&gt;</span><br><span class="line">      &lt;el-dropdown-item command="en" :disabled="'en'=== $i18n.locale "&gt;en&lt;/el-dropdown-item&gt;</span><br><span class="line">    &lt;/el-dropdown-menu&gt;</span><br><span class="line">  &lt;/el-dropdown&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Cookie from 'js-cookie'</span><br><span class="line">export default {</span><br><span class="line">  methods: {</span><br><span class="line">    changeLanguage(lang) {</span><br><span class="line">      Cookie.set('language', lang) // 切换多语言</span><br><span class="line">      this.$i18n.locale = lang // 设置给本地的i18n插件</span><br><span class="line">      this.$message.success('切换多语言成功')</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>第七步，在Navbar组件中引入</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 放置切换多语言 --&gt;</span><br><span class="line">     &lt;lang class="right-menu-item" /&gt;</span><br><span class="line">     &lt;!-- 放置主题 --&gt;</span><br><span class="line">     &lt;theme-picker class="right-menu-item" /&gt;</span><br><span class="line">     &lt;!-- 放置全屏插件 --&gt;</span><br><span class="line">     &lt;screen-full class="right-menu-item" /&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>最终效果</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200804001654730.png" alt="image-20200804001654730"></p>
<p><strong>提交代码</strong></p>
<h2 id="tab页的视图引入"><a href="#tab页的视图引入" class="headerlink" title="tab页的视图引入"></a>tab页的视图引入</h2><p>**<code>目标</code>**： 实现tab页打开路由的功能</p>
<blockquote>
<p>当前我们实现的打开页面，看到一个页面之后，另一个页面就会关闭，为了显示更加有效率，我们可以引入多页签组件</p>
</blockquote>
<p>多页签的组件的代码过于繁杂，开发实际需要的是集成和调用能力，所以我们只是将开发好的组件集成到当前的功能项中即可。</p>
<blockquote>
<p> 在资源目录中，**<code>多页签</code>**目录下放置的是 组件和vuex模块</p>
</blockquote>
<p>第一步，将组件TagsView目录放置到**<code>src/components</code>** , 并全局注册</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> TagsView <span class="keyword">from</span> <span class="string">'./TagsView'</span></span><br><span class="line">Vue.component(<span class="string">'TagsView'</span>, TagsView)</span><br></pre></td></tr></tbody></table></figure>



<p>第二步，将Vuex模块**<code>tagsView.js</code>**放置到 <strong><code>src/store/modules</code></strong></p>
<p>并在store中引入该模块</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tagsView <span class="keyword">from</span> <span class="string">'./modules/tagsView'</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store({</span><br><span class="line">  <span class="attr">modules</span>: {</span><br><span class="line">    app,</span><br><span class="line">    settings,</span><br><span class="line">    user,</span><br><span class="line">    permission,</span><br><span class="line">    tagsView</span><br><span class="line">  },</span><br><span class="line">  getters</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>第三步，在**<code>src/layout/Index.vue</code>**中引入该组件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div :class="classObj" class="app-wrapper"&gt;</span><br><span class="line">    &lt;div v-if="device==='mobile'&amp;&amp;sidebar.opened" class="drawer-bg" @click="handleClickOutside" /&gt;</span><br><span class="line">    &lt;sidebar class="sidebar-container" /&gt;</span><br><span class="line">    &lt;div class="main-container"&gt;</span><br><span class="line">      &lt;div :class="{'fixed-header':fixedHeader}"&gt;</span><br><span class="line">        &lt;navbar /&gt;</span><br><span class="line">        &lt;!-- 放置tabsview --&gt;</span><br><span class="line">        &lt;tags-view /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;app-main /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>效果如下</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200804012117287.png" alt="image-20200804012117287"></p>
<p><strong><code>提交代码</code></strong><br>#12.打包上线</p>
<h2 id="打包之前的路由模式"><a href="#打包之前的路由模式" class="headerlink" title="打包之前的路由模式"></a><strong>打包之前的路由模式</strong></h2><p>**<code>目标</code>**配置打包之前的路由模式</p>
<blockquote>
<p>在SPA单页应用中，有两种路由模式</p>
</blockquote>
<p><strong>hash模式</strong> ： #后面是路由路径，特点是前端访问，#后面的变化不会经过服务器</p>
<p><strong>history模式</strong>：正常的/访问模式，特点是后端访问，任意地址的变化都会访问服务器</p>
<blockquote>
<p>开发到现在，我们一直都在用hash模式，打包我们尝试用history模式</p>
</blockquote>
<p>改成history模式非常简单，只需要将路由的mode类型改成history即可</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createRouter = <span class="function">() =&gt;</span> <span class="keyword">new</span> Router({</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">'history'</span>, <span class="comment">// require service support</span></span><br><span class="line">  <span class="attr">scrollBehavior</span>: <span class="function">() =&gt;</span> ({ <span class="attr">y</span>: <span class="number">0</span> }), <span class="comment">// 管理滚动行为 如果出现滚动 切换就让 让页面回到顶部</span></span><br><span class="line">  <span class="attr">routes</span>: [...constantRoutes] <span class="comment">// 改成只有静态路由</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>假设我们的地址是这样的  <strong><code>www.xxxx/com/hr</code></strong>/a <strong><code>www.xxxx/com/hr</code></strong>/b</p>
</blockquote>
<p>我们会发现，其实域名是**<code>www.xxxx/com</code>**，hr是特定的前缀地址，此时我们可以配置一个base属性，配置为hr</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createRouter = <span class="function">() =&gt;</span> <span class="keyword">new</span> Router({</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">'history'</span>, <span class="comment">// require service support</span></span><br><span class="line">  <span class="attr">base</span>: <span class="string">'/hr/'</span>, <span class="comment">// 配置项目的基础地址</span></span><br><span class="line">  <span class="attr">scrollBehavior</span>: <span class="function">() =&gt;</span> ({ <span class="attr">y</span>: <span class="number">0</span> }), <span class="comment">// 管理滚动行为 如果出现滚动 切换就让 让页面回到顶部</span></span><br><span class="line">  <span class="attr">routes</span>: [...constantRoutes] <span class="comment">// 改成只有静态路由</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>此时，我们会发现地址已经变成我们想要的样子了</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200804014626686.png" alt="image-20200804014626686"></p>
<p><strong>提交代码</strong></p>
<h2 id="性能分析和CDN的应用"><a href="#性能分析和CDN的应用" class="headerlink" title="性能分析和CDN的应用"></a>性能分析和CDN的应用</h2><p>**<code>目标</code>**： 对开发的应用进行性能分析和CDN的应用</p>
<h3 id="性能分析"><a href="#性能分析" class="headerlink" title="性能分析"></a>性能分析</h3><blockquote>
<p>我们集成了 功能，写了很多组件，最终都会打包成一堆文件，那么真实运行的性能如何呢？</p>
</blockquote>
<p>我们可以使用vue-cli本身提供的性能分析工具，对我们开发的所有功能进行打包分析</p>
<p>它的应用非常简单</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run preview -- --report</span><br></pre></td></tr></tbody></table></figure>

<p>这个命令会从我们的**<code>入口main.js</code>**进行依赖分析，分析出最大的包，方便我们进行观察和优化</p>
<p>执行完这个命令，我们会看到如下的页面</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200804015849396.png" alt="image-20200804015849396"></p>
<p>如图所以，方块越大，说明该文件占用的文件越大，文件越大，对于网络带宽和访问速度的要求就越高，这也就是我们优化的方向</p>
<blockquote>
<p>像这种情况，我们怎么优化一下呢</p>
</blockquote>
<h3 id="webpack排除打包"><a href="#webpack排除打包" class="headerlink" title="webpack排除打包"></a>webpack排除打包</h3><p>CDN是一个比较好的方式</p>
<blockquote>
<p>文件不是大吗？我们就不要把这些大的文件和那些小的文件打包到一起了，像这种xlsx,element这种功能性很全的插件，我们可以放到CDN服务器上，一来，减轻整体包的大小，二来CDN的加速服务可以加快我们对于插件的访问速度</p>
</blockquote>
<p><strong>使用方式</strong></p>
<p>先找到 <code>vue.config.js</code>， 添加 <code>externals</code> 让 <code>webpack</code> 不打包 <code>xlsx</code> 和 <code>element</code>   </p>
<p><strong><code>vue.config.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 排除 elementUI xlsx  和 vue </span></span><br><span class="line"> <span class="attr">externals</span>:</span><br><span class="line">     {</span><br><span class="line">       <span class="string">'vue'</span>: <span class="string">'Vue'</span>,</span><br><span class="line">       <span class="string">'element-ui'</span>: <span class="string">'ELEMENT'</span>,</span><br><span class="line">       <span class="string">'xlsx'</span>: <span class="string">'XLSX'</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>再次运行，我们会发现包的大小已经大幅减小</p>
<h3 id="CDN文件配置"><a href="#CDN文件配置" class="headerlink" title="CDN文件配置"></a>CDN文件配置</h3><blockquote>
<p>但是，没有被打包的几个模块怎么处理？</p>
</blockquote>
<p>可以采用CDN的方式，在页面模板中预先引入</p>
<p><strong><code>vue.config.js</code></strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cdn = {</span><br><span class="line">  <span class="attr">css</span>: [</span><br><span class="line">    <span class="comment">// element-ui css</span></span><br><span class="line">    <span class="string">'https://unpkg.com/element-ui/lib/theme-chalk/index.css'</span> <span class="comment">// 样式表</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">js</span>: [</span><br><span class="line">    <span class="comment">// vue must at first!</span></span><br><span class="line">    <span class="string">'https://unpkg.com/vue/dist/vue.js'</span>, <span class="comment">// vuejs</span></span><br><span class="line">    <span class="comment">// element-ui js</span></span><br><span class="line">    <span class="string">'https://unpkg.com/element-ui/lib/index.js'</span>, <span class="comment">// elementUI</span></span><br><span class="line">      <span class="string">'https://cdn.jsdelivr.net/npm/xlsx@0.16.6/dist/jszip.min.js'</span>,</span><br><span class="line">    <span class="string">'https://cdn.jsdelivr.net/npm/xlsx@0.16.6/dist/xlsx.full.min.js'</span></span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>但是请注意，这时的配置实际上是对开发环境和生产环境都生效的，在开发环境时，没有必要使用CDN，此时我们可以使用环境变量来进行区分</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cdn = { <span class="attr">css</span>: [], <span class="attr">js</span>: [] }</span><br><span class="line"><span class="comment">// 通过环境变量 来区分是否使用cdn</span></span><br><span class="line"><span class="keyword">const</span> isProd = process.env.NODE_ENV === <span class="string">'production'</span> <span class="comment">// 判断是否是生产环境</span></span><br><span class="line"><span class="keyword">let</span> externals = {}</span><br><span class="line"><span class="keyword">if</span> (isProd) {</span><br><span class="line">  <span class="comment">// 如果是生产环境 就排除打包 否则不排除</span></span><br><span class="line">  externals = {</span><br><span class="line">    <span class="comment">// key(包名) / value(这个值 是 需要在CDN中获取js, 相当于 获取的js中 的该包的全局的对象的名字)</span></span><br><span class="line">    <span class="string">'vue'</span>: <span class="string">'Vue'</span>, <span class="comment">// 后面的名字不能随便起 应该是 js中的全局对象名</span></span><br><span class="line">    <span class="string">'element-ui'</span>: <span class="string">'ELEMENT'</span>, <span class="comment">// 都是js中全局定义的</span></span><br><span class="line">    <span class="string">'xlsx'</span>: <span class="string">'XLSX'</span> <span class="comment">// 都是js中全局定义的</span></span><br><span class="line">  }</span><br><span class="line">  cdn = {</span><br><span class="line">    <span class="attr">css</span>: [</span><br><span class="line">      <span class="string">'https://unpkg.com/element-ui/lib/theme-chalk/index.css'</span> <span class="comment">// 提前引入elementUI样式</span></span><br><span class="line">    ], <span class="comment">// 放置css文件目录</span></span><br><span class="line">    <span class="attr">js</span>: [</span><br><span class="line">      <span class="string">'https://unpkg.com/vue/dist/vue.js'</span>, <span class="comment">// vuejs</span></span><br><span class="line">      <span class="string">'https://unpkg.com/element-ui/lib/index.js'</span>, <span class="comment">// element</span></span><br><span class="line">      <span class="string">'https://cdn.jsdelivr.net/npm/xlsx@0.16.6/dist/xlsx.full.min.js'</span>, <span class="comment">// xlsx 相关</span></span><br><span class="line">      <span class="string">'https://cdn.jsdelivr.net/npm/xlsx@0.16.6/dist/jszip.min.js'</span> <span class="comment">// xlsx 相关</span></span><br><span class="line">    ] <span class="comment">// 放置js文件目录</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="注入CDN文件到模板"><a href="#注入CDN文件到模板" class="headerlink" title="注入CDN文件到模板"></a>注入CDN文件到模板</h3><p>之后通过 <code>html-webpack-plugin</code>注入到 <code>index.html</code>之中:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config.plugin(<span class="string">'html'</span>).tap(<span class="function"><span class="params">args</span> =&gt;</span> {</span><br><span class="line">  args[<span class="number">0</span>].cdn = cdn</span><br><span class="line">  <span class="keyword">return</span> args</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>找到 <code>public/index.html</code>。通过你配置的<code>CDN Config</code> 依次注入 css 和 js。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;!-- 引入样式 --&gt;</span><br><span class="line">  &lt;% for(var css of htmlWebpackPlugin.options.cdn.css) { %&gt;</span><br><span class="line">    &lt;link rel="stylesheet" href="&lt;%=css%&gt;"&gt;</span><br><span class="line">  &lt;% } %&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 引入JS --&gt;</span><br><span class="line">&lt;% for(var js of htmlWebpackPlugin.options.cdn.js) { %&gt;</span><br><span class="line">  &lt;script src="&lt;%=js%&gt;"&gt;&lt;/script&gt;</span><br><span class="line">&lt;% } %&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>最后，进行打包 </p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run build:prod</span><br></pre></td></tr></tbody></table></figure>

<h2 id="在nodejs环境中应用并代理跨域"><a href="#在nodejs环境中应用并代理跨域" class="headerlink" title="在nodejs环境中应用并代理跨域"></a>在nodejs环境中应用并代理跨域</h2><p>**<code>目标</code>**将打包好的代码打包上线，并在nodejs中代理跨域</p>
<h3 id="使用koa框架部署项目"><a href="#使用koa框架部署项目" class="headerlink" title="使用koa框架部署项目"></a>使用koa框架部署项目</h3><blockquote>
<p>到现在为止，我们已经完成了一个前端工程师的开发流程，按照常规的做法，此时，运维会将我们的代码部署到阿里云的ngix服务上，对于我们而言，我们可以将其部署到本机的nodejs环境中</p>
</blockquote>
<p>部署 自动化部署 /手动部署</p>
<p>第一步，建立web服务文件夹  <strong><code>hrServer</code></strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir hrServer <span class="comment">#建立hrServer文件夹 </span></span><br></pre></td></tr></tbody></table></figure>

<p>第二步，在该文件夹下，初始化npm</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm init -y</span><br></pre></td></tr></tbody></table></figure>

<p>第三步，安装服务端框架koa(也可以采用express或者egg)</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i koa koa-static</span><br></pre></td></tr></tbody></table></figure>

<p>第四步，拷贝上小节打包的dist目录到**<code>hrServer/public</code>**下</p>
<p>第五步，在根目录下创建app.js，代码如下</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa  = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> serve = <span class="built_in">require</span>(<span class="string">'koa-static'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">app.use(serve(__dirname + <span class="string">"/public"</span>)); <span class="comment">//将public下的代码静态化</span></span><br><span class="line">app.listen(<span class="number">3333</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'人资项目启动'</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>此时，我们可以访问，<a target="_blank" rel="noopener" href="http://localhost:3333/">http://localhost:3333</a></p>
</blockquote>
<p>页面出来了</p>
<p><img src="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200805012430884.png" alt="image-20200805012430884"></p>
<h3 id="解决history页面访问问题"><a href="#解决history页面访问问题" class="headerlink" title="解决history页面访问问题"></a>解决history页面访问问题</h3><p>但是，此时存在两个问题，</p>
<ol>
<li><strong>当我们刷新页面，发现404</strong></li>
</ol>
<blockquote>
<p>  这是因为我们采用了history的模式，地址的变化会引起服务器的刷新，我们只需要在app.js对所有的地址进行一下处理即可</p>
</blockquote>
<p>安装 koa中间件 </p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i koa2-connect-history-api-fallback <span class="comment">#专门处理history模式的中间件</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>注册中间件</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa  = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> serve = <span class="built_in">require</span>(<span class="string">'koa-static'</span>);</span><br><span class="line"><span class="keyword">const</span>  { historyApiFallback } = <span class="built_in">require</span>(<span class="string">'koa2-connect-history-api-fallback'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="comment">// 这句话 的意思是除接口之外所有的请求都发送给了 index.html</span></span><br><span class="line">app.use(historyApiFallback({ </span><br><span class="line">     <span class="attr">whiteList</span>: [<span class="string">'/prod-api'</span>]</span><br><span class="line"> }));  <span class="comment">// 这里的whiteList是 白名单的意思</span></span><br><span class="line">app.use(serve(__dirname + <span class="string">"/public"</span>)); <span class="comment">//将public下的代码静态化</span></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3333</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'人资项目启动'</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<h3 id="解决生产环境跨域问题"><a href="#解决生产环境跨域问题" class="headerlink" title="解决生产环境跨域问题"></a>解决生产环境跨域问题</h3><ol>
<li>当点击登录时，发现接口404</li>
</ol>
<blockquote>
<p>  前面我们讲过，vue-cli的代理只存在于开发期，当我们上线到node环境或者ngix环境时，需要我们再次在环境中代理</p>
</blockquote>
<p>在nodejs中代理</p>
<p>安装跨域代理中间件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i koa2-proxy-middleware</span><br></pre></td></tr></tbody></table></figure>

<p>配置跨越代理</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">'koa2-proxy-middleware'</span>)</span><br><span class="line"></span><br><span class="line">app.use(proxy({</span><br><span class="line">  <span class="attr">targets</span>: {</span><br><span class="line">    <span class="comment">// (.*) means anything</span></span><br><span class="line">    <span class="string">'/prod-api/(.*)'</span>: {</span><br><span class="line">        <span class="attr">target</span>: <span class="string">'http://ihrm-java.itheima.net/api'</span>, <span class="comment">//后端服务器地址</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: {  </span><br><span class="line">            <span class="string">'/prod-api'</span>: <span class="string">""</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}))</span><br></pre></td></tr></tbody></table></figure>

<p>注意：这里之所以用了<strong>pathRewrite</strong>，是因为生产环境的请求基础地址是 <strong>/prod-api</strong>，需要将该地址去掉</p>
<p>此时，项目就可以跨域访问了！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Abigail Cui</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.abigailcui.com/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/">https://www.abigailcui.com/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.abigailcui.com" target="_blank">Abigail Cui的小站</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Vue%E5%BA%94%E7%94%A8/">Vue应用</a><a class="post-meta__tags" href="/tags/Vue/">Vue</a></div><div class="post_share"><div class="social-share" data-image="/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200711002545085.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/07/14/Git%E5%B8%B8%E7%94%A8%E6%80%BB%E7%BB%93/"><img class="prev-cover" src="/2021/07/14/Git%E5%B8%B8%E7%94%A8%E6%80%BB%E7%BB%93/code.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Git</div></div></a></div><div class="next-post pull-right"><a href="/2021/07/01/Todo-List/"><img class="next-cover" src="/2021/07/01/Todo-List/todo-list.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">基于vue的简易Todo-List</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/07/01/Todo-List/" title="基于vue的简易Todo-List"><img class="cover" src="/2021/07/01/Todo-List/todo-list.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-01</div><div class="title">基于vue的简易Todo-List</div></div></a></div><div><a href="/2021/05/20/vue应用1-用vant和node实现网易云音乐案例/" title="vue应用1—用vant和node实现网易云音乐案例"><img class="cover" src="/2021/05/20/vue%E5%BA%94%E7%94%A81-%E7%94%A8vant%E5%92%8Cnode%E5%AE%9E%E7%8E%B0%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E6%A1%88%E4%BE%8B/1_%E9%A6%96%E9%A1%B5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-20</div><div class="title">vue应用1—用vant和node实现网易云音乐案例</div></div></a></div><div><a href="/2021/06/20/vue应用2-vue移动端-仿头条demo/" title="vue应用2-vue移动端-仿头条demo"><img class="cover" src="/2021/06/20/vue%E5%BA%94%E7%94%A82-vue%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E4%BB%BF%E5%A4%B4%E6%9D%A1demo/%E9%A6%96%E9%A1%B5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-20</div><div class="title">vue应用2-vue移动端-仿头条demo</div></div></a></div><div><a href="/2021/05/14/vue基础6-路由_vant组件库使用/" title="vue基础6-路由_vant组件库使用"><img class="cover" src="/2021/05/14/vue%E5%9F%BA%E7%A1%806-%E8%B7%AF%E7%94%B1_vant%E7%BB%84%E4%BB%B6%E5%BA%93%E4%BD%BF%E7%94%A8/ArcGIS.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-14</div><div class="title">vue基础6-路由_vant组件库使用</div></div></a></div><div><a href="/2021/05/14/vue基础1-vue脚手架&基础API/" title="vue基础1-vue脚手架&基础API"><img class="cover" src="/2021/05/14/vue%E5%9F%BA%E7%A1%801-vue%E8%84%9A%E6%89%8B%E6%9E%B6&%E5%9F%BA%E7%A1%80API/ArcGIS.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-14</div><div class="title">vue基础1-vue脚手架&基础API</div></div></a></div><div><a href="/2021/05/14/vue基础2-基础API_计算属性_过滤器_侦听器_品牌管理案例/" title="vue基础2-基础API_计算属性_过滤器_侦听器"><img class="cover" src="/2021/05/14/vue%E5%9F%BA%E7%A1%802-%E5%9F%BA%E7%A1%80API_%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7_%E8%BF%87%E6%BB%A4%E5%99%A8_%E4%BE%A6%E5%90%AC%E5%99%A8_%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86%E6%A1%88%E4%BE%8B/ArcGIS.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-14</div><div class="title">vue基础2-基础API_计算属性_过滤器_侦听器</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.</span> <span class="toc-text">1.项目设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E4%BA%BA%E5%8A%9B%E8%B5%84%E6%BA%90%E7%9A%84%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">1.人力资源的环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vue-element-admin%E7%9A%84%E4%BA%86%E8%A7%A3%E5%92%8C%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">vue-element-admin的了解和介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E5%87%86%E5%A4%87"><span class="toc-number">2.2.</span> <span class="toc-text">搭建项目前的一些基本准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%A8%A1%E6%9D%BF%E5%90%AF%E5%8A%A8%E5%92%8C%E7%9B%AE%E5%BD%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.3.</span> <span class="toc-text">项目模板启动和目录介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E5%92%8C%E4%BB%A3%E7%A0%81%E6%B3%A8%E9%87%8A"><span class="toc-number">2.4.</span> <span class="toc-text">项目运行机制和代码注释</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#main-js"><span class="toc-number">2.4.1.</span> <span class="toc-text">main.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#App-vue"><span class="toc-number">2.4.2.</span> <span class="toc-text">App.vue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#permission-js"><span class="toc-number">2.4.3.</span> <span class="toc-text">permission.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vuex%E7%BB%93%E6%9E%84"><span class="toc-number">2.4.4.</span> <span class="toc-text">Vuex结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scss"><span class="toc-number">2.4.5.</span> <span class="toc-text">scss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#icons"><span class="toc-number">2.4.6.</span> <span class="toc-text">icons</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SCSS%E5%A4%84%E7%90%86%E7%9A%84%E4%BA%86%E8%A7%A3%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">2.5.</span> <span class="toc-text">SCSS处理的了解和使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%B0%8F%E5%9E%8B%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="toc-number">2.5.1.</span> <span class="toc-text">搭建小型测试环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">2.5.2.</span> <span class="toc-text">变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E8%BF%9C%E7%A8%8BGit%E4%BB%93%E5%BA%93%E5%B9%B6%E5%AE%8C%E6%88%90%E5%88%9D%E5%A7%8B%E6%8F%90%E4%BA%A4"><span class="toc-number">2.6.</span> <span class="toc-text">建立远程Git仓库并完成初始提交</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API%E6%A8%A1%E5%9D%97%E5%92%8C%E8%AF%B7%E6%B1%82%E5%B0%81%E8%A3%85%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.7.</span> <span class="toc-text">API模块和请求封装模块介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Axios%E7%9A%84%E6%8B%A6%E6%88%AA%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.7.1.</span> <span class="toc-text">Axios的拦截器介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#api%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8D%95%E7%8B%AC%E5%B0%81%E8%A3%85"><span class="toc-number">2.7.2.</span> <span class="toc-text">api模块的单独封装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E8%B5%84%E6%BA%90%E5%9B%BE%E7%89%87%E5%92%8C%E7%BB%9F%E4%B8%80%E6%A0%B7%E5%BC%8F"><span class="toc-number">2.8.</span> <span class="toc-text">公共资源图片和统一样式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97"><span class="toc-number">3.</span> <span class="toc-text">2.登录模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%9B%BA%E5%AE%9A%E7%9A%84%E6%9C%AC%E5%9C%B0%E8%AE%BF%E9%97%AE%E7%AB%AF%E5%8F%A3%E5%92%8C%E7%BD%91%E7%AB%99%E5%90%8D%E7%A7%B0"><span class="toc-number">3.1.</span> <span class="toc-text">设置固定的本地访问端口和网站名称</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%9F%BA%E7%A1%80%E5%B8%83%E5%B1%80"><span class="toc-number">3.2.</span> <span class="toc-text">登录页面的基础布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%A1%A8%E5%8D%95%E7%9A%84%E6%A0%A1%E9%AA%8C"><span class="toc-number">3.3.</span> <span class="toc-text">登录表单的校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#el-form%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C%E7%9A%84%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.3.1.</span> <span class="toc-text">el-form表单校验的先决条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E6%9C%BA%E5%8F%B7%E5%92%8C%E5%AF%86%E7%A0%81%E7%9A%84%E6%A0%A1%E9%AA%8C"><span class="toc-number">3.3.2.</span> <span class="toc-text">手机号和密码的校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">3.3.3.</span> <span class="toc-text">关于修饰符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue-Cli%E9%85%8D%E7%BD%AE%E8%B7%A8%E5%9F%9F%E4%BB%A3%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">Vue-Cli配置跨域代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0%E8%B7%A8%E5%9F%9F%EF%BC%9F"><span class="toc-number">3.4.1.</span> <span class="toc-text">为什么会出现跨域？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">3.4.2.</span> <span class="toc-text">解决开发环境的跨域问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%8D%95%E7%8B%AC%E7%9A%84%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.5.</span> <span class="toc-text">封装单独的登录接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85Vuex%E7%9A%84%E7%99%BB%E5%BD%95Action%E5%B9%B6%E5%A4%84%E7%90%86token"><span class="toc-number">3.6.</span> <span class="toc-text">封装Vuex的登录Action并处理token</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8Vuex%E4%B8%AD%E5%AF%B9token%E8%BF%9B%E8%A1%8C%E7%AE%A1%E7%90%86"><span class="toc-number">3.6.1.</span> <span class="toc-text">在Vuex中对token进行管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%99%BB%E5%BD%95%E7%9A%84Action"><span class="toc-number">3.6.2.</span> <span class="toc-text">封装登录的Action</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#request%E4%B8%AD%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E5%BC%82%E5%B8%B8%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">3.7.</span> <span class="toc-text">request中环境变量和异常的处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%88%86axios%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E8%AF%B7%E6%B1%82%E5%9F%BA%E7%A1%80%E5%9C%B0%E5%9D%80"><span class="toc-number">3.7.1.</span> <span class="toc-text">区分axios在不同环境中的请求基础地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86axios%E7%9A%84%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">3.7.2.</span> <span class="toc-text">处理axios的响应拦截器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E8%B0%83%E7%94%A8%E7%99%BB%E5%BD%95action-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="toc-number">3.8.</span> <span class="toc-text">登录页面调用登录action,处理异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%A1%B5%E7%9A%84token%E6%8B%A6%E6%88%AA%E5%A4%84%E7%90%86"><span class="toc-number">3.9.</span> <span class="toc-text">主页的token拦截处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8B%A6%E6%88%AA%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">3.9.1.</span> <span class="toc-text">权限拦截的流程图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%BD%AC%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="toc-number">3.9.2.</span> <span class="toc-text">流程图转化代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%A1%B5%E7%9A%84%E5%B7%A6%E4%BE%A7%E5%AF%BC%E8%88%AA%E6%A0%B7%E5%BC%8F"><span class="toc-number">3.10.</span> <span class="toc-text">主页的左侧导航样式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%A4%B4%E9%83%A8%E5%86%85%E5%AE%B9%E7%9A%84%E5%B8%83%E5%B1%80%E5%92%8C%E6%A0%B7%E5%BC%8F"><span class="toc-number">3.11.</span> <span class="toc-text">设置头部内容的布局和样式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E4%B8%BB%E9%A1%B5%E6%A8%A1%E5%9D%97"><span class="toc-number">4.</span> <span class="toc-text">3.主页模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%B5%84%E6%96%99%E6%8E%A5%E5%8F%A3%E5%92%8Ctoken%E6%B3%A8%E5%85%A5"><span class="toc-number">4.1.</span> <span class="toc-text">获取用户资料接口和token注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%B5%84%E6%96%99%E7%9A%84action%E5%B9%B6%E5%85%B1%E4%BA%AB%E7%94%A8%E6%88%B7%E7%8A%B6%E6%80%81"><span class="toc-number">4.2.</span> <span class="toc-text">封装获取用户资料的action并共享用户状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8B%A6%E6%88%AA%E5%A4%84%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E8%B5%84%E6%96%99action"><span class="toc-number">4.3.</span> <span class="toc-text">权限拦截处调用获取资料action</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8B%A6%E6%88%AA%E5%99%A8%E8%B0%83%E7%94%A8action"><span class="toc-number">4.3.1.</span> <span class="toc-text">权限拦截器调用action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%B4%E5%83%8F%E6%8E%A5%E5%8F%A3%E5%90%88%E5%B9%B6%E6%95%B0%E6%8D%AE"><span class="toc-number">4.3.2.</span> <span class="toc-text">获取头像接口合并数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4-%E8%A7%A3%E5%86%B3%E5%BC%82%E5%B8%B8%E5%9B%BE%E7%89%87%E6%83%85%E5%86%B5"><span class="toc-number">4.4.</span> <span class="toc-text">自定义指令-解决异常图片情况</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4"><span class="toc-number">4.4.1.</span> <span class="toc-text">自定义指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8main-js%E5%AE%8C%E6%88%90%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E5%85%A8%E5%B1%80%E6%B3%A8%E5%86%8C"><span class="toc-number">4.4.2.</span> <span class="toc-text">在main.js完成自定义指令全局注册</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%87%BA%E5%8A%9F%E8%83%BD"><span class="toc-number">4.5.</span> <span class="toc-text">实现登出功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token%E5%A4%B1%E6%95%88%E7%9A%84%E4%B8%BB%E5%8A%A8%E4%BB%8B%E5%85%A5"><span class="toc-number">4.6.</span> <span class="toc-text">Token失效的主动介入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E4%BB%8B%E5%85%A5token%E5%A4%84%E7%90%86%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91"><span class="toc-number">4.6.1.</span> <span class="toc-text">主动介入token处理的业务逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%9B%BE%E8%BD%AC%E5%8C%96%E4%BB%A3%E7%A0%81-1"><span class="toc-number">4.6.2.</span> <span class="toc-text">流程图转化代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token%E5%A4%B1%E6%95%88%E7%9A%84%E8%A2%AB%E5%8A%A8%E5%A4%84%E7%90%86"><span class="toc-number">4.7.</span> <span class="toc-text">Token失效的被动处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.8.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%B7%AF%E7%94%B1%E5%92%8C%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.</span> <span class="toc-text">4.路由和页面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%A1%B5%E9%9D%A2%E6%95%B4%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text">路由页面整理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9D%97%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA"><span class="toc-number">5.2.</span> <span class="toc-text">业务模块页面的快速搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%A8%A1%E5%9D%97%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%92%8C%E8%B7%AF%E7%94%B1%E6%96%87%E4%BB%B6"><span class="toc-number">5.2.1.</span> <span class="toc-text">新建模块的页面和路由文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%AF%8F%E4%B8%AA%E6%A8%A1%E5%9D%97%E7%9A%84%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"><span class="toc-number">5.2.2.</span> <span class="toc-text">设置每个模块的路由规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E5%92%8C%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E4%B8%B4%E6%97%B6%E5%90%88%E5%B9%B6%EF%BC%8C%E5%BD%A2%E6%88%90%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95"><span class="toc-number">5.3.</span> <span class="toc-text">静态路由和动态路由临时合并，形成左侧菜单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E7%9A%84%E6%98%BE%E7%A4%BA%E9%80%BB%E8%BE%91%EF%BC%8C%E8%AE%BE%E7%BD%AE%E8%8F%9C%E5%8D%95%E5%9B%BE%E6%A0%87"><span class="toc-number">5.4.</span> <span class="toc-text">左侧菜单的显示逻辑，设置菜单图标</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84"><span class="toc-number">6.</span> <span class="toc-text">5.组织结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E5%B8%83%E5%B1%80"><span class="toc-number">6.1.</span> <span class="toc-text">组织架构树形结构布局</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84"><span class="toc-number">6.1.1.</span> <span class="toc-text">认识组织架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%E7%9A%84%E5%A4%B4%E9%83%A8%E5%86%85%E5%AE%B9"><span class="toc-number">6.1.2.</span> <span class="toc-text">实现组织架构的头部内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E5%BD%A2%E7%BB%84%E4%BB%B6%E8%AE%A4%E8%AF%86"><span class="toc-number">6.1.3.</span> <span class="toc-text">树形组件认识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%A0%91%E5%BD%A2%E7%9A%84%E9%9D%99%E6%80%81%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84"><span class="toc-number">6.1.4.</span> <span class="toc-text">实现树形的静态组织架构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E6%A0%91%E5%BD%A2%E7%9A%84%E6%93%8D%E4%BD%9C%E5%86%85%E5%AE%B9%E5%8D%95%E7%8B%AC%E6%8A%BD%E6%8F%90%E6%88%90%E7%BB%84%E4%BB%B6"><span class="toc-number">6.2.</span> <span class="toc-text">将树形的操作内容单独抽提成组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%8D%95%E7%8B%AC%E7%9A%84%E6%A0%91%E6%93%8D%E4%BD%9C%E6%A0%8F%E7%BB%84%E4%BB%B6"><span class="toc-number">6.2.1.</span> <span class="toc-text">封装单独的树操作栏组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%E4%B8%AD%E5%BA%94%E7%94%A8%E6%93%8D%E4%BD%9C%E6%A0%8F%E7%BB%84%E4%BB%B6"><span class="toc-number">6.2.2.</span> <span class="toc-text">在组织架构中应用操作栏组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%A0%91%E5%BD%A2%E5%A4%84%E7%90%86"><span class="toc-number">6.3.</span> <span class="toc-text">获取组织架构数据，并进行树形处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85API%E6%8E%A5%E5%8F%A3%EF%BC%8C%E8%8E%B7%E5%8F%96%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%E6%95%B0%E6%8D%AE"><span class="toc-number">6.3.1.</span> <span class="toc-text">封装API接口，获取组织架构数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%95%B0%E7%BB%84%E6%95%B0%E6%8D%AE%E8%BD%AC%E5%8C%96%E6%88%90%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84"><span class="toc-number">6.3.2.</span> <span class="toc-text">将数组数据转化成树形结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%83%A8%E9%97%A8%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.4.</span> <span class="toc-text">删除部门功能实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%88%A0%E9%99%A4%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%B3%A8%E5%86%8C%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95%E4%BA%8B%E4%BB%B6"><span class="toc-number">6.4.1.</span> <span class="toc-text">封装删除接口，注册下拉菜单事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%88%A0%E9%99%A4%E6%8E%A5%E5%8F%A3%EF%BC%8C%E9%80%9A%E7%9F%A5%E7%88%B6%E7%BB%84%E4%BB%B6%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">6.4.2.</span> <span class="toc-text">调用删除接口，通知父组件更新数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E9%83%A8%E9%97%A8%E5%8A%9F%E8%83%BD-%E5%BB%BA%E7%AB%8B%E7%BB%84%E4%BB%B6"><span class="toc-number">6.5.</span> <span class="toc-text">新增部门功能-建立组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%96%B0%E5%A2%9E%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%96%B0%E5%BB%BA%E7%BB%84%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%BC%B9%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-number">6.5.1.</span> <span class="toc-text">封装新增接口，新建组件中的弹层结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E6%96%B0%E5%A2%9E%E5%AD%90%E9%83%A8%E9%97%A8%E6%98%BE%E7%A4%BA%E5%BC%B9%E5%B1%82%E7%BB%84%E4%BB%B6"><span class="toc-number">6.5.2.</span> <span class="toc-text">点击新增子部门显示弹层组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E6%96%B0%E5%A2%9E%E9%83%A8%E9%97%A8%E7%9A%84%E8%A7%84%E5%88%99%E6%A0%A1%E9%AA%8C"><span class="toc-number">6.6.</span> <span class="toc-text">完成新增部门的规则校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E6%96%B0%E5%A2%9E%E8%A1%A8%E5%8D%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A0%A1%E9%AA%8C%E6%9D%A1%E4%BB%B6"><span class="toc-number">6.6.1.</span> <span class="toc-text">完成新增表单的基本校验条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B0%E5%A2%9E%E8%A1%A8%E5%8D%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99"><span class="toc-number">6.6.2.</span> <span class="toc-text">配置新增表单的基本校验规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E9%97%A8%E5%90%8D%E7%A7%B0%E5%92%8C%E9%83%A8%E9%97%A8%E7%BC%96%E7%A0%81%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C"><span class="toc-number">6.6.3.</span> <span class="toc-text">部门名称和部门编码的自定义校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%A6%96%E9%83%A8%E5%86%85%E5%AE%B9%E7%9A%84pid%E6%95%B0%E6%8D%AE"><span class="toc-number">6.6.4.</span> <span class="toc-text">处理首部内容的pid数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E9%83%A8%E9%97%A8%E5%8A%9F%E8%83%BD-%E9%83%A8%E9%97%A8%E8%B4%9F%E8%B4%A3%E4%BA%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">6.7.</span> <span class="toc-text">新增部门功能-部门负责人数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD-%E6%8F%90%E4%BA%A4-%E5%8F%96%E6%B6%88-%E5%85%B3%E9%97%AD"><span class="toc-number">6.8.</span> <span class="toc-text">新增功能-提交-取消-关闭</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E9%80%9A%E8%BF%87%EF%BC%8C%E8%B0%83%E7%94%A8%E6%96%B0%E5%A2%9E%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.8.1.</span> <span class="toc-text">校验通过，调用新增接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8sync%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%85%B3%E9%97%AD%E6%96%B0%E5%A2%9E%E5%BC%B9%E5%B1%82"><span class="toc-number">6.8.2.</span> <span class="toc-text">利用sync修饰符关闭新增弹层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E6%97%B6%E9%87%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%92%8C%E6%A0%A1%E9%AA%8C"><span class="toc-number">6.8.3.</span> <span class="toc-text">取消时重置数据和校验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E9%83%A8%E9%97%A8%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%9B%9E%E5%86%99"><span class="toc-number">6.9.</span> <span class="toc-text">编辑部门功能实现数据回写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E7%BC%96%E8%BE%91%E5%BC%B9%E5%87%BA%E5%B1%82%EF%BC%8C%E8%AE%B0%E5%BD%95%E5%BD%93%E5%89%8D%E8%8A%82%E7%82%B9"><span class="toc-number">6.9.1.</span> <span class="toc-text">点击编辑弹出层，记录当前节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E7%BB%84%E4%BB%B6%E8%B0%83%E7%94%A8%E5%AD%90%E7%BB%84%E4%BB%B6%E7%9A%84%E8%8E%B7%E5%8F%96%E8%AF%A6%E6%83%85%E6%96%B9%E6%B3%95"><span class="toc-number">6.9.2.</span> <span class="toc-text">父组件调用子组件的获取详情方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E6%98%BE%E7%A4%BA%E6%8E%A7%E5%88%B6%E6%A0%87%E9%A2%98"><span class="toc-number">6.9.3.</span> <span class="toc-text">根据计算属性显示控制标题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%97%B6%E6%94%AF%E6%8C%81%E7%BC%96%E8%BE%91%E5%92%8C%E6%96%B0%E5%A2%9E%E5%9C%BA%E6%99%AF"><span class="toc-number">6.10.</span> <span class="toc-text">同时支持编辑和新增场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%BC%96%E8%BE%91%E6%8E%A5%E5%8F%A3%EF%BC%8C%E4%BF%9D%E5%AD%98%E5%8C%BA%E5%88%86%E5%9C%BA%E6%99%AF"><span class="toc-number">6.10.1.</span> <span class="toc-text">封装编辑接口，保存区分场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99%E6%94%AF%E6%8C%81%E7%BC%96%E8%BE%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E6%A0%A1%E9%AA%8C"><span class="toc-number">6.10.2.</span> <span class="toc-text">校验规则支持编辑场景下的校验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%99%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E6%B7%BB%E5%8A%A0%E5%8A%A0%E8%BD%BD%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="toc-number">6.11.</span> <span class="toc-text">给数据获取添加加载进度条</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%85%AC%E5%8F%B8%E5%92%8C%E8%A7%92%E8%89%B2"><span class="toc-number">7.</span> <span class="toc-text">6.公司和角色</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E5%85%AC%E5%8F%B8%E8%A7%92%E8%89%B2%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">7.1.</span> <span class="toc-text">建立公司角色页面的基本结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%85%AC%E5%8F%B8%E8%A7%92%E8%89%B2%E4%BF%A1%E6%81%AF"><span class="toc-number">7.2.</span> <span class="toc-text">读取公司角色信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E8%A7%92%E8%89%B2%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">7.2.1.</span> <span class="toc-text">读取角色列表数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%85%AC%E5%8F%B8%E4%BF%A1%E6%81%AF%E6%95%B0%E6%8D%AE"><span class="toc-number">7.2.2.</span> <span class="toc-text">读取公司信息数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD"><span class="toc-number">7.3.</span> <span class="toc-text">删除角色功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD"><span class="toc-number">7.4.</span> <span class="toc-text">编辑角色功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%BC%96%E8%BE%91%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%96%B0%E5%BB%BA%E7%BC%96%E8%BE%91%E5%BC%B9%E5%B1%82"><span class="toc-number">7.4.1.</span> <span class="toc-text">封装编辑接口，新建编辑弹层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD%EF%BC%8C%E4%B8%BA%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD%E7%95%99%E5%8F%A3"><span class="toc-number">7.4.2.</span> <span class="toc-text">实现编辑功能，为新增功能留口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD"><span class="toc-number">7.5.</span> <span class="toc-text">新增角色功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">7.6.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">7.员工管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E9%80%9A%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E6%A0%8F"><span class="toc-number">8.1.</span> <span class="toc-text">封装一个通用的工具栏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%B7%A5%E5%85%B7%E6%A0%8F%E7%9A%84%E7%BB%84%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">8.1.1.</span> <span class="toc-text">通用工具栏的组件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%BB%9F%E4%B8%80%E6%B3%A8%E5%86%8C"><span class="toc-number">8.1.2.</span> <span class="toc-text">组件统一注册</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B8%83%E5%B1%80%E5%92%8C%E7%BB%93%E6%9E%84"><span class="toc-number">8.2.</span> <span class="toc-text">员工列表页面的基本布局和结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E5%92%8C%E5%88%86%E9%A1%B5%E5%8A%A0%E8%BD%BD"><span class="toc-number">8.3.</span> <span class="toc-text">员工列表数据请求和分页加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%88%97%E8%A1%A8%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">8.4.</span> <span class="toc-text">员工列表中的数据进行格式化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%88%97%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B1%9E%E6%80%A7%E5%A4%84%E7%90%86%E8%81%98%E7%94%A8%E5%BD%A2%E5%BC%8F"><span class="toc-number">8.4.1.</span> <span class="toc-text">利用列格式化属性处理聘用形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E8%A7%A3%E5%86%B3%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">8.4.2.</span> <span class="toc-text">过滤器解决时间格式的处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%91%98%E5%B7%A5%E5%8A%9F%E8%83%BD"><span class="toc-number">8.5.</span> <span class="toc-text">删除员工功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5%E5%8A%9F%E8%83%BD-%E5%BC%B9%E5%B1%82-%E6%A0%A1%E9%AA%8C-%E9%83%A8%E9%97%A8"><span class="toc-number">8.6.</span> <span class="toc-text">新增员工功能-弹层-校验-部门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E5%91%98%E5%B7%A5%E5%BC%B9%E5%B1%82%E7%BB%84%E4%BB%B6"><span class="toc-number">8.6.1.</span> <span class="toc-text">新建员工弹层组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E5%BC%B9%E5%87%BA%E5%B1%82%EF%BC%8C%E7%82%B9%E5%87%BB%E5%BC%B9%E5%87%BA"><span class="toc-number">8.6.2.</span> <span class="toc-text">引用弹出层，点击弹出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5%E7%9A%84%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-number">8.6.3.</span> <span class="toc-text">新增员工的表单校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E9%83%A8%E9%97%A8%E6%95%B0%E6%8D%AE%E8%BD%AC%E5%8C%96%E6%A0%91%E5%BD%A2"><span class="toc-number">8.6.4.</span> <span class="toc-text">加载部门数据转化树形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E9%83%A8%E9%97%A8%E8%B5%8B%E5%80%BC%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">8.6.5.</span> <span class="toc-text">点击部门赋值表单数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5%E5%8A%9F%E8%83%BD-%E7%A1%AE%E5%AE%9A-%E5%8F%96%E6%B6%88"><span class="toc-number">8.7.</span> <span class="toc-text">新增员工功能-确定-取消</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%AF%BC%E5%85%A5%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">8.8.</span> <span class="toc-text">员工导入组件封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%9A%84%E5%AF%BC%E5%85%A5"><span class="toc-number">8.9.</span> <span class="toc-text">员工的导入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E5%85%AC%E5%85%B1%E5%AF%BC%E5%85%A5%E7%9A%84%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1"><span class="toc-number">8.9.1.</span> <span class="toc-text">建立公共导入的页面路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90excel%E5%AF%BC%E5%85%A5%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%B0%81%E8%A3%85%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.9.2.</span> <span class="toc-text">分析excel导入代码，封装接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0excel%E5%AF%BC%E5%85%A5"><span class="toc-number">8.9.3.</span> <span class="toc-text">实现excel导入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%AF%BC%E5%87%BAexcel%E5%8A%9F%E8%83%BD"><span class="toc-number">8.10.</span> <span class="toc-text">员工导出excel功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85excel%E6%89%80%E9%9C%80%E4%BE%9D%E8%B5%96%E5%92%8C%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD"><span class="toc-number">8.10.1.</span> <span class="toc-text">安装excel所需依赖和按需加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#excel%E5%AF%BC%E5%87%BA%E5%8F%82%E6%95%B0%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">8.10.2.</span> <span class="toc-text">excel导出参数的介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#excel%E5%AF%BC%E5%87%BA%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">8.10.3.</span> <span class="toc-text">excel导出基本的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">8.10.4.</span> <span class="toc-text">导出时间格式的处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-%E5%A4%8D%E6%9D%82%E8%A1%A8%E5%A4%B4%E7%9A%84%E5%AF%BC%E5%87%BA"><span class="toc-number">8.10.5.</span> <span class="toc-text">扩展  复杂表头的导出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E8%AF%A6%E6%83%85%E9%A1%B5%E5%88%9B%E5%BB%BA%E5%92%8C%E5%B8%83%E5%B1%80"><span class="toc-number">8.11.</span> <span class="toc-text">员工详情页创建和布局</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E6%83%85%E9%A1%B5%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B8%83%E5%B1%80%E5%92%8C%E8%B7%AF%E7%94%B1"><span class="toc-number">8.11.1.</span> <span class="toc-text">详情页的基本布局和路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%92%8C%E4%BF%9D%E5%AD%98%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.11.2.</span> <span class="toc-text">读取和保存用户信息的接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">8.11.3.</span> <span class="toc-text">实现用户名和密码的修改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E7%BB%84%E4%BB%B6%E5%92%8C%E5%B2%97%E4%BD%8D%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">8.12.</span> <span class="toc-text">个人组件和岗位组件封装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E4%B8%AA%E4%BA%BA%E8%AF%A6%E6%83%85%E7%BB%84%E4%BB%B6"><span class="toc-number">8.12.1.</span> <span class="toc-text">封装个人详情组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%B2%97%E4%BD%8D%E7%BB%84%E4%BB%B6"><span class="toc-number">8.12.2.</span> <span class="toc-text">封装岗位组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E5%92%8C%E5%B2%97%E4%BD%8D%E4%BF%A1%E6%81%AF-%E8%AF%BB%E5%8F%96-%E4%BF%9D%E5%AD%98"><span class="toc-number">8.13.</span> <span class="toc-text">员工个人信息和岗位信息-读取-保存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E4%B8%AA%E4%BA%BA%E4%BF%9D%E5%AD%98%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">8.13.1.</span> <span class="toc-text">读取个人保存个人信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E4%BF%9D%E5%AD%98%E5%B2%97%E4%BD%8D%E4%BF%A1%E6%81%AF"><span class="toc-number">8.13.2.</span> <span class="toc-text">读取保存岗位信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%85%BE%E8%AE%AF%E4%BA%91Cos"><span class="toc-number">8.14.</span> <span class="toc-text">配置腾讯云Cos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E7%BB%84%E4%BB%B6-%E4%B8%8A%E4%BC%A0%E7%BB%84%E4%BB%B6%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">8.15.</span> <span class="toc-text">封装上传图片组件-上传组件需求分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E4%B8%8A%E4%BC%A0%E7%BB%84%E4%BB%B6-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.16.</span> <span class="toc-text">封装上传组件-代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%BB%84%E4%BB%B6"><span class="toc-number">8.16.1.</span> <span class="toc-text">新建文件上传组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E5%9B%BE%E7%89%87%E8%BF%9B%E8%A1%8C%E9%A2%84%E8%A7%88"><span class="toc-number">8.16.2.</span> <span class="toc-text">点击图片进行预览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E4%B8%8A%E4%BC%A0%E6%95%B0%E9%87%8F%E6%8E%A7%E5%88%B6%E4%B8%8A%E4%BC%A0%E6%8C%89%E9%92%AE"><span class="toc-number">8.16.3.</span> <span class="toc-text">根据上传数量控制上传按钮</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%9B%BE%E7%89%87%E5%92%8C%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87"><span class="toc-number">8.16.4.</span> <span class="toc-text">删除图片和添加图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E4%B9%8B%E5%89%8D%E6%A3%80%E6%9F%A5"><span class="toc-number">8.16.5.</span> <span class="toc-text">上传之前检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%8A%A8%E4%BD%9C%E8%B0%83%E7%94%A8%E4%B8%8A%E4%BC%A0%E8%85%BE%E8%AE%AF%E4%BA%91"><span class="toc-number">8.16.6.</span> <span class="toc-text">上传动作调用上传腾讯云</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E5%A4%84%E7%90%86%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE"><span class="toc-number">8.16.7.</span> <span class="toc-text">上传成功之后处理返回数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E7%9A%84%E8%BF%9B%E5%BA%A6%E6%9D%A1%E6%98%BE%E7%A4%BA"><span class="toc-number">8.16.8.</span> <span class="toc-text">上传的进度条显示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E5%91%98%E5%B7%A5%E8%AF%A6%E6%83%85%E4%B8%AD%E5%BA%94%E7%94%A8%E4%B8%8A%E4%BC%A0%E7%BB%84%E4%BB%B6"><span class="toc-number">8.17.</span> <span class="toc-text">在员工详情中应用上传组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%91%98%E5%B7%A5%E7%9A%84%E5%A4%B4%E5%83%8F%E5%92%8C%E8%AF%81%E4%BB%B6%E7%85%A7%E8%B5%8B%E5%80%BC%E7%BB%99%E4%B8%8A%E4%BC%A0%E7%BB%84%E4%BB%B6"><span class="toc-number">8.17.1.</span> <span class="toc-text">将员工的头像和证件照赋值给上传组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E6%97%B6%E5%A4%84%E7%90%86%E5%A4%B4%E5%83%8F%E5%92%8C%E8%AF%81%E4%BB%B6%E7%85%A7%E7%9A%84%E4%BF%9D%E5%AD%98"><span class="toc-number">8.17.2.</span> <span class="toc-text">保存时处理头像和证件照的保存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%88%97%E8%A1%A8%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87"><span class="toc-number">8.18.</span> <span class="toc-text">员工列表显示图片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E5%9C%B0%E5%9D%80%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81"><span class="toc-number">8.19.</span> <span class="toc-text">图片地址生成二维码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8D%B0%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">8.20.</span> <span class="toc-text">打印员工信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%89%93%E5%8D%B0%E9%A1%B5%E9%9D%A2%E5%8F%8A%E8%B7%AF%E7%94%B1"><span class="toc-number">8.20.1.</span> <span class="toc-text">新建打印页面及路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8vue-print-nb%E8%BF%9B%E8%A1%8C%E6%89%93%E5%8D%B0"><span class="toc-number">8.20.2.</span> <span class="toc-text">利用vue-print-nb进行打印</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E5%92%8C%E7%AE%A1%E7%90%86"><span class="toc-number">9.</span> <span class="toc-text">8.权限设计和管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1-RBAC%E7%9A%84%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3"><span class="toc-number">9.1.</span> <span class="toc-text">权限设计-RBAC的权限设计思想</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%99%E5%88%86%E9%85%8D%E5%91%98%E5%B7%A5%E8%A7%92%E8%89%B2"><span class="toc-number">9.2.</span> <span class="toc-text">给分配员工角色</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2%E7%AA%97%E4%BD%93"><span class="toc-number">9.2.1.</span> <span class="toc-text">新建分配角色窗体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A7%92%E8%89%B2%E5%88%97%E8%A1%A8%E5%92%8C%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2"><span class="toc-number">9.2.2.</span> <span class="toc-text">获取角色列表和当前用户角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%99%E5%91%98%E5%B7%A5%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2"><span class="toc-number">9.2.3.</span> <span class="toc-text">给员工分配角色</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%82%B9%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">9.3.</span> <span class="toc-text">权限点管理页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%9D%83%E9%99%90%E7%82%B9%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2"><span class="toc-number">9.3.1.</span> <span class="toc-text">新建权限点管理页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%9D%83%E9%99%90%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%BD%AC%E5%8C%96%E6%A0%91%E5%BD%A2"><span class="toc-number">9.3.2.</span> <span class="toc-text">获取权限数据并转化树形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E7%BC%96%E8%BE%91%E6%9D%83%E9%99%90%E7%9A%84%E5%BC%B9%E5%B1%82"><span class="toc-number">9.3.3.</span> <span class="toc-text">新增编辑权限的弹层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%EF%BC%8C%E7%BC%96%E8%BE%91%EF%BC%8C%E5%88%A0%E9%99%A4%E6%9D%83%E9%99%90%E7%82%B9"><span class="toc-number">9.3.4.</span> <span class="toc-text">新增，编辑，删除权限点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%99%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90"><span class="toc-number">9.4.</span> <span class="toc-text">给角色分配权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90%E5%BC%B9%E5%87%BA%E5%B1%82"><span class="toc-number">9.4.1.</span> <span class="toc-text">新建分配权限弹出层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%99%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90-1"><span class="toc-number">9.4.2.</span> <span class="toc-text">给角色分配权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%9D%83%E9%99%90%E5%BA%94%E7%94%A8-%E9%A1%B5%E9%9D%A2%E8%AE%BF%E9%97%AE%E5%92%8C%E8%8F%9C%E5%8D%95"><span class="toc-number">9.5.</span> <span class="toc-text">前端权限应用-页面访问和菜单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E5%8F%97%E6%8E%A7%E7%9A%84%E4%B8%BB%E4%BD%93%E6%80%9D%E8%B7%AF"><span class="toc-number">9.5.1.</span> <span class="toc-text">权限受控的主体思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BAVuex%E4%B8%AD%E7%AE%A1%E7%90%86%E6%9D%83%E9%99%90%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="toc-number">9.5.2.</span> <span class="toc-text">新建Vuex中管理权限的模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vuex%E7%AD%9B%E9%80%89%E6%9D%83%E9%99%90%E8%B7%AF%E7%94%B1"><span class="toc-number">9.5.3.</span> <span class="toc-text">Vuex筛选权限路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8B%A6%E6%88%AA%E5%87%BA%E8%B0%83%E7%94%A8%E7%AD%9B%E9%80%89%E6%9D%83%E9%99%90Action"><span class="toc-number">9.5.4.</span> <span class="toc-text">权限拦截出调用筛选权限Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E8%A7%A3%E9%99%A4%E5%90%88%E5%B9%B6"><span class="toc-number">9.5.5.</span> <span class="toc-text">静态路由动态路由解除合并</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%87%BA%E6%97%B6%EF%BC%8C%E9%87%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E6%9D%83%E9%99%90%E5%92%8C-404%E9%97%AE%E9%A2%98"><span class="toc-number">9.6.</span> <span class="toc-text">登出时，重置路由权限和 404问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%9D%83%E9%99%90%E5%BA%94%E7%94%A8"><span class="toc-number">9.7.</span> <span class="toc-text">功能权限应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%9D%83%E9%99%90%E7%9A%84%E5%8F%97%E6%8E%A7%E6%80%9D%E8%B7%AF"><span class="toc-number">9.7.1.</span> <span class="toc-text">功能权限的受控思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Mixin%E6%8A%80%E6%9C%AF%E5%B0%86%E6%A3%80%E6%9F%A5%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-number">9.7.2.</span> <span class="toc-text">使用Mixin技术将检查方法注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97%E9%9B%86%E6%88%90"><span class="toc-number">10.</span> <span class="toc-text">9.其他模块集成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E6%A8%A1%E5%9D%97%E9%9B%86%E6%88%90"><span class="toc-number">10.1.</span> <span class="toc-text">全模块集成</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E4%B8%BB%E9%A1%B5%E5%AE%A1%E6%89%B9"><span class="toc-number">11.</span> <span class="toc-text">10.主页审批</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E7%9A%84%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84"><span class="toc-number">11.1.</span> <span class="toc-text">首页的页面结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E7%94%A8%E6%88%B7%E8%B5%84%E6%96%99%E6%98%BE%E7%A4%BA"><span class="toc-number">11.2.</span> <span class="toc-text">首页用户资料显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-number">11.3.</span> <span class="toc-text">工作日历组件封装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">11.3.1.</span> <span class="toc-text">新建工作日历组件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%8E%86%E9%80%BB%E8%BE%91"><span class="toc-number">11.3.2.</span> <span class="toc-text">实现工作日历逻辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E9%9B%B7%E8%BE%BE%E5%9B%BE%E5%9B%BE%E8%A1%A8%E6%98%BE%E7%A4%BA%E5%9C%A8%E9%A6%96%E9%A1%B5"><span class="toc-number">11.4.</span> <span class="toc-text">封装雷达图图表显示在首页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E9%9B%B7%E8%BE%BE%E5%9B%BE"><span class="toc-number">11.4.1.</span> <span class="toc-text">了解雷达图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E9%9B%B7%E8%BE%BE%E5%9B%BE%E6%8F%92%E4%BB%B6"><span class="toc-number">11.4.2.</span> <span class="toc-text">封装雷达图插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A1%E6%89%B9%E6%B5%81%E7%A8%8B%E4%B8%9A%E5%8A%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.5.</span> <span class="toc-text">审批流程业务的基本介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E4%B8%80%E4%B8%AA%E7%A6%BB%E8%81%8C%E5%AE%A1%E6%89%B9"><span class="toc-number">11.6.</span> <span class="toc-text">提交一个离职审批</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E5%A4%9A%E8%AF%AD%E8%A8%80tab%E9%A1%B5%E9%9D%A2%E5%85%A8%E5%B1%8F%E4%B8%BB%E9%A2%98"><span class="toc-number">12.</span> <span class="toc-text">11.多语言tab页面全屏主题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E6%8F%92%E4%BB%B6%E7%9A%84%E5%BC%95%E7%94%A8"><span class="toc-number">12.1.</span> <span class="toc-text">全屏插件的引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%B8%BB%E9%A2%98%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="toc-number">12.2.</span> <span class="toc-text">动态主题的设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0"><span class="toc-number">12.3.</span> <span class="toc-text">多语言实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%A4%9A%E8%AF%AD%E8%A8%80%E5%8C%85"><span class="toc-number">12.3.1.</span> <span class="toc-text">初始化多语言包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80%E5%8C%85"><span class="toc-number">12.3.2.</span> <span class="toc-text">引入自定义语言包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E4%B8%AD%E5%BA%94%E7%94%A8%E5%A4%9A%E8%AF%AD%E8%A8%80%E5%8C%85"><span class="toc-number">12.3.3.</span> <span class="toc-text">在左侧菜单中应用多语言包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%A4%9A%E8%AF%AD%E8%A8%80%E6%8F%92%E4%BB%B6"><span class="toc-number">12.3.4.</span> <span class="toc-text">封装多语言插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tab%E9%A1%B5%E7%9A%84%E8%A7%86%E5%9B%BE%E5%BC%95%E5%85%A5"><span class="toc-number">12.4.</span> <span class="toc-text">tab页的视图引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E4%B9%8B%E5%89%8D%E7%9A%84%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.5.</span> <span class="toc-text">打包之前的路由模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%92%8CCDN%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">12.6.</span> <span class="toc-text">性能分析和CDN的应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">12.6.1.</span> <span class="toc-text">性能分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E6%8E%92%E9%99%A4%E6%89%93%E5%8C%85"><span class="toc-number">12.6.2.</span> <span class="toc-text">webpack排除打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CDN%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">12.6.3.</span> <span class="toc-text">CDN文件配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5CDN%E6%96%87%E4%BB%B6%E5%88%B0%E6%A8%A1%E6%9D%BF"><span class="toc-number">12.6.4.</span> <span class="toc-text">注入CDN文件到模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8nodejs%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%BA%94%E7%94%A8%E5%B9%B6%E4%BB%A3%E7%90%86%E8%B7%A8%E5%9F%9F"><span class="toc-number">12.7.</span> <span class="toc-text">在nodejs环境中应用并代理跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8koa%E6%A1%86%E6%9E%B6%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE"><span class="toc-number">12.7.1.</span> <span class="toc-text">使用koa框架部署项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3history%E9%A1%B5%E9%9D%A2%E8%AE%BF%E9%97%AE%E9%97%AE%E9%A2%98"><span class="toc-number">12.7.2.</span> <span class="toc-text">解决history页面访问问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">12.7.3.</span> <span class="toc-text">解决生产环境跨域问题</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/2021/07/02/vue%E5%BA%94%E7%94%A83%E2%80%94HR-saas%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F/image-20200711002545085.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Abigail Cui</div><div class="footer_custom_text">plain living and high thinking</div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                console.log('已挂载history_calendar')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax  src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script data-pjax>function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                console.log('已挂载electric_clock')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax  src="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body></html>